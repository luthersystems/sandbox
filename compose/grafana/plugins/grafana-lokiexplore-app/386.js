"use strict";(self.webpackChunkgrafana_lokiexplore_app=self.webpackChunkgrafana_lokiexplore_app||[]).push([[386],{7709:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(6089),a=n(2007),i=n(5959),s=n.n(i),l=n(3571);const o=e=>{const{isExcluded:t,isIncluded:n,onInclude:r,onExclude:i,onClear:o,titles:u,buttonFill:d,hideExclude:p}=e,g=(0,a.useStyles2)(c,n,t,p);return s().createElement("div",{className:g.container},s().createElement(a.Button,{variant:n?"primary":"secondary",fill:d,size:"sm","aria-selected":n,className:g.includeButton,onClick:n?o:r,"data-testid":l.b.exploreServiceDetails.buttonFilterInclude,title:null==u?void 0:u.include},"Include"),!p&&s().createElement(a.Button,{variant:t?"primary":"secondary",fill:d,size:"sm","aria-selected":t,className:g.excludeButton,onClick:t?o:i,title:null==u?void 0:u.exclude,"data-testid":l.b.exploreServiceDetails.buttonFilterExclude},"Exclude"))},c=(e,t,n,a)=>({container:(0,r.css)({display:"flex",justifyContent:"center"}),includeButton:(0,r.css)({borderRadius:0,borderRight:t||a?void 0:"none"}),excludeButton:(0,r.css)({borderRadius:`0 ${e.shape.radius.default} ${e.shape.radius.default} 0`,borderLeft:n?void 0:"none"})})},7191:(e,t,n)=>{n.d(t,{R:()=>l});var r=n(5959),a=n.n(r),i=n(6089),s=n(2007);const l=({children:e})=>{const t=(0,s.useStyles2)(o);return a().createElement("div",{className:t.wrap},a().createElement(s.EmptyState,{variant:"not-found",message:e?"":"An error occurred"},e&&e))},o=e=>({wrap:(0,i.css)({margin:"0 auto"})})},2661:(e,t,n)=>{n.d(t,{P:()=>nt,y:()=>tt});var r=n(5959),a=n.n(r),i=n(7781),s=n(9736),l=n(20),o=n(4351),c=n(7352),u=n(2007),d=n(6089);function p(e){const t=(0,u.useStyles2)(g);return a().createElement(a().Fragment,null,a().createElement(u.Alert,{className:t.alert,severity:"info",title:"Welcome to Grafana Logs Drilldown!",onRemove:e.onRemove},a().createElement("div",null,"Check out our"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://grafana.com/docs/grafana-cloud/visualizations/simplified-exploration/logs/",rel:"noreferrer"},"Get started doc"),", or see"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/releases",rel:"noreferrer"},"recent changes"),".",a().createElement("br",null),"Help us shape the future of the app."," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://forms.gle/1sYWCTPvD72T1dPH9",rel:"noreferrer"},"Send us feedback")," ","or engage with us on"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/?tab=readme-ov-file#explore-logs",rel:"noreferrer"},"GitHub"),".")))}function g(e){return{alert:(0,d.css)({flex:"none"})}}var h=n(9598),f=n(5953),v=n(1459);const m=()=>{const e=(0,u.useStyles2)(b);return a().createElement("div",{className:e.wrapper},a().createElement("a",{href:"https://forms.gle/1sYWCTPvD72T1dPH9",className:e.feedback,title:"Share your thoughts about Logs in Grafana.",target:"_blank",rel:"noreferrer noopener"},a().createElement(u.Icon,{name:"comment-alt-message"})," Give feedback"))},b=e=>({wrapper:(0,d.css)({display:"flex",marginLeft:"auto",gap:e.spacing(1),position:"relative",top:e.spacing(-1)}),feedback:(0,d.css)({alignSelf:"center",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.link}})});class y extends s.Bs{}var S,w,O;O=function({model:e}){var t,n;const r=s.jh.getVariables(e).useState();let i=r.variables;return(null===(t=e.state.include)||void 0===t?void 0:t.length)&&(i=r.variables.filter((t=>{var n,r;return null===(n=e.state.include)||void 0===n?void 0:n.includes(null!==(r=t.state.name)&&void 0!==r?r:"")}))),(null===(n=e.state.exclude)||void 0===n?void 0:n.length)&&(i=r.variables.filter((t=>{var n,r;return!(null===(n=e.state.exclude)||void 0===n?void 0:n.includes(null!==(r=t.state.name)&&void 0!==r?r:""))}))),a().createElement(a().Fragment,null,i.map((t=>a().createElement(s.Lp,{key:t.state.key,variable:t,layout:e.state.layout}))))},(w="Component")in(S=y)?Object.defineProperty(S,w,{value:O,enumerable:!0,configurable:!0,writable:!0}):S[w]=O;var x=n(3571);const E=({onRemove:e,pattern:t,size:n="lg"})=>{const i=(0,u.useStyles2)(k),[s,l]=(0,r.useState)(!1);return a().createElement("div",{className:i.pattern,onClick:()=>l(!s),onMouseLeave:()=>l(!1)},a().createElement(u.Tag,{title:t,key:t,name:s?t:P(t,n),className:i.tag}),a().createElement(u.Button,{"aria-label":"Remove pattern","data-testid":x.b.exploreServiceDetails.buttonRemovePattern,variant:"secondary",size:"sm",className:i.removeButton,onClick:e},a().createElement(u.Icon,{name:"times"})))},C={sm:50,lg:Math.round(window.innerWidth/8)};function P(e,t){const n=e.length;if(n<C[t])return e;const r=Math.round(.4*C[t]);return`${e.substring(0,r)} â€¦ ${e.substring(n-r)}`}const k=e=>({pattern:(0,d.css)({display:"flex",fontFamily:"monospace",gap:e.spacing(.25),cursor:"pointer",overflow:"hidden"}),tag:(0,d.css)({borderTopRightRadius:0,borderBottomRightRadius:0,backgroundColor:e.colors.secondary.main,border:`solid 1px ${e.colors.secondary.border}`,color:e.colors.secondary.text,boxSizing:"border-box",padding:e.spacing(.25,.75),overflow:"hidden",textOverflow:"ellipsis"}),removeButton:(0,d.css)({paddingLeft:2.5,paddingRight:2.5})});var j=n(4509),F=n(7478);const L=({patterns:e,onRemove:t})=>{const n=(0,u.useStyles2)(_);if(!e||0===e.length)return null;const r=e.filter((e=>"include"===e.type)),i=e.filter((e=>"include"!==e.type)),s=n=>{(0,F.bN)(),t(e.filter((e=>e!==n))),(0,j.EE)(j.NO.service_details,j.ir.service_details.pattern_removed,{includePatternsLength:r.length-("include"===(null==n?void 0:n.type)?1:0),excludePatternsLength:i.length-("include"!==(null==n?void 0:n.type)?1:0),type:n.type})};return a().createElement("div",null,r.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(u.Text,{variant:"bodySmall",weight:"bold","data-testid":x.b.patterns.buttonIncludedPattern},"Included pattern",e.length>1?"s":""),a().createElement("div",{className:n.patterns},r.map((e=>a().createElement(E,{key:e.pattern,pattern:e.pattern,size:"lg",onRemove:()=>s(e)}))))),i.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(u.Text,{variant:"bodySmall",weight:"bold","data-testid":x.b.patterns.buttonExcludedPattern},"Excluded pattern",i.length>1?"s":"",":"),a().createElement("div",{className:n.patterns},i.map((e=>a().createElement(E,{key:e.pattern,pattern:e.pattern,size:i.length>1?"sm":"lg",onRemove:()=>s(e)}))))))};function _(e){return{patternsContainer:(0,d.css)({overflow:"hidden"}),patterns:(0,d.css)({display:"flex",gap:e.spacing(1),alignItems:"center",flexWrap:"wrap"})}}class T extends s.Bs{}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(T,"Component",(({model:e})=>{const t=s.jh.getAncestor(e,nt),{controls:n,patterns:r}=t.useState(),i=s.jh.getAncestor(e,V),{lineFilterRenderer:l,levelsRenderer:o}=i.useState(),c=(0,u.useStyles2)((t=>function(e){return{firstRowWrapper:(0,d.css)({"& > div > div":{gap:"16px",label:"first-row-wrapper",[e.breakpoints.down("lg")]:{flexDirection:"column"}}}),controlsFirstRowContainer:(0,d.css)({label:"controls-first-row",display:"flex",gap:e.spacing(2),justifyContent:"space-between",alignItems:"flex-start",[e.breakpoints.down("md")]:{flexDirection:"column-reverse"}}),controlsRowContainer:(0,d.css)({"&:empty":{display:"none"},label:"controls-row",display:"flex",gap:e.spacing(2),alignItems:"flex-start",[e.breakpoints.down("lg")]:{flexDirection:"column"}}),stickyControlsContainer:(0,d.css)({position:"sticky",top:D,left:0,background:e.colors.background.canvas,zIndex:e.zIndex.navbarFixed,gap:e.spacing(0),boxShadow:e.shadows.z1}),controlsContainer:(0,d.css)({label:"controlsContainer",display:"flex",flexDirection:"column",gap:e.spacing(1),padding:e.spacing(2)}),filters:(0,d.css)({label:"filters",display:"flex"}),filtersWrap:(0,d.css)({label:"filtersWrap",display:"flex",gap:e.spacing(2),width:"calc(100% - 450)",flexWrap:"wrap",alignItems:"flex-end"}),controlsWrapper:(0,d.css)({label:"controlsWrapper",display:"flex",flexDirection:"column",marginTop:e.spacing(.375)}),timeRangeDatasource:(0,d.css)({label:"timeRangeDatasource",display:"flex",gap:e.spacing(1),flexWrap:"wrap",justifyContent:"flex-end"}),timeRange:(0,d.css)({label:"timeRange",display:"flex",flexDirection:"row",gap:e.spacing(1)})}}(t,e.state.position)));return a().createElement("div",{className:(0,d.cx)(c.controlsContainer,"sticky"===e.state.position?c.stickyControlsContainer:void 0)},a().createElement(a().Fragment,null,n&&a().createElement("div",{className:c.controlsFirstRowContainer},a().createElement("div",{className:c.filtersWrap},a().createElement("div",{className:(0,d.cx)(c.filters,c.firstRowWrapper)},n.map((e=>e instanceof s.G1?a().createElement(e.Component,{key:e.state.key,model:e}):null)))),a().createElement("div",{className:c.controlsWrapper},a().createElement(m,null),a().createElement("div",{className:c.timeRangeDatasource},n.map((e=>e.state.key===R?a().createElement(e.Component,{key:e.state.key,model:e}):null)),a().createElement("div",{className:c.timeRange},n.map((e=>e instanceof y||e instanceof s.G1?null:a().createElement(e.Component,{key:e.state.key,model:e}))))))),a().createElement("div",{className:c.controlsRowContainer},o&&a().createElement(o.Component,{model:o}),n&&a().createElement("div",{className:c.filtersWrap},a().createElement("div",{className:c.filters},n.map((e=>e instanceof y&&e.state.key===M?a().createElement(e.Component,{key:e.state.key,model:e}):null))))),a().createElement("div",{className:c.controlsRowContainer},a().createElement(L,{patterns:r,onRemove:e=>t.setState({patterns:e})})),a().createElement("div",{className:c.controlsRowContainer},l&&a().createElement(l.Component,{model:l}))))}));const D=40;var N=n(2085),$=n(9683);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const A=`${h.s_}.interceptBannerStorageKey`,M="vars-fields-metadata",R="vars-ds";class V extends s.Bs{onActivate(){const e=(0,$.FT)();this.setState({lineFilterRenderer:new v.Y({}),levelsRenderer:new N.qV({}),variableLayout:new T({position:e===$.G3.explore?"sticky":"relative"})})}dismiss(){this.setState({interceptDismissed:!0}),localStorage.setItem(A,"true")}constructor(e){super(B(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){I(e,t,n[t])}))}return e}({},e),{interceptDismissed:!!localStorage.getItem(A)})),this.addActivationHandler(this.onActivate.bind(this))}}function W(e){return{bodyContainer:(0,d.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),container:(0,d.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column",maxWidth:"100vw"}),body:(0,d.css)({label:"body-wrapper",flexGrow:1,display:"flex",flexDirection:"column",gap:e.spacing(1),padding:`0 ${e.spacing(2)} ${e.spacing(2)}`}),controlsContainer:(0,d.css)({label:"controlsContainer",display:"flex",flexDirection:"column",gap:e.spacing(1)})}}I(V,"Component",(({model:e})=>{const t=s.jh.getAncestor(e,nt),{contentScene:n}=t.useState(),{interceptDismissed:r,variableLayout:i}=e.useState();if(!n)return f.v.warn("content scene not defined"),null;const l=(0,u.useStyles2)(W);return a().createElement("div",{className:l.bodyContainer},a().createElement("div",{className:l.container},!r&&a().createElement(p,{onRemove:()=>{e.dismiss()}}),i&&a().createElement(i.Component,{model:i}),a().createElement("div",{className:l.body},n&&a().createElement(n.Component,{model:n}))))}));var z=n(173),H=n(8531),Q=n(7985),K=n(2245),G=n(4702),U=n(5553),q=n(9731),J=n(6991),Y=n(6709),X=n(5719),Z=n(3241),ee=n(6854),te=n(6464),ne=n(708);function re(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function ae(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){re(i,r,a,s,l,"next",e)}function l(e){re(i,r,a,s,l,"throw",e)}s(void 0)}))}}const ie=function(){var e=ae((function*(e,t,n,r,a,i){const s=yield(0,H.getDataSourceSrv)().get((0,X.U4)(r));if(!(s instanceof H.DataSourceWithBackend))throw f.v.error(new Error("getTagValuesProvider: Invalid datasource!")),new Error("Invalid datasource!");const o=s.languageProvider;let c=[];if(o&&o.fetchDetectedLabelValues){const r={expr:n,limit:1e3,timeRange:a,throwError:!0},s={showErrorAlert:!1};try{let n=yield o.fetchDetectedLabelValues(e.key,r,s);if(n&&(0,Z.isArray)(n)){var u;if(i===l._Y)return{replace:!0,values:n.map((e=>({text:e})))};const r=t.state.filters;let a=[];r.forEach((e=>{var t,n;const r=null!==(n=null===(t=e.valueLabels)||void 0===t?void 0:t[0])&&void 0!==n?n:e.value;(0,ne.SM)(e.operator)?r.split("|").forEach((e=>a.push(e))):a.push(r)}));const s=n.filter((e=>!a.includes(e)));if("structuredMetadata"!==(null===(u=e.meta)||void 0===u?void 0:u.parser)){if(e.value){const t=(0,U.bu)(e,i);return{replace:!0,values:s.map((e=>({text:e,value:JSON.stringify({value:e,parser:t.parser})})))}}return{replace:!0,values:s.map((t=>{var n,r;return{text:t,value:JSON.stringify({value:t,parser:null!==(r=null===(n=e.meta)||void 0===n?void 0:n.parser)&&void 0!==r?r:"mixed"})}}))}}c=s.map((e=>({text:e})))}else c=[],f.v.error(n,{msg:"fetchDetectedLabelValues error!"})}catch(e){f.v.error(e,{msg:"getDetectedFieldValuesTagValuesProvider: loki missing detected_field/.../values endpoint. Upgrade to Loki 3.3.0 or higher."}),c=[]}}else f.v.warn("getDetectedFieldValuesTagValuesProvider: fetchDetectedLabelValues is not defined in Loki datasource. Upgrade to Grafana 11.4 or higher."),c=[];return{replace:!0,values:c}}));return function(t,n,r,a,i,s){return e.apply(this,arguments)}}();function se(e,t){return le.apply(this,arguments)}function le(){return le=ae((function*(e,t){const n=yield(0,H.getDataSourceSrv)().get((0,X.U4)(e));if(!(n instanceof H.DataSourceWithBackend))throw f.v.error(new Error("getTagValuesProvider: Invalid datasource!")),new Error("Invalid datasource!");const r=n;if(r&&r.getTagValues){const n=function(e,t){let n=e.filter((e=>!((0,ne.BG)(t.operator)&&e.key===t.key)));return n.some((e=>(0,ne.BG)(e.operator)))||(n=[]),n}(new te.K(e.state.filters).getJoinedLabelsFilters(),t),i={key:t.key,filters:n};let s=yield r.getTagValues(i);if((0,Z.isArray)(s)){var a;s=s.filter((n=>!e.state.filters.filter((e=>e.key===t.key)).some((e=>{if((0,ne.SM)(e.operator)){return e.value.split("|").some((e=>e===n.text))}return e.operator===ee.w7.Equal&&e.value===n.text}))));const n=(0,o.eT)(null===(a=(0,U.S9)(e).getValue())||void 0===a?void 0:a.toString(),t.key),r=new Set(n);n.length&&s.sort(((e,t)=>(r.has(t.text)?1:-1)-(r.has(e.text)?1:-1)))}return{replace:!0,values:s}}return f.v.error(new Error("getTagValuesProvider: missing or invalid datasource!")),{replace:!0,values:[]}})),le.apply(this,arguments)}var oe=n(8502);function ce(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function ue(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){ce(i,r,a,s,l,"next",e)}function l(e){ce(i,r,a,s,l,"throw",e)}s(void 0)}))}}function de(e){return pe.apply(this,arguments)}function pe(){return pe=ue((function*(e){const t=yield(0,H.getDataSourceSrv)().get((0,X.U4)(e));if(!(t instanceof H.DataSourceWithBackend))throw f.v.error(new Error("getTagKeysProvider: Invalid datasource!")),new Error("Invalid datasource!");const n=t;if(n&&n.getTagKeys){const t={filters:new te.K(e.state.filters).getJoinedLabelsFilters()},r=yield n.getTagKeys(t),a=(Array.isArray(r)?r:[]).filter((e=>!oe.rm.includes(e.text)));return{replace:!0,values:a}}return f.v.error(new Error("getTagKeysProvider: missing or invalid datasource!")),{replace:!0,values:[]}})),pe.apply(this,arguments)}function ge(e){return he.apply(this,arguments)}function he(){return he=ue((function*({limit:e,timeRange:t,scopedVars:n,expr:r,sceneRef:a,variableType:i}){const s=yield(0,H.getDataSourceSrv)().get((0,X.U4)(a));if(!(s instanceof H.DataSourceWithBackend))throw f.v.error(new Error("getTagKeysProvider: Invalid datasource!")),new Error("Invalid datasource!");const o=s,c=o.languageProvider,u={expr:r,timeRange:t,scopedVars:n,variableType:i,sceneRef:a,limit:e},d=o&&"function"==typeof c.fetchDetectedFields&&c.fetchDetectedFields.bind(c)||function(e){return function(e,t,n){return fe.apply(this,arguments)}(o,e)};if(d&&"function"==typeof d){const e=yield d(u);if(e instanceof Error)throw f.v.error(e,{msg:"Failed to fetch detected fields"}),e;const t=e.filter((e=>i===l._Y?e.label===l.e4:i===l.sL&&e.label!==l.e4||null!==e.parsers)).map((e=>{if(i===l.sL){var t;let n=1===(null===(t=e.parsers)||void 0===t?void 0:t.length)?e.parsers[0]:"mixed";null===e.parsers&&(n="structuredMetadata");const r=e.type;return{text:e.label,value:e.label,group:n,meta:{parser:n,type:r}}}return{text:e.label,value:e.label}}));return t.sort(((e,t)=>"structuredMetadata"===e.group&&"structuredMetadata"!==t.group?-1:"structuredMetadata"!==e.group&&"structuredMetadata"===t.group?1:0)),{replace:!0,values:t}}return f.v.error(new Error("getTagKeysProvider: missing or invalid datasource!")),{replace:!0,values:[]}})),he.apply(this,arguments)}function fe(){return fe=ue((function*(e,t,n){if(!("interpolateString"in e)||"function"!=typeof(null==e?void 0:e.interpolateString))throw new Error("Datasource missing interpolateString method");const r=t.expr&&"{}"!==t.expr?e.interpolateString(t.expr,t.scopedVars):void 0;if(!r)throw new Error("fetchDetectedFields requires query expression");var a;const s=null!==(a=null==t?void 0:t.timeRange)&&void 0!==a?a:(0,i.getDefaultTimeRange)(),l=e.getTimeRangeParams(s),{start:o,end:c}=l;var u;const d={start:o,end:c,limit:null!==(u=null==t?void 0:t.limit)&&void 0!==u?u:1e3};return d.query=r,new Promise(function(){var t=ue((function*(t,r){try{t((yield e.getResource("detected_fields",d,n)).fields)}catch(e){console.error("error",e),r(e)}}));return function(e,n){return t.apply(this,arguments)}}())})),fe.apply(this,arguments)}var ve=n(7796);function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let be={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},ye={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Se={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},we={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},Oe=null;for(let e=1;e<20;++e)be[111+e]="f"+e;for(let e=0;e<=9;++e)be[e+96]=e.toString();function xe(e){if("keypress"===e.type){let t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return be[e.which]?be[e.which]:ye[e.which]?ye[e.which]:String.fromCharCode(e.which).toLowerCase()}function Ee(e){return"shift"===e||"ctrl"===e||"alt"===e||"meta"===e}function Ce(e,t,n){return n||(n=function(){if(!Oe){Oe={};for(let e in be){const t=parseInt(e,10);t>95&&t<112||be.hasOwnProperty(e)&&(Oe[be[e]]=e)}}return Oe}()[e]?"keydown":"keypress"),"keypress"===n&&t.length&&(n="keydown"),n}function Pe(e,t){let n,r,a,i=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),a=0;a<n.length;++a)r=n[a],we[r]&&(r=we[r]),t&&"keypress"!==t&&Se[r]&&(r=Se[r],i.push("shift")),Ee(r)&&i.push(r);if(!r)throw new Error("Unable to get key");return{key:r,modifiers:i,action:t=Ce(r,i,t)}}function ke(e,t){return null!==e&&e!==document&&(e===t||ke(e.parentNode,t))}const je=new class{constructor(e){me(this,"target",void 0),me(this,"_callbacks",{}),me(this,"_directMap",{}),me(this,"_sequenceLevels",{}),me(this,"_resetTimer",void 0),me(this,"_ignoreNextKeyup",!1),me(this,"_ignoreNextKeypress",!1),me(this,"_nextExpectedAction",!1),me(this,"_globalCallbacks",{}),me(this,"_resetSequences",(e=>{e=e||{};let t,n=!1;for(t in this._sequenceLevels)e[t]?n=!0:this._sequenceLevels[t]=0;n||(this._nextExpectedAction=!1)})),me(this,"_getMatches",((e,t,n,r,a,i)=>{let s,l,o=[],c=n.type;if(!this._callbacks[e])return[];for("keyup"===c&&Ee(e)&&(t=[e]),s=0;s<this._callbacks[e].length;++s)if(l=this._callbacks[e][s],(r||!l.seq||this._sequenceLevels[l.seq]===l.level)&&c===l.action&&("keypress"===c&&!n.metaKey&&!n.ctrlKey||(u=t,d=l.modifiers,u.sort().join(",")===d.sort().join(",")))){let t=!r&&l.combo===a,n=r&&l.seq===r&&l.level===i;(t||n)&&this._callbacks[e].splice(s,1),o.push(l)}var u,d;return o})),me(this,"_fireCallback",((e,t,n,r)=>{const a=t.target||t.srcElement;var i;a&&a instanceof HTMLElement&&this.stopCallback(t,a,n,r)||!1===e(t,n)&&((i=t).preventDefault?i.preventDefault():i.returnValue=!1,function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(t))})),me(this,"_handleKey",((e,t,n)=>{let r,a=this._getMatches(e,t,n),i={},s=0,l=!1;for(r=0;r<a.length;++r){var o;if(a[r].seq)s=Math.max(s,null!==(o=a[r].level)&&void 0!==o?o:0)}for(r=0;r<a.length;++r){const t=a[r].seq;if(t){if(a[r].level!==s)continue;l=!0,i[t]=1,this._fireCallback(a[r].callback,n,a[r].combo,t);const o=t.lastIndexOf(e),c=t.slice(0,o);for(const[e,t]of Object.entries(this._sequenceLevels))t>0&&e.startsWith(c)&&(i[e]=1)}else l||this._fireCallback(a[r].callback,n,a[r].combo)}var c;for(const t of null!==(c=this._callbacks[e])&&void 0!==c?c:[])t.action===n.type&&t.seq&&0===t.level&&(i[t.seq]=1);let u="keypress"===n.type&&this._ignoreNextKeypress;n.type!==this._nextExpectedAction||Ee(e)||u||this._resetSequences(i),this._ignoreNextKeypress=l&&"keydown"===n.type})),me(this,"_handleKeyEvent",(e=>{if(!(e instanceof KeyboardEvent))throw new Error("Didn't get a KeyboardEvent");const t=e;if(t.repeat)return;"number"!=typeof t.which&&(t.which=t.keyCode);let n=xe(t);n&&("keyup"!==t.type||this._ignoreNextKeyup!==n?this.handleKey(n,function(e){let t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(t),t):this._ignoreNextKeyup=!1)})),me(this,"_resetSequenceTimer",(()=>{clearTimeout(this._resetTimer),this._resetTimer=setTimeout(this._resetSequences,1e3)})),me(this,"_bindSequence",((e,t,n,r)=>{this._sequenceLevels[e]=0;const a=t=>()=>{this._nextExpectedAction=t,++this._sequenceLevels[e],this._resetSequenceTimer()},i=t=>{this._fireCallback(n,t,e),"keyup"!==r&&(this._ignoreNextKeyup=xe(t)),this._resetSequenceTimer()};for(let n=0;n<t.length;++n){let s=n+1===t.length?i:a(r||Pe(t[n+1]).action);this._bindSingle(t[n],s,r,e,n)}})),me(this,"_bindSingle",((e,t,n,r,a)=>{this._directMap[e+":"+n]=t;let i,s=(e=e.replace(/\s+/g," ")).split(" ");if(s.length>1)return void this._bindSequence(e,s,t,n);i=Pe(e,n),this._callbacks[i.key]=this._callbacks[i.key]||[];const l={type:i.action,metaKey:!1,ctrlKey:!1};this._getMatches(i.key,i.modifiers,l,r,e,a);const o={callback:t,modifiers:i.modifiers,action:i.action,seq:r,level:a,combo:e};this._callbacks[i.key][r?"unshift":"push"](o)})),me(this,"_bindMultiple",((e,t,n)=>{for(let r=0;r<e.length;++r)this._bindSingle(e[r],t,n)})),me(this,"bind",((e,t,n)=>(e=e instanceof Array?e:[e],this._bindMultiple(e,t,n),self))),me(this,"unbind",((e,t)=>this.bind(e,(function(){}),t))),me(this,"bindGlobal",((e,t,n)=>{if(this.bind(e,t,n),e instanceof Array)for(let t=0;t<e.length;t++)this._globalCallbacks[e[t]]=!0;else this._globalCallbacks[e]=!0})),me(this,"unbindGlobal",((e,t)=>{if(this.unbind(e,t),e instanceof Array)for(let t=0;t<e.length;t++)this._globalCallbacks[e[t]]=!1;else this._globalCallbacks[e]=!1})),me(this,"trigger",((e,t)=>{let n=this;return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n})),me(this,"reset",(()=>(this._callbacks={},this._directMap={},this))),me(this,"stopCallback",((e,t,n,r)=>{if(this._globalCallbacks[n]||r&&this._globalCallbacks[r])return!1;if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(ke(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){let n=e.composedPath()[0];n!==e.target&&n instanceof HTMLElement&&(t=n)}return Boolean("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||"isContentEditable"in t&&t.isContentEditable)})),me(this,"handleKey",((...e)=>this._handleKey(...e))),me(this,"addKeycodes",(e=>{for(let t in e)e.hasOwnProperty(t)&&(be[t]=e[t]);Oe=null})),this.target=e,this.target.addEventListener("keypress",(e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)})),this.target.addEventListener("keydown",(e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)})),this.target.addEventListener("keyup",(e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)}))}}(document);class Fe{addBinding(e){je.bind(e.key,(t=>{t.preventDefault(),t.stopPropagation(),t.returnValue=!1,e.onTrigger()}),"keydown"),this._binds.push(e)}removeAll(){this._binds.forEach((e=>{je.unbind(e.key,e.type)})),this._binds=[]}constructor(){!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_binds",[])}}var Le=n(5700),_e=n(8428);function Te(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function De(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){Te(i,r,a,s,l,"next",e)}function l(e){Te(i,r,a,s,l,"throw",e)}s(void 0)}))}}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const $e=(0,H.getAppEvents)();function Ie(e){const t=new Fe;let n=null;const r=$e.subscribe(i.SetPanelAttentionEvent,(e=>{"string"==typeof e.payload.panelId&&(n=e.payload.panelId)}));function a(e,t){return()=>{const r=s.jh.findObject(e,(e=>e.state.key===n&&e.isActive));r&&r instanceof s.Eb&&t(r)}}return t.addBinding({key:"p l",onTrigger:a(e,Me)}),t.addBinding({key:"a l",onTrigger:function(e,t){return()=>{s.jh.findAllObjects(e,(e=>e instanceof s.Eb&&e.isActive)).forEach((e=>{e&&e instanceof s.Eb&&t(e)}))}}(e,Me)}),t.addBinding({key:"p x",onTrigger:a(e,function(){var e=De((function*(e){const t=(0,Le.iD)(e);t&&H.locationService.push(t)}));return function(t){return e.apply(this,arguments)}}())}),t.addBinding({key:"t c",onTrigger:()=>{!function(e){const t=window.__grafanaSceneContext;window.__grafanaSceneContext=e}(s.jh.getTimeRange(e)),$e.publish(new Re)}}),t.addBinding({key:"t v",onTrigger:()=>{const t=new Ve({updateUrl:!1});e.publishEvent(t),$e.publish(t)}}),t.addBinding({key:"d r",onTrigger:()=>s.jh.getTimeRange(e).onRefresh()}),t.addBinding({key:"t z",onTrigger:()=>{Be(e)}}),t.addBinding({key:"ctrl+z",onTrigger:()=>{Be(e)}}),t.addBinding({key:"t a",onTrigger:()=>{const t=(0,X.m0)(e);null==t||t.toAbsolute()}}),t.addBinding({key:"t left",onTrigger:()=>{Ae(e,"left")}}),t.addBinding({key:"t right",onTrigger:()=>{Ae(e,"right")}}),()=>{t.removeAll(),r.unsubscribe()}}function Be(e){const t=(0,X.m0)(e);null==t||t.onZoom()}function Ae(e,t){const n=(0,X.m0)(e);n&&("left"===t&&n.onMoveBackward(),"right"===t&&n.onMoveForward())}function Me(e){const t=e.state.options;var n;null!=(n=t)&&"object"==typeof n&&"legend"in n&&"boolean"==typeof t.legend.showLegend&&e.onOptionsChange({legend:{showLegend:!t.legend.showLegend}})}class Re extends i.BusEventBase{}Ne(Re,"type","copy-time");class Ve extends i.BusEventWithPayload{}function We(){return(We=De((function*(){const e=yield navigator.clipboard.readText();let t;try{t=JSON.parse(e);const n=(0,_e.OK)(t);if(n)return{isError:!1,range:n}}catch(e){}return{range:e,isError:!0}}))).apply(this,arguments)}Ne(Ve,"type","paste-time");var ze=n(4532),He=n(5548),Qe=n(1532),Ke=n(6838),Ge=n(2499),Ue=n(1792);const qe=()=>{const e=(0,u.useStyles2)(Je),t=(0,u.useTheme2)();return a().createElement("div",{className:e.wrap},a().createElement("div",{className:e.graphicContainer},a().createElement(Ue.A,{src:(t.isDark,"/public/plugins/grafana-lokiexplore-app/img/grot_loki.svg")})),a().createElement("div",{className:e.text},a().createElement("h3",{className:e.title},"Welcome to Grafana Logs Drilldown"),a().createElement("p",null,"We noticed there is no Loki datasource configured.",a().createElement("br",null),"Add a"," ",a().createElement("a",{className:"external-link",href:i.locationUtil.assureBaseUrl("/connections/datasources/new")},"Loki datasource")," ","to view logs."),a().createElement("br",null),a().createElement("p",null,"Click"," ",a().createElement("a",{href:"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/",target:"_blank",className:"external-link",rel:"noreferrer"},"here")," ","to learn more...")))},Je=e=>({graphicContainer:(0,d.css)({display:"flex",justifyContent:"center",margin:"0 auto",width:"200px",height:"250px",padding:e.spacing(1),[e.breakpoints.up("md")]:{alignSelf:"flex-end",width:"300px",height:"auto",padding:e.spacing(1)},[e.breakpoints.up("lg")]:{alignSelf:"flex-end",width:"400px",height:"auto",padding:e.spacing(1)}}),text:(0,d.css)({display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"}),title:(0,d.css)({marginBottom:"1.5rem"}),wrap:(0,d.css)({[e.breakpoints.up("md")]:{margin:"4rem auto auto auto",flexDirection:"row"},padding:"2rem",margin:"0 auto auto auto",display:"flex",alignItems:"center",flexDirection:"column",textAlign:"center"})});function Ye(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function Xe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){Ye(i,r,a,s,l,"next",e)}function l(e){Ye(i,r,a,s,l,"throw",e)}s(void 0)}))}}function Ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function et(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const tt="showLogsButtonScene";class nt extends s.Bs{onActivate(){const e={};this.setVariableProviders();var t;(s.jh.findByKeyAndType(this,tt,ve.H).setState({hidden:!1}),this.state.contentScene)||(e.contentScene=function(e){if((0,$.FT)()===$.G3.explore)return new z.y({});return new c.Mn({drillDownLabel:e})}(null===(t=this.state.routeMatch)||void 0===t?void 0:t.params.breakdownLabel));this.setTagProviders(),this.setState(e),this.updatePatterns(this.state,(0,U.Ku)(this)),this.resetVariablesIfNotInUrl((0,U.ir)(this),(0,U.n5)(l.mB)),this.resetVariablesIfNotInUrl((0,U.iw)(this),(0,U.n5)(l._Y)),this._subs.add(this.subscribeToState((e=>{this.updatePatterns(e,(0,U.Ku)(this))})));const n=s.jh.getTimeRange(this);this._subs.add(n.subscribeToState(this.limitMaxInterval(n))),this._subs.add(this.subscribeToEvent(Ve,this.subscribeToPasteTimeEvent));const r=(0,U.ir)(this).state.filters,a=(0,U.oY)(this).state.filters,i=(0,U.YS)(this);i.updateFilters([...a,...r]),this._subs.add(i.subscribeToState(this.subscribeToCombinedFieldsVariable));const o=Ie(this);return()=>{o()}}setTagProviders(){this.setLabelsProviders()}setLabelsProviders(){const e=(0,U.cR)(this);e._getOperators=()=>(0,He.Ht)(e),e.setState({getTagKeysProvider:de,getTagValuesProvider:se})}limitMaxInterval(e){return(t,n)=>{const{jsonData:r}=Y.plugin.meta;if(null==r?void 0:r.interval)try{var a;const l=i.rangeUtil.intervalToSeconds(null!==(a=null==r?void 0:r.interval)&&void 0!==a?a:"");if(!l)return;const o=t.value.to.diff(t.value.from,"seconds");if(o>l){if(o<=n.value.to.diff(n.value.from,"seconds"))e.setState({value:n.value,from:n.from,to:n.to});else{const t=new s.JZ(J.sp);e.setState({value:t.state.value,from:t.state.from,to:t.state.to})}(0,H.getAppEvents)().publish({type:i.AppEvents.alertWarning.name,payload:["Time range interval exceeds maximum interval configured by the administrator."]}),(0,j.EE)("all","interval_too_long",{attempted_duration_seconds:o,configured_max_interval:l})}}catch(e){console.error(e)}}}setVariableProviders(){const e=(0,U.iw)(this),t=(0,U.YS)(this);t._getOperators=()=>(0,He.Ht)(t),e.setState({getTagValuesProvider:this.getLevelsTagValuesProvider(),getTagKeysProvider:this.getLevelsTagKeysProvider()}),t.setState({getTagKeysProvider:this.getCombinedFieldsTagKeysProvider(),getTagValuesProvider:this.getCombinedFieldsTagValuesProvider()})}getCombinedFieldsTagKeysProvider(){return(e,t)=>{const n=(0,U.oY)(this),r=(0,U.ir)(this),a=(0,Ke.O)(l.sL),i=n.state.filters.filter((e=>e.key!==t)),o=r.state.filters.filter((e=>e.key!==t)),c=this.renderVariableFilters(l.mB,o),u=this.renderVariableFilters(l._P,i),d=a.replace(l.Gd,c).replace(l.w0,u);return ge({expr:s.jh.interpolate(this,d),sceneRef:this,timeRange:s.jh.getTimeRange(this).state.value,variableType:l.sL})}}getCombinedFieldsTagValuesProvider(){return(e,t)=>{const n=(0,Ke.O)(l.sL),r=(0,U.oY)(this),a=(0,U.ir)(this),i=r.state.filters.filter((e=>e.key!==t.key&&(0,ne.BG)(e.operator))),o=a.state.filters.filter((e=>e.key!==t.key&&(0,ne.BG)(e.operator))),c=this.renderVariableFilters(l.mB,o),u=this.renderVariableFilters(l._P,i),d=n.replace(l.Gd,c).replace(l.w0,u),p=s.jh.interpolate(this,d);return ie(t,e,p,this,s.jh.getTimeRange(this).state.value,l.sL)}}getLevelsTagKeysProvider(){return(e,t)=>{const n=e.state.filters.filter((e=>e.key!==t)),r=this.renderVariableFilters(l._Y,n),a=(0,Ke.O)(l._Y).replace(l.Gd,r);return ge({expr:s.jh.interpolate(this,a),sceneRef:this,timeRange:s.jh.getTimeRange(this).state.value,variableType:l._Y})}}getLevelsTagValuesProvider(){return(e,t)=>{const n=e.state.filters.filter((e=>e.key!==t.key&&e.operator===ee.w7.Equal)),r=this.renderVariableFilters(l._Y,n),a=(0,Ke.O)(l._Y).replace(l.Gd,r),i=s.jh.interpolate(this,a);return ie(t,e,i,this,s.jh.getTimeRange(this).state.value,l._Y)}}renderVariableFilters(e,t){if(e===l.mB)return(0,Q.ZX)(t);if(e===l._P)return(0,Q.E3)(t);if(e===l._Y)return(0,Q.E3)(t);{const e=new Error("getFieldsTagValuesProvider only supports fields, metadata, and levels");throw f.v.error(e),e}}resetVariablesIfNotInUrl(e,t){const n=H.locationService.getLocation();null===new URLSearchParams(n.search).get(t)&&e.setState({filters:[]})}updatePatterns(e,t){var n;const r=(0,Ge.M)(null!==(n=e.patterns)&&void 0!==n?n:[]);t.changeValueTo(r)}getUrlState(){return{patterns:JSON.stringify(this.state.patterns)}}updateFromUrl(e){const t={};e.patterns&&"string"==typeof e.patterns&&(t.patterns=JSON.parse(e.patterns)),this.setState(t)}constructor(e){var t,n;const{variablesScene:r,unsub:a}=function(e,t){const n=new s.H9({name:l.MB,datasource:l.eL,layout:"combobox",label:"Labels",allowCustomValue:!0,filters:null!=t?t:[],expressionBuilder:Q.VW,hide:K.zL.dontHide,key:"adhoc_service_filter",onAddCustomValue:Q.c0});n._getOperators=function(){return ze.II};const r=new s.H9({name:l.mB,label:"Detected fields",applyMode:"manual",layout:"combobox",expressionBuilder:Q.ZX,hide:K.zL.hideVariable,allowCustomValue:!0});r._getOperators=()=>ze.II;const a=new s.H9({name:l._P,label:"Metadata",applyMode:"manual",layout:"combobox",expressionBuilder:e=>(0,Q.E3)(e),hide:K.zL.hideVariable,allowCustomValue:!0});a._getOperators=()=>ze.II;const i=new s.H9({name:l.sL,label:"Fields",applyMode:"manual",layout:"combobox",hide:K.zL.hideVariable,allowCustomValue:!0,onAddCustomValue:Q.PP,skipUrlSync:!0}),c=new s.H9({name:l._Y,label:"Error levels",applyMode:"manual",layout:"vertical",expressionBuilder:Q._q,hide:K.zL.hideVariable,supportsMultiValueOperators:!0}),u=new s.H9({name:l.NW,hide:K.zL.hideVariable,getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),expressionBuilder:Q.CY,layout:"horizontal"});u._getOperators=()=>ze.eb;const d=new s.mI({name:l.EY,label:"Data source",value:e,pluginId:"loki"}),p=d.subscribeToState((e=>{const t=`${e.value}`;e.value&&(0,o.ke)(t)}));return{variablesScene:new s.Pj({variables:[d,n,r,c,a,i,new s.yP({name:l.uw,value:"",hide:K.zL.hideVariable}),new s.H9({name:l.WM,hide:K.zL.hideVariable,expressionBuilder:Q.CY}),u,new G.m({name:l.QE,value:l.YN,skipUrlSync:!0,hide:K.zL.hideVariable,options:[{value:l.YN,label:l.YN}]})]}),unsub:p}}(null!==(n=(0,o.QB)())&&void 0!==n?n:"grafanacloud-logs",e.initialFilters),c=[new s.G1({key:"vars-row__datasource-labels-timepicker-button",direction:"row",children:[new s.vA({body:new y({key:"vars-labels",layout:"vertical",include:[l.MB]})}),new ve.H({key:tt,disabled:!0})]}),new y({key:"vars-metadata",layout:"vertical",include:[l._P]}),new y({key:"vars-fields",layout:"vertical",include:[l.mB]}),new y({key:R,layout:"horizontal",include:[l.EY]}),new y({key:M,layout:"vertical",include:[l.sL]}),new s.KE({key:"vars-timepicker"}),new s.WM({key:"vars-refresh"})];var u,d,p;"explore"===(0,$.FT)()&&H.config.featureToggles.exploreLogsAggregatedMetrics&&c.push(new q.s({key:"vars-toolbar",isOpen:!1})),super(et(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ze(e,t,n[t])}))}return e}({$timeRange:null!==(u=e.$timeRange)&&void 0!==u?u:new s.JZ({}),$variables:null!==(d=e.$variables)&&void 0!==d?d:r,controls:null!==(p=e.controls)&&void 0!==p?p:c,patterns:[]},e),{body:new V({})})),t=this,Ze(this,"_urlSync",new s.So(this,{keys:["patterns"]})),Ze(this,"subscribeToCombinedFieldsVariable",((e,t)=>{if(!(0,Qe.B)(e.filters,null==t?void 0:t.filters)){const t=e.filters.filter((e=>(0,oe.OH)(e))),n=e.filters.filter((e=>!(0,oe.OH)(e)));(0,U.ir)(this).updateFilters(n),(0,U.oY)(this).updateFilters(t)}})),Ze(this,"subscribeToPasteTimeEvent",Xe((function*(){const e=yield function(){return We.apply(this,arguments)}();if(e.isError)return;const n=s.jh.getTimeRange(t),r="string"==typeof e.range.to?e.range.to:void 0,a="string"==typeof e.range.from?e.range.from:void 0,l=i.rangeUtil.convertRawToRange(e.range);n&&l?n.setState({value:l,to:r,from:a}):f.v.error(new Error("Invalid time range from clipboard"),{msg:"Invalid time range from clipboard",sceneTimeRange:typeof n,to:null!=r?r:"",from:null!=a?a:""})}))),this._subs.add(a),this.addActivationHandler(this.onActivate.bind(this)),(0,X.hJ)(this).then((e=>{this.setState({ds:e})}))}}Ze(nt,"Component",(({model:e})=>{const{body:t}=e.useState();return(0,U.S9)(e).state.options.length?t?a().createElement(t.Component,{model:t}):a().createElement(u.LoadingPlaceholder,{text:"Loading..."}):a().createElement(qe,null)}))},2085:(e,t,n)=>{n.d(t,{dm:()=>b,kz:()=>v,qV:()=>m});var r=n(9736),a=n(5959),i=n.n(a),s=n(5553),l=n(6089),o=n(2007),c=n(20),u=n(6854),d=n(3571),p=n(7478);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}function f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const v="levels-var-custom-renderer";class m extends r.Bs{onActivate(){this.onFilterChange(),this._subs.add((0,s.iw)(this).subscribeToEvent(r.oh,(()=>{this.onFilterChange()})))}onFilterChange(){const e=(0,s.iw)(this);this.setState({options:e.state.filters.map((e=>{var t,n;return{text:null!==(n=null===(t=e.valueLabels)||void 0===t?void 0:t[0])&&void 0!==n?n:e.value,selected:!0,value:e.value}}))})}constructor(e){super(f(h({},e),{isLoading:!1,visible:!1,key:v,isOpen:!1})),g(this,"getTagValues",(()=>{var e,t;this.setState({isLoading:!0});const n=(0,s.iw)(this);var r;const a=null==n||null===(t=n.state)||void 0===t||null===(e=t.getTagValuesProvider)||void 0===e?void 0:e.call(t,n,null!==(r=n.state.filters[0])&&void 0!==r?r:{key:c.e4});null==a||a.then((e=>{Array.isArray(e.values)&&this.setState({isLoading:!1,options:e.values.map((e=>{var t;return{text:e.text,value:null!==(t=e.value)&&void 0!==t?t:e.text,selected:n.state.filters.some((t=>t.value===e.text))}}))})}))})),g(this,"updateFilters",((e,t)=>{var n;const r=(0,s.iw)(this),a=null===(n=this.state.options)||void 0===n?void 0:n.filter((e=>e.selected));var i;r.updateFilters(null!==(i=null==a?void 0:a.map((e=>({key:c.e4,operator:u.w7.Equal,value:e.text}))))&&void 0!==i?i:[],{skipPublish:e,forcePublish:t})})),g(this,"onChangeOptions",(e=>{var t;(0,p.bN)(),this.setState({options:null===(t=this.state.options)||void 0===t?void 0:t.map((t=>e.some((e=>e.value===t.value))?f(h({},t),{selected:!0}):f(h({},t),{selected:!1})))}),this.state.isOpen?this.updateFilters(!0):this.updateFilters(!1)})),g(this,"openSelect",(e=>{this.setState({isOpen:e})})),g(this,"onCloseMenu",(()=>{this.openSelect(!1),this.updateFilters(!1,!0)})),this.addActivationHandler(this.onActivate.bind(this))}}function b(e){const t=r.jh.findObject(e,(e=>e instanceof m));t instanceof m&&t.onFilterChange()}g(m,"Component",(({model:e})=>{const{options:t,isLoading:n,visible:a,isOpen:l}=e.useState(),c=(0,o.useStyles2)(y);return(0,s.iw)(e).useState(),a?i().createElement("div",{"data-testid":d.b.variables.levels.inputWrap,className:c.wrapper},i().createElement(r.Zx,{layout:"vertical",label:"Log levels"}),i().createElement(o.MultiSelect,{"aria-label":"Log level filters",prefix:i().createElement(o.Icon,{size:"lg",name:"filter"}),placeholder:"All levels",className:c.control,onChange:e.onChangeOptions,onCloseMenu:()=>e.onCloseMenu(),onOpenMenu:e.getTagValues,onFocus:()=>e.openSelect(!0),menuShouldPortal:!0,isOpen:l,isLoading:n,isClearable:!0,blurInputOnSelect:!1,closeMenuOnSelect:!1,openMenuOnFocus:!0,showAllSelectedWhenOpen:!0,hideSelectedOptions:!1,value:null==t?void 0:t.filter((e=>e.selected)),options:null==t?void 0:t.map((e=>({value:e.value,label:e.text})))})):null}));const y=()=>({control:(0,l.css)({flex:"1"}),wrapper:(0,l.css)({flex:"0 0 auto",whiteSpace:"nowrap"})})},1459:(e,t,n)=>{n.d(t,{Y:()=>w,F:()=>O});var r=n(9736),a=n(5959),i=n.n(a),s=n(5553),l=n(6854),o=n(4509),c=n(3241),u=n(6089),d=n(2007),p=n(72);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function f({onClick:e,props:t}){const[n,r]=(0,a.useState)(!1),s=(0,d.useStyles2)(v);return i().createElement(i().Fragment,null,i().createElement("span",null,i().createElement("div",{className:s.titleWrap},i().createElement("span",null,"Line filter"),i().createElement(d.IconButton,{onClick:e,name:"times",size:"xs","aria-label":"Remove line filter"})),i().createElement("span",{className:s.collapseWrap},i().createElement(p._,h(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}({},t),{focus:n,setFocus:r,type:"variable"})),n&&i().createElement(d.IconButton,{className:s.collapseBtn,tooltip:"Collapse",size:"lg","aria-label":"Collapse filter",onClick:()=>r(!1),name:"table-collapse-all"}))))}const v=e=>({titleWrap:(0,u.css)({display:"flex",fontSize:e.typography.bodySmall.fontSize,marginBottom:e.spacing(.5),gap:e.spacing(1)}),collapseWrap:(0,u.css)({display:"flex"}),collapseBtn:(0,u.css)({marginLeft:e.spacing(1)})});var m=n(7478);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){b(e,t,n[t])}))}return e}function S(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class w extends r.Bs{isFilterExclusive({operator:e}){return e===l.cK.negativeMatch||e===l.cK.negativeRegex}updateFilter(e,t,n=!0){n?(this.updateVariableLineFilter(e,t,!0),this.updateVariableDebounced(e,t,!1,!0)):this.updateVariableLineFilter(e,t)}constructor(...e){super(...e),b(this,"handleEnter",((e,t,n)=>{"Enter"===e.key&&((0,m.bN)(),this.updateVariableLineFilter(n,S(y({},n),{value:t})))})),b(this,"onRegexToggle",(e=>{let t;switch(e.operator){case l.cK.match:t=l.cK.regex;break;case l.cK.negativeMatch:t=l.cK.negativeRegex;break;case l.cK.regex:t=l.cK.match;break;case l.cK.negativeRegex:t=l.cK.negativeMatch;break;default:throw new Error("Invalid operator!")}this.updateFilter(e,S(y({},e),{operator:t}),!1)})),b(this,"onToggleExclusive",(e=>{let t;switch(e.operator){case l.cK.match:t=l.cK.negativeMatch;break;case l.cK.negativeMatch:t=l.cK.match;break;case l.cK.regex:t=l.cK.negativeRegex;break;case l.cK.negativeRegex:t=l.cK.regex;break;default:throw new Error("Invalid operator!")}this.updateFilter(e,S(y({},e),{operator:t}),!1)})),b(this,"onCaseSensitiveToggle",(e=>{const t=e.key===l.ld.caseSensitive?l.ld.caseInsensitive:l.ld.caseSensitive;this.updateFilter(e,S(y({},e),{key:t}),!1)})),b(this,"onInputChange",((e,t)=>{this.updateFilter(t,S(y({},t),{value:e.target.value}),!0)})),b(this,"removeFilter",(e=>{(0,m.bN)();const t=(0,s.Gk)(this),n=t.state.filters.filter((t=>void 0!==t.keyLabel&&t.keyLabel!==e.keyLabel));t.setState({filters:n})})),b(this,"updateVariableLineFilter",((e,t,n=!1,r=!1)=>{const a=(0,s.Gk)(this),i=a.state.filters.filter((t=>void 0!==t.keyLabel&&t.keyLabel!==e.keyLabel));a.updateFilters([{keyLabel:e.keyLabel,key:t.key,operator:t.operator,value:t.value},...i],{skipPublish:n,forcePublish:r}),(0,o.EE)(o.NO.service_details,o.ir.service_details.search_string_in_variables_changed,{searchQueryLength:e.value.length,containsLevel:e.value.toLowerCase().includes("level"),operator:t.operator,caseSensitive:t.key})})),b(this,"updateVariableDebounced",(0,c.debounce)(((e,t,n=!1,r=!1)=>{this.updateVariableLineFilter(e,t,n,r)}),1e3))}}function O(e){e.sort(((e,t)=>{var n,r;return parseInt(null!==(n=e.keyLabel)&&void 0!==n?n:"0",10)-parseInt(null!==(r=t.keyLabel)&&void 0!==r?r:"0",10)}))}function x(e){return{lineFiltersWrap:(0,u.css)({label:"lineFiltersWrap",display:"flex",flexWrap:"wrap",gap:`${e.spacing(.25)} ${e.spacing(2)}`})}}b(w,"Component",(({model:e})=>{const t=(0,s.Gk)(e),{filters:n}=t.useState(),r=(0,d.useStyles2)(x);return O(n),n.length?i().createElement("div",{className:r.lineFiltersWrap},n.map((t=>{const n={lineFilter:t.value,regex:t.operator===l.cK.regex||t.operator===l.cK.negativeRegex,caseSensitive:t.key===l.ld.caseSensitive,exclusive:e.isFilterExclusive(t),handleEnter:(n,r)=>e.handleEnter(n,t.value,t),setExclusive:()=>e.onToggleExclusive(t),updateFilter:(n,r)=>e.updateFilter(t,S(y({},t),{value:n}),r),onRegexToggle:()=>e.onRegexToggle(t),onInputChange:n=>e.onInputChange(n,t),onCaseSensitiveToggle:()=>e.onCaseSensitiveToggle(t)};return i().createElement(f,{key:t.keyLabel,onClick:()=>e.removeFilter(t),props:n})}))):null}))},7796:(e,t,n)=>{n.d(t,{H:()=>g});var r=n(9736),a=n(2007),i=n(5959),s=n.n(i),l=n(6089),o=n(7478),c=n(5553),u=n(3571),d=n(708);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends r.Bs{onActivate(){const e=(0,c.cR)(this),t=e.state.filters.some((e=>(0,d.BG)(e.operator)));this.setState({disabled:!t}),e.subscribeToState((e=>{const t=e.filters.some((e=>(0,d.BG)(e.operator)));this.setState({disabled:!t})}))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}({},e)),p(this,"getLink",(()=>{const e=(0,c.cR)(this).state.filters.find((e=>(0,d.BG)(e.operator)));return e?(0,o.k9)(e.key,e.value):""})),this.addActivationHandler(this.onActivate.bind(this))}}function h(e){return{button:(0,l.css)({[e.breakpoints.down("lg")]:{alignSelf:"flex-end"},[e.breakpoints.down("md")]:{marginTop:e.spacing(1),alignSelf:"flex-start"},alignSelf:"flex-start",marginTop:"22px"})}}p(g,"Component",(({model:e})=>{const{disabled:t,hidden:n}=e.useState(),r=(0,a.useStyles2)(h);if(!0===n)return null;const i=e.getLink();return s().createElement(a.LinkButton,{"data-testid":u.b.index.header.showLogsButton,disabled:t||!i,fill:"outline",className:r.button,href:i},"Show logs")}))},9731:(e,t,n)=>{n.d(t,{s:()=>f});var r=n(9736),a=n(2007),i=n(5959),s=n.n(i),l=n(6089),o=n(8531),c=n(4509),u=n(173),d=n(2533),p=n(3571);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=`${d.id}.serviceSelection.aggregatedMetrics`;class f extends r.Bs{constructor(e){const t=localStorage.getItem(h),n=o.config.featureToggles.exploreLogsAggregatedMetrics&&"false"!==t;var r;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}({isOpen:!1,options:{aggregatedMetrics:{active:null!=n&&n,userOverride:null!==(r="true"===t)&&void 0!==r&&r,disabled:!1}}},e)),g(this,"toggleAggregatedMetricsOverride",(()=>{const e=!this.state.options.aggregatedMetrics.active;(0,c.EE)(c.NO.service_selection,c.ir.service_selection.aggregated_metrics_toggled,{enabled:e}),localStorage.setItem(h,e.toString()),this.setState({options:{aggregatedMetrics:{active:e,disabled:this.state.options.aggregatedMetrics.disabled,userOverride:e}}})})),g(this,"onToggleOpen",(e=>{this.setState({isOpen:e})}))}}function v(e){return{popover:(0,l.css)({display:"flex",padding:e.spacing(2),flexDirection:"column",background:e.colors.background.primary,boxShadow:e.shadows.z3,borderRadius:e.shape.radius.default,border:`1px solid ${e.colors.border.weak}`,zIndex:1,marginRight:e.spacing(2)}),heading:(0,l.css)({fontWeight:e.typography.fontWeightMedium,paddingBottom:e.spacing(2)}),options:(0,l.css)({display:"grid",gridTemplateColumns:"1fr 50px",rowGap:e.spacing(1),columnGap:e.spacing(2),alignItems:"center"})}}g(f,"Component",(({model:e})=>{const{isOpen:t,options:n}=e.useState(),r=(0,a.useStyles2)(v),i=()=>s().createElement("div",{className:r.popover,onClick:e=>e.stopPropagation()},s().createElement("div",{className:r.heading},"Query options"),s().createElement("div",{className:r.options},s().createElement("div",{title:"Aggregated metrics will return service queries results much more quickly, but with lower resolution"},"Aggregated metrics"),s().createElement("span",{title:n.aggregatedMetrics.disabled?`Aggregated metrics can only be enabled for queries starting after ${u.X.toLocaleString()}`:""},s().createElement(a.Switch,{label:"Toggle aggregated metrics","data-testid":p.b.index.aggregatedMetricsToggle,value:n.aggregatedMetrics.active,disabled:n.aggregatedMetrics.disabled,onChange:e.toggleAggregatedMetricsOverride}))));return n.aggregatedMetrics?s().createElement(a.Dropdown,{overlay:i,placement:"bottom",onVisibleChange:e.onToggleOpen},s().createElement(a.ToolbarButton,{icon:"cog",variant:"canvas",isOpen:t,"data-testid":p.b.index.aggregatedMetricsMenu})):s().createElement(s().Fragment,null)}))},6991:(e,t,n)=>{n.d(t,{Oo:()=>h,c:()=>g,sp:()=>d});var r=n(9736),a=n(9683),i=n(7781),s=n(2661),l=n(7478),o=n(5953),c=n(5002),u=n(9598);const d={from:"now-15m",to:"now"};function p(e){return new r.P1({body:new s.P({$timeRange:new r.JZ(d),routeMatch:e})})}function g(){return new r.jD({title:"Grafana Logs Drilldown",url:(0,u._F)(a.G3.explore),layout:i.PageLayoutType.Custom,preserveUrlKeys:a.Zt,routePath:`${a.G3.explore}/*`,getScene:e=>p(e),drilldowns:[{routePath:a.HU.logs,getPage:(e,t)=>f(e,t,a.G3.logs),defaultRoute:!0},{routePath:a.HU.labels,getPage:(e,t)=>f(e,t,a.G3.labels)},{routePath:a.HU.patterns,getPage:(e,t)=>f(e,t,a.G3.patterns)},{routePath:a.HU.fields,getPage:(e,t)=>f(e,t,a.G3.fields)},{routePath:a.KL.label,getPage:(e,t)=>v(e,t,a._J.label)},{routePath:a.KL.field,getPage:(e,t)=>v(e,t,a._J.field)},{routePath:"*",getPage:()=>h()}]})}function h(){return new r.jD({title:"",url:i.urlUtil.renderUrl(u.Gy,void 0),getScene:()=>new r.P1({body:new r.G1({direction:"column",children:[]})}),hideFromBreadcrumbs:!0,routePath:"*",$behaviors:[()=>{(0,l.Ns)()}]})}function f(e,t,n){const{labelName:s,labelValue:l}=(0,a.XJ)(e);return new r.jD({title:(0,c.Zr)(n),layout:i.PageLayoutType.Custom,url:a.bw[n](l,s),routePath:a.HU[n],preserveUrlKeys:a.tm,getParentPage:()=>t,getScene:e=>p(e)})}function v(e,t,n){const{labelName:s,labelValue:l,breakdownLabel:u}=(0,a.XJ)(e);if(!u){const e=new Error("Breakdown value missing!");throw o.v.error(e,{msg:"makeBreakdownValuePage: Breakdown value missing!",labelName:s,labelValue:l,breakdownLabel:null!=u?u:""}),e}return new r.jD({title:(0,c.Zr)(u),layout:i.PageLayoutType.Custom,url:a.mC[n](l,s,u),routePath:a.KL[n],preserveUrlKeys:a.tm,getParentPage:()=>t,getScene:e=>p(e)})}},5700:(e,t,n)=>{n.d(t,{ls:()=>A,Ci:()=>M,GD:()=>R,iD:()=>V,K_:()=>K});var r=n(9736),a=n(5959),i=n.n(a),s=n(7781),l=n(8531),o=n(2007),c=n(5719),u=(n(3571),n(4509)),d=n(4351),p=n(8428),g=n(2165);const h=(e,t,n=!1)=>{t||(t=(0,c.u9)(e)),t=t.replace(/\s+/g," ").trimEnd();const a=(0,c.U4)(e),i=r.jh.getTimeRange(e).state.value,o=(0,d.N$)(e),u=(0,d.k5)(),h=function(){const e=new URLSearchParams(window.location.search).get("urlColumns");if(e)try{const t=(0,p.aJ)(JSON.parse(e));let n={};for(const e in t)n[e]=t[e];return n}catch(e){console.error(e)}return}(),f=JSON.stringify({"loki-explore":{range:(0,s.toURLRange)(i.raw),queries:[{refId:"logs",expr:t,datasource:a}],panelsState:{logs:{displayedFields:o,visualisationType:u,columns:h,labelFieldName:"table"===u?g.bz:void 0}},datasource:a}});var v;const m=null!==(v=l.config.appSubUrl)&&void 0!==v?v:"",b=s.urlUtil.renderUrl(`${m}/explore`,{panes:f,schemaVersion:1});return n&&window.open(b,"_blank"),b};var f=n(2661),v=n(5953),m=n(7389);const b=n.p+"3d96a93cfcb32df74eef.svg";function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){y(e,t,n[t])}))}return e}function w(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class O extends r.Bs{constructor(e){super(w(S({},e),{queries:[]})),y(this,"onActivate",(()=>{(0,c.hJ)(this).then((e=>{this.setState({ds:e})})),this._subs.add(this.subscribeToState(((e,t)=>{this.state.queries.length||this.getQueries(),!this.state.context&&this.state.queries.length&&this.getContext()})))})),y(this,"getQueries",(()=>{const e=r.jh.getData(this),t=(0,c.UX)(e,(e=>e instanceof r.dt),r.dt);if(t){const e=this.state.frame?x(this.state.frame):null,n=t.state.queries.map((n=>{var a;return w(S({},n),{expr:r.jh.interpolate(t,n.expr),legendFormat:(null==e?void 0:e.name)?`{{ ${e.name} }}`:r.jh.interpolate(t,n.legendFormat),datasource:null!==(a=n.datasource)&&void 0!==a?a:void 0})}));JSON.stringify(n)!==JSON.stringify(this.state.queries)&&this.setState({queries:n})}})),y(this,"getFieldConfig",(()=>{var e;const t=(0,c.UX)(this,(e=>e instanceof r.Eb),r.Eb),n=r.jh.getData(this),a=null==n||null===(e=n.state.data)||void 0===e?void 0:e.series;let i=null==t?void 0:t.state.fieldConfig;if(i&&(null==a?void 0:a.length))for(const e of a)for(const t of e.fields){const e=Object.keys(t.config).map((e=>({id:e,value:t.config[e]}))),n=i.overrides.find((e=>{var n,r;return e.matcher.options===(null!==(r=null!==(n=t.config.displayNameFromDS)&&void 0!==n?n:t.config.displayName)&&void 0!==r?r:t.name)&&"byName"===e.matcher.id}));var s,l;if(!n)i.overrides.unshift({matcher:{id:"byName",options:null!==(l=null!==(s=t.config.displayNameFromDS)&&void 0!==s?s:t.config.displayName)&&void 0!==l?l:t.name},properties:e});n&&JSON.stringify(n.properties)!==JSON.stringify(e)&&(n.properties=e)}return i})),y(this,"getContext",(()=>{const e=this.getFieldConfig(),{queries:t,ds:n,labelName:a,fieldName:i,type:s}=this.state,l=r.jh.getTimeRange(this);if(!l||!t||!(null==n?void 0:n.uid))return;const o={origin:"Grafana Logs Drilldown",type:null!=s?s:"timeseries",queries:t,timeRange:S({},l.state.value),datasource:{uid:n.uid},url:window.location.href,id:`${JSON.stringify(t)}${a}${i}`,title:`${a}${i?` > ${i}`:""}`,logoPath:b,drillDownLabel:i,fieldConfig:e};JSON.stringify(o)!==JSON.stringify(this.state.context)&&this.setState({context:o})})),this.addActivationHandler(this.onActivate)}}y(O,"Component",(({model:e})=>{const{context:t}=e.useState(),{links:n}=(0,l.usePluginLinks)({extensionPointId:m.R6.MetricInvestigation,context:t});return i().createElement(i().Fragment,null,n.filter((e=>"grafana-investigations-app"===e.pluginId&&e.onClick)).map((e=>{var t;return i().createElement(o.IconButton,{tooltip:e.description,"aria-label":"extension-link-to-open-exploration",key:e.id,name:null!==(t=e.icon)&&void 0!==t?t:"panel-add",onClick:t=>{e.onClick&&e.onClick(t)}})})))}));const x=e=>{var t,n;const r=null!==(n=null===(t=e.fields[1])||void 0===t?void 0:t.labels)&&void 0!==n?n:{};if(1!==Object.keys(r).length)return;const a=Object.keys(r)[0];return{name:a,value:r[a]}};var E=n(1475),C=n(7813),P=n(5865),k=n(2969),j=n(6887),F=n(6089),L=n(1269);function _(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function T(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){_(i,r,a,s,l,"next",e)}function l(e){_(i,r,a,s,l,"throw",e)}s(void 0)}))}}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const $="Add to investigation",I="investigations_divider",B="Investigations";var A=function(e){return e.timeseries="timeseries",e.histogram="histogram",e}({}),M=function(e){return e.collapsed="Collapse",e.expanded="Expand",e}({});class R extends r.Bs{addItem(e){this.state.body&&this.state.body.addItem(e)}setItems(e){this.state.body&&this.state.body.setItems(e)}constructor(e){var t;super(N(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){D(e,t,n[t])}))}return e}({},e),{addInvestigationsLink:null===(t=e.addInvestigationsLink)||void 0===t||t})),this.addActivationHandler((()=>{var e,t,n,a,i,s,l;const o=[{text:"Navigation",type:"group"},{text:"Explore",iconClassName:"compass",href:V(this),onClick:()=>W(),shortcut:"p x"}];let u;try{u=r.jh.getAncestor(this,r.Eb)}catch(e){return void this.setState({body:new r.Lw({items:o})})}var p;(this.setState({investigationsButton:new O({labelName:(null===(e=this.state.investigationOptions)||void 0===e?void 0:e.getLabelName)?null===(t=this.state.investigationOptions)||void 0===t?void 0:t.getLabelName():null===(n=this.state.investigationOptions)||void 0===n?void 0:n.labelName,fieldName:null===(a=this.state.investigationOptions)||void 0===a?void 0:a.fieldName,frame:null===(i=this.state.investigationOptions)||void 0===i?void 0:i.frame,type:null===(s=this.state.investigationOptions)||void 0===s?void 0:s.type})}),this.state.addInvestigationsLink)&&(null===(p=this.state.investigationsButton)||void 0===p||p.activate());(this.state.panelType||(null==u?void 0:u.state.collapsible))&&function(e){e.push({text:"",type:"divider"}),e.push({text:"Visualization",type:"group"})}(o),(null==u?void 0:u.state.collapsible)&&function(e,t){const n=r.jh.getAncestor(t,r.Eb);e.push({text:n.state.collapsed?"Expand":"Collapse",iconClassName:n.state.collapsed?"table-collapse-all":"table-expand-all",onClick:()=>{const e=n.state.collapsed?"Expand":"Collapse",a=r.jh.getAncestor(t,r.G1);(0,P.Zb)(a,e),n.setState({collapsed:!n.state.collapsed}),(0,d.IW)("collapsed",e)}})}(o,this),this.state.panelType&&function(e,t){e.push({text:"histogram"!==t.state.panelType?"Histogram":"Time series",iconClassName:"histogram"!==t.state.panelType?"graph-bar":"chart-line",onClick:()=>{const e=r.jh.getAncestor(t,r.xK),n=r.jh.getAncestor(t,r.Eb).clone(),a=r.jh.getData(t).clone(),i=t.clone(),s=Array.isArray(n.state.headerActions)?n.state.headerActions.map((e=>e.clone())):n.state.headerActions;let l;l="histogram"!==t.state.panelType?r.d0.timeseries().setOverrides(E.jC):r.d0.histogram(),e.setState({body:l.setMenu(i).setTitle(n.state.title).setHeaderActions(s).setData(a).build()});const o="timeseries"!==t.state.panelType?"timeseries":"histogram";(0,d.IW)("panelType",o),i.setState({panelType:o});const u=(0,c.UX)(e,(e=>e instanceof C.E),C.E);u&&u.rebuildAvgFields(),z(o)}})}(o,this),this.setState({body:new r.Lw({items:o})});var g=this;this._subs.add(null===(l=this.state.investigationsButton)||void 0===l?void 0:l.subscribeToState(T((function*(){yield function(e){return Q.apply(this,arguments)}(g)}))))}))}}D(R,"Component",(({model:e})=>{const{body:t}=e.useState();return t?i().createElement(t.Component,{model:t}):i().createElement(i().Fragment,null)}));const V=e=>{const t=r.jh.getAncestor(e,f.P),n=r.jh.getData(e);let a=n instanceof r.dt?n:(0,c.oh)(n)[0];if(!a){const t=r.jh.findObject(e,(e=>e instanceof k.u||e instanceof j.u));if(t){const e=r.jh.getData(t);a=e instanceof r.dt?e:(0,c.oh)(e)[0]}else v.v.error(new Error("Unable to locate query runner!"),{msg:"PanelMenu - getExploreLink: Unable to locate query runner!"})}const i=a.state.queries[0].expr,s=r.jh.interpolate(e,i);return h(t,s)},W=()=>{(0,u.EE)(u.NO.all,u.ir.all.open_in_explore_menu_clicked)},z=e=>{(0,u.EE)(u.NO.service_details,u.ir.service_details.change_viz_type,{newVizType:e})},H=function(){var e=T((function*(e){const t=m.R6.MetricInvestigation,n=e.state.context;if(void 0!==l.getPluginLinkExtensions){return(0,l.getPluginLinkExtensions)({extensionPointId:t,context:n}).extensions[0]}if(void 0!==l.getObservablePluginLinks){return(yield(0,L.firstValueFrom)((0,l.getObservablePluginLinks)({extensionPointId:t,context:n})))[0]}}));return function(t){return e.apply(this,arguments)}}();function Q(){return(Q=T((function*(e){const t=e.state.investigationsButton;if(t){var n;const o=yield H(t);var r;const c=null!==(r=null===(n=e.state.body)||void 0===n?void 0:n.state.items)&&void 0!==r?r:[],u=c.find((e=>e.text===$));var a,i,s,l;if(o)if(u){if(u)null===(a=e.state.body)||void 0===a||a.setItems(c.filter((e=>!1===[I,B,$].includes(e.text))))}else null===(i=e.state.body)||void 0===i||i.addItem({text:I,type:"divider"}),null===(s=e.state.body)||void 0===s||s.addItem({text:B,type:"group"}),null===(l=e.state.body)||void 0===l||l.addItem({text:$,iconClassName:"plus-square",onClick:e=>o.onClick&&o.onClick(e)})}}))).apply(this,arguments)}const K=e=>({panelWrapper:(0,F.css)({width:"100%",height:"100%",label:"panel-wrapper",position:"absolute",display:"flex"})})},9405:(e,t,n)=>{n.d(t,{Of:()=>S,Qt:()=>k,XI:()=>O,hi:()=>x,oR:()=>L,ts:()=>j,u7:()=>C,vn:()=>P});var r=n(5959),a=n.n(r),i=n(7781),s=n(9736),l=n(4509),o=n(20),c=n(7709),u=n(7352),d=n(376),p=n(5553),g=n(6854),h=n(696),f=n(1532),v=n(5953),m=n(8502),b=n(7478);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class S extends i.BusEventBase{constructor(e,t,n,r){super(),y(this,"source",void 0),y(this,"operator",void 0),y(this,"key",void 0),y(this,"value",void 0),this.source=e,this.operator=t,this.key=n,this.value=r}}y(S,"type","add-filter");class w extends i.BusEventBase{constructor(e,t,n){super(),y(this,"key",void 0),y(this,"value",void 0),y(this,"operator",void 0),this.key=e,this.value=t,this.operator=n}}function O(e,t,n){const r="="===e.operator?"include":"exclude";k(e.key,e.value,r,t,n)}function x(e,t,n,r,a){const i=T(n,e,t);let s=i.state.filters.filter((t=>{const i=(0,p.z2)(n,t);return r&&a?!(t.key===e&&i.value===r&&t.operator===a):r?!(t.key===e&&i.value===r):a?!(t.key===e&&t.operator===a):!(t.key===e)}));t.publishEvent(new w(e,r,a),!0),i.setState({filters:s})}y(w,"type","add-filter");const E=e=>e===g.w7.gt||e===g.w7.gte?"greater":e===g.w7.lt||e===g.w7.lte?"lesser":void 0;function C(e,t,n,r){r||(r=F(e,t));const a=T(r,e,t),i=n?E(n):void 0;let s=a.state.filters.filter((t=>!(t.key===e&&(E(t.operator)===i||t.operator===g.w7.NotEqual))));a.setState({filters:s})}function P(e,t,n,r,a){const i=E(n);a||(a=F(e,r));const s=T(a,e,r);let l;a===o.mB&&(l=JSON.stringify({value:t,parser:(0,d.Ri)(e,r)}));let c=s.state.filters.filter((t=>!(t.key===e&&(E(t.operator)===i||t.operator===g.w7.NotEqual))));c=[...c,{key:e,operator:n,value:l||t,valueLabels:[t]}],s.setState({filters:c}),r.publishEvent(new S("filterButton",n,e,t),!0)}function k(e,t,n,r,a){(0,b.bN)(),a===o.MB&&(0,h._J)(e,t,r);const i=T(a,e,r);let s,l=t;a===o.mB?s=JSON.stringify({value:t,parser:(0,d.Ri)(e,r)}):a===o._Y&&"exclude"===n&&(l=`!${t}`);let c=i.state.filters.filter((r=>{const i=(0,p.z2)(a,r);return"include"===n?!(r.key===e&&r.operator===g.w7.NotEqual):"exclude"===n?!(r.key===e&&r.operator===g.w7.Equal):!(r.key===e&&i.value===t)}));const u=c.length!==i.state.filters.length;("include"===n||"exclude"===n||!u&&"toggle"===n)&&(c=[...c,{key:e,operator:"exclude"===n?g.w7.NotEqual:g.w7.Equal,value:s||t,valueLabels:[l]}]),i.setState({filters:c}),r.publishEvent(new S("filterButton",n,e,t),!0)}function j(e,t){return e===o.e4?o._Y:t}function F(e,t){var n,r;return(null===(r=(0,u.TG)(t))||void 0===r||null===(n=r.fields)||void 0===n?void 0:n.find((t=>t.name===e)))?o.MB:o.mB}class L extends s.Bs{onActivate(){const e=_(this.state.frame);if(e){const t=T(this.state.variableName,e.name,this);this.setFilterState(t),this._subs.add(t.subscribeToState(((e,n)=>{(0,f.B)(e.filters,n.filters)||this.setFilterState(t)})))}}setFilterState(e){const t=_(this.state.frame);if(!t)return void this.setState({isIncluded:!1,isExcluded:!1});const n=e.state.filters.find((e=>{const n=(0,m.OH)(t),r=(0,p.z2)(n?o._P:o.mB,e);return e.key===t.name&&r.value===t.value}));n?this.setState({isIncluded:n.operator===g.w7.Equal,isExcluded:n.operator===g.w7.NotEqual}):this.setState({isIncluded:!1,isExcluded:!1})}constructor(e){super(e),y(this,"onClick",(e=>{const t=_(this.state.frame);if(!t)return;k(t.name,t.value,e,this,this.state.variableName);const n=T(this.state.variableName,t.name,this);(0,l.EE)(l.NO.service_details,l.ir.service_details.add_to_filters_in_breakdown_clicked,{filterType:this.state.variableName,key:t.name,action:e,filtersLength:(null==n?void 0:n.state.filters.length)||0})})),this.addActivationHandler(this.onActivate.bind(this))}}y(L,"Component",(({model:e})=>{const{hideExclude:t,isExcluded:n,isIncluded:r}=e.useState();return a().createElement(c.F,{buttonFill:"outline",isIncluded:null!=r&&r,isExcluded:null!=n&&n,onInclude:()=>e.onClick("include"),onClear:()=>e.onClick("clear"),onExclude:()=>e.onClick("exclude"),hideExclude:t})}));const _=e=>{var t,n;const r=null!==(n=null===(t=e.fields[1])||void 0===t?void 0:t.labels)&&void 0!==n?n:{};if(1!==Object.keys(r).length)return void v.v.warn("getFilter: unexpected empty labels");const a=Object.keys(r)[0];return{name:a,value:r[a]}},T=(e,t,n)=>e===o.mB||e===o._P?(0,p.YS)(n):(0,p.bY)(j(t,e),n)},8313:(e,t,n)=>{n.d(t,{G:()=>f,x:()=>g});var r=n(9736),a=n(5959),i=n.n(a),s=n(158),l=n(9284),o=n(8072),c=n(6830),u=n(7781),d=n(5953);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends u.BusEventBase{}p(g,"type","breakdown-search-reset");const h={};class f extends r.Bs{filterValues(e){const t=r.jh.findObject(this,(e=>e instanceof o.O||e instanceof c.J6));if(t instanceof o.O||t instanceof c.J6){h[this.cacheKey]=e;const n=r.jh.findDescendents(t,s.h);null==n||n.forEach((t=>{t.state.body.isActive&&t.filterByString(e)}))}else d.v.warn("unable to find Breakdown scene",{typeofBody:typeof t,filter:e})}constructor(e){var t;super({filter:null!==(t=h[e])&&void 0!==t?t:""}),p(this,"cacheKey",void 0),p(this,"onValueFilterChange",(e=>{this.setState({filter:e.target.value}),this.filterValues(e.target.value)})),p(this,"clearValueFilter",(()=>{this.setState({filter:""}),this.filterValues("")})),p(this,"reset",(()=>{this.setState({filter:""}),h[this.cacheKey]=""})),this.cacheKey=e}}p(f,"Component",(({model:e})=>{const{filter:t}=e.useState();return i().createElement(l.D,{value:t,onChange:e.onValueFilterChange,onClear:e.clearValueFilter,placeholder:"Search for value"})}))},158:(e,t,n)=>{n.d(t,{h:()=>y});var r=n(5959),a=n.n(r),i=n(7781),s=n(9736),l=n(2601),o=n(9193),c=n(1049),u=n(2007),d=n(6089),p=n(8313),g=n(1269),h=n(6081),f=n(5865),v=n(5953);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}class y extends s.Bs{performRepeat(e){const t=[],n=(0,l.sortSeries)(e.series,this.sortBy,this.direction);for(let e=0;e<n.length;e++){const r=this.state.getLayoutChild(n[e],e);t.push(r)}this.sortedSeries=n,this.unfilteredChildren=t,this.getFilter()?(this.state.body.setState({children:[]}),this.filterByString(this.getFilter())):this.state.body.setState({children:t})}filterSummaryChart(e){const t=s.jh.getAncestor(this,h.U);if(t){const n=s.jh.findAllObjects(t,(e=>e.isActive&&e.state.key===f.s$));if(n[0]instanceof s.G1){const t=s.jh.findDescendents(n[0],s.Eb)[0];t instanceof s.Eb?t.setState({$data:new s.Es({transformations:[()=>{return t=e[0],e=>e.pipe((0,g.map)((e=>{if(!t||!t.length)return e;let n=[];return e.forEach((e=>{const r=(0,c.ee)(e);t.includes(r)&&n.push(e)})),n})));var t}]})}):v.v.warn("filterSummaryChart: VizPanel not found",{typeofPanel:typeof t})}else v.v.warn("filterSummaryChart: SceneFlexItem not found",{typeofGraphParent:typeof n})}}constructor(e){var{sortBy:t,direction:n,getFilter:r}=e;super(b(e,["sortBy","direction","getFilter"])),m(this,"unfilteredChildren",[]),m(this,"sortBy",void 0),m(this,"direction",void 0),m(this,"sortedSeries",[]),m(this,"getFilter",void 0),m(this,"sort",((e,t)=>{const n=s.jh.getData(this);this.sortBy=e,this.direction=t,n.state.data&&this.performRepeat(n.state.data)})),m(this,"iterateFrames",(e=>{if(s.jh.getData(this).state.data)for(let t=0;t<this.sortedSeries.length;t++)e(this.sortedSeries,t)})),m(this,"filterByString",(e=>{let t=[];this.iterateFrames(((e,n)=>{const r=(0,c.ee)(e[n]);t.push(r)})),(0,o.X)(t,e,(e=>{e&&e[0]?this.filterFrames((t=>{const n=(0,c.ee)(t);return e[0].includes(n)})):this.filterFrames((()=>!0)),this.filterSummaryChart(e)}))})),m(this,"filterFrames",(e=>{const t=[];if(this.iterateFrames(((n,r)=>{e(n[r])&&t.push(this.unfilteredChildren[r])})),0===t.length){const e=this.getFilter();this.state.body.setState({children:[S(e,this.clearFilter)]})}else this.state.body.setState({children:t})})),m(this,"clearFilter",(()=>{this.publishEvent(new p.x,!0)})),this.sortBy=t,this.direction=n,this.getFilter=r,this.addActivationHandler((()=>{const e=s.jh.getData(this);this._subs.add(e.subscribeToState(((e,t)=>{var n,r,a,s;((null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done||(null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Streaming&&e.data.series.length>(null!==(s=null===(a=t.data)||void 0===a?void 0:a.series.length)&&void 0!==s?s:0))&&this.performRepeat(e.data)}))),e.state.data&&this.performRepeat(e.state.data)}))}}function S(e,t){return new s.G1({direction:"row",children:[new s.vA({body:new s.dM({reactNode:a().createElement("div",{className:w.alertContainer},a().createElement(u.Alert,{title:"",severity:"info",className:w.noResultsAlert},"No values found matching â€œ",e,"â€",a().createElement(u.Button,{className:w.clearButton,onClick:t},"Clear filter")))})})]})}m(y,"Component",(({model:e})=>{const{body:t}=e.useState();return a().createElement(t.Component,{model:t})}));const w={alertContainer:(0,d.css)({flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"}),noResultsAlert:(0,d.css)({minWidth:"30vw",flexGrow:0}),clearButton:(0,d.css)({marginLeft:"1.5rem"})}},713:(e,t,n)=>{n.d(t,{a:()=>c});var r=n(9736),a=n(7191),i=n(2007),s=n(5959),l=n.n(s),o=n(6830);class c extends r.Bs{static Component({model:e}){const{type:t}=e.useState();return l().createElement(a.R,null,l().createElement(i.Alert,{title:"",severity:"warning"},"We did not find any ",t," for the given timerange. Please"," ",l().createElement("a",{className:o.ZI.link,href:"https://forms.gle/1sYWCTPvD72T1dPH9",target:"_blank",rel:"noopener noreferrer"},"let us know")," ","if you think this is a mistake."))}}},7243:(e,t,n)=>{n.d(t,{f:()=>p,u:()=>d});var r=n(6089),a=n(5959),i=n.n(a),s=n(2007),l=n(3571),o=n(7985);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function d({options:e,value:t,onChange:n,label:r}){const l=(0,s.useStyles2)(g),[o,c]=(0,a.useState)(!1),u=e.map((e=>({label:e.label,value:e.value})));return i().createElement(s.InlineField,{className:l.selectWrapper,label:r},i().createElement(s.Select,{options:u,value:t,onOpenMenu:()=>c(!0),onCloseMenu:()=>c(!1),onChange:e=>n(e.value),className:l.select,prefix:o?void 0:i().createElement(s.Icon,{name:"search"})}))}function p({options:e,value:t,onChange:n,label:r,selectOption:d,isLoading:p,initialFilter:h}){var f;const v=(0,s.useStyles2)(g),[m,b]=(0,a.useState)(!1),[y,S]=(0,a.useState)(h),w=e.map((e=>({label:e.label,value:e.value}))),O=y&&t&&(null===(f=y.value)||void 0===f?void 0:f.includes(t))?[y,...w]:w,x=null==O?void 0:O.find((e=>e.value===t));return i().createElement(s.InlineField,{className:v.serviceSceneSelectWrapper,label:r},i().createElement(s.Select,{isLoading:p,"data-testid":l.b.exploreServiceSearch.search,placeholder:"Search values",options:O,isClearable:!0,value:t,onOpenMenu:()=>b(!0),onCloseMenu:()=>b(!1),allowCustomValue:!0,prefix:m||(null==x?void 0:x.__isNew__)?void 0:i().createElement(s.Icon,{name:"search"}),onChange:(e,t)=>(null==e?void 0:e.__isNew__)||(null==e?void 0:e.icon)?(S(u(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){c(e,t,n[t])}))}return e}({},e),{icon:"filter"})),n(e.value)):"clear"===t.action?n(""):void("select-option"===t.action&&e.value&&!e.__isNew__&&d(e.value)),onInputChange:(e,t)=>{const r=t;return"input-change"===r.action?n(e):"menu-close"===r.action&&r.prevInputValue?(S({value:(0,o.vC)(r.prevInputValue),label:r.prevInputValue,icon:"filter",__isNew__:!0}),n(r.prevInputValue)):void 0}}))}function g(e){return{input:(0,r.css)({marginBottom:0}),select:(0,r.css)({maxWidth:e.spacing(64),minWidth:e.spacing(20)}),selectWrapper:(0,r.css)({label:"field-selector-select-wrapper",maxWidth:e.spacing(62.5),minWidth:e.spacing(20),marginRight:e.spacing.x1,marginBottom:0}),serviceSceneSelectWrapper:(0,r.css)({label:"service-select-wrapper",maxWidth:e.spacing(62.5),minWidth:e.spacing(20),marginRight:e.spacing.x1,marginBottom:0})}}},2969:(e,t,n)=>{n.d(t,{u:()=>F});var r,a,i,s=n(9736),l=n(7985),o=n(4351),c=n(7781),u=n(6081),d=n(1475),p=n(158),g=n(2007),h=n(376),f=n(1049),v=n(20),m=n(5959),b=n.n(m),y=n(6830),S=n(7352),w=n(2601),O=n(5553),x=n(5700),E=n(5865),C=n(1532),P=n(5953);function k(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){k(i,r,a,s,l,"next",e)}function l(e){k(i,r,a,s,l,"throw",e)}s(void 0)}))}}class F extends s.Bs{static Selector({model:e}){const{body:t}=e.useState();return t instanceof u.U?b().createElement(b().Fragment,null,t&&b().createElement(u.U.Selector,{model:t})):b().createElement(b().Fragment,null)}getTagKey(){const e=(0,O.Hj)(this);return String(e.state.value)}onActivate(){var e;const t=this.buildQuery();this.setState({body:this.build(t),$data:this.buildQueryRunner()}),this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState((e=>{this.onValuesDataQueryChange(e,t)}))),this.runQuery(),this.setSubscriptions()}buildQueryRunner(){const e=this.buildQuery();return(0,d.rS)([e],{runQueriesMode:"manual"})}buildQuery(){const e=this.getTagKey(),t=(0,O.ir)(this),n=(0,S.rD)(this),r=(0,h.Jl)(e,t,n),{variableName:a,filterExpression:i}=this.removeFieldLabelFromVariableInterpolation(),o=s.jh.interpolate(this,r.replace(`\${${a}}`,i));return(0,l.l)(o,{legendFormat:`{{${e}}}`,refId:e})}setSubscriptions(){this._subs.add(s.jh.getTimeRange(this).subscribeToState((()=>{this.runQuery()}))),this._subs.add((0,O.Gk)(this).subscribeToState(((e,t)=>{(0,C.B)(e.filters,t.filters)||this.runQuery()}))),this._subs.add((0,O.Ku)(this).subscribeToState(((e,t)=>{e.value!==t.value&&this.runQuery()}))),this._subs.add((0,O.cR)(this).subscribeToState(((e,t)=>{(0,C.B)(e.filters,t.filters)||this.runQuery()}))),this._subs.add((0,O.iw)(this).subscribeToState(((e,t)=>{(0,C.B)(e.filters,t.filters)||this.runQuery()})));const{parser:e}=this.getParserForThisField();"structuredMetadata"!==e?this.setFieldParserSubscriptions():this.setMetadataParserSubscriptions()}setMetadataParserSubscriptions(){const e=this.getTagKey();var t=this;this._subs.add((0,O.ir)(this).subscribeToState(function(){var e=j((function*(e,n){(0,C.B)(e.filters,n.filters)||t.runQuery()}));return function(t,n){return e.apply(this,arguments)}}()));var n=this;this._subs.add((0,O.oY)(this).subscribeToState(function(){var t=j((function*(t,r){(0,C.B)(t.filters.filter((t=>t.key!==e)),r.filters.filter((t=>t.key!==e)))||n.runQuery()}));return function(e,n){return t.apply(this,arguments)}}()))}setFieldParserSubscriptions(){const e=this.getTagKey();var t=this;this._subs.add((0,O.oY)(this).subscribeToState(function(){var e=j((function*(e,n){(0,C.B)(e.filters,n.filters)||t.runQuery()}));return function(t,n){return e.apply(this,arguments)}}()));var n=this;this._subs.add((0,O.ir)(this).subscribeToState(function(){var t=j((function*(t,r){(0,C.B)(t.filters.filter((t=>t.key!==e)),r.filters.filter((t=>t.key!==e)))||n.runQuery()}));return function(e,n){return t.apply(this,arguments)}}()))}rebuildQuery(){var e;const t=this.buildQuery();null===(e=this.getSceneQueryRunner())||void 0===e||e.setState({queries:[t]})}runQuery(){this.rebuildQuery();const e=this.getSceneQueryRunner();null==e||e.runQueries()}getSceneQueryRunner(){if(this.state.$data){const e=s.jh.findDescendents(this.state.$data,s.dt);if(1!==e.length){const e=new Error("Unable to find query runner in value breakdown!");throw P.v.error(e,{msg:"FieldValuesBreakdownScene: Unable to find query runner in value breakdown!"}),e}return e[0]}P.v.warn("FieldValuesBreakdownScene: Query is attempting to execute, but query runner is undefined!")}removeFieldLabelFromVariableInterpolation(){const e=this.getTagKey();let t,n;if("structuredMetadata"===this.getQueryParser()){const r=(0,O.oY)(this);n=v._P,t=(0,l.E3)(r.state.filters,[e])}else{n=v.mB;const r=(0,O.ir)(this);t=(0,l.ZX)(r.state.filters,[e])}return{filterExpression:t,variableName:n}}onValuesDataQueryChange(e,t){var n,r;(null===(n=e.data)||void 0===n?void 0:n.state)===c.LoadingState.Done&&this.state.body instanceof s.dM&&this.setState({body:this.build(t)}),(null===(r=e.data)||void 0===r?void 0:r.state)===c.LoadingState.Error&&this.setErrorState(e.data.errors)}setErrorState(e){this.setState({body:new s.dM({reactNode:b().createElement(g.Alert,{title:"Something went wrong with your request",severity:"error"},null==e?void 0:e.map(((e,t)=>b().createElement("div",{key:t},e.status&&b().createElement(b().Fragment,null,b().createElement("strong",null,"Status"),": ",e.status," ",b().createElement("br",null)),e.message&&b().createElement(b().Fragment,null,b().createElement("strong",null,"Message"),": ",e.message," ",b().createElement("br",null)),e.traceId&&b().createElement(b().Fragment,null,b().createElement("strong",null,"TraceId"),": ",e.traceId)))))})})}build(e){const{optionValue:t,parser:n}=this.getParserForThisField(),{sortBy:r,direction:a}=(0,o.vs)("fields",w.DEFAULT_SORT_BY,"desc"),i=s.jh.getAncestor(this,y.J6),l=()=>{var e;return null!==(e=i.state.search.state.filter)&&void 0!==e?e:""};return new u.U({options:[{value:"single",label:"Single"},{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new s.G1({direction:"column",children:[new s.dM({reactNode:b().createElement(y.J6.LabelsMenu,{model:i})}),new s.vA({minHeight:300,body:s.d0.timeseries().setTitle(t).setShowMenuAlways(!0).setMenu(new x.GD({})).build()})]}),new s.G1({direction:"column",children:[new s.dM({reactNode:b().createElement(y.J6.LabelsMenu,{model:i})}),new E.s7({title:t,type:"field",tagKey:this.getTagKey()}),new s.dM({reactNode:b().createElement(y.J6.ValuesMenu,{model:i})}),new p.h({body:new s.gF({templateColumns:y.OK,autoRows:"200px",children:[new s.vA({body:new s.dM({reactNode:b().createElement(g.LoadingPlaceholder,{text:"Loading..."})})})],isLazy:!0}),getLayoutChild:(0,h.Zp)(f.ee,(null==e?void 0:e.expr.includes("count_over_time"))?g.DrawStyle.Bars:g.DrawStyle.Line,"structuredMetadata"===n?v._P:v.mB,s.jh.getAncestor(this,y.J6).state.sort,t),sortBy:r,direction:a,getFilter:l})]}),new s.G1({direction:"column",children:[new s.dM({reactNode:b().createElement(y.J6.LabelsMenu,{model:i})}),new E.s7({title:t,type:"field",tagKey:this.getTagKey()}),new s.dM({reactNode:b().createElement(y.J6.ValuesMenu,{model:i})}),new p.h({body:new s.gF({templateColumns:"1fr",autoRows:"200px",children:[new s.vA({body:new s.dM({reactNode:b().createElement(g.LoadingPlaceholder,{text:"Loading..."})})})],isLazy:!0}),getLayoutChild:(0,h.Zp)(f.ee,(null==e?void 0:e.expr.includes("count_over_time"))?g.DrawStyle.Bars:g.DrawStyle.Line,"structuredMetadata"===n?v._P:v.mB,s.jh.getAncestor(this,y.J6).state.sort,t),sortBy:r,direction:a,getFilter:l})]})]})}getParserForThisField(){const e=(0,O.Hj)(this),t=String(e.state.value);return{optionValue:t,parser:(0,h.Ri)(t,this)}}getParserForFields(){return(0,h.k$)((0,O.ir)(this))}getQueryParser(){const{parser:e}=this.getParserForThisField(),t=this.getParserForFields();return e===t?t:void 0===e?"mixed":"structuredMetadata"===e?t:"structuredMetadata"===t?e:"mixed"}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}i=({model:e})=>{const{body:t}=e.useState(),n=(0,g.useStyles2)(x.K_);return t?b().createElement("span",{className:n.panelWrapper},t&&b().createElement(t.Component,{model:t})):b().createElement(g.LoadingPlaceholder,{text:"Loading..."})},(a="Component")in(r=F)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i},7813:(e,t,n)=>{n.d(t,{E:()=>x});var r=n(9736),a=n(20),i=n(7985),s=n(1475),l=n(2007),o=n(6081),c=n(6830),u=n(7352),d=n(5959),p=n.n(d),g=n(2606),h=n(9683),f=n(7781),v=n(376),m=n(5553),b=n(5700),y=n(5953),S=n(4351),w=n(4059);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class x extends r.Bs{updateChildren(e,t=void 0){var n;const a=(0,u.UO)(e),i=(0,u.nU)(e),s=(0,u.dB)(e),l=this.calculateCardinalityMap(e);null===(n=this.state.body)||void 0===n||n.state.layouts.forEach((e=>{if(e instanceof r.gF){const n=new Set(null==i?void 0:i.values),o=e.state.children;for(let l=0;l<o.length;l++){const c=e.state.children[l];if(c instanceof r.xK){const e=c.state.body;if(e instanceof r.Eb){if(t){const n=null==i?void 0:i.values.indexOf(e.state.title);if((n&&-1!==n?null==s?void 0:s.values[n]:void 0)!==t){const t=(0,v.ph)(e.state.title,a),n=this.getQueryRunnerForPanel(e.state.title,a,t);e.setState({$data:n})}}n.has(e.state.title)?n.delete(e.state.title):(o.splice(l,1),l--)}else y.v.warn("panel is not VizPanel!")}else y.v.warn("gridItem is not SceneCSSGridItem")}const c=Array.from(n).map((e=>e));o.push(...this.buildChildren(c)),o.sort(this.sortChildren(l)),o.map((e=>{this.subscribeToPanel(e)})),e.setState({children:o})}else y.v.warn("Layout is not SceneCSSGridLayout")}))}sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;var i;const s=null!==(i=e.get(r.state.title))&&void 0!==i?i:0;var l;return(null!==(l=e.get(a.state.title))&&void 0!==l?l:0)-s}}calculateCardinalityMap(e){const t=(0,u.UO)(e),n=new Map;if(null==t?void 0:t.length)for(let e=0;e<(null==t?void 0:t.length);e++){const r=t.fields[0].values[e],a=t.fields[1].values[e];n.set(r,a)}return n}onActivate(){var e;this.setState({body:this.build()});const t=r.jh.getAncestor(this,u.Mn);void 0===t.state.fieldsCount&&this.updateFieldCount(),this._subs.add(null===(e=t.state.$detectedFieldsData)||void 0===e?void 0:e.subscribeToState(this.onDetectedFieldsChange)),this._subs.add(this.subscribeToFieldsVar())}subscribeToFieldsVar(){return(0,m.ir)(this).subscribeToState(((e,t)=>{const n=r.jh.getAncestor(this,u.Mn),a=e.filters.map((e=>(0,m.bu)(e).parser)),i=t.filters.map((e=>(0,m.bu)(e).parser)),s=(0,v.Qg)(a);if(s!==(0,v.Qg)(i)){var l;const e=null===(l=n.state.$detectedFieldsData)||void 0===l?void 0:l.state;e&&this.updateChildren(e,s)}}))}build(){var e;const t=(0,m.Hj)(this).state.options.map((e=>String(e.value)));r.jh.getAncestor(this,c.J6).state.search.reset();const n=this.buildChildren(t),a=r.jh.getAncestor(this,u.Mn),i=this.calculateCardinalityMap(null===(e=a.state.$detectedFieldsData)||void 0===e?void 0:e.state);n.sort(this.sortChildren(i));const s=n.map((e=>e.clone()));return[...n,...s].map((e=>{this.subscribeToPanel(e)})),new o.U({options:[{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new r.gF({templateColumns:c.OK,autoRows:"200px",children:n,isLazy:!0}),new r.gF({templateColumns:"1fr",autoRows:"200px",children:s,isLazy:!0})]})}subscribeToPanel(e){const t=e.state.body;var n;t&&this._subs.add(null==t||null===(n=t.state.$data)||void 0===n?void 0:n.getResultsStream().subscribe((t=>{t.data.errors&&t.data.errors.length>0&&(e.setState({isHidden:!0}),this.updateFieldCount())})))}rebuildAvgFields(){const e=(0,u.rD)(this),t=this.getActiveGridLayouts(),n=[];var a;const i=null!==(a=(0,S.ex)("panelType",[b.ls.histogram,b.ls.timeseries]))&&void 0!==a?a:b.ls.timeseries;null==t||t.state.children.forEach((t=>{if(t instanceof r.xK&&!t.state.isHidden){const a=r.jh.findDescendents(t,r.Eb);if(a.length){const r=a[0].state.title,s=(0,v.ph)(r,e);if((0,v.JI)(s)){const t=this.buildChild(r,e,i);t&&n.push(t)}else n.push(t)}}})),n.length&&(null==t||t.setState({children:n}))}buildChildren(e){const t=[],n=(0,u.rD)(this);var r;const i=null!==(r=(0,S.ex)("panelType",[b.ls.timeseries,b.ls.histogram]))&&void 0!==r?r:b.ls.timeseries;for(const r of e){if(r===a.To||!r)continue;const e=this.buildChild(r,n,i);e&&t.push(e)}return t}buildChild(e,t,n){if(e===a.To||!e)return;const i=(0,v.ph)(e,t),o=this.getQueryRunnerForPanel(e,t,i);let c;const u=[];(0,v.JI)(i)?(c="histogram"===n?r.d0.histogram():r.d0.timeseries(),c.setTitle(e).setData(o).setMenu(new b.GD({investigationOptions:{labelName:e},panelType:n})),u.push(new g.X({labelName:String(e),hideValueDrilldown:!0,fieldType:h._J.field}))):(c=r.d0.timeseries().setTitle(e).setData(o).setMenu(new b.GD({investigationOptions:{labelName:e}})).setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars).setOverrides(s.jC),u.push(new g.X({labelName:String(e),fieldType:h._J.field}))),c.setHeaderActions(u),c.setSeriesLimit(w.l),c.setShowMenuAlways(!0);const d=c.build();return new r.xK({body:d})}getQueryRunnerForPanel(e,t,n){const r=(0,m.ir)(this),a=(0,v.Jl)(e,r,t),l=(0,i.l)(a,{legendFormat:(0,v.JI)(n)?e:`{{${e}}}`,refId:e});return(0,s.rS)([l])}getActiveGridLayouts(){var e,t,n;return null!==(n=null===(e=this.state.body)||void 0===e?void 0:e.state.layouts.find((e=>e.isActive)))&&void 0!==n?n:null===(t=this.state.body)||void 0===t?void 0:t.state.layouts[0]}updateFieldCount(){var e,t;const n=this.getActiveGridLayouts(),a=null==n?void 0:n.state.children,i=null==a?void 0:a.filter((e=>!e.state.isHidden));var s;null===(e=(t=r.jh.getAncestor(this,c.J6).state).changeFieldCount)||void 0===e||e.call(t,null!==(s=null==i?void 0:i.length)&&void 0!==s?s:0)}static Selector({model:e}){const{body:t}=e.useState();return p().createElement(p().Fragment,null,t&&p().createElement(o.U.Selector,{model:t}))}constructor(e){super(e),O(this,"onDetectedFieldsChange",(e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===f.LoadingState.Done&&this.updateChildren(e)})),this.addActivationHandler(this.onActivate.bind(this))}}O(x,"Component",(({model:e})=>{const{body:t}=e.useState(),n=(0,l.useStyles2)(b.K_);return t?p().createElement("span",{className:n.panelWrapper},t&&p().createElement(t.Component,{model:t})):p().createElement(l.LoadingPlaceholder,{text:"Loading..."})}))},6830:(e,t,n)=>{n.d(t,{J6:()=>N,OK:()=>D,ZI:()=>$});var r=n(6089),a=n(5959),i=n.n(a),s=n(7781),l=n(9736),o=n(2007),c=n(4509),u=n(4351),d=n(20),p=n(1532),g=n(4702),h=n(7478),f=n(9683),v=n(2601),m=n(2661),b=n(7352),y=n(8313),S=n(158),w=n(7813),O=n(7243),x=n(2969),E=n(6081),C=n(1049),P=n(5659),k=n(8502),j=n(713),F=n(5553),L=n(6779),_=n(5548);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const D="repeat(auto-fit, minmax(400px, 1fr))";class N extends l.Bs{onActivate(){var e,t,n;const r=(0,F.Hj)(this),a=l.jh.getAncestor(this,b.Mn);this.setState({loading:(null===(t=a.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)!==s.LoadingState.Done}),this._subs.add(this.subscribeToEvent(y.x,(()=>{this.state.search.clearValueFilter()}))),this._subs.add(this.subscribeToEvent(C.gf,this.handleSortByChange)),this._subs.add(r.subscribeToState(this.variableChanged)),this._subs.add((0,F.cR)(this).subscribeToState(((e,t)=>{const n=(0,F.Hj)(this);let{labelName:r}=(0,f.W6)();const a=e.filters.find((e=>e.key===r)),i=t.filters.find((e=>e.key===r));n.state.value===d.To&&a!==i&&this.setState({loading:!0,body:void 0})}))),this._subs.add(null===(n=a.state.$detectedFieldsData)||void 0===n?void 0:n.subscribeToState(((e,t)=>{var n,r,a;(null===(n=e.data)||void 0===n?void 0:n.state)===s.LoadingState.Done&&((null===(r=e.data.series)||void 0===r?void 0:r[0])&&this.updateOptions(null===(a=e.data.series)||void 0===a?void 0:a[0]))})));const i=(0,b.rD)(this);i&&this.updateOptions(i),(0,f.NX)(this)}updateOptions(e){if(!e||!e.length){const e=l.jh.getAncestor(this,m.P);let r;var t,n;if((0,_.mE)(e).length>1)null===(t=(n=this.state).changeFieldCount)||void 0===t||t.call(n,0),r=new L.W({clearCallback:()=>(0,_.rA)(this)});else r=new j.a({type:"fields"});return void this.setState({loading:!1,body:r})}const r=l.jh.getAncestor(this,b.Mn);var a;(0,F.Hj)(this).setState({options:(0,k.rd)(e.fields[0].values.map((e=>String(e)))),loading:!1,value:null!==(a=r.state.drillDownLabel)&&void 0!==a?a:d.To}),this.setState({loading:!1})}updateBody(e){const t=(0,F.Hj)(this);if(!t.state.options||!t.state.options.length)return;const n={};if(t.state.options&&t.state.options.length<=1){const e=l.jh.getAncestor(this,m.P);var r,a;if((0,_.mE)(e).length>1)null===(r=(a=this.state).changeFieldCount)||void 0===r||r.call(a,0),n.body=new L.W({clearCallback:()=>(0,_.rA)(this)});else n.body=new j.a({type:"fields"})}else e.value===d.To&&this.state.body instanceof x.u?n.body=new w.E({}):e.value!==d.To&&this.state.body instanceof w.E?n.body=new x.u({}):(void 0===this.state.body||this.state.body instanceof j.a||this.state.body instanceof L.W)&&(n.body=e.value===d.To?new w.E({}):new x.u({}));this.setState(n)}constructor(e){var t,n,r,a;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){T(e,t,n[t])}))}return e}({$variables:null!==(r=e.$variables)&&void 0!==r?r:new l.Pj({variables:[new g.m({name:d.LI,defaultToAll:!1,includeAll:!0,value:null!==(t=e.value)&&void 0!==t?t:d.To,options:null!==(n=e.options)&&void 0!==n?n:[]})]}),loading:!0,sort:new C.wd({target:"fields"}),search:new y.G("fields"),value:null!==(a=e.value)&&void 0!==a?a:d.To},e)),T(this,"_variableDependency",new l.Sh(this,{variableNames:[d.MB]})),T(this,"variableChanged",((e,t)=>{(e.value!==t.value||!(0,p.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof j.a||this.state.body instanceof L.W)&&this.updateBody(e)})),T(this,"handleSortByChange",(e=>{if("fields"!==e.target)return;const t=this.state.body;var n;t instanceof x.u&&t.state.body instanceof E.U&&(null===(n=t.state.body)||void 0===n||n.state.layouts.forEach((n=>{l.jh.findDescendents(t,S.h).forEach((t=>t.sort(e.sortBy,e.direction)))})));(0,c.EE)(c.NO.service_details,c.ir.service_details.value_breakdown_sort_change,{target:"fields",criteria:e.sortBy,direction:e.direction})})),T(this,"onFieldSelectorChange",(e=>{if(!e)return;const t=(0,F.Hj)(this),{sortBy:n,direction:r}=(0,u.vs)("fields",v.DEFAULT_SORT_BY,"desc");(0,c.EE)(c.NO.service_details,c.ir.service_details.select_field_in_breakdown_clicked,{field:e,previousField:t.getValueText(),view:"fields",sortBy:n,sortByDirection:r});const a=l.jh.getAncestor(this,b.Mn);(0,h.fg)(f._J.field,e,a)})),this.addActivationHandler(this.onActivate.bind(this))}}T(N,"LabelsMenu",(({model:e})=>{const{body:t,loading:n,search:r}=e.useState(),a=(0,o.useStyles2)(I),s=(0,F.Hj)(e),{options:l,value:c}=s.useState();return i().createElement("div",{className:a.labelsMenuWrapper},t instanceof w.E&&i().createElement(w.E.Selector,{model:t}),t instanceof x.u&&i().createElement(x.u.Selector,{model:t}),t instanceof x.u&&i().createElement(r.Component,{model:r}),!n&&l.length>1&&i().createElement(O.u,{label:"Field",options:l,value:String(c),onChange:e.onFieldSelectorChange}))})),T(N,"ValuesMenu",(({model:e})=>{const{loading:t,sort:n}=e.useState(),r=(0,o.useStyles2)(I),a=(0,F.Hj)(e),{value:s}=a.useState();return i().createElement("div",{className:r.valuesMenuWrapper},!t&&s!==d.To&&i().createElement(i().Fragment,null,i().createElement(n.Component,{model:n})))})),T(N,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r}=e.useState(),a=(0,o.useStyles2)(I);return i().createElement("div",{className:a.container},i().createElement(P.O,{isLoading:n,blockingMessage:r},t instanceof w.E&&e&&i().createElement(N.LabelsMenu,{model:e}),i().createElement("div",{className:a.content},t&&i().createElement(t.Component,{model:t}))))}));const $={link:(0,r.css)({textDecoration:"underline"}),button:(0,r.css)({marginLeft:"1.5rem"})};function I(e){return{container:(0,r.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column",gap:e.spacing(1)}),content:(0,r.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),labelsMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",justifyContent:"space-between",flexDirection:"row-reverse",gap:e.spacing(2)}),valuesMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",gap:e.spacing(2),flexDirection:"row"})}}},8072:(e,t,n)=>{n.d(t,{O:()=>A});var r=n(6089),a=n(5959),i=n.n(a),s=n(7781),l=n(9736),o=n(2007),c=n(4509),u=n(9683),d=n(20),p=n(158),g=n(7243),h=n(5659),f=n(8502),v=n(8313),m=n(4351),b=n(1049),y=n(7352),S=n(4702),w=n(7478),O=n(1532),x=n(6887),E=n(6081),C=n(1475),P=n(2606),k=n(42),j=n(5553),F=n(5700),L=n(4059);function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class T extends l.Bs{onActivate(){var e;const t=(0,j.ir)(this),n=l.jh.getAncestor(this,y.Mn).state.$detectedLabelsData;this.state.body?(null==n||null===(e=n.state.data)||void 0===e?void 0:e.state)===s.LoadingState.Done&&this.update(null==n?void 0:n.state.data.series[0]):this.setState({body:this.build()}),this._subs.add(null==n?void 0:n.subscribeToState(((e,t)=>{var n;(null===(n=e.data)||void 0===n?void 0:n.state)===s.LoadingState.Done&&this.update(e.data.series[0])}))),this._subs.add(t.subscribeToState((()=>{this.updateQueriesOnFieldsVariableChange()})))}getPanelByIndex(e,t){const n=e.state.children[t].state.body;return{panel:n,title:n.state.title}}update(e){var t;const n=(0,j.P4)(this).state.options.filter((e=>e.value!==d.To)).map((e=>e.label));null===(t=this.state.body)||void 0===t||t.state.layouts.forEach((t=>{let r=[];const a=t,i=new Set(n),s=a.state.children;for(let e=0;e<s.length;e++){const{title:t}=this.getPanelByIndex(a,e);i.has(t)?i.delete(t):(s.splice(e,1),e--),r.push(t)}const l=Array.from(i).map((e=>({label:e,value:e})));s.push(...this.buildChildren(l));const o=this.calculateCardinalityMap(e);s.sort(this.sortChildren(o)),a.setState({children:s})}))}calculateCardinalityMap(e){const t=new Map;if(null==e?void 0:e.length)for(let n=0;n<(null==e?void 0:e.fields.length);n++){const r=e.fields[n].name,a=e.fields[n].values[0];t.set(r,a)}return t}build(){var e;const t=(0,j.P4)(this);l.jh.getAncestor(this,A).state.search.reset();const n=this.buildChildren(t.state.options),r=l.jh.getAncestor(this,y.Mn).state.$detectedLabelsData;if((null==r||null===(e=r.state.data)||void 0===e?void 0:e.state)===s.LoadingState.Done){const e=this.calculateCardinalityMap(null==r?void 0:r.state.data.series[0]);n.sort(this.sortChildren(e))}const a=n.map((e=>e.clone()));return new E.U({options:[{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new l.gF({isLazy:!0,templateColumns:k.di,autoRows:"200px",children:n}),new l.gF({isLazy:!0,templateColumns:"1fr",autoRows:"200px",children:a})]})}buildChildren(e){const t=[];for(const n of e){const{value:e}=n,r=String(e);if(e===d.To||!e)continue;const a=(0,k.oj)(this,String(n.value),String(n.value)),i=(0,C.rS)([a]);t.push(new l.xK({body:l.d0.timeseries().setTitle(r).setData(i).setHeaderActions([new P.X({labelName:r,fieldType:u._J.label})]).setCustomFieldConfig("stacking",{mode:o.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",o.DrawStyle.Bars).setHoverHeader(!1).setShowMenuAlways(!0).setOverrides(C.jC).setMenu(new F.GD({investigationOptions:{labelName:r}})).setSeriesLimit(L.l).build()}))}return t}sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;if(r.state.title===d.e4)return-1;if(a.state.title===d.e4)return 1;var i;const s=null!==(i=e.get(r.state.title))&&void 0!==i?i:0;var l;return(null!==(l=e.get(a.state.title))&&void 0!==l?l:0)-s}}static Selector({model:e}){const{body:t}=e.useState();return i().createElement(i().Fragment,null,t&&i().createElement(E.U.Selector,{model:t}))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_(e,t,n[t])}))}return e}({},e)),_(this,"updateQueriesOnFieldsVariableChange",(()=>{var e;null===(e=this.state.body)||void 0===e||e.state.layouts.forEach((e=>{const t=e;for(let e=0;e<t.state.children.length;e++){const{panel:a,title:i}=this.getPanelByIndex(t,e),s=a.state.$data,o=(0,k.oj)(this,i,i);var n,r;if(s instanceof l.dt)if(o.expr===(null==s||null===(r=s.state.queries)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.expr))break;a.setState({$data:(0,C.rS)([o])})}}))})),this.addActivationHandler(this.onActivate.bind(this))}}_(T,"Component",(({model:e})=>{const{body:t}=e.useState(),n=(0,o.useStyles2)(F.K_);return t?i().createElement("span",{className:n.panelWrapper},t&&i().createElement(t.Component,{model:t})):i().createElement(o.LoadingPlaceholder,{text:"Loading..."})}));var D=n(2601),N=n(713);function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$(e,t,n[t])}))}return e}function B(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class A extends l.Bs{onActivate(){var e,t,n,r,a;const i=l.jh.getAncestor(this,y.Mn),o=(0,j.P4)(this);this.setState({loading:(null===(t=i.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)!==s.LoadingState.Done,error:(null===(r=i.state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.state)===s.LoadingState.Error}),this._subs.add(this.subscribeToEvent(v.x,(()=>{this.state.search.clearValueFilter()}))),this._subs.add(this.subscribeToEvent(b.gf,this.handleSortByChange)),this._subs.add(null===(a=i.state.$detectedLabelsData)||void 0===a?void 0:a.subscribeToState(this.onDetectedLabelsDataChange)),this._subs.add((0,j.cR)(this).subscribeToState(((e,t)=>{this.onLabelsVariableChange(e,t)}))),this._subs.add(o.subscribeToState(((e,t)=>{this.onGroupByVariableChange(e,t)})));const c=(0,y.TG)(this);c&&this.updateOptions(c),(0,u.NX)(this)}onGroupByVariableChange(e,t){(e.value!==t.value||!(0,O.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof N.a)&&this.updateBody()}onLabelsVariableChange(e,t){let{labelName:n}=(0,u.W6)();n===d.ky&&(n=d.OX);const r=(0,j.P4)(this),a=e.filters.find((e=>e.key===n)),i=t.filters.find((e=>e.key===n));r.state.value===d.To&&a!==i&&this.setState({loading:!0,body:void 0,error:void 0})}updateOptions(e){if(!e||!e.length)return void this.setState({loading:!1,body:new N.a({type:"labels"})});const t=(0,j.P4)(this),n=(0,f.dD)(e.fields.map((e=>e.name)));var r;t.setState({loading:!1,options:n,value:null!==(r=this.state.value)&&void 0!==r?r:d.To})}updateBody(){const e=(0,j.P4)(this);if(!e.state.options||!e.state.options.length)return;const t={loading:!1,blockingMessage:void 0,error:!1};e.hasAllValue()&&this.state.body instanceof x.u?t.body=new T({}):!e.hasAllValue()&&this.state.body instanceof T?t.body=new x.u({}):void 0===this.state.body?e.state.options.length>0?t.body=e.hasAllValue()?new T({}):new x.u({}):t.body=new N.a({type:"labels"}):this.state.body instanceof N.a&&e.state.options.length>0&&(t.body=e.hasAllValue()?new T({}):new x.u({})),this.setState(I({},t))}constructor(e){var t,n,r;super(B(I({},e),{$variables:null!==(r=e.$variables)&&void 0!==r?r:new l.Pj({variables:[new S.m({name:d.Jg,defaultToAll:!1,includeAll:!0,value:null!==(t=e.value)&&void 0!==t?t:d.To,options:null!==(n=e.options)&&void 0!==n?n:[]})]}),loading:!0,sort:new b.wd({target:"labels"}),search:new v.G("labels"),value:e.value})),$(this,"_variableDependency",new l.Sh(this,{variableNames:[d.MB]})),$(this,"onDetectedLabelsDataChange",((e,t)=>{var n,r,a,i,l,o,c,u,d;if((null===(n=e.data)||void 0===n?void 0:n.state)===s.LoadingState.Done&&(null===(r=e.data.series)||void 0===r?void 0:r[0])&&!(0,O.B)(null===(i=e.data.series)||void 0===i||null===(a=i[0])||void 0===a?void 0:a.fields,null===(c=t.data)||void 0===c||null===(o=c.series)||void 0===o||null===(l=o[0])||void 0===l?void 0:l.fields))this.updateOptions(null===(d=e.data.series)||void 0===d?void 0:d[0]);else if((null===(u=e.data)||void 0===u?void 0:u.state)===s.LoadingState.Done){(0,j.P4)(this).setState({loading:!1})}})),$(this,"handleSortByChange",(e=>{if("labels"!==e.target)return;const t=this.state.body;if(t instanceof x.u){l.jh.findDescendents(t,p.h).forEach((t=>{t.sort(e.sortBy,e.direction)}))}(0,c.EE)(c.NO.service_details,c.ir.service_details.value_breakdown_sort_change,{target:"labels",criteria:e.sortBy,direction:e.direction})})),$(this,"onChange",(e=>{if(!e)return;const t=(0,j.P4)(this);t.changeValueTo(e);const{sortBy:n,direction:r}=(0,m.vs)("labels",D.DEFAULT_SORT_BY,"desc");(0,c.EE)(c.NO.service_details,c.ir.service_details.select_field_in_breakdown_clicked,{label:e,previousLabel:t.getValueText(),view:"labels",sortBy:n,sortByDirection:r});const a=l.jh.getAncestor(this,y.Mn);(0,w.fg)(u._J.label,e,a)})),this.addActivationHandler(this.onActivate.bind(this))}}function M(e){return{container:(0,r.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column",gap:e.spacing(1)}),content:(0,r.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),labelsMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",justifyContent:"space-between",flexDirection:"row-reverse",gap:e.spacing(2)}),valuesMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",gap:e.spacing(2),flexDirection:"row"})}}$(A,"LabelsMenu",(({model:e})=>{const{body:t,loading:n,search:r}=e.useState(),a=(0,j.P4)(e),{options:s,value:l}=a.useState(),c=(0,o.useStyles2)(M);return i().createElement("div",{className:c.labelsMenuWrapper},t instanceof x.u&&i().createElement(x.u.Selector,{model:t}),t instanceof T&&i().createElement(T.Selector,{model:t}),t instanceof x.u&&i().createElement(r.Component,{model:r}),!n&&s.length>0&&i().createElement(g.u,{label:"Label",options:s,value:String(l),onChange:e.onChange}))})),$(A,"ValuesMenu",(({model:e})=>{const{loading:t,sort:n}=e.useState(),r=(0,j.P4)(e),{value:a}=r.useState(),s=(0,o.useStyles2)(M);return i().createElement("div",{className:s.valuesMenuWrapper},!t&&a!==d.To&&i().createElement(i().Fragment,null,i().createElement(n.Component,{model:n})))})),$(A,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r,error:a}=e.useState(),s=(0,o.useStyles2)(M);return i().createElement("div",{className:s.container},i().createElement(h.O,{isLoading:n,blockingMessage:r},a&&i().createElement(o.Alert,{title:"",severity:"warning"},"The labels are not available at this moment. Try using a different time range or check again later."),t instanceof T&&e&&i().createElement(A.LabelsMenu,{model:e}),i().createElement("div",{className:s.content},t&&i().createElement(t.Component,{model:t}))))}))},6887:(e,t,n)=>{n.d(t,{u:()=>N});var r=n(9736),a=n(6081),i=n(1049),s=n(2007),l=n(1475),o=n(4351),c=n(7781),u=n(158),d=n(376),p=n(20),g=n(5959),h=n.n(g),f=n(8072),v=n(2601),m=n(42),b=n(8531),y=n(5553),S=n(5700),w=n(6779),O=n(713),x=n(2661),E=n(5548),C=n(5865),P=n(7985),k=n(5953),j=n(1532);function F(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function L(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){F(i,r,a,s,l,"next",e)}function l(e){F(i,r,a,s,l,"throw",e)}s(void 0)}))}}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_(e,t,n[t])}))}return e}function D(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class N extends r.Bs{onActivate(){this.setState({$data:this.buildQueryRunner(),body:this.build()}),this.runQuery(),this.setSubscriptions()}buildQueryRunner(){const e=this.buildQuery();return(0,l.rS)([e],{runQueriesMode:"manual"})}buildQuery(){const e=(0,m.oj)(this,p.zp,String((0,y.P4)(this).state.value)),{variableName:t,filterExpression:n}=this.removeValueLabelFromVariableInterpolation();return e.expr=e.expr.replace(`\${${t}}`,n),e}setSubscriptions(){var e;this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState(((e,t)=>{this.onValuesDataQueryChange(e)}))),this._subs.add((0,y.P4)(this).subscribeToState((e=>{e.value===p.To&&this.setState({$data:void 0,body:void 0})}))),this._subs.add(r.jh.getTimeRange(this).subscribeToState((()=>{this.runQuery()}))),this._subs.add((0,y.ir)(this).subscribeToState(((e,t)=>{(0,j.B)(e.filters,t.filters)||this.runQuery()}))),this._subs.add((0,y.oY)(this).subscribeToState(((e,t)=>{(0,j.B)(e.filters,t.filters)||this.runQuery()}))),this._subs.add((0,y.Gk)(this).subscribeToState(((e,t)=>{(0,j.B)(e.filters,t.filters)||this.runQuery()}))),this._subs.add((0,y.Ku)(this).subscribeToState(((e,t)=>{e.value!==t.value&&this.runQuery()})));const t=this.getTagKey();var n=this;this._subs.add((0,y.cR)(this).subscribeToState(function(){var e=L((function*(e,r){(0,j.B)(e.filters.filter((e=>t===p.e4&&e.key!==t)),r.filters.filter((e=>t===p.e4&&e.key!==t)))||n.runQuery()}));return function(t,n){return e.apply(this,arguments)}}()));var a=this;this._subs.add((0,y.iw)(this).subscribeToState(function(){var e=L((function*(e,n){(0,j.B)(e.filters.filter((e=>t!==p.e4&&e.key!==t)),n.filters.filter((e=>t!==p.e4&&e.key!==t)))||a.runQuery()}));return function(t,n){return e.apply(this,arguments)}}()))}rebuildQuery(){var e;null===(e=this.getSceneQueryRunner())||void 0===e||e.setState({queries:[this.buildQuery()]})}runQuery(){this.rebuildQuery();const e=this.getSceneQueryRunner();null==e||e.runQueries()}getSceneQueryRunner(){if(this.state.$data){const e=r.jh.findDescendents(this.state.$data,r.dt);if(1!==e.length){const e=new Error("Unable to find query runner in value breakdown!");throw k.v.error(e,{msg:"LabelValuesBreakdownScene: Unable to find query runner in value breakdown!"}),e}return e[0]}k.v.warn("LabelValuesBreakdownScene: Query is attempting to execute, but query runner is undefined!")}removeValueLabelFromVariableInterpolation(){const e=this.getTagKey();let t,n;if(e===p.e4){const r=(0,y.iw)(this);n=p._Y,t=(0,P._q)(r.state.filters,[e])}else{const r=(0,y.cR)(this);n=p.MB,t=(0,P.VW)(r.state.filters,[e])}return{filterExpression:t,variableName:n}}getTagKey(){const e=(0,y.P4)(this);return String(e.state.value)}onValuesDataQueryChange(e){this.setEmptyStates(e),this.setErrorStates(e)}setErrorStates(e){var t,n;if((null==e||null===(t=e.data)||void 0===t?void 0:t.errors)&&(null===(n=e.data)||void 0===n?void 0:n.state)!==c.LoadingState.Done){var r;const t=this.state.errors;null==e||null===(r=e.data)||void 0===r||r.errors.forEach((e=>{const n=`${e.status}_${e.traceId}_${e.message}`;void 0===t[n]&&(t[n]=D(T({},e),{displayed:!1}))})),this.setState({errors:t}),this.showErrorToast(this.state.errors)}}setEmptyStates(e){var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===c.LoadingState.Done)if(e.data.series.length>0&&!(this.state.body instanceof a.U))this.setState({body:this.build()});else if(0===e.data.series.length){const e=r.jh.getAncestor(this,x.P);(0,E.mE)(e).length>1?this.setState({body:new w.W({clearCallback:()=>(0,E.rA)(this)})}):this.setState({body:new O.a({type:"fields"})})}}getActiveLayout(){const e=this.state.body;if(e instanceof a.U){const t=null==e?void 0:e.state.layouts.find((e=>e.isActive));if(t instanceof r.G1)return t}}activeLayoutContainsNoPanels(){const e=this.getActiveLayout();if(e){return r.jh.findDescendents(e,u.h).some((e=>{const t=e.state.body.state.children[0];return t instanceof r.vA||t instanceof r.dM}))}return!1}build(){const e=(0,y.P4)(this).state,t=String(null==e?void 0:e.value),n=r.jh.getAncestor(this,f.O);let c=r.d0.timeseries();c=c.setCustomFieldConfig("stacking",{mode:s.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",s.DrawStyle.Bars).setShowMenuAlways(!0).setOverrides(l.jC).setMenu(new S.GD({})).setTitle(t);const g=c.build(),{sortBy:b,direction:w}=(0,o.vs)("labels",v.DEFAULT_SORT_BY,"desc"),O=()=>{var e;return null!==(e=n.state.search.state.filter)&&void 0!==e?e:""};return new a.U({options:[{value:"single",label:"Single"},{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new r.G1({direction:"column",children:[new r.dM({reactNode:h().createElement(f.O.LabelsMenu,{model:n})}),new r.vA({minHeight:300,body:g})]}),new r.G1({direction:"column",children:[new r.dM({reactNode:h().createElement(f.O.LabelsMenu,{model:n})}),new C.s7({title:t,levelColor:!0,tagKey:this.getTagKey(),type:"label"}),new r.dM({reactNode:h().createElement(f.O.ValuesMenu,{model:n})}),new u.h({body:new r.gF({isLazy:!0,templateColumns:m.di,autoRows:"200px",children:[new r.vA({body:new r.dM({reactNode:h().createElement(s.LoadingPlaceholder,{text:"Loading..."})})})]}),getLayoutChild:(0,d.Zp)(i.ee,s.DrawStyle.Bars,p.MB,r.jh.getAncestor(this,f.O).state.sort,t),sortBy:b,direction:w,getFilter:O})]}),new r.G1({direction:"column",children:[new r.dM({reactNode:h().createElement(f.O.LabelsMenu,{model:n})}),new C.s7({title:t,levelColor:!0,tagKey:this.getTagKey(),type:"label"}),new r.dM({reactNode:h().createElement(f.O.ValuesMenu,{model:n})}),new u.h({body:new r.gF({templateColumns:"1fr",autoRows:"200px",children:[new r.vA({body:new r.dM({reactNode:h().createElement(s.LoadingPlaceholder,{text:"Loading..."})})})]}),getLayoutChild:(0,d.Zp)(i.ee,s.DrawStyle.Bars,p.MB,r.jh.getAncestor(this,f.O).state.sort,t),sortBy:b,direction:w,getFilter:O})]})]})}showErrorToast(e){const t=(0,b.getAppEvents)();let n=[];for(const t in e){const r=e[t];r.displayed||(n.push(r),r.displayed=!0)}n.length&&(this.activeLayoutContainsNoPanels()||t.publish({type:c.AppEvents.alertError.name,payload:null==n?void 0:n.map(((e,t)=>this.renderError(t,e)))}),this.setState({errors:e}))}renderError(e,t){return h().createElement("div",{key:e},t.status&&h().createElement(h().Fragment,null,h().createElement("strong",null,"Status"),": ",t.status," ",h().createElement("br",null)),t.message&&h().createElement(h().Fragment,null,h().createElement("strong",null,"Message"),": ",t.message," ",h().createElement("br",null)),t.traceId&&h().createElement(h().Fragment,null,h().createElement("strong",null,"TraceId"),": ",t.traceId))}static Selector({model:e}){const{body:t}=e.useState();return h().createElement(h().Fragment,null,t&&t instanceof a.U&&h().createElement(a.U.Selector,{model:t}))}constructor(e){super(D(T({},e),{errors:{}})),this.addActivationHandler(this.onActivate.bind(this))}}_(N,"Component",(({model:e})=>{const{body:t}=e.useState(),n=(0,s.useStyles2)(S.K_);return t?h().createElement("span",{className:n.panelWrapper},t&&h().createElement(t.Component,{model:t})):h().createElement(s.LoadingPlaceholder,{text:"Loading..."})}))},6081:(e,t,n)=>{n.d(t,{U:()=>g});var r=n(5959),a=n.n(r),i=n(9736),s=n(2007),l=n(4509),o=n(9683),c=n(6089),u=n(4351);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class g extends i.Bs{constructor(e){var t;super(p(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){d(e,t,n[t])}))}return e}({},e),{active:null!==(t=e.active)&&void 0!==t?t:"grid"})),d(this,"isTopLevelLayoutType",(()=>this.state.options.every((e=>"single"!==e.value)))),d(this,"updateLayout",(()=>{const e=(0,u.Dy)();e&&("single"===e&&this.isTopLevelLayoutType()?this.setState({active:"grid"}):this.setState({active:"grid"===e||"rows"===e||"single"===e?e:"grid"}))})),d(this,"onLayoutChange",(e=>{(0,l.EE)(l.NO.service_details,l.ir.service_details.layout_type_changed,{layout:e,view:(0,o.FT)()}),(0,u.zu)(e),this.setState({active:e})})),d(this,"onActivate",(()=>{this.updateLayout()})),this.addActivationHandler(this.onActivate.bind(this))}}d(g,"Selector",(function({model:e}){const{active:t,options:n}=e.useState(),r=(0,s.useStyles2)(h);return a().createElement(s.Field,{className:r.field},a().createElement(s.RadioButtonGroup,{options:n,value:t,onChange:e.onLayoutChange}))})),d(g,"Component",(({model:e})=>{const{layouts:t,options:n,active:r}=e.useState(),i=n.findIndex((e=>e.value===r));if(-1===i)return null;const s=t[i];return a().createElement(s.Component,{model:s})}));const h=e=>({field:(0,c.css)({marginBottom:0})})},6779:(e,t,n)=>{n.d(t,{W:()=>p});var r,a,i,s=n(9736),l=n(7191),o=n(2007),c=n(5959),u=n.n(c),d=n(6830);class p extends s.Bs{}i=({model:e})=>{const{clearCallback:t}=e.useState();return u().createElement(l.R,null,u().createElement(o.Alert,{title:"",severity:"info"},"No labels match these filters."," ",u().createElement(o.Button,{className:d.ZI.button,onClick:()=>t()},"Clear filters")," "))},(a="Component")in(r=p)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i},5865:(e,t,n)=>{n.d(t,{Zb:()=>y,s$:()=>w,s7:()=>b});var r=n(9736),a=n(5700),i=n(2007),s=n(1475),l=n(4351),o=n(5959),c=n.n(o),u=n(5553),d=n(5570),p=n(4509),g=n(7781),h=n(20),f=n(5953),v=n(42);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b extends r.Bs{onActivate(){var e;const t=null!==(e=(0,l.ex)("collapsed",[a.Ci.collapsed,a.Ci.expanded]))&&void 0!==e?e:a.Ci.expanded,n=function(e,t){var n;const o=null!==(n=(0,l.ex)("collapsed",[a.Ci.collapsed,a.Ci.expanded]))&&void 0!==n?n:a.Ci.expanded,c=r.d0.timeseries().setTitle(e).setMenu(new a.GD({})).setCollapsible(!0).setCollapsed(o===a.Ci.collapsed).setCustomFieldConfig("stacking",{mode:i.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",i.DrawStyle.Bars).setShowMenuAlways(!0).setSeriesLimit(100);(null==t?void 0:t.levelColor)&&c.setOverrides(s.jC);return c.build()}(this.state.title,{levelColor:this.state.levelColor}),o=S(t);n.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(t)}),this.setState({body:new r.G1({key:w,minHeight:o,height:o,maxHeight:o,wrap:"nowrap",children:[new r.vA({body:n})]})}),this._subs.add(n.subscribeToState(((e,t)=>{if(e.collapsed!==t.collapsed){y(r.jh.getAncestor(n,r.G1),e.collapsed?a.Ci.collapsed:a.Ci.expanded),(0,l.IW)("collapsed",e.collapsed?a.Ci.collapsed:a.Ci.expanded)}})))}initLegendOptions(e,t,n){e&&("label"===this.state.type?t===h.e4?(0,s.C6)(n,e,this):(0,s.dO)(t,n,e,this):(0,s.Nr)(t,n,e,this))}getQuerySubscription(e,t,n){return t.subscribeToState(((t,r)=>{var a;(null===(a=t.data)||void 0===a?void 0:a.state)===g.LoadingState.Done&&("label"===this.state.type?e===h.e4?(0,s.C6)(n,t.data.series,this):(0,s.dO)(e,n,t.data.series,this):(0,s.Nr)(e,n,t.data.series,this))}))}getFieldsVariableLegendSyncSubscription(e,t){return null==t?void 0:t.subscribeToState((()=>{var t,n;const a=null===(t=this.state.body)||void 0===t?void 0:t.state.children[0];if(!(a instanceof r.vA))throw new Error("Cannot find sceneFlexItem");const i=a.state.body;if(!(i instanceof r.Eb))throw new Error("ValueSummary - getFieldsVariableLegendSyncSubscription: Cannot find VizPanel");const l=null===(n=r.jh.getData(this).state.data)||void 0===n?void 0:n.series;l?(0,s.Nr)(e,i,l,this):f.v.warn("ValueSummary - getFieldsVariableLegendSyncSubscription: missing dataframe!")}))}getLabelsVariableLegendSyncSubscription(e){const t=e===h.e4,n=t?(0,u.iw)(this):(0,u.cR)(this);return null==n?void 0:n.subscribeToState((()=>{var n,a;const i=null===(n=this.state.body)||void 0===n?void 0:n.state.children[0];if(!(i instanceof r.vA))throw new Error("Cannot find sceneFlexItem");const l=i.state.body;if(!(l instanceof r.Eb))throw new Error("ValueSummary - getLabelsVariableLegendSyncSubscription: Cannot find VizPanel");const o=null===(a=r.jh.getData(this).state.data)||void 0===a?void 0:a.series;o?t?(0,s.C6)(l,o,this):(0,s.dO)(e,l,o,this):f.v.warn("ValueSummary - getLabelsVariableLegendSyncSubscription: missing dataframe!")}))}constructor(e){super(e),m(this,"extendTimeSeriesLegendBus",(e=>{var t,n;const a=r.jh.getData(this),i=null===(t=a.state.data)||void 0===t?void 0:t.series,s=this.state.tagKey,l=null===(n=this.state.body)||void 0===n?void 0:n.state.children[0];if(!(l instanceof r.vA))throw new Error("Cannot find sceneFlexItem");const o=l.state.body;if(!(o instanceof r.Eb))throw new Error("Cannot find VizPanel");this.initLegendOptions(i,s,o),"label"===this.state.type?this._subs.add(this.getLabelsVariableLegendSyncSubscription(s)):(this._subs.add(this.getFieldsVariableLegendSyncSubscription(s,(0,u.ir)(this))),this._subs.add(this.getFieldsVariableLegendSyncSubscription(s,(0,u.oY)(this)))),this._subs.add(this.getQuerySubscription(s,a,o)),e.onToggleSeriesVisibility=(e,t)=>{let n;n="label"===this.state.type?s===h.e4?(0,d.PE)(e,this):(0,v.R7)(s,e,this):(0,v.zr)(s,e,this),(0,p.EE)(p.NO.service_details,p.ir.service_details.label_in_panel_summary_clicked,{label:e,action:n})}})),this.addActivationHandler(this.onActivate.bind(this))}}function y(e,t){const n=S(t);e.setState({minHeight:n,height:n,maxHeight:n})}function S(e){return e===a.Ci.collapsed?35:300}m(b,"Component",(({model:e})=>{const{body:t}=e.useState();return t?c().createElement("div",null,c().createElement(t.Component,{model:t})):null}));const w="value_summary_panel"},9284:(e,t,n)=>{n.d(t,{D:()=>c});var r=n(6089),a=n(2007),i=n(5959),s=n.n(i);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const c=e=>{var{value:t,onChange:n,placeholder:r,onClear:i,suffix:c}=e,d=o(e,["value","onChange","placeholder","onClear","suffix"]);const p=(0,a.useStyles2)(u);return s().createElement(a.Input,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}({value:t,onChange:n,suffix:s().createElement("span",{className:p.suffixWrapper},i&&t?s().createElement(a.IconButton,{"aria-label":"Clear search",tooltip:"Clear search",onClick:i,name:"times",className:p.clearIcon}):void 0,c&&c),prefix:s().createElement(a.Icon,{name:"search"}),placeholder:r},d))},u=e=>({suffixWrapper:(0,r.css)({gap:e.spacing(.5),display:"inline-flex"}),clearIcon:(0,r.css)({cursor:"pointer"})})},2606:(e,t,n)=>{n.d(t,{X:()=>$});var r=n(9736),a=n(7352),i=n(7478),s=n(9683),l=n(2007),o=n(5959),c=n.n(o),u=n(9405),d=n(20),p=n(7781),g=n(5553),h=n(6854),f=n(6089),v=n(3241),m=n(5953),b=n(3571);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(e){return e.ns="ns",e.us="Âµs",e.ms="ms",e.s="s",e.m="m",e.h="h",e}(S||{});var w=function(e){return e.B="B",e.KB="KB",e.MB="MB",e.GB="GB",e.TB="TB",e}(w||{});class O extends r.Bs{onActivate(){const e=(0,g.bY)((0,u.ts)(this.state.labelName,this.state.variableType),this).state.filters.filter((e=>e.key===this.state.labelName)),t=e.find((e=>e.operator===h.w7.gte||e.operator===h.w7.gt)),n=e.find((e=>e.operator===h.w7.lte||e.operator===h.w7.lt));let r={};if("duration"===this.state.fieldType||"bytes"===this.state.fieldType){if(t){const e=x((0,g.bu)(t).value,this.state.fieldType);e&&(r.gt=e.value,r.gtu=e.unit,r.gte=t.operator===h.w7.gte)}if(n){const e=x((0,g.bu)(n).value,this.state.fieldType);e&&(r.lt=e.value,r.ltu=e.unit,r.lte=n.operator===h.w7.lte)}}else{if(t){const e=(0,g.bu)(t).value;r.gt=Number(e),r.gtu="",r.gte=t.operator===h.w7.gte}if(n){const e=(0,g.bu)(n).value;r.lt=Number(e),r.ltu="",r.lte=n.operator===h.w7.lte}}0!==Object.keys(r).length&&(r.hasExistingFilter=!0),this.setState(r)}onSubmit(){this.state.gt?(0,u.vn)(this.state.labelName,this.state.gt.toString()+this.state.gtu,this.state.gte?h.w7.gte:h.w7.gt,this,this.state.variableType):(0,u.u7)(this.state.labelName,this,this.state.gte?h.w7.gte:h.w7.gt,this.state.variableType),this.state.lt?(0,u.vn)(this.state.labelName,this.state.lt.toString()+this.state.ltu,this.state.lte?h.w7.lte:h.w7.lt,this,this.state.variableType):(0,u.u7)(this.state.labelName,this,this.state.lte?h.w7.lte:h.w7.lt,this.state.variableType);r.jh.getAncestor(this,$).togglePopover()}constructor(e){let t;const n=e.fieldType;if("bytes"===n)t={ltu:"B",gtu:"B"};else if("duration"===n)t={ltu:"s",gtu:"s"};else{if("float"!==n)throw new Error(`field type incorrectly defined: ${n}`);t={ltu:"",gtu:""}}super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){y(e,t,n[t])}))}return e}({},e,t)),y(this,"onInputKeydown",(e=>{const t=void 0===this.state.gt&&void 0===this.state.lt;"Enter"!==e.key||t||this.onSubmit()})),this.addActivationHandler(this.onActivate.bind(this))}}function x(e,t){if("duration"===t){const t=Object.values(S).find((t=>{const n=t.length;return e.slice(-1*n)===t}));if(t){const n=Number(e.replace(t,""));if(!isNaN(n))return{unit:t,value:n}}}if("bytes"===t){const t=Object.values(w).sort(((e,t)=>t.length-e.length)).find((t=>{const n=t.length;return e.slice(-1*n)===t}));if(t){const n=Number(e.replace(t,""));if(!isNaN(n))return{unit:t,value:n}}}}function E(e){if("duration"===e){return Object.keys(S).map((e=>({text:e,value:S[e],label:e})))}if("bytes"===e){return Object.keys(w).map((e=>({text:e,value:w[e],label:e})))}const t=new Error(`invalid field type: ${e}`);throw m.v.error(t,{msg:"getUnitOptions, invalid field type"}),t}y(O,"Component",(({model:e})=>{const t=(0,l.useStyles2)(C),{labelName:n,gt:a,lt:i,gte:s,lte:o,gtu:u,ltu:d,fieldType:p,hasExistingFilter:g}=e.useState(),h="float"!==p&&p!==n?`(${p})`:void 0,v=r.jh.getAncestor(e,$),m=void 0===a&&void 0===i;return c().createElement(l.ClickOutsideWrapper,{useCapture:!0,onClick:()=>v.togglePopover()},c().createElement(l.Stack,{direction:"column",gap:0,role:"tooltip"},c().createElement("div",{className:t.card.body},c().createElement("div",{className:t.card.title},n," ",h),c().createElement("div",{className:t.card.fieldWrap},c().createElement(l.FieldSet,{className:t.card.fieldset},c().createElement(l.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThanInclusive,horizontal:!0,className:(0,f.cx)(t.card.field,t.card.inclusiveField)},c().createElement(l.Select,{className:t.card.inclusiveInput,menuShouldPortal:!1,value:void 0!==s?s.toString():"false",options:[{label:"Greater than",value:"false"},{label:"Greater than or equal",value:"true"}],onChange:t=>e.setState({gte:"true"===t.value})})),c().createElement(l.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThan,horizontal:!0,className:t.card.field},c().createElement(l.Input,{onKeyDownCapture:e.onInputKeydown,autoFocus:!0,onChange:t=>{e.setState({gt:""!==t.currentTarget.value?Number(t.currentTarget.value):void 0})},className:t.card.numberInput,value:a,type:"number"})),"float"!==p&&c().createElement(l.Label,null,c().createElement(l.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThanUnit,horizontal:!0,className:t.card.field,label:c().createElement("span",{className:t.card.unitFieldLabel},"Unit")},c().createElement(l.Select,{onChange:t=>{e.setState({gtu:t.value})},menuShouldPortal:!1,options:E(p),className:t.card.selectInput,value:u})))),c().createElement(l.FieldSet,{className:t.card.fieldset},c().createElement(l.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThanInclusive,horizontal:!0,className:(0,f.cx)(t.card.field,t.card.inclusiveField)},c().createElement(l.Select,{className:t.card.inclusiveInput,menuShouldPortal:!1,value:void 0!==o?o.toString():"false",options:[{label:"Less than",value:"false"},{label:"Less than or equal",value:"true"}],onChange:t=>e.setState({lte:"true"===t.value})})),c().createElement(l.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThan,horizontal:!0,className:t.card.field},c().createElement(l.Input,{onKeyDownCapture:e.onInputKeydown,onChange:t=>e.setState({lt:""!==t.currentTarget.value?Number(t.currentTarget.value):void 0}),className:t.card.numberInput,value:i,type:"number"})),"float"!==p&&c().createElement(l.Label,null,c().createElement(l.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThanUnit,horizontal:!0,className:t.card.field,label:c().createElement("span",{className:t.card.unitFieldLabel},"Unit")},c().createElement(l.Select,{onChange:t=>{e.setState({ltu:t.value})},menuShouldPortal:!1,options:E(p),className:t.card.selectInput,value:d}))))),c().createElement("div",{className:t.card.buttons},g&&c().createElement(l.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.removeButton,disabled:!g,onClick:()=>{e.setState({gt:void 0,lt:void 0}),e.onSubmit()},size:"sm",variant:"destructive",fill:"outline"},"Remove"),c().createElement(l.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.submitButton,disabled:m,onClick:()=>e.onSubmit(),size:"sm",variant:"primary",fill:"outline",type:"submit"},"Add"),c().createElement(l.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.cancelButton,onClick:()=>v.togglePopover(),size:"sm",variant:"secondary",fill:"outline"},"Cancel")))))}));const C=e=>({card:{buttons:(0,f.css)({display:"flex",flexWrap:"wrap",justifyContent:"flex-end",gap:e.spacing(1.5),marginTop:e.spacing(1)}),inclusiveInput:(0,f.css)({minWidth:"185px"}),selectInput:(0,f.css)({minWidth:"65px"}),numberInput:(0,f.css)({width:"75px"}),fieldWrap:(0,f.css)({display:"flex",flexDirection:"column",paddingTop:e.spacing(2),paddingBottom:0}),field:(0,f.css)({display:"flex",alignItems:"center",marginBottom:e.spacing(1)}),inclusiveField:(0,f.css)({marginRight:e.spacing(1)}),unitFieldLabel:(0,f.css)({marginLeft:e.spacing(2),marginRight:e.spacing(1.5)}),numberFieldLabel:(0,f.css)({width:"100px"}),switchFieldLabel:(0,f.css)({marginLeft:e.spacing(2),marginRight:e.spacing(1)}),fieldset:(0,f.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:0}),title:(0,f.css)({}),body:(0,f.css)({padding:e.spacing(2)}),p:(0,f.css)({maxWidth:300})}});var P=n(376),k=n(5719),j=n(2085);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}function _(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const T="Include",D="Exclude",N="Add to filter";class $ extends r.Bs{onChange(e){const t=this.getVariable(),n=t.state.name,r=this.getExistingFilter(t),a=(0,g.z2)(n,r);(null==r?void 0:r.operator)===h.w7.NotEqual&&a.value===d.ZO&&e.value===T?this.clearFilter(n):e.value===T?this.onClickExcludeEmpty(n):e.value===D?this.onClickIncludeEmpty(n):e.value===N&&this.onClickNumericFilter(n),this.setState({selectedValue:e})}getExistingFilter(e){let{labelName:t}=(0,s.W6)();if(this.state.labelName!==t)return null==e?void 0:e.state.filters.find((e=>e.key===this.state.labelName))}onActivate(){var e,t;const n=r.jh.getAncestor(this,a.Mn);(null===(t=n.state.$data)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)===p.LoadingState.Done&&this.calculateSparsity(),this._subs.add(r.jh.getData(this).subscribeToState((e=>{var t,r,a,i;(null===(t=e.data)||void 0===t?void 0:t.state)===p.LoadingState.Done&&((null===(a=n.state.$data)||void 0===a||null===(r=a.state.data)||void 0===r?void 0:r.state)===p.LoadingState.Done&&this.calculateSparsity(),this._subs.add(null===(i=n.state.$data)||void 0===i?void 0:i.subscribeToState((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===p.LoadingState.Done&&this.calculateSparsity()}))))})))}togglePopover(){this.setState({showPopover:!this.state.showPopover})}calculateSparsity(){var e;const t=r.jh.getAncestor(this,a.Mn),n=(0,a.tn)(null===(e=t.state.$data)||void 0===e?void 0:e.state.data),i=null==n?void 0:n.fields.find((e=>"labels"===e.name)),s=r.jh.getData(this),l=(0,k.UX)(s,(e=>e instanceof r.dt),r.dt);if(l){const e=l.state.queries[0];(null==e?void 0:e.expr.includes("avg_over_time"))&&this.setState({hasNumericFilters:!0})}if(!i||!n)return void this.setState({hasSparseFilters:!1});const o=this.getVariable(),c=i.values.reduce(((e,t)=>((null==t?void 0:t[this.state.labelName])&&e++,e)),0),u=r.jh.getAncestor(this,r.Eb);if(void 0!==c&&n.length>0){const e=(c/n.length*100).toLocaleString(),t=`${this.state.labelName} exists on ${e}% of ${n.length} sampled log lines`;u.setState({description:t})}else u.setState({description:void 0});const p=this.getExistingFilter(o),h=p&&o.state.name===d.mB?(0,g.bu)(p):void 0;c<n.length||(null==h?void 0:h.value)===d.ZO?this.setState({hasSparseFilters:!0}):this.setState({hasSparseFilters:!1})}getVariable(){return this.state.fieldType===s._J.field?(0,g.ir)(this):this.state.labelName===d.e4?(0,g.iw)(this):(0,g.cR)(this)}constructor(e){super(_(L({},e),{showPopover:!1})),F(this,"onClickNumericFilter",(e=>{const t=(0,a.rD)(this),n=(0,P.ph)(this.state.labelName,t);if(!n||"string"===n||"boolean"===n||"int"===n){const e=new Error(`Incorrect field type: ${n}`);throw m.v.error(e,{msg:`onClickNumericFilter invalid field type ${n}`}),e}this.setState({popover:new O({labelName:this.state.labelName,variableType:e,fieldType:n})}),this.togglePopover()})),F(this,"getViewValuesLink",(()=>{const e=r.jh.getAncestor(this,a.Mn);return(0,i.FB)(this.state.fieldType,this.state.labelName,e)})),F(this,"onClickExcludeEmpty",(e=>{(0,u.Qt)(this.state.labelName,d.ZO,"exclude",this,e)})),F(this,"onClickIncludeEmpty",(e=>{(0,u.Qt)(this.state.labelName,d.ZO,"include",this,e)})),F(this,"clearFilter",(e=>{(0,u.Qt)(this.state.labelName,d.ZO,"clear",this,e)})),F(this,"clearFilters",(e=>{(0,u.hi)(this.state.labelName,this,e),this.state.labelName===d.e4&&(0,j.dm)(this)})),this.addActivationHandler(this.onActivate.bind(this))}}function I(e){const t=(0,l.useStyles2)(B);return c().createElement("span",{className:t.description},e.selected&&c().createElement("span",{className:t.selected}),e.text)}F($,"Component",(({model:e})=>{const{hideValueDrilldown:t,labelName:n,hasSparseFilters:r,hasNumericFilters:a,selectedValue:i,popover:u,showPopover:p,fieldType:f}=e.useState(),m=e.getVariable(),y=m.useState().name,S=e.getExistingFilter(m),w=(0,g.z2)(y,S),O=(0,l.useStyles2)(A),x=(0,o.useRef)(null),E=f===s._J.label&&m.state.name===d.mB&&0===m.state.filters.filter((e=>e.key!==n&&e.operator===h.w7.Equal)).length,C=(null==S?void 0:S.operator)===h.w7.NotEqual&&w.value===d.ZO,P=!!S;var k;const j=null!==(k=null==i?void 0:i.value)&&void 0!==k?k:C?T:a?N:T,F=!!(null==S?void 0:S.operator)&&[h.w7.gte,h.w7.gt,h.w7.lte,h.w7.lt].includes(S.operator),$=j===N||F,B=j===T&&!$,M={value:T,component:()=>c().createElement(I,{selected:B,text:`Include all log lines with ${n}`})},R={value:D,component:()=>c().createElement(I,{selected:!1,text:`Exclude all log lines with ${n}`})},V={value:N,component:()=>c().createElement(I,{selected:$,text:`Add an expression, i.e. ${n} > 30`})},W=[];a&&W.push(V),r&&(F||W.push(M),W.push(R));const z=C?M:a?V:M;var H;return c().createElement(c().Fragment,null,P&&c().createElement(l.IconButton,{disabled:E,name:"filter",tooltip:`Clear ${n} filters`,onClick:()=>e.clearFilters(y)}),(a||r)&&c().createElement(c().Fragment,null,c().createElement(l.ButtonGroup,{"data-testid":b.b.breakdowns.common.filterButtonGroup},c().createElement(l.Button,{"data-testid":b.b.breakdowns.common.filterButton,ref:x,onClick:()=>e.onChange(null!=i?i:z),size:"sm",fill:"outline",variant:"secondary"},null!==(H=null==i?void 0:i.value)&&void 0!==H?H:z.value),c().createElement(l.ButtonSelect,{"data-testid":b.b.breakdowns.common.filterSelect,className:O.buttonSelect,variant:"default",options:W,onChange:t=>{e.onChange(t)}}))),!0!==t&&c().createElement(l.LinkButton,{title:`View breakdown of values for ${n}`,variant:"primary",fill:"outline",size:"sm","aria-label":`Select ${n}`,href:e.getViewValuesLink()},"Select"),u&&c().createElement(l.PopoverController,{content:c().createElement(u.Component,{model:u})},((e,t,n)=>{const r={onBlur:t,onFocus:e};return c().createElement(c().Fragment,null,x.current&&c().createElement(c().Fragment,null,c().createElement(l.Popover,L(_(L({},n,v.rest),{show:p,wrapperClassName:O.popover,referenceElement:x.current,renderArrow:!0}),r))))})))}));const B=e=>({selected:(0,f.css)({label:"selectable-value-selected","&:before":{content:'""',position:"absolute",left:0,top:"4px",height:"calc(100% - 8px)",width:"2px",backgroundColor:e.colors.warning.main}}),description:(0,f.css)({textAlign:"left",fontSize:e.typography.pxToRem(12)})}),A=e=>({popover:(0,f.css)({borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3,background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`}),description:(0,f.css)({textAlign:"left",fontSize:e.typography.pxToRem(12)}),buttonSelect:(0,f.css)({border:`1px solid ${e.colors.border.strong}`,borderLeft:"none",borderTopLeftRadius:0,borderBottomLeftRadius:0,padding:1,height:"24px"})})},1049:(e,t,n)=>{n.d(t,{ee:()=>m,gf:()=>g,wd:()=>h});var r=n(9736),a=n(5959),i=n.n(a),s=n(7781),l=n(5570),o=n(2007),c=n(4351),u=n(3571),d=n(2601);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends s.BusEventBase{constructor(e,t,n){super(),p(this,"target",void 0),p(this,"sortBy",void 0),p(this,"direction",void 0),this.target=e,this.sortBy=t,this.direction=n}}p(g,"type","sort-criteria-changed");class h extends r.Bs{constructor(e){const{sortBy:t,direction:n}=(0,c.vs)(e.target,d.DEFAULT_SORT_BY,"desc");super({target:e.target,sortBy:t,direction:n}),p(this,"sortingOptions",[{label:"",options:[{value:"changepoint",label:"Most relevant",description:"Smart ordering of graphs based on the most significant spikes in the data"},{value:"outliers",label:"Outlying values",description:"Order by the amount of outlying values in the data"},{value:s.ReducerID.stdDev,label:"Widest spread",description:"Sort graphs by deviation from the average value"},{value:"alphabetical",label:"Name",description:"Alphabetical order"},{value:s.ReducerID.sum,label:"Count",description:"Sort graphs by total number of logs"},{value:s.ReducerID.max,label:"Highest spike",description:"Sort graphs by the highest values (max)"},{value:s.ReducerID.min,label:"Lowest dip",description:"Sort graphs by the smallest values (min)"}]},{label:"Percentiles",options:[...s.fieldReducers.selectOptions([],v).options]}]),p(this,"onCriteriaChange",(e=>{e.value&&(this.setState({sortBy:e.value}),(0,c.fq)(this.state.target,e.value,this.state.direction),this.publishEvent(new g(this.state.target,e.value,this.state.direction),!0))})),p(this,"onDirectionChange",(e=>{e.value&&(this.setState({direction:e.value}),(0,c.fq)(this.state.target,this.state.sortBy,e.value),this.publishEvent(new g(this.state.target,this.state.sortBy,e.value),!0))}))}}p(h,"Component",(({model:e})=>{const{sortBy:t,direction:n}=e.useState(),r=e.sortingOptions.find((e=>e.options.find((e=>e.value===t)))),a=null==r?void 0:r.options.find((e=>e.value===t));return i().createElement(i().Fragment,null,i().createElement(o.InlineField,{label:"Sort by",htmlFor:"sort-by-criteria",tooltip:"Calculate a derived quantity from the values in your time series and sort by this criteria. Defaults to standard deviation."},i().createElement(o.Select,{"data-testid":u.b.breakdowns.common.sortByFunction,value:a,width:20,isSearchable:!0,options:e.sortingOptions,placeholder:"Choose criteria",onChange:e.onCriteriaChange,inputId:"sort-by-criteria"})),i().createElement(o.InlineField,null,i().createElement(o.Select,{"data-testid":u.b.breakdowns.common.sortByDirection,onChange:e.onDirectionChange,"aria-label":"Sort direction",placeholder:"",value:n,options:[{label:"Asc",value:"asc"},{label:"Desc",value:"desc"}]})))}));const f=["p10","p25","p75","p90","p99"];function v(e){return e.id>="p1"&&e.id<="p99"&&f.includes(e.id)}function m(e){var t;return null!==(t=(0,l.H7)(e))&&void 0!==t?t:"No labels"}},5659:(e,t,n)=>{n.d(t,{O:()=>l});var r=n(6089),a=n(5959),i=n.n(a),s=n(2007);function l({blockingMessage:e,isLoading:t,children:n}){const r=(0,s.useStyles2)(o);return t&&!e&&(e="Loading..."),t?i().createElement(s.LoadingPlaceholder,{className:r.statusMessage,text:e}):e?i().createElement("div",{className:r.statusMessage},e):i().createElement(i().Fragment,null,n)}function o(e){return{statusMessage:(0,r.css)({fontStyle:"italic",marginTop:e.spacing(7),textAlign:"center"})}}},4059:(e,t,n)=>{n.d(t,{l:()=>r});const r=20},72:(e,t,n)=>{n.d(t,{_:()=>_});var r=n(5959),a=n.n(r),i=n(2007),s=n(7781),l=n(6089);function o(e){return{outline:"2px dotted transparent",outlineOffset:"2px",boxShadow:`0 0 0 2px ${e.colors.background.canvas}, 0 0 0px 4px ${e.colors.primary.main}`,transitionTimingFunction:"cubic-bezier(0.19, 1, 0.22, 1)",transitionDuration:"0.2s",transitionProperty:"outline, outline-offset, box-shadow"}}function c(e,t){return{zIndex:"-1",position:"absolute",opacity:"0",width:`${e}px`,height:`${e}px`,borderRadius:t.shape.radius.default,content:'""',[t.transitions.handleMotion("no-preference","reduce")]:{transitionDuration:"0.2s",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionProperty:"opacity"}}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}function p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const g=e=>{const t=(0,i.useTheme2)(),n=e.regex?t.colors.text.maxContrast:t.colors.text.disabled,r=h(t),s=(e.regex?"Disable":"Enable")+" regex";return a().createElement(i.Tooltip,{content:s},a().createElement("button",{onClick:()=>e.onRegexToggle(e.regex?"match":"regex"),className:(0,l.cx)(r.button,e.regex?r.active:null),"aria-label":s},a().createElement("svg",{fill:n,width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},a().createElement("text",{fontSize:"13",width:"16",height:"16",x:"50%",y:"50%",dominantBaseline:"central",textAnchor:"middle"},".*"))))},h=(e,t="secondary")=>{const n=16+e.spacing.gridSize;return{button:(0,l.css)({zIndex:0,position:"relative",margin:`0 ${e.spacing.x0_5} 0 ${e.spacing.x0_5}`,boxShadow:"none",border:"none",display:"inline-flex",background:"transparent",justifyContent:"center",alignItems:"center",padding:0,color:e.colors.text.primary,"&:before":p(d({},c(n,e)),{position:"absolute"}),"&:hover":{"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:s.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1}},"&:focus, &:focus-visible":o(e),"&:focus:not(:focus-visible)":{outline:"none",boxShadow:"none"}}),active:(0,l.css)({"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:s.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1},"&:hover":{"&:before":{backgroundColor:"none",opacity:0}}})}};var f=n(3571),v=n(6854);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){m(e,t,n[t])}))}return e}function y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const S=e=>{const t=(0,i.useTheme2)(),n=e.caseSensitive?t.colors.text.maxContrast:t.colors.text.disabled,r=w(t),s=(e.caseSensitive?"Disable":"Enable")+" case match";return a().createElement(i.Tooltip,{content:s},a().createElement("button",{onClick:()=>e.onCaseSensitiveToggle(e.caseSensitive?v.ld.caseInsensitive:v.ld.caseSensitive),className:(0,l.cx)(r.button,e.caseSensitive?r.active:null),"aria-label":s},a().createElement("svg",{fill:n,width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},a().createElement("text",{fontSize:"13",width:"16",height:"16",x:"50%",y:"50%",dominantBaseline:"central",textAnchor:"middle"},"Aa"))))},w=(e,t="secondary")=>{const n=16+e.spacing.gridSize;return{button:(0,l.css)({zIndex:0,position:"relative",margin:`0 ${e.spacing.x0_5} 0 ${e.spacing.x0_5}`,boxShadow:"none",border:"none",display:"inline-flex",background:"transparent",justifyContent:"center",alignItems:"center",padding:0,color:e.colors.text.primary,"&:before":y(b({},c(n,e)),{position:"absolute"}),"&:hover":{"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:s.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1}},"&:focus, &:focus-visible":o(e),"&:focus:not(:focus-visible)":{outline:"none",boxShadow:"none"}}),active:(0,l.css)({"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:s.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1},"&:hover":{"&:before":{backgroundColor:"none",opacity:0}}})}};var O=n(8428);function x(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}let P;const k=e=>{var{value:t,onChange:n,placeholder:s,onClear:l,suffix:o,width:c,regex:u}=e,d=C(e,["value","onChange","placeholder","onClear","suffix","width","regex"]);const p=(0,i.useStyles2)(F),[g,h]=(0,r.useState)(!1),[f,v]=(0,r.useState)(""),m=(0,r.useCallback)((e=>{if(!e||!u)return v(""),void h(!1);if(void 0!==P)try{null==P||P.compile(e),h(!1),v("")}catch(e){const t=(0,O.DU)(e);h(!0),t&&v(t)}else j().then((()=>m(e)))}),[u]);return(0,r.useEffect)((()=>{m(t)}),[m,t]),a().createElement(i.Tooltip,{placement:"auto-start",show:!!f&&g,content:f},a().createElement(i.Input,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){E(e,t,n[t])}))}return e}({invalid:g,"aria-invalid":g,rows:2,width:c,value:t,onChange:n,suffix:a().createElement("span",{className:p.suffixWrapper},l&&t?a().createElement(i.IconButton,{"aria-label":"Clear line filter",tooltip:"Clear line filter",onClick:l,name:"times",className:p.clearIcon}):void 0,o&&o),prefix:a().createElement(i.Icon,{name:"search"}),placeholder:s},d)))},j=function(){var e,t=(e=function*(){P=null,P=(yield n.e(470).then(n.bind(n,4470))).RE2JS},function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){x(i,r,a,s,l,"next",e)}function l(e){x(i,r,a,s,l,"throw",e)}s(void 0)}))});return function(){return t.apply(this,arguments)}}(),F=e=>({suffixWrapper:(0,l.css)({gap:e.spacing(.5),display:"inline-flex"}),clearIcon:(0,l.css)({cursor:"pointer"})}),L=30;function _({exclusive:e,lineFilter:t,caseSensitive:n,setExclusive:s,regex:o,onInputChange:c,onCaseSensitiveToggle:u,onRegexToggle:d,handleEnter:p,onSubmitLineFilter:h,onClearLineFilter:v,focus:m,setFocus:b,type:y}){const w=(0,i.useStyles2)((e=>T(e,y))),[O,x]=(0,r.useState)(L);function E(e){var t;const n=Math.max(null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0,L);x(n+9)}return(0,r.useEffect)((()=>{E(t)}),[t,m]),a().createElement("div",{className:w.wrapper},!h&&a().createElement(i.Select,{prefix:null,className:w.select,value:e?"exclusive":"inclusive",options:[{value:"exclusive",label:"Exclude"},{value:"inclusive",label:"Include"}],onChange:()=>s(!e)}),a().createElement(i.Field,{className:w.field},a().createElement(k,{regex:o,width:m?O:void 0,onFocus:()=>b(!0),"data-testid":f.b.exploreServiceDetails.searchLogs,value:null!=t?t:"",className:(0,l.cx)(h?w.inputNoBorderRight:void 0,w.input),onChange:c,suffix:a().createElement("span",{className:`${w.suffix} input-suffix`},a().createElement(S,{caseSensitive:n,onCaseSensitiveToggle:u}),a().createElement(g,{regex:o,onRegexToggle:d})),prefix:null,placeholder:"Search in log lines",onClear:v,onKeyUp:e=>{p(e,t),E(t)}})),h&&a().createElement("span",{className:w.buttonWrap},a().createElement(i.Button,{onClick:()=>{s(!1),h()},className:w.includeButton,variant:"secondary",fill:"outline",disabled:!t},"Include"),a().createElement(i.Button,{onClick:()=>{s(!0),h()},className:w.excludeButton,variant:"secondary",fill:"outline",disabled:!t},"Exclude")))}const T=(e,t)=>({inputNoBorderRight:(0,l.css)({input:{borderTopRightRadius:0,borderBottomRightRadius:0}}),suffix:(0,l.css)({display:"inline-flex",gap:e.spacing(.5)}),removeBtn:(0,l.css)({borderTopLeftRadius:0,borderBottomLeftRadius:0}),buttonWrap:(0,l.css)({display:"flex",justifyContent:"center"}),includeButton:(0,l.css)({borderLeft:"none",borderRadius:0,borderRight:"none","&[disabled]":{borderRight:"none"}}),excludeButton:(0,l.css)({borderRadius:`0 ${e.shape.radius.default} ${e.shape.radius.default} 0`,borderLeft:"none","&[disabled]":{borderLeft:"none"}}),submit:(0,l.css)({borderTopLeftRadius:0,borderBottomLeftRadius:0}),select:(0,l.css)({label:"line-filter-exclusion",marginLeft:0,paddingLeft:0,height:"auto",borderBottomRightRadius:"0",borderTopRightRadius:"0",borderRight:"none",minHeight:"30px",minWidth:"95px",maxWidth:"95px",outline:"none"}),wrapper:(0,l.css)({display:"flex",width:"100%"}),input:(0,l.css)({label:"line-filter-input-wrapper",minWidth:"200px",maxWidth:"editor"===t?"calc(100vw - 198px)":"calc(100vw - 288px)",input:{borderTopLeftRadius:0,borderBottomLeftRadius:0,fontFamily:"monospace",fontSize:e.typography.bodySmall.fontSize,width:"100%"}}),exclusiveBtn:(0,l.css)({marginRight:"1rem"}),field:(0,l.css)({label:"field",flex:"0 1 auto",marginBottom:0})})},2649:(e,t,n)=>{n.d(t,{PY:()=>S,ZB:()=>b,zQ:()=>y});var r=n(6089),a=n(9736),i=n(2007),s=n(5959),l=n.n(s),o=n(4351),c=n(8632),u=n(4509),d=n(9641),p=n(7781),g=n(8996),h=n(8531),f=n(8428),v=n(5953);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b extends a.Bs{constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){m(e,t,n[t])}))}return e}({},e)),m(this,"handleWrapLinesChange",(e=>{this.getLogsPanelScene().setState({wrapLogMessage:e}),(0,o.YK)("wrapLogMessage",e),this.getLogsListScene().setLogsVizOption({wrapLogMessage:e}),this.getLogsListScene().setLogsVizOption({prettifyLogMessage:e})})),m(this,"onChangeLogsSortOrder",(e=>{this.getLogsPanelScene().setState({sortOrder:e}),(0,o.YK)("sortOrder",e),this.getLogsListScene().setLogsVizOption({sortOrder:e})})),m(this,"getLogsListScene",(()=>a.jh.getAncestor(this,c.i))),m(this,"getLogsPanelScene",(()=>a.jh.getAncestor(this,g.o))),m(this,"clearDisplayedFields",(()=>{this.getLogsListScene().clearDisplayedFields(),(0,u.EE)(u.NO.service_details,u.ir.service_details.logs_clear_displayed_fields)}))}}function y(){return(0,o.YM)("sortOrder",p.LogsSortOrder.Descending)}function S(){const e=h.locationService.getLocation(),t=new URLSearchParams(e.search).get("sortOrder");try{if("string"==typeof t){const e=(0,f.FH)(JSON.parse(t));if(e)return e}}catch(e){v.v.error(e,{msg:"LogOptionsScene(getLogsPanelSortOrderFromURL): unable to parse sortOrder"})}return!1}m(b,"Component",(function({model:e}){const{onChangeVisualizationType:t,visualizationType:n}=e.useState(),{wrapLogMessage:r,sortOrder:a}=e.getLogsPanelScene().useState(),{displayedFields:s}=e.getLogsListScene().useState(),o=(0,i.useStyles2)(w),c=null!=r&&r;return l().createElement("div",{className:o.container},s.length>0&&l().createElement(i.Tooltip,{content:`Clear displayed fields: ${s.join(", ")}`},l().createElement(i.Button,{size:"sm",variant:"secondary",fill:"outline",onClick:e.clearDisplayedFields},"Show original log line")),l().createElement(i.InlineField,{className:o.buttonGroupWrapper,transparent:!0},l().createElement(i.RadioButtonGroup,{size:"sm",options:[{label:"Newest first",value:p.LogsSortOrder.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:p.LogsSortOrder.Ascending,description:"Show results oldest to newest"}],value:a,onChange:e.onChangeLogsSortOrder})),l().createElement(i.InlineField,{className:o.buttonGroupWrapper,transparent:!0},l().createElement(i.RadioButtonGroup,{size:"sm",value:c,onChange:e.handleWrapLinesChange,options:[{label:"Wrap",value:!0,description:"Enable wrapping of long log lines"},{label:"No wrap",value:!1,description:"Disable wrapping of long log lines"}]})),l().createElement(d.C,{vizType:n,onChange:t}))}));const w=e=>({container:(0,r.css)({display:"flex",alignItems:"center",gap:e.spacing(1),marginTop:e.spacing(.5)}),buttonGroupWrapper:(0,r.css)({margin:0,alignItems:"center"})})},8632:(e,t,n)=>{n.d(t,{i:()=>bt});var r=n(5959),a=n.n(r),i=n(9736),s=n(8531),l=n(6089),o=n(7781),c=n(2165),u=n(5953),d=n(9598),p=n(8428);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}function f(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const v=`${d.s_}.tableColumnWidths`;var m=function(e){return e.text="text",e.labels="labels",e.auto="auto",e}({});const b=(0,r.createContext)({columnWidthMap:{},setColumnWidthMap:()=>{},columns:{},filteredColumns:{},setColumns:()=>{},setFilteredColumns:()=>{},setVisible:()=>!1,visible:!1,bodyState:"auto",setBodyState:()=>{},clearSelectedLine:()=>{}});const y=({children:e,initialColumns:t,logsFrame:n,setUrlColumns:i,clearSelectedLine:s,setUrlTableBodyState:l,urlTableBodyState:o,showColumnManagementDrawer:d,isColumnManagementActive:g})=>{const[f,m]=(0,r.useState)(S(t)),[y,w]=(0,r.useState)(null!=o?o:"auto"),[O,x]=(0,r.useState)(void 0),E=function(){let e={};const t=localStorage.getItem(v);if(t)try{return e=(0,p.Zt)(JSON.parse(t)),!1===e&&u.v.error(new p.QX("getColumnWidthsFromLocalStorage: unable to validate values in local storage"),{msg:"NarrowingError: error parsing table column widths from local storage"}),e}catch(e){u.v.error(e,{msg:"error parsing table column widths from local storage"})}return e}(),[C,P]=(0,r.useState)(E),k=(0,r.useCallback)((e=>{if(e){const t=S(e);m(t),i((e=>{let t=[];return Object.keys(e).forEach((n=>{e[n].active&&void 0!==e[n].index&&t.push(n)})),t.sort(((t,n)=>{const r=e[t],a=e[n];return r.index-a.index})),t})(t))}}),[i]),j=(0,r.useCallback)((e=>{w(e),l(e)}),[l]),F=(0,r.useCallback)((e=>{d(e)}),[d]);return(0,r.useEffect)((()=>{t&&k(t)}),[t,k]),(0,r.useEffect)((()=>{const e=function(e,t){if(!t)return void u.v.warn("missing dataframe, cannot set url state");const n=Object.keys(e).filter((t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.active})).sort(((t,n)=>{const r=e[t],a=e[n];return void 0!==r.index&&void 0!==a.index?r.index-a.index:0})),r=t.timeField,a=t.bodyField;if(r&&a||n.length){const e=[];return(null==r?void 0:r.name)&&e.push(r.name),(null==a?void 0:a.name)&&e.push(a.name),n.length?n:e}return[]}(f,n);if(null==e?void 0:e.length){0===Object.keys(f).filter((e=>f[e].active)).length&&function(e,t,n){const r=h({},e);r[(0,c.fF)(n)]={index:0,active:!0,type:"TIME_FIELD",percentOfLinesWithLabel:100,cardinality:1/0},r[(0,c.Il)(n)]={index:1,active:!0,type:"BODY_FIELD",percentOfLinesWithLabel:100,cardinality:1/0},t(r)}(f,k,n),x(void 0)}}),[f,n,x,k]),a().createElement(b.Provider,{value:{setColumnWidthMap:e=>{localStorage.setItem(v,JSON.stringify(e)),P(e)},columnWidthMap:C,bodyState:y,setBodyState:j,setFilteredColumns:x,filteredColumns:O,columns:f,setColumns:k,visible:g,setVisible:F,clearSelectedLine:()=>{s()}}},e)},S=e=>{if("labelTypes"in e){const t=h({},e),{labelTypes:n}=t;return f(t,["labelTypes"])}return e};const w=()=>(0,r.useContext)(b);var O=n(3367),x=n(1269),E=n(1625),C=n(2007);const P=(0,r.createContext)({cellIndex:{index:null,numberOfMenuItems:3},setActiveCellIndex:e=>!1}),k=({children:e})=>{const[t,n]=(0,r.useState)({index:null}),i=(0,r.useCallback)((e=>{n(e)}),[]);return a().createElement(P.Provider,{value:{cellIndex:t,setActiveCellIndex:i}},e)},j=()=>(0,r.useContext)(P),F=(0,r.createContext)({isHeaderMenuActive:!1,setHeaderMenuActive:e=>!1}),L=({children:e})=>{const[t,n]=(0,r.useState)(!1),i=(0,r.useCallback)((e=>{n(e)}),[]);return a().createElement(F.Provider,{value:{isHeaderMenuActive:t,setHeaderMenuActive:i}},e)},_=()=>(0,r.useContext)(F);var T=n(9193);function D({searchValue:e,setSearchValue:t}){const{columns:n,setFilteredColumns:r}=w(),i=e=>{const t=e[0];let a={},i=0;var l;t.forEach((e=>{e in n&&(a[e]=n[e],i++)})),r(a),l=i,(0,s.reportInteraction)("grafana_logs_app_table_text_search_result_count",{resultCount:l})},o=function(e){return{searchWrap:(0,l.css)({padding:`${e.spacing(.4)} 0 ${e.spacing(.4)} ${e.spacing(.4)}`})}}((0,C.useTheme2)());return a().createElement(C.Field,{className:o.searchWrap},a().createElement(C.Input,{value:e,type:"text",placeholder:"Search fields by name",onChange:e=>{var a;const s=null===(a=e.currentTarget)||void 0===a?void 0:a.value;var l;t(s),s?(l=s,(0,T.E)(Object.keys(n),l,i)):r(void 0)}}))}var N=n(9902);function $(){const e=function(e){return{empty:(0,l.css)({marginBottom:e.spacing(2),marginLeft:e.spacing(1.75),fontSize:e.typography.fontSize})}}((0,C.useTheme2)());return a().createElement("div",{className:e.empty},"No fields")}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function A(e){var t=function(e,t){if("object"!==M(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===M(t)?t:String(t)}function M(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function R(e){const t=function(e){return{dragIcon:(0,l.css)({cursor:"drag",marginLeft:e.spacing(1),opacity:.4}),labelCount:(0,l.css)({marginLeft:e.spacing(.5),marginRight:e.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11),opacity:.6,display:"flex",flexDirection:"column",alignItems:"self-end"}),contentWrap:(0,l.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),customWidthWrap:(0,l.css)({fontSize:e.typography.bodySmall.fontSize,cursor:"pointer"}),checkboxLabel:(0,l.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})}}((0,C.useTheme2)());var n,r,i,s,o,c;return e.labels[e.label]?a().createElement(a().Fragment,null,a().createElement("div",{className:t.contentWrap},a().createElement(C.Checkbox,{className:t.checkboxLabel,label:e.label,onChange:e.onChange,checked:null!==(c=null===(n=e.labels[e.label])||void 0===n?void 0:n.active)&&void 0!==c&&c}),e.showCount&&a().createElement("div",{className:t.labelCount},a().createElement("div",null,null===(r=e.labels[e.label])||void 0===r?void 0:r.percentOfLinesWithLabel,"%"),a().createElement("div",null,null===(i=e.labels[e.label])||void 0===i?void 0:i.cardinality," ",1===(null===(s=e.labels[e.label])||void 0===s?void 0:s.cardinality)?"value":"values")),e.columnWidthMap&&e.setColumnWidthMap&&void 0!==(null===(o=e.columnWidthMap)||void 0===o?void 0:o[e.label])&&a().createElement("div",{onClick:()=>{var t;const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){I(e,t,n[t])}))}return e}({},e.columnWidthMap),r=e.label,{[r]:a}=n,i=B(n,[r].map(A));null===(t=e.setColumnWidthMap)||void 0===t||t.call(e,i)},title:"Clear column width override",className:t.customWidthWrap},"Reset column width",a().createElement(C.Icon,{name:"x"}))),e.draggable&&a().createElement(C.Icon,{"aria-label":"Drag and drop icon",title:"Drag and drop to reorder",name:"draggabledots",size:"lg",className:t.dragIcon})):null}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){V(e,t,n[t])}))}return e}function z(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const H=e=>{const{columnWidthMap:t,setColumnWidthMap:n}=w(),{reorderColumn:r,labels:i,valueFilter:s,toggleColumn:o}=e,c=(0,C.useTheme2)(),{columns:u}=w(),d=function(e){return{wrap:(0,l.css)({marginTop:e.spacing(1),marginBottom:e.spacing(1),display:"flex",background:e.colors.background.primary}),dragging:(0,l.css)({background:e.colors.background.secondary}),columnWrapper:(0,l.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}(c),p=Object.keys(i).filter((e=>s(e))),g=e=>{e.destination&&r(u,e.source.index,e.destination.index)},h=e=>{const t=i[e];if(t)return`${e} appears in ${null==t?void 0:t.percentOfLinesWithLabel}% of log lines`};return p.length?a().createElement(N.JY,{onDragEnd:g},a().createElement(N.gL,{droppableId:"order-fields",direction:"vertical"},(e=>a().createElement("div",z(W({className:d.columnWrapper},e.droppableProps),{ref:e.innerRef}),p.sort(function(e){return(t,n)=>{const r=e[t],a=e[n];return null!=r.index&&null!=a.index?r.index-a.index:0}}(i)).map(((e,r)=>a().createElement(N.sx,{draggableId:e,key:e,index:r},((r,s)=>a().createElement("div",z(W({className:(0,l.cx)(d.wrap,s.isDragging?d.dragging:void 0),ref:r.innerRef},r.draggableProps,r.dragHandleProps),{title:h(e)}),a().createElement(R,{setColumnWidthMap:n,columnWidthMap:t,label:e,onChange:()=>o(e),labels:i,draggable:!0})))))),e.placeholder)))):a().createElement($,null)},Q=new Intl.Collator(void 0,{sensitivity:"base"});const K=e=>{const{labels:t,valueFilter:n,toggleColumn:r}=e,i=function(e){return{wrap:(0,l.css)({marginTop:e.spacing(.25),marginBottom:e.spacing(.25),display:"flex",background:e.colors.background.primary,borderBottom:`1px solid ${e.colors.background.canvas}`}),dragging:(0,l.css)({background:e.colors.background.secondary}),columnWrapper:(0,l.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}((0,C.useTheme2)()),s=Object.keys(t).filter((e=>n(e)));return s.length?a().createElement("div",{className:i.columnWrapper},s.sort(function(e){return(t,n)=>{const r=e[t],a=e[n];return null!=r&&null!=a?Number("TIME_FIELD"===a.type)-Number("TIME_FIELD"===r.type)||Number("BODY_FIELD"===a.type)-Number("BODY_FIELD"===r.type)||Q.compare(t,n):0}}(t)).map((e=>{var n;return a().createElement("div",{key:e,className:i.wrap,title:`${e} appears in ${null===(n=t[e])||void 0===n?void 0:n.percentOfLinesWithLabel}% of log lines`},a().createElement(R,{showCount:!0,label:e,onChange:()=>r(e),labels:t}))}))):a().createElement($,null)};const G=e=>{const t=function(e){return{sidebarWrap:(0,l.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,l.css)({appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11)}),columnHeader:(0,l.css)({display:"flex",justifyContent:"space-between",fontSize:e.typography.h6.fontSize,background:e.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:e.spacing(.75),paddingRight:e.spacing(.75),paddingBottom:e.spacing(.75),paddingLeft:e.spacing(1.5),zIndex:3,marginBottom:e.spacing(2)})}}((0,C.useTheme2)());var n,r;return a().createElement("div",{className:t.sidebarWrap},a().createElement(a().Fragment,null,a().createElement("div",{className:t.columnHeader},"Selected fields",a().createElement("button",{onClick:e.clear,className:t.columnHeaderButton},"Reset")),a().createElement(H,{reorderColumn:e.reorderColumn,toggleColumn:e.toggleColumn,labels:null!==(n=e.filteredColumnsWithMeta)&&void 0!==n?n:e.columnsWithMeta,valueFilter:t=>{var n,r;return null!==(r=null===(n=e.columnsWithMeta[t])||void 0===n?void 0:n.active)&&void 0!==r&&r},id:"selected-fields"}),a().createElement("div",{className:t.columnHeader},"Fields"),a().createElement(K,{toggleColumn:e.toggleColumn,labels:null!==(r=e.filteredColumnsWithMeta)&&void 0!==r?r:e.columnsWithMeta,valueFilter:t=>{var n;return!(null===(n=e.columnsWithMeta[t])||void 0===n?void 0:n.active)}})))};function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){U(e,t,n[t])}))}return e}function J(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Y(e){return(t,n,r)=>{if(n===r)return;const a=q({},t),i=Object.keys(a).filter((e=>a[e].active)).map((e=>{var t;return{fieldName:e,index:null!==(t=a[e].index)&&void 0!==t?t:0}})).sort(((e,t)=>e.index-t.index)),[s]=i.splice(n,1);i.splice(r,0,s),i.filter((e=>void 0!==e)).forEach(((e,t)=>{a[e.fieldName].index=t})),e(a)}}function X(){const{columns:e,setColumns:t,setVisible:n,filteredColumns:i,setFilteredColumns:l}=w(),[o,c]=(0,r.useState)(""),d=Y(t);return a().createElement(C.ClickOutsideWrapper,{onClick:()=>{n(!1),l(e),c("")},useCapture:!0},a().createElement(D,{searchValue:o,setSearchValue:c}),a().createElement(G,{toggleColumn:n=>{if(!e||!(n in e))return void function(e,t){let n;try{n={columns:JSON.stringify(t),columnName:e}}catch(t){n={msg:"Table: ColumnSelectionDrawerWrap failed to encode context",columnName:e}}u.v.warn("failed to get column",n)}(n,e);const r=Object.keys(e).filter((t=>e[t].active)).length,a=!e[n].active||void 0;let o;if(o=J(q({},e),a?{[n]:J(q({},e[n]),{active:a,index:r})}:{[n]:J(q({},e[n]),{active:!1,index:void 0})}),function(t){if(e){var n,r;const a=!(null===(n=e[t])||void 0===n?void 0:n.active),i=null===(r=Object.keys(e).filter((t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.active})))||void 0===r?void 0:r.length,l={columnAction:a?"add":"remove",columnCount:a?i+1:i-1};(0,s.reportInteraction)("grafana_logs_app_table_column_filter_clicked",l)}}(n),t(o),i){var d;const e=!(null===(d=i[n])||void 0===d?void 0:d.active);let t;t=J(q({},i),e?{[n]:J(q({},i[n]),{active:e,index:r})}:{[n]:J(q({},i[n]),{active:!1,index:void 0})}),l(t),c("")}},filteredColumnsWithMeta:i,columnsWithMeta:e,clear:()=>{const n=q({},e);let r=0;Object.keys(n).forEach((e=>{const t="BODY_FIELD"===n[e].type||"TIME_FIELD"===n[e].type;n[e].active=t,n[e].index=t?r++:void 0})),t(n),l(n),c("")},reorderColumn:d}))}const Z=e=>a().createElement(ee,{onMouseOut:e.onMouseOut,onMouseIn:e.onMouseIn,onClick:e.onClick,field:e.field,rowIndex:e.rowIndex},e.children),ee=e=>{var t;const n=(0,C.useTheme2)(),r=j(),i=((e,t)=>({active:(0,l.css)({height:"calc(100% + 36px)",zIndex:e.zIndex.tooltip,background:"transparent"}),wrap:(0,l.css)({position:"absolute",overflowX:"hidden",whiteSpace:"nowrap",width:"100%",height:"100%",left:0,top:0,margin:"auto",background:null!=t?t:"transparent"})}))(n,void 0,null===(t=r.cellIndex)||void 0===t||t.numberOfMenuItems);return a().createElement("div",{onMouseLeave:e.onMouseOut,onMouseEnter:e.onMouseIn,onClick:e.onClick,className:r.cellIndex.index===e.rowIndex&&r.cellIndex.fieldName===e.field.name?(0,l.cx)(i.wrap,i.active):i.wrap},e.children)},te={logsFrame:null,addFilter:e=>{},timeRange:void 0,selectedLine:void 0},ne=(0,r.createContext)(te),re=({children:e,logsFrame:t,addFilter:n,selectedLine:r,timeRange:i})=>a().createElement(ne.Provider,{value:{logsFrame:t,addFilter:n,selectedLine:r,timeRange:i}},e),ae=()=>(0,r.useContext)(ne);var ie=n(6854);const se=e=>{const t=((e,t)=>({menu:(0,l.css)({position:"relative",paddingRight:"5px",display:"flex",minWidth:"60px",justifyContent:"flex-start"}),menuItemsWrap:(0,l.css)({boxShadow:e.shadows.z3,display:"flex",background:e.colors.background.secondary,padding:"5px 0",marginLeft:"column"===t?"5px":void 0}),menuItem:(0,l.css)({overflow:"auto",textOverflow:"ellipsis",cursor:"pointer",paddingLeft:"5px",paddingRight:"5px",display:"flex",alignItems:"center"})}))((0,C.useTheme2)(),e.pillType),{addFilter:n}=ae();return a().createElement("span",{className:t.menu},a().createElement("span",{className:t.menuItemsWrap},"derived"!==e.fieldType&&a().createElement(a().Fragment,null,a().createElement("div",{className:t.menuItem,onClick:()=>{n({key:e.label,value:e.value,operator:ie.w7.Equal})}},a().createElement(C.Icon,{title:"Add to search",size:"md",name:"plus-circle"})),a().createElement("div",{className:t.menuItem,onClick:()=>{n({key:e.label,value:e.value,operator:ie.w7.NotEqual})}},a().createElement(C.Icon,{title:"Exclude from search",size:"md",name:"minus-circle"}))),e.showColumn&&a().createElement("div",{title:"Add column",onClick:e.showColumn,className:t.menuItem},a().createElement("svg",{width:"18",height:"16",viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.38725 1.33301H13.3872C13.5641 1.33301 13.7336 1.40325 13.8587 1.52827C13.9837 1.65329 14.0539 1.82286 14.0539 1.99967V2.33333C14.0539 2.70152 13.7554 3 13.3872 3H13.0542C12.87 3 12.7206 2.85062 12.7206 2.66634H8.05391V13.333H12.7206C12.7206 13.1491 12.8697 13 13.0536 13H13.3872C13.7554 13 14.0539 13.2985 14.0539 13.6667V13.9997C14.0539 14.1765 13.9837 14.3461 13.8587 14.4711C13.7336 14.5961 13.5641 14.6663 13.3872 14.6663H1.38725C1.21044 14.6663 1.04087 14.5961 0.915843 14.4711C0.790819 14.3461 0.720581 14.1765 0.720581 13.9997V1.99967C0.720581 1.82286 0.790819 1.65329 0.915843 1.52827C1.04087 1.40325 1.21044 1.33301 1.38725 1.33301ZM2.05391 13.333H6.72058V2.66634H2.05391V13.333Z",fill:"#CCCCDC",fillOpacity:"1"}),a().createElement("path",{d:"M13.8538 7.19999H16.2538C16.466 7.19999 16.6695 7.28429 16.8195 7.4343C16.9696 7.58432 17.0538 7.78783 17.0538 7.99999C17.0538 8.21214 16.9696 8.41566 16.8195 8.56567C16.6695 8.71569 16.466 8.79999 16.2538 8.79999H13.8538V11.2C13.8538 11.4121 13.7696 11.6156 13.6195 11.7657C13.4695 11.9157 13.266 12 13.0538 12C12.8416 12 12.6382 11.9157 12.4881 11.7657C12.3381 11.6156 12.2538 11.4121 12.2538 11.2V8.79999H9.85384C9.64165 8.79999 9.43819 8.71569 9.28815 8.56567C9.13811 8.41566 9.05383 8.21214 9.05383 7.99999C9.05383 7.78783 9.13811 7.58432 9.28815 7.4343C9.43819 7.28429 9.64165 7.19999 9.85384 7.19999H12.2538V4.8C12.2538 4.58784 12.3381 4.38433 12.4881 4.23431C12.6382 4.0843 12.8416 4 13.0538 4C13.266 4 13.4695 4.0843 13.6195 4.23431C13.7696 4.38433 13.8538 4.58784 13.8538 4.8V7.19999Z",fill:"#CCCCDC",fillOpacity:"1"}))),e.links&&e.links.map((e=>{var n;return a().createElement("div",{className:t.menuItem,onClick:()=>{window.open(e.href,"_blank")},key:e.href},a().createElement(C.Icon,{title:null!==(n=e.title)&&void 0!==n?n:"Link",key:e.href,size:"md",name:"link"}))}))))},le="detected_level",oe=e=>{const{label:t,value:n}=e,r=(0,C.useTheme2)(),{cellIndex:i}=j();let s;if(t===le){const e=Re().options;"string"==typeof n&&n in e&&(s=e[n].color)}const c=i.index===e.rowIndex&&e.field.name===i.fieldName,u=((e,t)=>({activePillWrap:(0,l.css)({}),pillWrap:(0,l.css)({width:"100%"}),pill:(0,l.css)({border:`1px solid ${e.colors.border.weak}`,"&:hover":{border:`1px solid ${e.colors.border.strong}`},marginRight:"5px",marginTop:"4px",marginLeft:"5px",padding:"2px 5px",position:"relative",display:"inline-flex",flexDirection:"row-reverse",backgroundColor:"transparent",paddingLeft:t?`${e.spacing(.75)}`:"2px","&:before":{content:'""',position:"absolute",left:0,top:0,height:"100%",width:`${e.spacing(.25)}`,backgroundColor:t}}),menu:(0,l.css)({width:"100%"}),menuItem:(0,l.css)({overflow:"auto",textOverflow:"ellipsis"}),menuItemText:(0,l.css)({width:"65px",display:"inline-block"})}))(r,s);return a().createElement("div",{className:(0,l.cx)(u.pillWrap,c?u.activePillWrap:void 0)},!!n&&a().createElement(a().Fragment,null,a().createElement("span",{className:u.pill},a().createElement(a().Fragment,null,n)),c&&"string"==typeof n&&e.field.type!==o.FieldType.time&&a().createElement(se,{label:e.label,value:n,pillType:"column"})))};var ce=n(3571),ue=n(5002);function de(e){var t;const n=(e=>({clipboardButton:(0,l.css)({padding:0,height:"100%",lineHeight:"1",width:"20px"}),inspectButton:(0,l.css)({display:"inline-flex",verticalAlign:"middle",margin:0,overflow:"hidden",borderRadius:"5px"}),iconWrapper:(0,l.css)({height:"35px",position:"sticky",left:0,display:"flex",background:e.colors.background.secondary,padding:`0 ${e.spacing(.5)}`,zIndex:1,boxShadow:e.shadows.z2}),inspect:(0,l.css)({padding:"5px 3px","&:hover":{color:e.colors.text.link,cursor:"pointer"}})}))((0,C.useTheme2)()),{logsFrame:i,timeRange:s}=ae(),o=null==i||null===(t=i.idField)||void 0===t?void 0:t.values[e.rowIndex],c=null==i?void 0:i.bodyField.values[e.rowIndex],[u,d]=(0,r.useState)(!1),p=(0,r.useCallback)((()=>s?(0,ue.gW)("selectedLine",{id:o,row:e.rowIndex},s):""),[o,e.rowIndex,s]);return a().createElement(a().Fragment,null,a().createElement("div",{className:n.iconWrapper},a().createElement("div",{className:n.inspect},a().createElement(C.IconButton,{"data-testid":ce.b.table.inspectLine,className:n.inspectButton,tooltip:"View log line",variant:"secondary","aria-label":"View log line",tooltipPlacement:"top",size:"md",name:"eye",onClick:()=>d(!0),tabIndex:0})),a().createElement("div",{className:n.inspect},a().createElement(C.ClipboardButton,{className:n.clipboardButton,icon:"share-alt",variant:"secondary",fill:"text",size:"md",tooltip:"Copy link to log line",tooltipPlacement:"top",tabIndex:0,getText:p}))),a().createElement(a().Fragment,null,u&&a().createElement(C.Modal,{onDismiss:()=>d(!1),isOpen:!0,title:"Inspect value"},a().createElement("pre",null,c),a().createElement(C.Modal.ButtonRow,null,a().createElement(C.ClipboardButton,{icon:"copy",getText:()=>e.value},"Copy to Clipboard")))))}const pe=e=>{var t;let n=e.value;const r=e.field,i=r.display(n),s=((e,t)=>({flexWrap:(0,l.css)({display:"flex",alignItems:"flex-start",flexDirection:t===o.FieldType.number?"row-reverse":"row",textAlign:t===o.FieldType.number?"right":"left"}),content:(0,l.css)({position:"relative",overflow:"hidden",display:"flex",height:"100%"}),linkWrapper:(0,l.css)({color:e.colors.text.link,marginTop:"7px",marginLeft:"7px","&:hover":{textDecoration:"underline"}})}))((0,C.useTheme2)(),e.field.type),{setVisible:c}=w(),{cellIndex:u,setActiveCellIndex:d}=j(),p={index:e.rowIndex},g=Boolean(null===(t=(0,C.getCellLinks)(e.field,p))||void 0===t?void 0:t.length);if(null===n)return a().createElement(a().Fragment,null);n=a().isValidElement(e.value)?e.value:"object"==typeof n?JSON.stringify(e.value):(0,o.formattedValueToString)(i);return a().createElement(Z,{onClick:()=>e.rowIndex===u.index&&e.field.name===u.fieldName?d({index:null}):d({index:e.rowIndex,fieldName:e.field.name,numberOfMenuItems:3}),field:e.field,rowIndex:e.rowIndex},a().createElement("div",{className:s.content},0===e.fieldIndex&&a().createElement(de,{value:n,rowIndex:e.rowIndex}),a().createElement("div",{className:s.flexWrap}),!g&&((t,n)=>a().createElement(oe,{field:e.field,rowIndex:e.rowIndex,showColumns:()=>c(!0),label:n,value:t}))(n,r.name),g&&r.getLinks&&a().createElement(C.DataLinksContextMenu,{links:()=>{var e;return null!==(e=(0,C.getCellLinks)(r,p))&&void 0!==e?e:[]}},(e=>e.openMenu?a().createElement("div",{className:s.linkWrapper,onClick:e.openMenu},a().createElement(a().Fragment,null,n)):a().createElement("div",{className:s.linkWrapper},a().createElement(a().Fragment,null,n))))))};function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ge(e,t,n[t])}))}return e}function fe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ve(e){const t=(0,C.useTheme2)();let n;if(e.label===le){const t=Re().options;e.value in t&&(n=t[e.value].color)}const r=((e,t)=>({pill:(0,l.css)({flex:"0 1 auto",marginLeft:e.spacing(.5),marginRight:e.spacing(.5),padding:`${e.spacing(.25)} ${e.spacing(.25)}`,position:"relative",display:"inline-flex",flexDirection:"column",marginTop:e.spacing(.5)}),activePill:(0,l.css)({}),valueWrap:(0,l.css)({border:`1px solid ${e.colors.background.secondary}`,boxShadow:`-2px 2px 5px 0px ${e.colors.background.secondary}`,backgroundColor:"transparent",cursor:"pointer",position:"relative",paddingRight:`${e.spacing(.5)}`,paddingLeft:t?`${e.spacing(.75)}`:`${e.spacing(.5)}`,"&:before":{content:'""',position:"absolute",left:0,top:0,height:"100%",width:`${e.spacing(.25)}`,backgroundColor:t},"&:hover":{border:`1px solid ${e.colors.border.strong}`}})}))(t,n);return a().createElement("span",{className:(0,l.cx)(r.pill,e.menuActive?r.activePill:void 0),onClick:e.onClick},a().createElement("span",{className:r.valueWrap},e.label,"=",e.value),e.menuActive&&a().createElement(se,{pillType:"logPill",fieldType:e.fieldType,links:e.links,label:e.label,value:e.value,showColumn:e.onClickAdd}))}const me=e=>{const{label:t}=e,{cellIndex:n,setActiveCellIndex:i}=j(),{columns:l,setColumns:c}=w(),u=e.value,d=(0,s.getTemplateSrv)(),p=(0,r.useMemo)((()=>d.replace.bind(d)),[d]),g=e.field;if(!g||(null==g?void 0:g.type)===o.FieldType.other)return null;const h={index:e.rowIndex};e.originalField&&e.isDerivedField&&e.originalFrame&&(e.originalField.getLinks=(0,o.getLinksSupplier)(e.originalFrame,e.originalField,{},p));const f=e.originalField&&(0,C.getCellLinks)(e.originalField,h);return a().createElement(ve,{onClick:()=>e.rowIndex===n.index&&g.name===n.fieldName&&t===n.subFieldName?i({index:null}):i({index:e.rowIndex,fieldName:g.name,subFieldName:t,numberOfMenuItems:e.isDerivedField?2:3}),menuActive:n.index===e.rowIndex&&n.fieldName===g.name&&n.subFieldName===t,fieldType:e.isDerivedField?"derived":void 0,label:t,value:u,onClickAdd:()=>(e=>{const t=he({},l),n=Object.keys(l).filter((e=>l[e].active)).length;t[e].active?t[e]=fe(he({},t[e]),{active:!1,index:void 0}):t[e]=fe(he({},t[e]),{active:!0,index:n}),c(t)})(t),links:f})},be=e=>{var t,n;null==e||null===(n=e.current)||void 0===n||n.scrollTo({left:null===(t=e.current)||void 0===t?void 0:t.scrollLeft})};function ye({scrollerRef:e}){const t=(e=>({scroller:l.css`
    position: absolute;
    right: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 20px;
    top: 32px;
    margin-top: -24px;
    // For some reason clicking on this button causes text to be selected in the following row
    user-select: none;
  `,scrollLeft:l.css`
    cursor: pointer;
    background: ${e.colors.background.primary};

    &:hover {
      background: ${e.colors.background.secondary};
    }
  `,scrollRight:l.css`
    cursor: pointer;
    background: ${e.colors.background.primary};

    &:hover {
      background: ${e.colors.background.secondary};
    }
  `}))((0,C.useTheme2)());return a().createElement("div",{className:t.scroller},a().createElement("span",{onPointerDown:()=>{var t,n;null==(t=e)||null===(n=t.current)||void 0===n||n.scrollTo({top:0,left:0,behavior:"smooth"})},onPointerUp:()=>be(e),className:t.scrollLeft},a().createElement(C.Icon,{name:"arrow-left"})),a().createElement("span",{onPointerDown:()=>{var t,n;null==(t=e)||null===(n=t.current)||void 0===n||n.scrollTo({top:0,left:t.current.scrollWidth,behavior:"smooth"})},onPointerUp:()=>be(e),className:t.scrollRight},a().createElement(C.Icon,{name:"arrow-right"})))}function Se(e){const t=(0,C.useTheme2)(),n=we(t);return a().createElement("div",{"data-testid":ce.b.table.rawLogLine,className:n.rawLogLine},a().createElement(a().Fragment,null,e.value))}const we=(e,t)=>({rawLogLine:(0,l.css)({fontFamily:e.typography.fontFamilyMonospace,height:"35px",lineHeight:"35px",paddingRight:e.spacing(1.5),paddingLeft:e.spacing(1),fontSize:e.typography.bodySmall.fontSize})}),Oe=e=>{let t=e.value;const n=e.field,i=n.display(t),s=(0,C.useTheme2)(),l=xe(s),{columns:u,setVisible:d,bodyState:p}=w(),{logsFrame:g}=ae(),[h,f]=(0,r.useState)(!1),v=(0,r.useRef)(null);t=a().isValidElement(e.value)?e.value:"object"==typeof t?JSON.stringify(e.value):(0,o.formattedValueToString)(i);const b=(t=>Object.keys(u).filter((e=>e!==(0,c.Il)(g))).sort(((e,t)=>e===le?-1:t===le?1:"LINK_FIELD"===u[e].type?-1:"LINK_FIELD"===u[t].type?1:u[e].cardinality>u[t].cardinality?-1:1)).filter((e=>!u[e].active&&u[e].cardinality>1)).map((r=>{var i;const s=t[r],l=null==g||null===(i=g.raw)||void 0===i?void 0:i.fields.find((e=>e.name===r)),c=null==n?void 0:n.values[e.rowIndex],p=!s&&!!c;if(s)return a().createElement(me,{originalFrame:void 0,field:n,columns:u,rowIndex:e.rowIndex,frame:e.frame,showColumns:()=>d(!0),key:r,label:r,isDerivedField:!1,value:s});if(p&&(null==l?void 0:l.name)){const t=null==l?void 0:l.values[e.rowIndex];if((null==l?void 0:l.type)===o.FieldType.string&&t)return a().createElement(me,{originalFrame:null==g?void 0:g.raw,originalField:l,field:n,value:t,columns:u,rowIndex:e.rowIndex,frame:e.frame,showColumns:()=>d(!0),key:l.name,label:l.name,isDerivedField:!0})}return null})).filter((e=>e)))(e.labels),y=p===m.auto,S=b.length>0;return a().createElement(Z,{onMouseIn:()=>{f(!0)},onMouseOut:()=>{f(!1)},rowIndex:e.rowIndex,field:e.field},a().createElement(O.ScrollSyncPane,{innerRef:v,group:"horizontal"},a().createElement("div",{className:l.content},0===e.fieldIndex&&a().createElement(de,{rowIndex:e.rowIndex,value:t}),y&&S&&a().createElement(a().Fragment,null,b),p===m.labels&&S&&a().createElement(a().Fragment,null,b),p===m.labels&&!S&&a().createElement(Se,{value:t}),y&&!S&&a().createElement(Se,{value:t}),p===m.text&&a().createElement(Se,{value:t}),h&&a().createElement(ye,{scrollerRef:v}))))},xe=e=>({content:l.css`
    white-space: nowrap;
    overflow-x: auto;
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
    padding-right: 30px;
    display: flex;
    align-items: flex-start;
    height: 100%;
    &::-webkit-scrollbar {
      display: none; /* Chrome, Safari and Opera */
    }

    &:after {
      pointer-events: none;
      content: '';
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      top: 0;
      // Fade out text in last 10px to background color to add affordance to horiziontal scroll
      background: linear-gradient(to right, transparent calc(100% - 10px), ${e.colors.background.primary});
    }
  `});function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ce(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Pe(e){var t=function(e,t){if("object"!==ke(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ke(t)?t:String(t)}function ke(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}const je=e=>{const{setHeaderMenuActive:t,isHeaderMenuActive:n}=_(),{logsFrame:i}=ae(),s=(0,r.useRef)(null),o=((e,t,n)=>({logLineButton:(0,l.css)({marginLeft:"5px"}),tableHeaderMenu:(0,l.css)({label:"tableHeaderMenu",width:"100%",minWidth:"250px",height:"100%",maxHeight:"400px",backgroundColor:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`,padding:e.spacing(2),margin:e.spacing(1,0),boxShadow:e.shadows.z3,borderRadius:e.shape.radius.default}),leftAlign:(0,l.css)({label:"left-align",display:"flex",width:"calc(100% - 20px)"}),clearButton:(0,l.css)({marginLeft:"5px"}),rightAlign:(0,l.css)({label:"right-align",display:"flex",marginRight:"5px"}),wrapper:(0,l.css)({label:"wrapper",display:"flex",marginLeft:t?"56px":"6px",width:n?"calc(100% + 6px)":"100%",borderRight:`1px solid ${e.colors.border.weak}`,marginRight:"-6px"}),defaultContentWrapper:(0,l.css)({borderLeft:t?`1px solid ${e.colors.border.weak}`:"none",marginLeft:t?"-6px":0,paddingLeft:t?"12px":0,display:"flex"})}))((0,C.useTheme2)(),0===e.fieldIndex,e.field.name===(0,c.Il)(i)),{columnWidthMap:u,setColumnWidthMap:d,setBodyState:p,bodyState:g}=w(),h=e.field.name===(0,c.Il)(i),f=()=>{p(g===m.text?m.labels:m.text)};return a().createElement("span",{className:o.wrapper},a().createElement("span",{className:o.leftAlign},a().createElement("span",{className:o.defaultContentWrapper},e.defaultContent),u&&d&&void 0!==(null==u?void 0:u[e.field.name])&&a().createElement(C.IconButton,{tooltip:"Reset column width",tooltipPlacement:"top",className:o.clearButton,"aria-label":"Reset column width",name:"x",onClick:()=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ee(e,t,n[t])}))}return e}({},u),n=e.field.name,{[n]:r}=t,a=Ce(t,[n].map(Pe));null==d||d(a)}}),h&&a().createElement(a().Fragment,null,g===m.text?a().createElement(C.IconButton,{tooltipPlacement:"top",tooltip:"Show log labels","aria-label":"Show log labels",onClick:f,className:o.logLineButton,name:"brackets-curly",size:"md"}):a().createElement(C.IconButton,{tooltipPlacement:"top",tooltip:"Show log text","aria-label":"Show log text",onClick:f,className:o.logLineButton,name:"text-fields",size:"md"}))),a().createElement("span",{className:o.rightAlign},a().createElement(C.IconButton,{tooltip:`Show ${e.field.name} menu`,tooltipPlacement:"top",ref:s,"aria-label":`Show ${e.field.name} menu`,onClick:e=>{t(!n)},name:"ellipsis-v"})),s.current&&a().createElement(C.Popover,{show:n,content:a().createElement(C.ClickOutsideWrapper,{onClick:()=>t(!1),useCapture:!0},a().createElement("div",{className:o.tableHeaderMenu},e.children)),referenceElement:s.current}))};function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e){const{setHeaderMenuActive:t}=_(),{columns:n,setColumns:i,bodyState:s,setBodyState:o}=w(),{logsFrame:u}=ae(),d=_e(),p=(0,r.useCallback)((e=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Fe(e,t,n[t])}))}return e}({},n);Object.keys(t).filter((n=>{const r=t[n].index,a=t[e.name].index;return t[n].active&&a&&r&&r>a})).map((e=>t[e])).forEach((e=>{void 0!==e.index&&e.index--})),t[e.name].active=!1,t[e.name].index=void 0,i(t)}),[n,i]),g=e.headerProps.field.name===(0,c.Il)(u);return a().createElement(je,e.headerProps,a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{e.openColumnManagementDrawer(),t(!1)}},a().createElement(C.Icon,{className:d.icon,name:"columns",size:"md"}),"Manage columns")),a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>p(e.headerProps.field)},a().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 16",width:"17",height:"16",className:"css-q2u0ig-Icon"},a().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.73446 1.33301H12.2345C12.3892 1.33301 12.5375 1.40325 12.6469 1.52827C12.7563 1.65329 12.8178 1.82286 12.8178 1.99967V4.74967C12.8178 5.07184 12.5566 5.33301 12.2345 5.33301C11.9123 5.33301 11.6511 5.07184 11.6511 4.74967V2.66634H7.56779V13.333H11.6511V10.9163C11.6511 10.5942 11.9123 10.333 12.2345 10.333C12.5566 10.333 12.8178 10.5942 12.8178 10.9163V13.9997C12.8178 14.1765 12.7563 14.3461 12.6469 14.4711C12.5375 14.5961 12.3892 14.6663 12.2345 14.6663H1.73446C1.57975 14.6663 1.43137 14.5961 1.32198 14.4711C1.21258 14.3461 1.15112 14.1765 1.15112 13.9997V1.99967C1.15112 1.82286 1.21258 1.65329 1.32198 1.52827C1.43137 1.40325 1.57975 1.33301 1.73446 1.33301ZM2.31779 13.333H6.40112V2.66634H2.31779V13.333Z",fill:"#CCCCDC",fillOpacity:"1"}),a().createElement("path",{d:"M15.9893 10.6315C15.9498 10.7263 15.8919 10.8123 15.819 10.8846C15.7467 10.9575 15.6607 11.0154 15.5659 11.0549C15.4712 11.0943 15.3695 11.1147 15.2668 11.1147C15.1641 11.1147 15.0625 11.0943 14.9677 11.0549C14.8729 11.0154 14.7869 10.9575 14.7146 10.8846L12.9335 9.09573L11.1524 10.8846C11.0801 10.9575 10.9941 11.0154 10.8993 11.0549C10.8045 11.0943 10.7028 11.1147 10.6002 11.1147C10.4975 11.1147 10.3958 11.0943 10.301 11.0549C10.2063 11.0154 10.1202 10.9575 10.0479 10.8846C9.97504 10.8123 9.91717 10.7263 9.87769 10.6315C9.8382 10.5367 9.81787 10.4351 9.81787 10.3324C9.81787 10.2297 9.8382 10.1281 9.87769 10.0333C9.91717 9.9385 9.97504 9.85248 10.0479 9.78017L11.8368 7.99906L10.0479 6.21795C9.90148 6.07149 9.8192 5.87285 9.8192 5.66573C9.8192 5.4586 9.90148 5.25996 10.0479 5.1135C10.1944 4.96705 10.393 4.88477 10.6002 4.88477C10.8073 4.88477 11.0059 4.96705 11.1524 5.1135L12.9335 6.90239L14.7146 5.1135C14.8611 4.96705 15.0597 4.88477 15.2668 4.88477C15.4739 4.88477 15.6726 4.96705 15.819 5.1135C15.9655 5.25996 16.0478 5.4586 16.0478 5.66573C16.0478 5.87285 15.9655 6.07149 15.819 6.21795L14.0302 7.99906L15.819 9.78017C15.8919 9.85248 15.9498 9.9385 15.9893 10.0333C16.0288 10.1281 16.0491 10.2297 16.0491 10.3324C16.0491 10.4351 16.0288 10.5367 15.9893 10.6315Z",fill:"#CCCCDC",fillOpacity:"1"})),"Remove column")),e.slideLeft&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{var t;return null===(t=e.slideLeft)||void 0===t?void 0:t.call(e,n)}},a().createElement(C.Icon,{className:(0,l.cx)(d.icon,d.reverse),name:"arrow-from-right",size:"md"}),"Move left")),e.slideRight&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{var t;return null===(t=e.slideRight)||void 0===t?void 0:t.call(e,n)}},a().createElement(C.Icon,{className:d.icon,name:"arrow-from-right",size:"md"}),"Move right")),g&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{s===m.text?o(m.labels):o(m.text)}},s===m.text?a().createElement(C.Icon,{className:d.icon,name:"brackets-curly",size:"md"}):a().createElement(C.Icon,{className:d.icon,name:"text-fields",size:"md"}),s===m.text?"Show labels":"Show log text")),e.autoColumnWidths&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{var t;return null===(t=e.autoColumnWidths)||void 0===t?void 0:t.call(e)}},a().createElement(C.Icon,{className:d.icon,name:"arrows-h",size:"md"}),"Reset column widths")))}const _e=()=>({reverse:(0,l.css)({transform:"scaleX(-1)"}),link:(0,l.css)({paddingTop:"5px",paddingBottom:"5px"}),icon:(0,l.css)({marginRight:"10px"}),linkWrap:(0,l.css)({})});var Te=n(3241);function De(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ne(e,t,n[t])}))}return e}function Ie(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Be(e){return a().createElement(C.Table,{onColumnResize:e.onResize,initialSortBy:[{displayName:(0,c.fF)(e.logsFrame),desc:!0}],initialRowIndex:e.selectedLine,cellHeight:E.qM.Sm,data:e.data,height:e.height,width:e.width,footerOptions:{show:!0,reducer:["count"],countRows:!0}})}const Ae=e=>{const{height:t,timeZone:n,logsFrame:i,width:u,labels:d}=e,p=(0,C.useTheme2)(),g={section:(0,l.css)({position:"relative"}),tableWrap:(0,l.css)({".cellActions":{display:"none !important"}})},[h,f]=(0,r.useState)(void 0),{columns:v,visible:m,setVisible:b,setFilteredColumns:y,setColumns:S,clearSelectedLine:E,columnWidthMap:P,setColumnWidthMap:j}=w(),{selectedLine:F}=ae(),[_]=(0,r.useState)(F),T=Y(S),D=(0,s.getTemplateSrv)(),N=(0,r.useMemo)((()=>D.replace.bind(D)),[D]),$=(0,r.useCallback)((e=>{if(!e.length)return e;const[t]=(0,o.applyFieldOverrides)({data:[e],timeZone:n,theme:p,replaceVariables:N,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const[n,l]of t.fields.entries()){var r,s;l.type=l.type===o.FieldType.string?null!==(r=Me(l))&&void 0!==r?r:o.FieldType.string:l.type,l.config=Ie($e({},l.config),{custom:$e({inspect:!0,filterable:!0,headerComponent:t=>a().createElement(L,null,a().createElement(Le,{headerProps:Ie($e({},t),{fieldIndex:n}),openColumnManagementDrawer:()=>b(!0),slideLeft:0!==n?e=>T(e,n,n-1):void 0,slideRight:n!==e.fields.length-1?e=>T(e,n,n+1):void 0,autoColumnWidths:Object.keys(P).length>0?()=>{j({})}:void 0})),width:null!==(s=P[l.name])&&void 0!==s?s:We(l,n,v,u,t.fields.length,i),cellOptions:Ve(l,n,d,i)},l.config.custom),filterable:!0})}return t}),[n,p,d,u,N,b,P]);(0,r.useEffect)((()=>{const e=function(){var e,t=(e=function*(){const e=(t=i.raw).fields.filter((e=>{var n,r,a;const i="json.RawMessage"===(null===(n=e.typeInfo)||void 0===n?void 0:n.frame)&&"labels"===e.name&&(null==t||null===(r=t.meta)||void 0===r?void 0:r.type)!==o.DataFrameType.LogLines,s="labels"===e.name&&e.type===o.FieldType.other&&(null==t||null===(a=t.meta)||void 0===a?void 0:a.type)===o.DataFrameType.LogLines;return i||s})).flatMap((e=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:e.name}}]));var t;const n=function(e){let t={};for(const n in e)t[n]=!0;return Object.keys(e).length>0?{id:"organize",options:{indexByName:e,includeByName:t}}:null}(function(e){let t={};return Object.keys(e).filter((t=>e[t].active)).forEach((n=>{const r=e[n].index;void 0!==r&&(t[n]=r)})),t}(v));if(n)e.push(n);else{const t={time:i.timeField,body:i.bodyField,extraFields:i.extraFields};t&&void 0!==t.body&&void 0!==t.time&&e.push(function(e){return{id:"organize",options:{indexByName:{[e.time.name]:0,[e.body.name]:1},includeByName:{[e.body.name]:!0,[e.time.name]:!0}}}}(t))}if(e.length>0){const t=yield(0,x.lastValueFrom)((0,o.transformDataFrame)(e,[i.raw])),n=$(t[0]);f(n)}else f($(i.raw))},function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){De(i,r,a,s,l,"next",e)}function l(e){De(i,r,a,s,l,"throw",e)}s(void 0)}))});return function(){return t.apply(this,arguments)}}();e()}),[i.raw,i.bodyField,i.timeField,i.extraFields,$,v]),(0,r.useEffect)((()=>{_&&F&&E()}),[_,E,F]);const I=i.raw.fields.find((e=>e.name===(0,c.po)(i))),B=null==I?void 0:I.values.findIndex((e=>e===(null==_?void 0:_.id))),A=B&&-1!==B?B:void 0;if(!h)return a().createElement(a().Fragment,null);return a().createElement("div",{"data-testid":ce.b.table.wrapper,className:g.section},m&&a().createElement(C.Drawer,{size:"sm",onClose:()=>{b(!1),y(v)}},a().createElement(X,null)),a().createElement("div",{className:g.tableWrap},a().createElement(k,null,a().createElement(O.ScrollSync,{horizontal:!0,vertical:!1,proportional:!1},a().createElement(Be,{logsFrame:i,selectedLine:A,data:h,height:t,width:u,onResize:(0,Te.debounce)(((e,t)=>{const n=Object.keys(v).filter((e=>v[e].active)).find((t=>t===e));if(n&&t>0){const e=$e({},P);e[n]=t,j(e)}}),100)})))))};function Me(e){if(e.name){const t=e.name.toLowerCase();if("date"===t||"time"===t)return o.FieldType.time}for(let t=0;t<e.values.length;t++){const n=e.values[t];if(null!=n)return Ge(n)}}const Re=()=>({options:{critical:{color:"#705da0",index:0},crit:{color:"#705da0",index:1},error:{color:"#e24d42",index:2},err:{color:"#e24d42",index:3},eror:{color:"#e24d42",index:4},warning:{color:"#FF9900",index:5},warn:{color:"#FF9900",index:6},info:{color:"#7eb26d",index:7},debug:{color:"#1f78c1",index:8},trace:{color:"#6ed0e0",index:9}},type:o.MappingType.ValueToText});function Ve(e,t,n,r){return e.name===(0,c.Il)(r)?{cellComponent:e=>a().createElement(Oe,Ie($e({},e),{fieldIndex:t,labels:n[e.rowIndex]})),type:C.TableCellDisplayMode.Custom}:{cellComponent:e=>a().createElement(pe,Ie($e({},e),{fieldIndex:t})),type:C.TableCellDisplayMode.Custom}}function We(e,t,n,r,a,i){var s,l;const u=a<=2?r:Math.min(r/2),d=0===t?50:0;if(e.type===o.FieldType.time)return 200+d;const p=n[e.name];if(void 0===p)return;var g;const h=Math.max(null!==(g=p.maxLength)&&void 0!==g?g:0,e.name.length);return p.maxLength?Math.min(Math.max(6.5*h+95+d,90+d),u):e.name!==(0,c.Il)(i)?Math.min(Math.max(6.5*(null!==(f=null===(l=e.values)||void 0===l||null===(s=l[0])||void 0===s?void 0:s.length)&&void 0!==f?f:80)+95+d,90+d),u):void 0;var f}var ze=n(5540);const He=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,Qe=e=>{const{logsFrame:t}=ae(),[n,i]=(0,r.useState)({width:0,height:0});(0,ze.w)({ref:e.panelWrap,onResize:()=>{const t=e.panelWrap.current;t&&(n.width===t.clientWidth&&n.height===t.clientHeight||i({width:t.clientWidth,height:t.clientHeight}))}});const s={section:(0,l.css)({position:"relative"})},c=(0,o.getTimeZone)(),u=(0,r.useCallback)((t=>{const n=e.urlColumns;return(null==n?void 0:n.length)&&Object.values(n).forEach(((e,n)=>{t[e]&&(t[e].active=!0,t[e].index=n)})),t}),[e.urlColumns]);if(!t||!t.raw.length)return null;var d;const p=null!==(d=t.getLogFrameLabelsAsLabels())&&void 0!==d?d:[],g=t?t.raw.length:0;let h=function(e,t){let n={};const r=new Map,a=function(e){const t=new Map;return e.forEach((e=>{Object.keys(e).forEach((n=>{if(t.has(n)){const r=t.get(n),a=null==r?void 0:r.valueSet,i=null==r?void 0:r.maxLength;a&&!(null==a?void 0:a.has(e[n]))&&(null==a||a.add(e[n]),i&&e[n].length>i&&t.set(n,{maxLength:e[n].length,valueSet:a}))}else t.set(n,{maxLength:e[n].length,valueSet:new Set([e[n]])})}))})),t}(t),i=e?e.length:0;(null==t?void 0:t.length)&&i&&(t.forEach((e=>{Object.keys(e).forEach((e=>{var t;const n=a.get(e);var i;const s=null!==(i=null==n||null===(t=n.valueSet)||void 0===t?void 0:t.size)&&void 0!==i?i:0;if(r.has(e)){const t=r.get(e);t&&((null==t?void 0:t.active)?r.set(e,{percentOfLinesWithLabel:t.percentOfLinesWithLabel+1,active:!0,index:t.index,cardinality:s,maxLength:null==n?void 0:n.maxLength}):r.set(e,{percentOfLinesWithLabel:t.percentOfLinesWithLabel+1,active:!1,index:void 0,cardinality:s,maxLength:null==n?void 0:n.maxLength}))}else r.set(e,{percentOfLinesWithLabel:1,active:!1,index:void 0,cardinality:s,maxLength:null==n?void 0:n.maxLength})}))})),n=Object.fromEntries(r),Object.keys(n).forEach((e=>{n[e].percentOfLinesWithLabel=Ke(n[e].percentOfLinesWithLabel,i)})));return n}(t.raw,p);const f={time:t.timeField,body:t.bodyField,extraFields:t.extraFields};if(f){!function(e,t,n){e.forEach((e=>{var r,a;if(!e)return;const i=null===(r=t[e.name])||void 0===r?void 0:r.active,s=null===(a=t[e.name])||void 0===a?void 0:a.index;t[e.name]=i&&void 0!==s?{percentOfLinesWithLabel:Ke(e.values.filter((e=>null!=e)).length,n),active:!0,index:s,cardinality:n}:{percentOfLinesWithLabel:Ke(e.values.filter((e=>null!=e)).length,n),active:!1,index:void 0,cardinality:n}}))}([f.time,f.body,...f.extraFields],h,g),h=u(h);!function(e,t,n){var r,a;if(0===e.length){var i,s,l,o,c,u;if(null===(i=t.body)||void 0===i?void 0:i.name)n[null===(l=t.body)||void 0===l?void 0:l.name].active=!0,n[null===(o=t.body)||void 0===o?void 0:o.name].index=1;if(null===(s=t.time)||void 0===s?void 0:s.name)n[null===(c=t.time)||void 0===c?void 0:c.name].active=!0,n[null===(u=t.time)||void 0===u?void 0:u.name].index=0}if((null===(r=t.time)||void 0===r?void 0:r.name)&&(null===(a=t.body)||void 0===a?void 0:a.name)){var d,p;n[null===(d=t.body)||void 0===d?void 0:d.name].type="BODY_FIELD",n[null===(p=t.time)||void 0===p?void 0:p.name].type="TIME_FIELD"}t.extraFields.length&&t.extraFields.forEach((e=>{var t;(null===(t=e.config.links)||void 0===t?void 0:t.length)&&(n[e.name].type="LINK_FIELD")}))}(Object.keys(h).filter((e=>h[e].active)),f,h)}return a().createElement("section",{className:s.section},a().createElement(y,{setUrlTableBodyState:e.setUrlTableBodyState,logsFrame:t,initialColumns:h,setUrlColumns:e.setUrlColumns,clearSelectedLine:e.clearSelectedLine,urlTableBodyState:e.urlTableBodyState,showColumnManagementDrawer:e.showColumnManagementDrawer,isColumnManagementActive:e.isColumnManagementActive},a().createElement(Ae,{logsFrame:t,timeZone:c,height:n.height-50,width:n.width-25,labels:p})))},Ke=(e,t)=>Math.ceil(100*e/t);function Ge(e){let t=(0,o.guessFieldTypeFromValue)(e);return"string"===t&&He.test(e)&&(t=o.FieldType.time),t}const Ue=({dataFrame:e,setUrlColumns:t,urlColumns:n,addFilter:r,selectedLine:i,timeRange:s,panelWrap:l,clearSelectedLine:o,setUrlTableBodyState:u,urlTableBodyState:d,showColumnManagementDrawer:p,isColumnManagementActive:g})=>{if(!e)return null;const h=(0,c.Os)(e);return h?a().createElement(re,{addFilter:r,selectedLine:i,timeRange:s,logsFrame:h},a().createElement(Qe,{urlTableBodyState:d,setUrlColumns:t,setUrlTableBodyState:u,urlColumns:n,panelWrap:l,clearSelectedLine:o,showColumnManagementDrawer:p,isColumnManagementActive:g})):null};var qe=n(9641),Je=n(9405),Ye=n(1532),Xe=n(7352),Ze=n(376),et=n(5700),tt=n(4351);function nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}let at=["timestamp","body","Time","Line"];class it extends i.Bs{onActivate(){this.setState({menu:new et.GD({addInvestigationsLink:!1})}),this.onActivateSyncDisplayedFieldsWithUrlColumns()}getParentScene(){return i.jh.getAncestor(this,bt)}constructor(e){super(rt(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){nt(e,t,n[t])}))}return e}({},e),{isColumnManagementActive:!1})),nt(this,"showColumnManagementDrawer",(e=>{this.setState({isColumnManagementActive:e})})),nt(this,"onActivateSyncDisplayedFieldsWithUrlColumns",(()=>{const e=new URLSearchParams(s.locationService.getLocation().search).get("urlColumns"),t=(0,p.dU)(e),n=this.getParentScene();at=t&&this.urlHasDefaultUrlColumns(t)?this.updateDefaultUrlColumns(t):at,at.length,n.setState({urlColumns:Array.from(new Set([...at,...n.state.displayedFields]))})})),nt(this,"updateDisplayedFields",(e=>{const t=this.getParentScene();at=this.updateDefaultUrlColumns(e);const n=Array.from(new Set([...e||[]])).filter((e=>!at.includes(e)));t.setState({displayedFields:n}),(0,tt.ZF)(this,t.state.displayedFields)})),nt(this,"urlHasDefaultUrlColumns",(e=>at.some((t=>e.includes(t))))),nt(this,"updateDefaultUrlColumns",(e=>(at=at.reduce(((t,n)=>{if(e.includes(n)){t[e.indexOf(n)]=n}return t}),[]),at))),this.addActivationHandler(this.onActivate.bind(this))}}nt(it,"Component",(({model:e})=>{const t=(0,C.useStyles2)(st),n=i.jh.getAncestor(e,bt),{data:s}=i.jh.getData(e).useState(),{selectedLine:l,urlColumns:o,visualizationType:c,tableLogLineState:u}=n.useState(),{menu:d,isColumnManagementActive:p}=e.useState(),g=i.jh.getTimeRange(e),{value:h}=g.useState(),f=(0,Xe.tn)(s),v=(0,r.useRef)(null);return a().createElement("div",{className:t.panelWrapper,ref:v},a().createElement(C.PanelChrome,{loadingState:null==s?void 0:s.state,title:"Logs",menu:d?a().createElement(d.Component,{model:d}):void 0,showMenuAlways:!0,actions:a().createElement(a().Fragment,null,a().createElement(C.Button,{onClick:()=>e.showColumnManagementDrawer(!0),variant:"secondary",size:"sm"},"Manage columns"),a().createElement(qe.C,{vizType:c,onChange:n.setVisualizationType}))},f&&a().createElement(Ue,{panelWrap:v,addFilter:t=>{const r=(0,Ze.OE)(f,t.key,e);(0,Je.XI)(t,n,r)},timeRange:h,selectedLine:l,urlColumns:null!=o?o:[],setUrlColumns:t=>{(0,Ye.n)(t,n.state.urlColumns)||(n.setState({urlColumns:t}),e.updateDisplayedFields(t))},dataFrame:f,clearSelectedLine:()=>{n.state.selectedLine&&n.clearSelectedLine()},setUrlTableBodyState:e=>{n.setState({tableLogLineState:e})},urlTableBodyState:u,showColumnManagementDrawer:e.showColumnManagementDrawer,isColumnManagementActive:p})))}));const st=e=>({panelWrapper:(0,l.css)({width:"100%",height:"100%",label:"panel-wrapper-table"})});var lt=n(4509),ot=n(8996),ct=n(6177),ut=n.n(ct),dt=n(5553),pt=n(72),gt=n(7478);function ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ft extends i.Bs{clearVariable(){(0,dt.Rr)(this).updateFilters([],{skipPublish:!0}),this.setState({lineFilter:""})}getOperator(){if(this.state.regex&&this.state.exclusive)return ie.cK.negativeRegex;if(this.state.regex&&!this.state.exclusive)return ie.cK.regex;if(!this.state.regex&&this.state.exclusive)return ie.cK.negativeMatch;if(!this.state.regex&&!this.state.exclusive)return ie.cK.match;throw new Error("getOperator: failed to determine operation")}getFilterKey(){return this.state.caseSensitive?ie.ld.caseSensitive:ie.ld.caseInsensitive}getFilter(){return(0,dt.Rr)(this).state.filters[0]}updateFilter(e,t=!0){this.updateInputState(e),t?this.updateVariableDebounced(e):this.updateVariable(e)}updateInputState(e){this.setState({lineFilter:e})}constructor(e){var t,n,r,a;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ht(e,t,n[t])}))}return e}({lineFilter:null!==(t=null==e?void 0:e.lineFilter)&&void 0!==t?t:"",caseSensitive:null!==(n=null==e?void 0:e.caseSensitive)&&void 0!==n?n:(0,tt.hp)(!1),regex:null!==(r=null==e?void 0:e.regex)&&void 0!==r?r:(0,tt.og)(!1),exclusive:null!==(a=null==e?void 0:e.exclusive)&&void 0!==a?a:(0,tt.Zs)(!1)},e)),ht(this,"onActivate",(()=>{const e=this.getFilter();if(e)return this.setState({lineFilter:e.value,regex:e.operator===ie.cK.regex||e.operator===ie.cK.negativeRegex,caseSensitive:e.key===ie.ld.caseSensitive,exclusive:e.operator===ie.cK.negativeMatch||e.operator===ie.cK.negativeRegex}),()=>{this.clearFilter()}})),ht(this,"clearFilter",(()=>{this.updateVariableDebounced.cancel(),this.updateFilter("",!1)})),ht(this,"onToggleExclusive",(e=>{(0,tt.Bq)(e),this.setState({exclusive:e}),this.updateFilter(this.state.lineFilter,!1)})),ht(this,"onSubmitLineFilter",(()=>{(0,gt.bN)(),this.updateFilter(this.state.lineFilter,!1),this.updateVariableDebounced.flush();const e=(0,dt.Gk)(this),t=e.state.filters,n=this.getFilter();e.updateFilters([...t,n]),this.clearVariable()})),ht(this,"handleChange",(e=>{this.updateInputState(e.target.value)})),ht(this,"handleEnter",(e=>{"Enter"===e.key&&this.state.lineFilter&&this.onSubmitLineFilter()})),ht(this,"onCaseSensitiveToggle",(e=>{const t=e===ie.ld.caseSensitive;this.setState({caseSensitive:t}),(0,tt.Xo)(t),this.updateFilter(this.state.lineFilter,!1)})),ht(this,"onRegexToggle",(e=>{const t="regex"===e;this.setState({regex:t}),(0,tt.GL)(t),this.updateFilter(this.state.lineFilter,!1)})),ht(this,"updateVariableDebounced",ut()((e=>{this.updateVariable(e)}),1e3)),ht(this,"updateVariable",(e=>{this.updateVariableDebounced.flush();const t=(0,dt.Rr)(this),n=(0,dt.Gk)(this),r={key:this.getFilterKey(),keyLabel:n.state.filters.length.toString(),operator:this.getOperator(),value:e};t.updateFilters([r]),(0,lt.EE)(lt.NO.service_details,lt.ir.service_details.search_string_in_logs_changed,{searchQueryLength:e.length,containsLevel:e.toLowerCase().includes("level"),operator:r.operator,caseSensitive:r.key})})),this.addActivationHandler(this.onActivate)}}function vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}ht(ft,"Component",(function({model:e}){const{lineFilter:t,caseSensitive:n,regex:a,exclusive:i}=e.useState(),[s,l]=(0,r.useState)(!1);return(0,pt._)({exclusive:i,lineFilter:t,caseSensitive:n,regex:a,onSubmitLineFilter:e.onSubmitLineFilter,handleEnter:e.handleEnter,onInputChange:e.handleChange,updateFilter:e.updateFilter,onCaseSensitiveToggle:e.onCaseSensitiveToggle,onRegexToggle:e.onRegexToggle,setExclusive:e.onToggleExclusive,onClearLineFilter:e.clearFilter,focus:s,setFocus:l,type:"editor"})}));class bt extends i.Bs{getUrlState(){var e;const t=null!==(e=this.state.urlColumns)&&void 0!==e?e:[],n=this.state.selectedLine,r=this.state.visualizationType;var a,i;const s=null!==(i=null!==(a=this.state.displayedFields)&&void 0!==a?a:(0,tt.N$)(this))&&void 0!==i?i:[];return{urlColumns:JSON.stringify(t),selectedLine:JSON.stringify(n),visualizationType:JSON.stringify(r),displayedFields:JSON.stringify(s),tableLogLineState:JSON.stringify(this.state.tableLogLineState)}}updateFromUrl(e){const t={};try{if("string"==typeof e.urlColumns){const n=(0,p.aJ)(JSON.parse(e.urlColumns));n!==this.state.urlColumns&&(t.urlColumns=n)}if("string"==typeof e.selectedLine){const n=(0,p.lb)(JSON.parse(e.selectedLine));if(n){const e=n;e!==this.state.selectedLine&&(t.selectedLine=e)}}if("string"==typeof e.visualizationType){const n=(0,p.v_)(JSON.parse(e.visualizationType));n&&n!==this.state.visualizationType&&(t.visualizationType=n)}if("string"==typeof e.displayedFields){const n=(0,p.aJ)(JSON.parse(e.displayedFields));n&&n.length&&(t.displayedFields=n)}if("string"==typeof e.tableLogLineState){const n=JSON.parse(e.tableLogLineState);n!==m.labels&&n!==m.text||(t.tableLogLineState=n)}}catch(e){u.v.error(e,{msg:"LogsListScene: updateFromUrl unexpected error"})}Object.keys(t).length&&this.setState(t)}clearSelectedLine(){this.setState({selectedLine:void 0})}onActivate(){const e=new URLSearchParams(s.locationService.getLocation().search);this.setStateFromUrl(e),this.state.panel||this.updateLogsPanel(),this._subs.add(this.subscribeToState(((e,t)=>{e.visualizationType!==t.visualizationType&&this.updateLogsPanel()})))}setStateFromUrl(e){const t=e.get("selectedLine"),n=e.get("urlColumns"),r=e.get("visualizationType");var a;const i=null!==(a=e.get("displayedFields"))&&void 0!==a?a:JSON.stringify((0,tt.N$)(this)),s=e.get("tableLogLineState");this.updateFromUrl({selectedLine:t,urlColumns:n,vizType:r,displayedFields:i,tableLogLineState:s})}getVizPanel(){return this.logsPanelScene=new ot.o({}),new i.G1({direction:"column",children:"logs"===this.state.visualizationType?[new i.G1({children:[new i.vA({body:new ft({lineFilter:this.state.lineFilter}),xSizing:"fill"})]}),new i.vA({height:"calc(100vh - 220px)",body:this.logsPanelScene})]:[new i.vA({body:new ft({lineFilter:this.state.lineFilter}),xSizing:"fill"}),new i.vA({height:"calc(100vh - 220px)",body:new it({})})]})}constructor(e){super(mt(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){vt(e,t,n[t])}))}return e}({},e),{visualizationType:(0,tt.k5)(),displayedFields:[]})),vt(this,"_urlSync",new i.So(this,{keys:["urlColumns","selectedLine","visualizationType","displayedFields","tableLogLineState"]})),vt(this,"logsPanelScene",void 0),vt(this,"clearDisplayedFields",(()=>{this.setState({displayedFields:[]}),this.logsPanelScene&&this.logsPanelScene.clearDisplayedFields()})),vt(this,"setLogsVizOption",((e={})=>{this.logsPanelScene&&this.logsPanelScene.setLogsVizOption(e)})),vt(this,"updateLogsPanel",(()=>{if(this.setState({panel:this.getVizPanel()}),this.state.panel){const e=i.jh.findDescendents(this.state.panel,ft);if(e.length){const t=e[0];this._subs.add(t.subscribeToState(((e,t)=>{e.lineFilter!==t.lineFilter&&this.setState({lineFilter:e.lineFilter})})))}}})),vt(this,"setVisualizationType",(e=>{this.setState({visualizationType:e}),(0,lt.EE)(lt.NO.service_details,lt.ir.service_details.logs_visualization_toggle,{visualisationType:e}),(0,tt.o5)(e)})),this.addActivationHandler(this.onActivate.bind(this))}}vt(bt,"Component",(({model:e})=>{const{panel:t}=e.useState();if(t)return a().createElement("div",{className:yt.panelWrapper},a().createElement(t.Component,{model:t}))}));const yt={panelWrapper:(0,l.css)({'section > div[class$="panel-content"]':(0,l.css)({contain:"none",overflow:"auto"})})}},8996:(e,t,n)=>{n.d(t,{o:()=>D});var r=n(9736),a=n(7781),i=n(4351),s=n(5959),l=n.n(s),o=n(8632),c=n(2007),u=n(9405),d=n(376),p=n(20),g=n(4509),h=n(5553),f=n(5002);const v=({onClick:e})=>{const[t,n]=(0,s.useState)(!1);(0,s.useEffect)((()=>{let e;return t&&(e=setTimeout((()=>{n(!1)}),2e3)),()=>{clearTimeout(e)}}),[t]);const r=(0,s.useCallback)(((t,r)=>{e(t,r),n(!0)}),[e]);return l().createElement(c.IconButton,{"aria-label":t?"Copied":"Copy link to log line",tooltip:t?"Copied":"Copy link to log line",tooltipPlacement:"top",variant:t?"primary":"secondary",size:"md",name:t?"check":"share-alt",onClick:r})};var m=n(2649),b=n(71),y=n(5700),S=n(7352),w=n(6854),O=n(8531),x=n(8428),E=n(5953),C=n(5719),P=n(7191);const k=({clearFilters:e,error:t})=>l().createElement(P.R,null,l().createElement("div",null,l().createElement("p",null,t),l().createElement(c.Button,{variant:"secondary",onClick:e},"Clear filters")));var j=n(5548),F=n(2165);function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){L(e,t,n[t])}))}return e}function T(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class D extends r.Bs{setStateFromUrl(){const e=new URLSearchParams(O.locationService.getLocation().search);this.updateFromUrl({sortOrder:e.get("sortOrder"),wrapLogMessage:e.get("wrapLogMessage")})}getUrlState(){return{sortOrder:JSON.stringify(this.state.sortOrder),wrapLogMessage:JSON.stringify(this.state.wrapLogMessage)}}updateFromUrl(e){const t={};try{if("string"==typeof e.sortOrder&&e.sortOrder){const n=(0,x.FH)(JSON.parse(e.sortOrder));n&&(t.sortOrder=n,this.setLogsVizOption({sortOrder:n}))}if("string"==typeof e.wrapLogMessage&&e.wrapLogMessage){const n=JSON.parse(e.wrapLogMessage);"boolean"==typeof n&&(t.wrapLogMessage=n,this.setLogsVizOption({wrapLogMessage:n}),this.setLogsVizOption({prettifyLogMessage:n}))}}catch(e){E.v.error(e,{msg:"LogOptionsScene: updateFromUrl unexpected error"})}Object.keys(t).length&&this.setState(_({},t))}onActivate(){this.setStateFromUrl(),this.state.body||this.setState({body:this.getLogsPanel({wrapLogMessage:this.state.wrapLogMessage,prettifyLogMessage:this.state.wrapLogMessage,sortOrder:this.state.sortOrder})});const e=r.jh.getAncestor(this,S.Mn);this._subs.add(e.subscribeToState(((e,t)=>{var n,r,i,s,l,o;(null===(r=e.$data)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.state)===a.LoadingState.Error?this.handleLogsError(null===(o=e.$data)||void 0===o?void 0:o.state.data):(null===(s=e.$data)||void 0===s||null===(i=s.state.data)||void 0===i?void 0:i.state)===a.LoadingState.Done&&(0,F.y2)(null===(l=e.$data)||void 0===l?void 0:l.state.data.series)?this.handleNoData():this.state.error&&this.clearLogsError();e.logsCount!==t.logsCount&&(this.state.body?this.state.body.setState({title:this.getTitle(e.logsCount)}):this.setState({body:this.getLogsPanel({wrapLogMessage:this.state.wrapLogMessage,prettifyLogMessage:this.state.wrapLogMessage,sortOrder:this.state.sortOrder})}))})))}handleLogsError(e){var t;const n=(null===(t=e.errors)||void 0===t?void 0:t.length)?e.errors[0]:e.error,r=null==n?void 0:n.message;var a,i;r&&E.v.error(new Error("Logs Panel error"),{msg:r,status:null!==(a=n.statusText)&&void 0!==a?a:"N/A",type:null!==(i=n.type)&&void 0!==i?i:"N/A"});let s="Unexpected error response. Please review your filters or try a different time range.";(null==r?void 0:r.includes("parse error"))?s="Logs could not be retrieved due to invalid filter parameters. Please review your filters and try again.":(null==r?void 0:r.includes("response larger than the max message size"))&&(s="The response is too large to process. Try narrowing your search or using filters to reduce the data size."),this.showLogsError(s)}handleNoData(){this.showLogsError("No logs match your search. Please review your filters or try a different time range.")}showLogsError(e){var t;const n=null!==(t=this.state.logsVolumeCollapsedByError)&&void 0!==t?t:!(0,i.Rf)("collapsed");if(this.setState({error:e,logsVolumeCollapsedByError:n}),n){var a;null===(a=r.jh.findByKeyAndType(this,b.b,b._).state.panel)||void 0===a||a.setState({collapsed:!0})}}clearLogsError(){if(this.state.logsVolumeCollapsedByError){var e;null===(e=r.jh.findByKeyAndType(this,b.b,b._).state.panel)||void 0===e||e.setState({collapsed:!1})}this.setState({error:void 0,logsVolumeCollapsedByError:void 0})}setLogsVizOption(e={}){if(this.state.body){if("sortOrder"in e&&e.sortOrder!==this.state.body.state.options.sortOrder){const e=r.jh.getData(this),t=e instanceof r.dt?e:r.jh.findDescendents(e,r.dt)[0];t&&t.runQueries()}this.state.body.onOptionsChange(e)}}getParentScene(){return r.jh.getAncestor(this,o.i)}getTitle(e){var t;const n=(0,a.getValueFormat)("short"),r=void 0!==e?n(e,0):void 0;return void 0!==r?`Logs (${r.text}${null===(t=r.suffix)||void 0===t?void 0:t.trim()})`:"Logs"}getLogsPanel(e){const t=this.getParentScene(),n=t.state.visualizationType,a=r.jh.getAncestor(this,S.Mn);var s,o,c;return r.d0.logs().setTitle(this.getTitle(a.state.logsCount)).setOption("showTime",!0).setOption("onClickFilterLabel",this.handleLabelFilterClick).setOption("onClickFilterOutLabel",this.handleLabelFilterOutClick).setOption("isFilterLabelActive",this.handleIsFilterLabelActive).setOption("onClickFilterString",this.handleFilterStringClick).setOption("onClickFilterOutString",this.handleFilterOutStringClick).setOption("onClickShowField",this.onClickShowField).setOption("onClickHideField",this.onClickHideField).setOption("displayedFields",t.state.displayedFields).setOption("sortOrder",null!==(s=e.sortOrder)&&void 0!==s?s:(0,m.zQ)()).setOption("wrapLogMessage",null!==(o=e.wrapLogMessage)&&void 0!==o?o:Boolean((0,i.YM)("wrapLogMessage",!1))).setOption("prettifyLogMessage",null!==(c=e.prettifyLogMessage)&&void 0!==c?c:Boolean((0,i.YM)("wrapLogMessage",!1))).setMenu(new y.GD({investigationOptions:{type:"logs",getLabelName:()=>`Logs: ${(0,C.Mq)(a)}`}})).setOption("showLogContextToggle",!0).setShowMenuAlways(!0).setOption("enableInfiniteScrolling",!0).setOption("onNewLogsReceived",this.updateVisibleRange).setOption("logRowMenuIconsAfter",[l().createElement(v,{onClick:this.handleShareLogLineClick,key:0})]).setHeaderActions(new m.ZB({visualizationType:n,onChangeVisualizationType:t.setVisualizationType})).build()}handleLabelFilter(e,t,n,r){const a=(0,d.OE)(n,e,this);(0,u.Qt)(e,t,r,this,a),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_detail_filter_applied,{filterType:a,key:e,action:r})}constructor(e){super(_({sortOrder:(0,m.zQ)(),wrapLogMessage:Boolean((0,i.YM)("wrapLogMessage",!1)),error:void 0},e)),L(this,"_urlSync",new r.So(this,{keys:["sortOrder","wrapLogMessage"]})),L(this,"onClickShowField",(e=>{const t=this.getParentScene();if(-1===t.state.displayedFields.indexOf(e)&&this.state.body){const n=[...t.state.displayedFields,e];this.setLogsVizOption({displayedFields:n}),t.setState({displayedFields:n}),(0,i.ZF)(this,t.state.displayedFields),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_toggle_displayed_field)}})),L(this,"onClickHideField",(e=>{const t=this.getParentScene();if(t.state.displayedFields.indexOf(e)>=0&&this.state.body){const n=t.state.displayedFields.filter((t=>e!==t));this.setLogsVizOption({displayedFields:n}),t.setState({displayedFields:n}),(0,i.ZF)(this,t.state.displayedFields),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_toggle_displayed_field)}})),L(this,"clearDisplayedFields",(()=>{this.state.body&&(this.setLogsVizOption({displayedFields:[]}),(0,i.ZF)(this,[]))})),L(this,"updateVisibleRange",(e=>{var t,n;const a=r.jh.getAncestor(this,S.Mn);a.setState({logsCount:e[0].length}),(null===(n=a.state.$data)||void 0===n||null===(t=n.state.data)||void 0===t?void 0:t.series)&&a.state.$data.setState(T(_({},a.state.$data.state),{data:T(_({},a.state.$data.state.data),{series:e})}));r.jh.findByKeyAndType(this,b.b,b._).updateVisibleRange(e)})),L(this,"handleShareLogLineClick",((e,t)=>{if((null==t?void 0:t.rowId)&&this.state.body){const e=this.getParentScene(),n=(0,f.Ki)(t);(0,f.Dk)((0,f.gW)("panelState",{logs:{id:t.uid,displayedFields:e.state.displayedFields}},n))}})),L(this,"handleLabelFilterClick",((e,t,n)=>{this.handleLabelFilter(e,t,n,"toggle")})),L(this,"handleLabelFilterOutClick",((e,t,n)=>{this.handleLabelFilter(e,t,n,"exclude")})),L(this,"handleIsFilterLabelActive",((e,t)=>{const n=(0,h.bY)(p.MB,this),r=(0,h.bY)(p.mB,this),a=(0,h.bY)(p._Y,this),i=(0,h.bY)(p._P,this),s=n=>n&&n.state.filters.findIndex((n=>"="===n.operator&&n.key===e&&n.value===t))>=0;return s(n)||(n=>{if(n){const r=n.state.filters.find((t=>"="===t.operator&&t.key===e));if(r){return(0,h.bu)(r,e).value===t}}return!1})(r)||s(a)||s(i)})),L(this,"handleFilterOutStringClick",(e=>{const t=(0,h.Gk)(this);t&&(t.setState({filters:[...t.state.filters,{operator:w.cK.negativeMatch,value:e,key:w.ld.caseSensitive,keyLabel:t.state.filters.length.toString()}]}),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_popover_line_filter,{selectionLength:e.length}))})),L(this,"handleFilterStringClick",(e=>{const t=(0,h.Gk)(this);t&&(t.setState({filters:[...t.state.filters,{operator:w.cK.match,value:e,key:w.ld.caseSensitive,keyLabel:t.state.filters.length.toString()}]}),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_popover_line_filter,{selectionLength:e.length}))})),this.addActivationHandler(this.onActivate.bind(this))}}L(D,"Component",(({model:e})=>{const{body:t,error:n}=e.useState(),r=(0,c.useStyles2)(y.K_);return t?l().createElement("span",{className:r.panelWrapper},!n&&l().createElement(t.Component,{model:t}),n&&l().createElement(k,{error:n,clearFilters:()=>(0,j.rA)(t)})):l().createElement(c.LoadingPlaceholder,{text:"Loading..."})}))},71:(e,t,n)=>{n.d(t,{_:()=>D,b:()=>T});var r,a,i,s=n(5959),l=n.n(s),o=n(9736),c=n(2007),u=n(1475),d=n(7985),p=n(20),g=n(4509),h=n(6838),f=n(5570),v=n(7781),m=n(5553),b=n(1532),y=n(5700),S=n(7352),w=n(2165),O=n(4351),x=n(2661),E=n(8531),C=n(5719);class P extends o.Bs{}i=function({model:e}){const{component:t,isLoading:n}=(0,E.usePluginComponent)("grafana-adaptivelogs-app/temporary-exemptions/v1"),r=(0,m.bY)(p.MB,e),{filters:a}=r.useState(),i=a.map((({key:e,operator:t,value:n})=>({key:e,operator:t,value:n}))),s=(0,C.U4)(e);return n||!t?null:l().createElement(t,{dataSourceUid:s,streamSelector:i,contextHints:["explorelogs","logvolumepanel","headeraction"]})},(a="Component")in(r=P)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i;var k=n(9405),j=n(2085);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}function _(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const T="logs-volume-panel";class D extends o.Bs{onActivate(){if(!this.state.panel){const e=this.getVizPanel();this.setState({panel:e}),this.updateContainerHeight(e)}const e=(0,m.cR)(this),t=(0,m.ir)(this);this._subs.add(e.subscribeToState(((e,t)=>{(0,b.B)(e.filters,t.filters)||this.setState({panel:this.getVizPanel()})}))),this._subs.add(t.subscribeToState(((e,t)=>{(0,b.B)(e.filters,t.filters)||this.setState({panel:this.getVizPanel()})}))),this._subs.add(this.subscribeToEvent(k.Of,(e=>{if(e.key===p.e4){const e=o.jh.findObject(this,(e=>e instanceof j.qV));if(e instanceof j.qV){const e=(0,m.iw)(this);e.setState({filters:e.state.filters})}}})))}getTitle(e,t){var n,r;var a;const i=null!==(a=null===(n=o.jh.getAncestor(this,x.P).state.ds)||void 0===n?void 0:n.maxLines)&&void 0!==a?a:d.by,s=(0,v.getValueFormat)("short"),l=void 0!==e?s(e,0):void 0;if(void 0===e&&void 0!==t&&t<i){var c;const e=s(t,0);return void 0!==e?`Log volume (${e.text}${null===(c=e.suffix)||void 0===c?void 0:c.trim()})`:"Log volume"}return void 0!==l?`Log volume (${l.text}${null===(r=l.suffix)||void 0===r?void 0:r.trim()})`:"Log volume"}getVizPanel(){var e,t;const n=o.jh.getAncestor(this,S.Mn),r=o.d0.timeseries().setTitle(this.getTitle(n.state.totalLogsCount,n.state.logsCount)).setOption("legend",{showLegend:!0,calcs:["sum"],displayMode:c.LegendDisplayMode.List}).setUnit("short").setMenu(new y.GD({investigationOptions:{labelName:"level"}})).setCollapsible(!0).setCollapsed((0,O.Rf)("collapsed")).setHeaderActions(new P({})).setShowMenuAlways(!0).setData((0,u.rS)([(0,d.l)((0,h.m)(this,p.e4,!1),{legendFormat:`{{${p.e4}}}`})]));(0,u.ZC)(r);const a=r.build();return a.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(t)}),this._subs.add(a.subscribeToState(((e,t)=>{e.collapsed!==t.collapsed&&(this.updateContainerHeight(a),(0,O.RN)("collapsed",e.collapsed?"true":void 0))}))),this._subs.add(null===(e=a.state.$data)||void 0===e?void 0:e.subscribeToState((e=>{var t,r,i,s;if((null===(t=e.data)||void 0===t?void 0:t.state)===v.LoadingState.Done){var l,o;if((null===(i=n.state.$data)||void 0===i||null===(r=i.state.data)||void 0===r?void 0:r.state)!==v.LoadingState.Done||(null===(s=e.data.annotations)||void 0===s?void 0:s.length))this.displayVisibleRange();else this.updateVisibleRange(null===(o=n.state.$data)||void 0===o||null===(l=o.state.data)||void 0===l?void 0:l.series);(0,u.C6)(a,e.data.series,this)}}))),this._subs.add(null===(t=n.state.$data)||void 0===t?void 0:t.subscribeToState((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===v.LoadingState.Done&&this.updateVisibleRange(e.data.series)}))),this._subs.add(n.subscribeToState(((e,t)=>{e.totalLogsCount===t.totalLogsCount&&void 0===e.logsCount||(this.state.panel?this.state.panel.setState({title:this.getTitle(e.totalLogsCount,e.logsCount)}):this.setState({panel:this.getVizPanel()}))}))),a}updateContainerHeight(e){const t=o.jh.getAncestor(e,o.G1),n=e.state.collapsed?35:Math.max(Math.round(.2*window.innerHeight),100);t.setState({minHeight:n,height:n,maxHeight:n})}updateVisibleRange(e=[]){this.updatedLogSeries=e,this.displayVisibleRange()}displayVisibleRange(){var e,t;const n=this.state.panel;if(!n||!(null===(e=n.state.$data)||void 0===e?void 0:e.state.data)||(null===(t=n.state.$data)||void 0===t?void 0:t.state.data.state)!==v.LoadingState.Done||!this.updatedLogSeries)return;const r=(0,w.z5)(this.updatedLogSeries);this.updatedLogSeries=null,n.state.$data.setState({data:_(L({},n.state.$data.state.data),{annotations:[(0,w.hy)(r.start,r.end)]})})}constructor(e){super(_(L({},e),{key:T})),F(this,"updatedLogSeries",null),F(this,"extendTimeSeriesLegendBus",(e=>{const t=(0,m.iw)(this);this._subs.add(null==t?void 0:t.subscribeToState((()=>{var e,t,n,r;const a=this.state.panel;(null==a||null===(t=a.state.$data)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.series)&&(0,u.C6)(a,null==a||null===(r=a.state.$data)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.series,this)}))),e.onToggleSeriesVisibility=(e,t)=>{const n=(0,f.PE)(e,this);this.publishEvent(new k.Of("legend","include",p.e4,e),!0),(0,g.EE)(g.NO.service_details,g.ir.service_details.level_in_logs_volume_clicked,{level:e,action:n})}})),this.addActivationHandler(this.onActivate.bind(this))}}F(D,"Component",(({model:e})=>{const{panel:t}=e.useState();if(!t)return;const n=(0,c.useStyles2)(y.K_);return l().createElement("span",{className:n.panelWrapper},l().createElement(t.Component,{model:t}))}))},7352:(e,t,n)=>{n.d(t,{AA:()=>Ue,DS:()=>Ge,Mn:()=>tt,rD:()=>Ye,UO:()=>Xe,nU:()=>Ze,dB:()=>et,TG:()=>Je,tn:()=>qe});var r=n(5959),a=n.n(r),i=n(7781),s=n(9736),l=n(2007),o=n(1475),c=n(7985),u=n(20),d=n(2152),p=n(7478),g=n(1532),h=n(6089),f=n(4509),v=n(9683),m=n(2661),b=n(8531),y=n(5002);function S(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){S(i,r,a,s,l,"next",e)}function l(e){S(i,r,a,s,l,"throw",e)}s(void 0)}))}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class x extends s.Bs{setIsOpen(e){this.setState({isOpen:e})}onCopyLink(e,t,r){e?(k(r||n.g.location.href),(0,b.reportInteraction)("grafana_explore_shortened_link_clicked",{isAbsoluteTime:t})):((0,y.Dk)(void 0!==r?`${window.location.protocol}//${window.location.host}${b.config.appSubUrl}${r}`:n.g.location.href),this.state.onCopyLink&&this.state.onCopyLink(e,t,r))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){O(e,t,n[t])}))}return e}({isOpen:!1,lastSelected:E},e))}}O(x,"MenuActions",(({model:e})=>{const t=[{key:"normal",label:"Normal URL links",items:[{key:"copy-shortened-link",icon:"link",label:"Copy shortened URL",getUrl:()=>{},shorten:!0,absTime:!1},{key:"copy-link",icon:"link",label:"Copy URL",getUrl:()=>{},shorten:!1,absTime:!1}]},{key:"timesync",label:"Time-sync URL links (share with time range intact)",items:[{key:"copy-short-link-abs-time",icon:"clock-nine",label:"Copy absolute shortened URL",shorten:!0,getUrl:()=>j(void 0!==e.state.getSceneTimeRange?e.state.getSceneTimeRange():s.jh.getTimeRange(e)),absTime:!0},{key:"copy-link-abs-time",icon:"clock-nine",label:"Copy absolute URL",shorten:!1,getUrl:()=>j(void 0!==e.state.getSceneTimeRange?e.state.getSceneTimeRange():s.jh.getTimeRange(e)),absTime:!0}]}];return a().createElement(l.Menu,null,t.map((t=>a().createElement(l.MenuGroup,{key:t.key,label:t.label},t.items.map((t=>a().createElement(l.Menu.Item,{key:t.key,label:t.label,icon:t.icon,onClick:()=>{const n=t.getUrl();e.onCopyLink(t.shorten,t.absTime,n),e.setState({lastSelected:t})}})))))))})),O(x,"Component",(({model:e})=>{const{lastSelected:t,isOpen:n}=e.useState();return a().createElement(l.ButtonGroup,null,a().createElement(l.ToolbarButton,{tooltip:t.label,icon:t.icon,variant:"canvas",narrow:!0,onClick:()=>{const n=t.getUrl();e.onCopyLink(t.shorten,t.absTime,n)},"aria-label":"Copy shortened URL"},a().createElement("span",null,"Share")),a().createElement(l.Dropdown,{overlay:a().createElement(x.MenuActions,{model:e}),placement:"bottom-end",onVisibleChange:e.setIsOpen.bind(e)},a().createElement(l.ToolbarButton,{narrow:!0,variant:"canvas",isOpen:n,"aria-label":"Open copy link options"})))}));const E={key:"copy-link",label:"Copy shortened URL",icon:"share-alt",getUrl:()=>{},shorten:!0,absTime:!1};function C(e){let t=e.replace(`${window.location.protocol}//${window.location.host}${b.config.appSubUrl}`,"");return t.startsWith("/")?t.substring(1,t.length):t}const P=function(){var e=w((function*(e){const t=(0,b.getAppEvents)();try{return(yield(0,b.getBackendSrv)().post("/api/short-urls",{path:C(e)})).url}catch(e){console.error("Error when creating shortened link: ",e),t.publish({type:i.AppEvents.alertError.name,payload:["Error generating shortened link"]})}}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=w((function*(e){const t=(0,b.getAppEvents)(),n=yield P(e);n?((0,y.Dk)(n),t.publish({type:i.AppEvents.alertSuccess.name,payload:["Shortened link copied to clipboard"]})):t.publish({type:i.AppEvents.alertError.name,payload:["Error generating shortened link"]})}));return function(t){return e.apply(this,arguments)}}(),j=e=>{const t=(0,i.toUtc)(e.state.value.from),n=(0,i.toUtc)(e.state.value.to),r=b.locationService.getLocation(),a=i.urlUtil.getUrlSearchParams();return a.from=t.toISOString(),a.to=n.toISOString(),i.urlUtil.renderUrl(r.pathname,a)};var F=n(8632),L=n(3571),_=n(8072),T=n(6830),D=n(5659),N=n(5953);function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){var t,n;const{indexScene:r,pattern:a,type:i}=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$(e,t,n[t])}))}return e}({},e),l=s.jh.getAncestor(r,m.P);if(!l)return void N.v.warn("logs exploration scene not found");(0,p.bN)();const{patterns:o=[]}=l.state,c=o.filter((e=>e.pattern!==a));var u;const d=null!==(u=null===(t=c.filter((e=>"include"===e.type)))||void 0===t?void 0:t.length)&&void 0!==u?u:0;var g;const h=null!==(g=null===(n=c.filter((e=>"exclude"===e.type)))||void 0===n?void 0:n.length)&&void 0!==g?g:0;(0,f.EE)(f.NO.service_details,f.ir.service_details.pattern_selected,{type:i,includePatternsLength:d+("include"===i?1:0),excludePatternsLength:h+("exclude"===i?1:0)}),"undo"===i?l.setState({patterns:c}):l.setState({patterns:[...c,{pattern:a,type:i}]})}var B=n(7709),A=n(5719);const M=e=>({logsStatsRow:(0,h.css)({margin:`${e.spacing(1.15)}px 0`}),logsStatsRowActive:(0,h.css)({color:e.colors.primary.text,position:"relative"}),logsStatsRowLabel:(0,h.css)({display:"flex",marginBottom:"1px"}),logsStatsRowValue:(0,h.css)({flex:1,textOverflow:"ellipsis",overflow:"hidden"}),logsStatsRowCount:(0,h.css)({textAlign:"right",marginLeft:e.spacing(.75)}),logsStatsRowPercent:(0,h.css)({textAlign:"right",marginLeft:e.spacing(.75),width:e.spacing(4.5)}),logsStatsRowBar:(0,h.css)({height:e.spacing(.5),overflow:"hidden",background:e.colors.text.disabled}),logsStatsRowInnerBar:(0,h.css)({height:e.spacing(.5),overflow:"hidden",background:e.colors.primary.main})}),R=({active:e,count:t,proportion:n,value:r})=>{const i=(0,l.useStyles2)(M),s=`${Math.round(100*n)}%`,o={width:s};return a().createElement("div",{className:e?`${i.logsStatsRow} ${i.logsStatsRowActive}`:i.logsStatsRow},a().createElement("div",{className:i.logsStatsRowLabel},a().createElement("div",{className:i.logsStatsRowValue,title:r},r),a().createElement("div",{className:i.logsStatsRowCount},t),a().createElement("div",{className:i.logsStatsRowPercent},s)),a().createElement("div",{className:i.logsStatsRowBar},a().createElement("div",{className:i.logsStatsRowInnerBar,style:o})))};function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const z=e=>({logsStats:(0,h.css)({background:"inherit",color:e.colors.text.primary,wordBreak:"break-all",width:"fit-content",maxHeight:"40vh",overflowY:"auto",marginTop:e.spacing(1)}),logsStatsHeader:(0,h.css)({borderBottom:`1px solid ${e.colors.border.medium}`,display:"flex"}),logsStatsTitle:(0,h.css)({fontWeight:e.typography.fontWeightMedium,paddingRight:e.spacing(2),display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),logsStatsClose:(0,h.css)({cursor:"pointer"}),logsStatsBody:(0,h.css)({padding:"5px 0px"})}),H=e=>{const t=(0,l.useStyles2)(z),{stats:n,value:r}=e,i=n.slice(0,10);let s=i.find((e=>e.value===r)),o=n.slice(10);!s&&(s=o.find((e=>e.value===r)),o=o.filter((e=>e.value!==r)));const c=o.reduce(((e,t)=>e+t.count),0),u=i.reduce(((e,t)=>e+t.count),0)+c;let d=[...i];return c>0&&d.push({value:"Other",count:c,proportion:c/u}),d.sort(((e,t)=>t.count-e.count)),a().createElement("div",{className:t.logsStats},a().createElement("div",{className:t.logsStatsHeader},a().createElement("div",{className:t.logsStatsTitle},"From a sample of ",u," rows found")),a().createElement("div",{className:t.logsStatsBody},d.map((e=>a().createElement(R,W(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){V(e,t,n[t])}))}return e}({key:e.value},e),{active:e.value===r}))))))};var Q=n(5553);function K(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}const G=({exploration:e,pattern:t,maxLines:n})=>{const o=function(e){const t=[];let n=e.indexOf("<_>");for(;-1!==n;)t.push(n),n=e.indexOf("<_>",n+1);return t}(t),[u,d]=(0,r.useState)(void 0),[p,g]=(0,r.useState)(!1),h=(0,l.useStyles2)(U),v=(0,r.useRef)(null),m=(0,r.useRef)(null),b=function(){var r,a=(r=function*(){(0,f.EE)(f.NO.service_details,f.ir.service_details.pattern_field_clicked);const r=function(e,t,n){let r=1;const a=e.replace(/<_>/g,(()=>`<field_${r++}>`)),i=n.state.filterExpression,s=t.map(((e,t)=>`field_${t+1}`)).join(" ,");return`{${i}} |> \`${e}\` | pattern \`${a}\` | keep ${s} | line_format ""`}(t,o,(0,Q.cR)(e)),a=yield(0,A.hJ)(e),l=s.jh.getTimeRange(e).state.value;u&&r===v.current&&l===m.current||(v.current=r,m.current=l,null==a||a.query({requestId:"1",interval:"",intervalMs:0,scopedVars:{},range:l,targets:[(0,c.l)(r,{maxLines:n})],timezone:"",app:"",startTime:0}).forEach((e=>{var t,r;e.state!==i.LoadingState.Done||(null===(t=e.errors)||void 0===t?void 0:t.length)?(e.state===i.LoadingState.Error||(null===(r=e.errors)||void 0===r?void 0:r.length))&&(d(void 0),g(!0)):(d(function(e,t,n){const r=new Map;e.data[0].fields[0].values.toArray().forEach((e=>{Object.keys(e).forEach((t=>{var n,a;r.has(t)||r.set(t,new Map),null===(a=r.get(t))||void 0===a||a.set(e[t],((null===(n=r.get(t))||void 0===n?void 0:n.get(e[t]))||0)+1)}))}));const a=[];for(let e=0;e<=t;e++){var i;const t=[];null===(i=r.get(`field_${e+1}`))||void 0===i||i.forEach(((e,r)=>{t.push({value:r,count:e,proportion:e/n})})),t.sort(((e,t)=>t.count-e.count)),a.push(t)}return a}(e,o.length,n)),g(!1))})))},function(){var e=this,t=arguments;return new Promise((function(n,a){var i=r.apply(e,t);function s(e){K(i,n,a,s,l,"next",e)}function l(e){K(i,n,a,s,l,"throw",e)}s(void 0)}))});return function(){return a.apply(this,arguments)}}(),y=(0,r.useMemo)((()=>t.split("<_>")),[t]);return a().createElement("div",null,y.map(((e,t)=>a().createElement("span",{key:t},e,t!==o.length&&a().createElement(l.Toggletip,{onOpen:b,content:a().createElement(a().Fragment,null,u&&u[t].length>0&&a().createElement(H,{stats:u[t],value:""}),u&&0===u[t].length&&a().createElement("div",null,"No available stats for this field in the current timestamp."),!u&&p&&a().createElement("div",null,"Could not load stats for this pattern."),!u&&!p&&a().createElement("div",{style:{padding:"10px"}},a().createElement(l.Spinner,{size:"xl"})))},a().createElement("span",{className:h.pattern},"<_>"))))))};function U(e){return{pattern:(0,h.css)({cursor:"pointer",backgroundColor:e.colors.emphasize(e.colors.background.primary,.1),margin:"0 2px","&:hover":{backgroundColor:e.colors.emphasize(e.colors.background.primary,.2)}})}}var q=n(2499);function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Y extends s.Bs{onActivate(){if(this.state.body)return;const e=(0,c.l)(u.SA);this.replacePatternsInQuery(e);const t=(0,o.rS)([e]);t.getResultsStream().subscribe((e=>{this.onQueryWithFiltersResult(e)})),this.setState({body:new s.G1({direction:"column",children:[new s.vA({body:void 0,width:"100%",height:0}),new s.vA({height:300,width:"100%",body:s.d0.logs().setHoverHeader(!0).setOption("showLogContextToggle",!0).setOption("showTime",!0).setData(t).build()})]})})}replacePatternsInQuery(e){const t={pattern:this.state.pattern,type:"include"},n=(0,q.M)([t]);e.expr=e.expr.replace(u.sC,n)}removePatternFromFilterExclusion(){const e=s.jh.getAncestor(this,ee);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[],r=n.findIndex((e=>e===this.state.pattern));-1!==r&&(n.splice(r,1),e.setState({patternsNotMatchingFilters:n}))}setWarningMessage(e){const t=this.getNoticeFlexItem(),n=this.getVizFlexItem();return t instanceof s.vA&&t.setState({isHidden:!1,height:"auto",body:new s.dM({reactNode:e})}),n}getNoticeFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[0]}getVizFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[1]}getFlexItemChildren(){var e;return null===(e=this.state.body)||void 0===e?void 0:e.state.children}excludeThisPatternFromFiltering(){const e=s.jh.getAncestor(this,ee);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[];e.setState({patternsNotMatchingFilters:[...n,this.state.pattern]})}static Component({model:e}){const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):null}constructor(e){super(e),J(this,"clearFilters",(()=>{const e=(0,Q.ir)(this),t=(0,Q.Gk)(this),n=(0,Q.iw)(this);if(e.setState({filters:[]}),n.setState({filters:[]}),t.state.filters.length){t.setState({filters:[]});const e=this.getNoticeFlexItem();null==e||e.setState({isHidden:!0}),this.removePatternFromFilterExclusion()}})),J(this,"onQueryError",(e=>{if(e.data.state===i.LoadingState.Done&&(0===e.data.series.length||e.data.series.every((e=>0===e.length)))||e.data.state===i.LoadingState.Error){let t;try{t={pattern:this.state.pattern,traceIds:JSON.stringify(e.data.traceIds),request:JSON.stringify(e.data.request),msg:"onQueryError"}}catch(e){t={pattern:this.state.pattern,msg:"Failed to encode context"}}N.v.error(new Error("Pattern sample query returns no results"),t),this.setWarningMessage(a().createElement(l.Alert,{severity:"error",title:""},"This pattern returns no logs."));const n=this.getVizFlexItem();n instanceof s.vA&&n.setState({isHidden:!0})}})),J(this,"onQueryWithFiltersResult",(e=>{const t=(0,c.l)(u.pT);this.replacePatternsInQuery(t);const n=(0,o.rS)([t]);if(n.getResultsStream().subscribe(this.onQueryError),e.data.state===i.LoadingState.Done&&(0===e.data.series.length||e.data.series.every((e=>0===e.length)))){const e=this.getNoticeFlexItem(),t=this.getVizFlexItem();if(e instanceof s.vA&&e.setState({isHidden:!1,height:"auto",body:new s.dM({reactNode:a().createElement(l.Alert,{severity:"warning",title:""},"The logs returned by this pattern do not match the current query filters.",a().createElement(l.Button,{className:T.ZI.button,onClick:()=>this.clearFilters()},"Clear filters"))})}),t instanceof s.vA){const e=t.state.body;e instanceof s.Eb&&(null==e||e.setState({$data:n}))}this.excludeThisPatternFromFiltering()}e.data.state===i.LoadingState.Error&&this.onQueryError(e)})),this.addActivationHandler(this.onActivate.bind(this))}}function X({tableViz:e,row:t}){const{expandedRows:n}=e.useState(),i=null==n?void 0:n.find((e=>e.state.key===t.pattern));return(0,r.useEffect)((()=>{if(!i){const a=(r=t.pattern,new Y({pattern:r,key:r}));var n;e.setState({expandedRows:[...null!==(n=e.state.expandedRows)&&void 0!==n?n:[],a]})}var r}),[t,e,i]),i?a().createElement(i.Component,{model:i}):null}const Z=[""," K"," Mil"," Bil"," Tri"," Quadr"," Quint"," Sext"," Sept"];class ee extends s.Bs{onActivate(){var e;const t=null===(e=s.jh.getAncestor(this,m.P).state.ds)||void 0===e?void 0:e.maxLines;this.setState({maxLines:t})}buildColumns(e,t,n,r,o){const c=le(n),u=s.jh.getTimeRange(this).state.value;return[{id:"volume-samples",header:"",cell:e=>{const t={timeRange:u,series:[e.cell.row.original.dataFrame],state:i.LoadingState.Done},n=new s.Zv({data:t}),r=s.d0.timeseries().setData(n).setHoverHeader(!0).setOption("tooltip",{mode:l.TooltipDisplayMode.None}).setCustomFieldConfig("hideFrom",{legend:!0,tooltip:!0}).setCustomFieldConfig("axisPlacement",l.AxisPlacement.Hidden).setDisplayMode("transparent").build();return a().createElement("div",{className:c.tableTimeSeriesWrap},a().createElement("div",{className:c.tableTimeSeries},a().createElement(r.Component,{model:r})))}},{id:"count",header:"Count",sortType:"number",cell:e=>{const t=(0,i.scaledUnits)(1e3,Z)(e.cell.row.original.sum);var n,r;return a().createElement("div",{className:c.countTextWrap},a().createElement("div",null,null!==(n=t.prefix)&&void 0!==n?n:"",t.text,null!==(r=t.suffix)&&void 0!==r?r:""))}},{id:"percent",header:"%",sortType:"number",cell:t=>a().createElement("div",{className:c.countTextWrap},a().createElement("div",null,(100*t.cell.row.original.sum/e).toFixed(0),"%"))},{id:"pattern",header:"Pattern",cell:e=>a().createElement("div",{className:(0,h.cx)(ie(),c.tablePatternTextDefault)},a().createElement(G,{exploration:(0,A.Ti)(this),pattern:e.cell.row.original.pattern,maxLines:r}))},{id:"include",header:void 0,disableGrow:!0,cell:e=>{if(null==o?void 0:o.includes(e.cell.row.original.pattern))return;const n=null==t?void 0:t.find((t=>t.pattern===e.cell.row.original.pattern)),r="include"===(null==n?void 0:n.type),i="exclude"===(null==n?void 0:n.type);return a().createElement(B.F,{isExcluded:i,isIncluded:r,onInclude:()=>e.cell.row.original.includeLink(),onExclude:()=>e.cell.row.original.excludeLink(),onClear:()=>e.cell.row.original.undoLink(),buttonFill:"outline"})}}]}buildTableData(e,t){const n=s.jh.getAncestor(this,m.P);return e.filter((e=>!t.size||t.has(e.pattern))).map((e=>({dataFrame:e.dataFrame,pattern:e.pattern,sum:e.sum,includeLink:()=>I({pattern:e.pattern,type:"include",indexScene:n}),excludeLink:()=>I({pattern:e.pattern,type:"exclude",indexScene:n}),undoLink:()=>I({pattern:e.pattern,type:"undo",indexScene:n})})))}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}var te,ne,re;re=function({model:e}){const t=s.jh.getAncestor(e,m.P),{patterns:n}=t.useState(),r=(0,l.useTheme2)(),i=se(r),o=s.jh.getAncestor(e,ge),{legendSyncPatterns:u}=o.useState(),{patternFrames:d,patternsNotMatchingFilters:p}=e.useState(),g=null!=d?d:[],h=s.jh.getAncestor(e,Ce);var f;const v=(null!==(f=h.state.patternFrames)&&void 0!==f?f:[]).reduce(((e,t)=>e+t.sum),0),b=e.buildTableData(g,u);var y;const S=e.buildColumns(v,n,r,null!==(y=e.state.maxLines)&&void 0!==y?y:c.by,p);return a().createElement("div",{"data-testid":L.b.patterns.tableWrapper,className:i.tableWrap},a().createElement(l.InteractiveTable,{columns:S,data:b,getRowId:e=>e.pattern,renderExpandedRow:t=>a().createElement(X,{tableViz:e,row:t})}))},(ne="Component")in(te=ee)?Object.defineProperty(te,ne,{value:re,enumerable:!0,configurable:!0,writable:!0}):te[ne]=re;const ae=b.config.theme2,ie=()=>(0,h.css)({minWidth:"200px",fontFamily:ae.typography.fontFamilyMonospace,overflow:"hidden",overflowWrap:"break-word"}),se=e=>({link:(0,h.css)({textDecoration:"underline"}),tableWrap:(0,h.css)({"> div":{height:"calc(100vh - 450px)",minHeight:"470px"},th:{top:0,position:"sticky",backgroundColor:e.colors.background.canvas,zIndex:e.zIndex.navbarFixed}})}),le=e=>({tablePatternTextDefault:(0,h.css)({fontFamily:e.typography.fontFamilyMonospace,minWidth:"200px",maxWidth:"100%",overflow:"hidden",overflowWrap:"break-word",fontSize:e.typography.bodySmall.fontSize,wordBreak:"break-word"}),countTextWrap:(0,h.css)({textAlign:"right",fontSize:e.typography.bodySmall.fontSize}),tableTimeSeriesWrap:(0,h.css)({width:"230px",pointerEvents:"none"}),tableTimeSeries:(0,h.css)({height:"30px",overflow:"hidden"})});function oe(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function ce(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){oe(i,r,a,s,l,"next",e)}function l(e){oe(i,r,a,s,l,"throw",e)}s(void 0)}))}}function ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function de(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const pe=b.config.theme2.visualization.palette;class ge extends s.Bs{onActivate(){this.updateBody(),this._subs.add(s.jh.getAncestor(this,tt).subscribeToState(((e,t)=>{var n,r,a,i,l,o;const c=null==e||null===(a=e.$patternsData)||void 0===a||null===(r=a.state)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.series,u=null==t||null===(o=t.$patternsData)||void 0===o||null===(l=o.state)||void 0===l||null===(i=l.data)||void 0===i?void 0:i.series;if(!(0,g.B)(c,u)){const e=s.jh.getAncestor(this,Ce);this.updatePatterns(e.state.patternFrames),e.setState({filteredPatterns:void 0})}}))),this._subs.add(s.jh.getAncestor(this,Ce).subscribeToState(((e,t)=>{const n=s.jh.getAncestor(this,Ce);e.filteredPatterns&&!(0,g.B)(e.filteredPatterns,t.filteredPatterns)?this.updatePatterns(n.state.filteredPatterns):n.state.patternFilter||this.updatePatterns(n.state.patternFrames)})))}updatePatterns(e=[]){var t=this;return ce((function*(){var n;null===(n=t.state.body)||void 0===n||n.forEachChild((n=>{n instanceof s.Eb&&n.setState({$data:t.getTimeseriesDataNode(e)}),n instanceof ee&&n.setState({patternFrames:e})}))}))()}updateBody(){var e=this;return ce((function*(){var t,n;const r=s.jh.getAncestor(e,Ce).state.patternFrames;(null===(n=s.jh.getAncestor(e,tt).state.$patternsData)||void 0===n||null===(t=n.state.data)||void 0===t?void 0:t.series)&&r?e.setState({body:e.getSingleViewLayout(),legendSyncPatterns:new Set,loading:!1}):N.v.warn("Failed to update PatternsFrameScene body")}))()}extendTimeSeriesLegendBus(e,t){const n=t.onToggleSeriesVisibility;t.onToggleSeriesVisibility=(t,r)=>{var a;null==n||n(t,r);const i=null===(a=e.state.fieldConfig.overrides)||void 0===a?void 0:a[0],s=null==i?void 0:i.matcher.options.names,l=new Set;s&&s.forEach(l.add,l),this.setState({legendSyncPatterns:l})}}getSingleViewLayout(){const e=s.jh.getAncestor(this,Ce).state.patternFrames;if(!e)return void N.v.warn("Failed to set getSingleViewLayout");const t=this.getTimeSeries(e);return new s.gF({templateColumns:"100%",autoRows:"200px",isLazy:!0,children:[t,new ee({patternFrames:e})]})}getTimeSeries(e){const t=s.jh.getAncestor(this,m.P),n=s.d0.timeseries().setData(this.getTimeseriesDataNode(e)).setOption("legend",{asTable:!0,showLegend:!0,displayMode:l.LegendDisplayMode.Table,placement:"right",width:200}).setHoverHeader(!0).setUnit("short").setLinks([{url:"#",targetBlank:!1,onClick:e=>{I({pattern:e.origin.labels.name,type:"include",indexScene:t})},title:"Include"},{url:"#",targetBlank:!1,onClick:e=>{I({pattern:e.origin.labels.name,type:"exclude",indexScene:t})},title:"Exclude"}]).build();return n.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(e,t)}),n}getTimeseriesDataNode(e){const t=s.jh.getTimeRange(this).state.value;return new s.Zv({data:{series:e.map(((e,t)=>{const n=e.dataFrame;return n.fields[1].config.color=function(e){return{mode:"fixed",fixedColor:pe[e]}}(t),n.fields[1].name="",n})),state:i.LoadingState.Done,timeRange:t}})}constructor(e){super(de(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ue(e,t,n[t])}))}return e}({loading:!0},e),{legendSyncPatterns:new Set})),this.addActivationHandler(this.onActivate.bind(this))}}ue(ge,"Component",(({model:e})=>{var t;const{body:n,loading:r}=e.useState(),i=s.jh.getAncestor(e,tt),{$patternsData:l}=i.useState(),o=null==l||null===(t=l.state.data)||void 0===t?void 0:t.series;return a().createElement("div",{className:he.container},!r&&o&&o.length>0&&a().createElement(a().Fragment,null,n&&a().createElement(n.Component,{model:n})))}));const he={container:(0,h.css)({width:"100%",".show-on-hover":{display:"none"}})};var fe=n(9193),ve=n(9284);function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class be extends s.Bs{onActivate(){const e=s.jh.getAncestor(this,Ce);this._subs.add(e.subscribeToState(((e,t)=>{if(e.patternFilter!==t.patternFilter){const e=s.jh.getAncestor(this,Ce);e.state.patternFrames&&(0,fe.E)(e.state.patternFrames.map((e=>e.pattern)),e.state.patternFilter,this.onSearchResult)}}))),this._subs.add(e.subscribeToState(((e,t)=>{e.patternFilter&&!e.filteredPatterns&&e.patternFrames&&!(0,g.B)(e.filteredPatterns,t.filteredPatterns)&&(0,fe.X)(e.patternFrames.map((e=>e.pattern)),e.patternFilter,this.onSearchResult)})))}setFilteredPatterns(e,t){const n=s.jh.getAncestor(this,Ce),r=null!=t?t:n.state.patternFrames;if(r){const t=r.filter((t=>!(!n.state.patternFilter||!(null==r?void 0:r.length))&&e.find((e=>e===t.pattern))));n.setState({filteredPatterns:t})}}setEmptySearch(){s.jh.getAncestor(this,Ce).setState({filteredPatterns:void 0})}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){me(e,t,n[t])}))}return e}({},e)),me(this,"clearSearch",(()=>{s.jh.getAncestor(this,Ce).setState({patternFilter:""})})),me(this,"handleSearchChange",(e=>{s.jh.getAncestor(this,Ce).setState({patternFilter:e.target.value})})),me(this,"onSearchResult",(e=>{const t=s.jh.getAncestor(this,Ce);t.state.patternFilter?this.setFilteredPatterns(e[0]):t.state.filteredPatterns&&!t.state.patternFilter&&this.setEmptySearch()})),this.addActivationHandler(this.onActivate.bind(this))}}me(be,"Component",(function({model:e}){const t=s.jh.getAncestor(e,Ce),{patternFilter:n}=t.useState();return a().createElement(l.Field,{className:ye.field},a().createElement(ve.D,{onChange:e.handleSearchChange,onClear:e.clearSearch,value:n,placeholder:"Search patterns"}))}));const ye={field:(0,h.css)({label:"field",marginBottom:0}),icon:(0,h.css)({cursor:"pointer"})};var Se=n(7191);function we(){return a().createElement(Se.R,null,a().createElement("div",null,a().createElement("p",null,a().createElement("strong",null,"Sorry, we could not detect any patterns.")),a().createElement("p",null,"Check back later or reach out to the team in the"," ",a().createElement(l.TextLink,{href:"https://slack.grafana.com/",external:!0},"Grafana Labs community Slack channel")),a().createElement("p",null,"Patterns let you detect similar log lines to include or exclude from your search.")))}function Oe(){return a().createElement(Se.R,null,a().createElement("div",null,a().createElement("p",null,a().createElement("strong",null,"Patterns are only available for the most recent ",Ee," hours of data.")),a().createElement("p",null,"See the"," ",a().createElement(l.TextLink,{href:"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/patterns/",external:!0},"patterns docs")," ","for more info.")))}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ee=3;class Ce extends s.Bs{onActivate(){var e,t;const n=s.jh.getAncestor(this,tt);var r;(this.setBody(),null===(e=n.state.$patternsData)||void 0===e?void 0:e.state)&&this.onDataChange(null===(r=n.state.$patternsData)||void 0===r?void 0:r.state);this._subs.add(null===(t=n.state.$patternsData)||void 0===t?void 0:t.subscribeToState(this.onDataChange))}setBody(){this.setState({body:new s.G1({direction:"column",children:[new s.vA({ySizing:"content",body:new be}),new s.vA({body:new ge})]})})}updatePatternFrames(e){if(!e)return;const t=this.dataFrameToPatternFrame(e);this.setState({patternFrames:t})}dataFrameToPatternFrame(e){const t=s.jh.getAncestor(this,tt),n=s.jh.getAncestor(t,m.P).state.patterns;return e.map((e=>{var t,r;const a=null==n?void 0:n.find((t=>t.pattern===e.name)),i=null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.sum;var s;return{dataFrame:e,pattern:null!==(s=e.name)&&void 0!==s?s:"",sum:i,status:null==a?void 0:a.type}}))}constructor(e){var t;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){xe(e,t,n[t])}))}return e}({$variables:null!==(t=e.$variables)&&void 0!==t?t:new s.Pj({variables:[new s.yP({name:u.Jg,defaultToAll:!0,includeAll:!0})]}),loading:!0,patternFilter:""},e)),xe(this,"onDataChange",((e,t)=>{var n,r,a,s,l;const o=null===(n=e.data)||void 0===n?void 0:n.series,c=null==t||null===(r=t.data)||void 0===r?void 0:r.series;(null===(a=e.data)||void 0===a?void 0:a.state)===i.LoadingState.Done?(this.setState({loading:!1,error:!1}),(0,g.B)(o,c)||this.updatePatternFrames(o)):(null===(s=e.data)||void 0===s?void 0:s.state)===i.LoadingState.Loading?this.setState({loading:!0,error:!1}):(null===(l=e.data)||void 0===l?void 0:l.state)===i.LoadingState.Error&&this.setState({loading:!1,error:!0})})),this.addActivationHandler(this.onActivate.bind(this))}}function Pe(e){return{container:(0,h.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),content:(0,h.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),controls:(0,h.css)({flexGrow:0,display:"flex",alignItems:"top",gap:e.spacing(2)}),controlsRight:(0,h.css)({flexGrow:0,display:"flex",justifyContent:"flex-end"}),controlsLeft:(0,h.css)({display:"flex",justifyContent:"flex-left",justifyItems:"left",width:"100%",flexDirection:"column"}),patternMissingText:(0,h.css)({padding:e.spacing(2)})}}xe(Ce,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r,patternFrames:o,error:c}=e.useState(),{value:u}=s.jh.getTimeRange(e).useState(),d=(0,l.useStyles2)(Pe),p=(0,i.dateTime)().diff(u.to,"hours")>=Ee;return a().createElement("div",{className:d.container},a().createElement(D.O,{isLoading:n,blockingMessage:r},!n&&c&&a().createElement("div",{className:d.patternMissingText},a().createElement(l.Text,{textAlignment:"center",color:"primary"},a().createElement("p",null,"There are no pattern matches."),a().createElement("p",null,"Pattern matching has not been configured."),a().createElement("p",null,"Patterns let you detect similar log lines and add or exclude them from your search."),a().createElement("p",null,"To see them in action, add the following to your Loki configuration"),a().createElement("p",null,a().createElement("code",null,"--pattern-ingester.enabled=true")))),!c&&!n&&0===(null==o?void 0:o.length)&&p&&a().createElement(Oe,null),!c&&!n&&0===(null==o?void 0:o.length)&&!p&&a().createElement(we,null),!c&&!n&&o&&o.length>0&&a().createElement("div",{className:d.content},t&&a().createElement(t.Component,{model:t}))))}));var ke=n(71),je=n(6145),Fe=function(e){return e.logs="Logs",e.labels="Labels",e.fields="Fields",e.patterns="Patterns",e}({});const Le=[{displayName:"Logs",value:v.G3.logs,getScene:()=>new s.G1({direction:"column",children:[new s.vA({body:new ke._({})}),new s.vA({minHeight:"470px",height:"calc(100vh - 500px)",body:new F.i({})})]}),testId:L.b.exploreServiceDetails.tabLogs},{displayName:"Labels",value:v.G3.labels,getScene:()=>new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:je.yV.Crosshair})],children:[new s.vA({body:new _.O({})})]}),testId:L.b.exploreServiceDetails.tabLabels},{displayName:"Fields",value:v.G3.fields,getScene:e=>{return t=e,new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:je.yV.Crosshair})],children:[new s.vA({body:new T.J6({changeFieldCount:t})})]});var t},testId:L.b.exploreServiceDetails.tabFields},{displayName:"Patterns",value:v.G3.patterns,getScene:()=>new s.G1({children:[new s.vA({body:new Ce({})})]}),testId:L.b.exploreServiceDetails.tabPatterns}],_e=[{displayName:"Label",value:v._J.label,getScene:e=>function(e){return new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:je.yV.Crosshair})],children:[new s.vA({body:new _.O({value:e})})]})}(e),testId:L.b.exploreServiceDetails.tabLabels},{displayName:"Field",value:v._J.field,getScene:e=>function(e){return new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:je.yV.Crosshair})],children:[new s.vA({body:new T.J6({value:e})})]})}(e),testId:L.b.exploreServiceDetails.tabFields}];function Te(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}class De extends s.Bs{onActivate(){const e=s.jh.getAncestor(this,m.P).state.ds;void 0!==(null==e?void 0:e.maxLines)&&this.setState({maxLines:e.maxLines}),this.state.shareButtonScene||this.setState({shareButtonScene:new x({})})}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(De,"Component",(({model:e})=>{const t=(0,l.useStyles2)($e);let n=(0,v.FT)(),r=!1;if(!Object.values(v.G3).includes(n)){const e=(0,v.er)();r=!0,e===v._J.field&&(n=v.G3.fields),e===v._J.label&&(n=v.G3.labels)}const o=s.jh.getAncestor(e,tt),u=o.useState(),{loading:d,$data:g,logsCount:m,totalLogsCount:b}=u,y=Te(u,["loading","$data","logsCount","totalLogsCount"]),{maxLines:S}=e.useState(),w=y.loadingStates;return a().createElement(l.Box,{paddingY:0},a().createElement("div",{className:t.actions},a().createElement(l.Stack,{gap:1},e.state.shareButtonScene&&a().createElement(e.state.shareButtonScene.Component,{model:e.state.shareButtonScene}))),a().createElement(l.TabsBar,null,Le.map(((e,t)=>a().createElement(l.Tab,{"data-testid":e.testId,key:t,label:e.displayName,active:n===e.value,counter:w[e.displayName]?void 0:Ne(e,y),suffix:e.displayName===Fe.logs?({className:e})=>function(e,t,n,r){const s=(0,l.useStyles2)(Ie),o=(0,i.getValueFormat)("short");if(void 0===t&&void 0!==n&&n<r){var c;const t=o(n,0);return a().createElement("span",{className:(0,h.cx)(e,s.logsCountStyles)},t.text,null===(c=t.suffix)||void 0===c?void 0:c.trim())}if(void 0!==t){var u;const n=o(t,0);return a().createElement("span",{className:(0,h.cx)(e,s.logsCountStyles)},n.text,null===(u=n.suffix)||void 0===u?void 0:u.trim())}return a().createElement("span",{className:(0,h.cx)(e,s.emptyCountStyles)})}(e,b,m,null!=S?S:c.by):void 0,icon:w[e.displayName]?"spinner":void 0,href:(0,p.rs)(e.value,o),onChangeTab:()=>{(e.value&&e.value!==n||r)&&(0,f.EE)(f.NO.service_details,f.ir.service_details.action_view_changed,{newActionView:e.value,previousActionView:n})}})))))}));const Ne=(e,t)=>{switch(e.value){case"fields":return t.fieldsCount;case"patterns":return t.patternsCount;case"labels":return t.labelsCount;default:return}};function $e(e){return{actions:(0,h.css)({display:"flex",justifyContent:"flex-end",[e.breakpoints.up(e.breakpoints.values.md)]:{position:"absolute",right:0,zIndex:2}})}}function Ie(e){return{emptyCountStyles:(0,h.css)({display:"inline-block",fontSize:e.typography.bodySmall.fontSize,minWidth:"1em",marginLeft:e.spacing(1),padding:e.spacing(.25,1)}),logsCountStyles:(0,h.css)({fontSize:e.typography.bodySmall.fontSize,label:"counter",marginLeft:e.spacing(1),borderRadius:e.spacing(3),backgroundColor:e.colors.action.hover,padding:e.spacing(.25,1),color:e.colors.text.secondary,fontWeight:e.typography.fontWeightMedium})}}var Be=n(7389),Ae=n(7796),Me=n(6854);function Re(e,t){const n=["^","$",".","*","+","?","(",")","[","]","{","}","|"];return t||n.push("\\"),e.split("").filter(((e,t,r)=>{const a=r[t+1],i=n.includes(a);return!("\\"===e&&i)})).join("")}var Ve=n(2245),We=n(2085),ze=n(708);function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){He(e,t,n[t])}))}return e}function Ke(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Ge="logsPanelQuery",Ue="logsCountQuery";function qe(e){return null==e?void 0:e.series.find((e=>e.refId===Ge))}function Je(e){var t,n,r;return null===(r=s.jh.getAncestor(e,tt).state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]}function Ye(e){var t;const n=s.jh.getAncestor(e,tt);return Xe(null===(t=n.state.$detectedFieldsData)||void 0===t?void 0:t.state)}const Xe=e=>{var t,n;return null==e||null===(n=e.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]},Ze=e=>{var t,n,r,a;return null===(a=e.data)||void 0===a||null===(r=a.series)||void 0===r||null===(n=r[0])||void 0===n||null===(t=n.fields)||void 0===t?void 0:t[0]},et=e=>{var t,n,r,a;return null===(a=e.data)||void 0===a||null===(r=a.series)||void 0===r||null===(n=r[0])||void 0===n||null===(t=n.fields)||void 0===t?void 0:t[2]};class tt extends s.Bs{setSubscribeToLabelsVariable(){const e=(0,Q.cR)(this);0!==e.state.filters.length?this._subs.add(e.subscribeToState(((e,t)=>{0===e.filters.length&&this.redirectToStart();let{labelName:n,labelValue:r,breakdownLabel:a}=(0,v.W6)();n===u.ky&&(n=u.OX);const i=s.jh.getAncestor(this,m.P),l=i.state.routeMatch;if(e.filters.some((e=>e.key===n&&(0,ze.BG)(e.operator)&&(0,Be.uu)(e.value)===r))){if(!(0,g.B)(e.filters,t.filters)){var o,c,d,h;null===(o=this.state.$patternsData)||void 0===o||o.runQueries(),null===(c=this.state.$detectedLabelsData)||void 0===c||c.runQueries(),null===(d=this.state.$detectedFieldsData)||void 0===d||d.runQueries(),null===(h=this.state.$logsCount)||void 0===h||h.runQueries()}}else{const t=e.filters.find((e=>(0,ze.BG)(e.operator)&&e.value!==u.ZO));if(t){const e=(0,u.zE)(t.value)?(0,Be.uu)((0,u.Dx)(t.value)):(0,Be.uu)(t.value);var f,b,y;i.setState({routeMatch:Ke(Qe({},l),{params:Ke(Qe({},null==l?void 0:l.params),{labelName:t.key===u.OX?u.ky:t.key,labelValue:e.split("|")[0]}),url:null!==(f=null==l?void 0:l.url)&&void 0!==f?f:"",path:null!==(b=null==l?void 0:l.path)&&void 0!==b?b:"",isExact:null===(y=null==l?void 0:l.isExact)||void 0===y||y})}),this.resetTabCount(),a?(0,p.fg)((0,v.er)(),a,this):(0,p.Vt)((0,v.FT)(),this)}else this.redirectToStart()}}))):this.redirectToStart()}redirectToStart(){this.setState({$data:void 0,$logsCount:void 0,body:void 0,$patternsData:void 0,$detectedLabelsData:void 0,$detectedFieldsData:void 0,patternsCount:void 0,labelsCount:void 0,fieldsCount:void 0,logsCount:void 0,totalLogsCount:void 0}),(0,d.JO)().setServiceSceneState(this.state),this._subs.unsubscribe(),(0,p.Ns)()}showVariables(){s.jh.findByKeyAndType(this,We.kz,We.qV).setState({visible:!0}),(0,Q.YS)(this).setState({hide:Ve.zL.dontHide})}getMetadata(){const e=(0,d.JO)().getServiceSceneState();e&&this.setState(Qe({},e))}onActivate(){s.jh.findByKeyAndType(this,m.y,Ae.H).setState({hidden:!0}),this.showVariables(),this.getMetadata(),this.resetBodyAndData(),this.setBreakdownView(),this.runQueries(),this._subs.add(this.subscribeToPatternsQuery()),this._subs.add(this.subscribeToDetectedLabelsQuery()),this._subs.add(this.subscribeToDetectedFieldsQuery((0,v.FT)()!==v.G3.fields)),this._subs.add(this.subscribeToLogsQuery()),this._subs.add(this.subscribeToLogsCountQuery()),this.setSubscribeToLabelsVariable(),this._subs.add(this.subscribeToFieldsVariable()),this._subs.add(this.subscribeToMetadataVariable()),this._subs.add(this.subscribeToLevelsVariableChangedEvent()),this._subs.add(this.subscribeToLevelsVariableFiltersState()),this._subs.add(this.subscribeToDataSourceVariable()),this._subs.add(this.subscribeToPatternsVariable()),this._subs.add(this.subscribeToLineFiltersVariable()),this._subs.add(this.subscribeToTimeRange()),function(e){const t=i.urlUtil.getUrlSearchParams(),n=t["var-lineFilter"];if(!Array.isArray(n)||!n.length)return;const r=n[0];if("string"!=typeof r||!r)return;const a=s.jh.getAncestor(e,m.P),l=(0,Q.Gk)(e),o=null==r?void 0:r.match(/\|=.`(.+?)`/);var c,u;o&&2===o.length&&(null===(u=a.state.body)||void 0===u||null===(c=u.state.lineFilterRenderer)||void 0===c||c.addActivationHandler((()=>{l.setState({filters:[{key:Me.ld.caseSensitive,operator:Me.cK.match,value:Re(o[1],!0),keyLabel:"0"}]})})));const d=null==r?void 0:r.match(/`\(\?i\)(.+)`/);var p,g;d&&2===d.length&&(null===(g=a.state.body)||void 0===g||null===(p=g.state.lineFilterRenderer)||void 0===p||p.addActivationHandler((()=>{l.updateFilters([{key:Me.ld.caseInsensitive,operator:Me.cK.match,value:Re(d[1],!1),keyLabel:"0"}])})));const h=b.locationService.getLocation();delete t["var-lineFilter"],b.locationService.replace(i.urlUtil.renderUrl(h.pathname,t))}(this)}subscribeToPatternsVariable(){return(0,Q.Ku)(this).subscribeToState(((e,t)=>{var n,r;e.value!==t.value&&(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())}))}subscribeToLineFiltersVariable(){return(0,Q.Gk)(this).subscribeToEvent(s.oh,(()=>{var e,t;null===(e=this.state.$logsCount)||void 0===e||e.runQueries(),null===(t=this.state.$detectedFieldsData)||void 0===t||t.runQueries()}))}subscribeToDataSourceVariable(){return(0,Q.S9)(this).subscribeToState((()=>{this.redirectToStart()}))}resetTabCount(){this.setState({fieldsCount:void 0,labelsCount:void 0,patternsCount:void 0}),(0,d.JO)().setServiceSceneState(this.state)}subscribeToFieldsVariable(){return(0,Q.ir)(this).subscribeToState(((e,t)=>{var n,r;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())}))}subscribeToMetadataVariable(){return(0,Q.oY)(this).subscribeToState(((e,t)=>{var n,r;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())}))}subscribeToLevelsVariableChangedEvent(){return(0,Q.iw)(this).subscribeToEvent(s.oh,(()=>{var e;null===(e=this.state.$detectedFieldsData)||void 0===e||e.runQueries()}))}subscribeToLevelsVariableFiltersState(){return(0,Q.iw)(this).subscribeToState(((e,t)=>{var n;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$logsCount)||void 0===n||n.runQueries())}))}runQueries(){const e=(0,v.FT)(),t=(0,v.er)();var n,r,a,i;e!==v.G3.patterns&&void 0!==this.state.patternsCount||(null===(n=this.state.$patternsData)||void 0===n||n.runQueries());e!==v.G3.labels&&t!==v._J.label&&void 0!==this.state.labelsCount||(null===(r=this.state.$detectedLabelsData)||void 0===r||r.runQueries());e!==v.G3.fields&&t!==v._J.field&&void 0!==this.state.fieldsCount||(null===(a=this.state.$detectedFieldsData)||void 0===a||a.runQueries());void 0===this.state.logsCount&&(null===(i=this.state.$logsCount)||void 0===i||i.runQueries())}subscribeToPatternsQuery(){var e;return null===(e=this.state.$patternsData)||void 0===e?void 0:e.subscribeToState((e=>{var t;if(this.updateLoadingState(e,Fe.patterns),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data.series;void 0!==(null==t?void 0:t.length)&&(this.setState({patternsCount:t.length}),(0,d.JO)().setPatternsCount(t.length))}}))}subscribeToDetectedLabelsQuery(){var e;return null===(e=this.state.$detectedLabelsData)||void 0===e?void 0:e.subscribeToState((e=>{var t;if(this.updateLoadingState(e,Fe.labels),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data,n=t.series[0].fields;if(void 0!==t.series.length&&void 0!==n.length){const e=t.series[0].fields.filter((e=>u.e4!==e.name));this.setState({labelsCount:e.length+1}),(0,d.JO)().setLabelsCount(n.length)}}}))}updateLoadingState(e,t){var n;const r=this.state.loadingStates;r[t]=(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Loading;const a=Object.values(r).some((e=>e));this.setState({loading:a,loadingStates:r})}subscribeToLogsQuery(){var e;return null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState(((e,t)=>{var n,r;if(this.updateLoadingState(e,Fe.logs),(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done||(null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Streaming){var a,s;const t=null!==(s=null===(a=e.data.series[0])||void 0===a?void 0:a.length)&&void 0!==s?s:0;t!==this.state.logsCount&&this.setState({logsCount:t})}}))}subscribeToLogsCountQuery(){var e;return null===(e=this.state.$logsCount)||void 0===e?void 0:e.subscribeToState((e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){var n,r,a,s;const t=null===(s=e.data.series[0])||void 0===s||null===(a=s.fields)||void 0===a||null===(r=a[1])||void 0===r||null===(n=r.values)||void 0===n?void 0:n[0];this.setState({totalLogsCount:t})}}))}subscribeToDetectedFieldsQuery(e){var t;return null===(t=this.state.$detectedFieldsData)||void 0===t?void 0:t.subscribeToState((t=>{var n;if(this.updateLoadingState(t,Fe.fields),e&&(null===(n=t.data)||void 0===n?void 0:n.state)===i.LoadingState.Done){const e=t.data.series[0];void 0!==e&&e.length!==this.state.fieldsCount&&(this.setState({fieldsCount:e.length}),(0,d.JO)().setFieldsCount(e.length))}}))}subscribeToTimeRange(){return s.jh.getTimeRange(this).subscribeToState((()=>{var e,t,n,r;null===(e=this.state.$patternsData)||void 0===e||e.runQueries(),null===(t=this.state.$detectedLabelsData)||void 0===t||t.runQueries(),null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries()}))}resetBodyAndData(){let e={};this.state.$data||(e.$data=st()),this.state.$patternsData||(e.$patternsData=rt()),this.state.$detectedLabelsData||(e.$detectedLabelsData=at()),this.state.$detectedFieldsData||(e.$detectedFieldsData=it()),this.state.$logsCount||(e.$logsCount=lt()),this.state.body||(e.body=nt()),Object.keys(e).length&&this.setState(e)}setBreakdownView(){const{body:e}=this.state,t=(0,v.FT)(),n=Le.find((e=>e.value===t));if(!e){const e=new Error("body is not defined in setBreakdownView!");throw N.v.error(e,{msg:"ServiceScene setBreakdownView error"}),e}if(n)e.setState({children:[...e.state.children.slice(0,1),n.getScene((e=>{"fields"===n.value&&this.setState({fieldsCount:e})}))]});else{const t=(0,v.er)(),n=_e.find((e=>e.value===t));n&&this.state.drillDownLabel?e.setState({children:[...e.state.children.slice(0,1),n.getScene(this.state.drillDownLabel)]}):N.v.error(new Error("not setting breakdown view"),{msg:"setBreakdownView error"})}}constructor(e){var t;super(Qe({loadingStates:{[Fe.patterns]:!1,[Fe.labels]:!1,[Fe.fields]:!1,[Fe.logs]:!1},loading:!0,body:null!==(t=e.body)&&void 0!==t?t:nt(),$data:st(),$patternsData:rt(),$detectedLabelsData:at(),$detectedFieldsData:it(),$logsCount:lt()},e)),He(this,"_variableDependency",new s.Sh(this,{variableNames:[u.EY,u.MB,u.mB,u.uw,u._Y]})),this.addActivationHandler(this.onActivate.bind(this))}}function nt(){return new s.G1({direction:"column",children:[new s.vA({ySizing:"content",body:new De({})})]})}function rt(){return(0,o.FH)([(0,c.BM)(`{${u.S1}}`,"patterns",{refId:"patterns"})])}function at(){return(0,o.FH)([(0,c.BM)(`{${u.S1}}`,"detected_labels",{refId:"detectedLabels"})])}function it(){return(0,o.FH)([(0,c.BM)(u.SA,"detected_fields",{refId:"detectedFields"})])}function st(){return(0,o.rS)([(0,c.l)(u.SA,{refId:Ge})])}function lt(){const e=(0,o.rS)([(0,c.l)(`sum(count_over_time(${u.SA}[$__auto]))`,{refId:Ue,queryType:"instant"})],{runQueriesMode:"manual"});if(e instanceof s.dt)return e;const t=new Error("log count query provider is not query runner!");throw N.v.error(t,{msg:"getLogCountQueryRunner: invalid return type"}),t}He(tt,"Component",(({model:e})=>{const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):a().createElement(l.LoadingPlaceholder,{text:"Loading..."})}))},577:(e,t,n)=>{n.d(t,{p:()=>g});var r,a,i,s=n(9736),l=n(5959),o=n.n(l),c=n(2007),u=n(6089),d=n(4351),p=n(696);class g extends s.Bs{setHover(e){this.setState({hover:e})}onClick(e){e?(0,p.wy)(this.state.labelName,this.state.labelValue,this):(0,p._J)(this.state.labelName,this.state.labelValue,this)}}i=({model:e})=>{const{ds:t,labelValue:n,labelName:r,hover:a}=e.useState(),i=(0,d.eT)(t,r).includes(n),s=(0,c.useStyles2)((e=>({wrapper:(0,u.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignSelf:"center"})}))),l=i?`Remove  ${n} from favorites`:`Add ${n} to favorites`;return o().createElement("span",{className:s.wrapper},o().createElement(c.ToolbarButton,{onMouseOver:()=>{e.setHover(!0)},onMouseOut:()=>{e.setHover(!1)},icon:o().createElement(c.Icon,{name:i?"favorite":"star",size:"lg",type:i?"mono":"default"}),color:i?"rgb(235, 123, 24)":"#ccc",onClick:()=>e.onClick(i),name:"star","aria-label":l,tooltip:l}))},(a="Component")in(r=g)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i},173:(e,t,n)=>{n.d(t,{X:()=>ue,y:()=>ge});var r=n(6089),a=n(3241),i=n(5959),s=n.n(i),l=n(7781),o=n(9736),c=n(2007),u=n(4351),d=n(20),p=n(4509),g=n(7478),h=n(5553),f=n(6854),v=n(3571),m=n(696);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class y extends o.Bs{onActivate(){const e=(0,h.cR)(this);this.setState({hidden:e.state.filters.length>0}),e.subscribeToState((e=>{this.setState({hidden:e.filters.length>0})}))}constructor(e){super(e),b(this,"getLink",(()=>{if(this.state.labelValue)return w(this.state.labelName,this.state.labelValue,this)})),b(this,"onClick",(()=>{S(this.state.labelName,this.state.labelValue,this)})),this.addActivationHandler(this.onActivate.bind(this))}}function S(e,t,n){(0,p.EE)(p.NO.service_selection,p.ir.service_selection.service_selected,{value:t,label:e}),(0,m._J)(e,t,n)}function w(e,t,n){var r;const a=(0,h.cR)(n),i=[...a.state.filters.filter((n=>!(n.key===e&&n.value===t))),{key:e,operator:f.w7.Equal,value:t}];e===d.OX&&(e=d.ky);const s=a.clone({filters:i});return(0,g.k9)(e,t,null===(r=s.urlSync)||void 0===r?void 0:r.getUrlState())}function O(e){return{button:(0,r.css)({alignSelf:"center"})}}b(y,"Component",(({model:e})=>{const t=(0,c.useStyles2)(O);(0,h.cR)(e).useState();const{hidden:n}=e.useState();if(n)return null;const r=e.getLink();return s().createElement(c.LinkButton,{"data-testid":v.b.index.selectServiceButton,tooltip:`View logs for ${e.state.labelValue}`,className:t.button,variant:"primary",fill:"outline",size:"sm",disabled:!r,href:e.getLink(),onClick:e.onClick},"Show logs")}));var x=n(7985),E=n(1475),C=n(7191);const P=()=>s().createElement(C.R,null,s().createElement("p",null,"Log volume has not been configured."),s().createElement("p",null,s().createElement(c.TextLink,{href:"https://grafana.com/docs/loki/latest/reference/api/#query-log-volume",external:!0},"Instructions to enable volume in the Loki config:")),s().createElement(c.Text,{textAlignment:"left"},s().createElement("pre",null,s().createElement("code",null,"limits_config:",s().createElement("br",null),"Â Â volume_enabled: true")))),k=()=>s().createElement(C.R,null,s().createElement("p",null,"No service matched your search."));var j=n(5570),F=n(7243),L=n(4702),_=n(1532),T=n(8531),D=n(2245),N=n(9731),$=n(2661),I=n(5002);function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class M extends o.Bs{}B(M,"Component",(({model:e})=>{const t=o.jh.getAncestor(e,ge),n=o.jh.getAncestor(e,H),{tabOptions:r,showPopover:a}=n.useState(),i=(0,c.useStyles2)(R),l=r.map((e=>A(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){B(e,t,n[t])}))}return e}({},e),{icon:e.saved?"save":void 0,label:`${e.label}`})));return s().createElement(c.Stack,{direction:"column",gap:0,role:"tooltip"},s().createElement("div",{className:i.card.body},s().createElement(c.Select,{menuShouldPortal:!1,width:50,onBlur:()=>{n.toggleShowPopover()},autoFocus:!0,isOpen:a,placeholder:"Search labels",options:l,isSearchable:!0,openMenuOnFocus:!0,onChange:e=>{e.value&&(n.toggleShowPopover(),t.setSelectedTab(e.value))}})))}));const R=e=>({card:{body:(0,r.css)({padding:e.spacing(1)}),p:(0,r.css)({maxWidth:300})}});function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){V(e,t,n[t])}))}return e}function z(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class H extends o.Bs{getLabelsFromQueryRunnerState(e=(()=>{var e;return null===(e=this.state.$labelsData)||void 0===e?void 0:e.state})()){var t;return null===(t=e.data)||void 0===t?void 0:t.series[0].fields.map((e=>({label:e.name,cardinality:e.values[0]})))}populatePrimaryLabelsVariableOptions(e){const t=o.jh.getAncestor(this,ge).getSelectedTab(),n=(0,u.sj)((0,h.S9)(this).getValue().toString()),r=e.map((e=>{const r=n.indexOf(e.label);return{label:e.label===d.OX?d.ky:e.label,value:e.label,active:t===e.label,saved:-1!==r,savedIndex:r}})).sort(((e,t)=>e.value===d.OX||t.value===d.OX?e.value===d.OX?-1:1:e.label<t.label?-1:e.label>t.label?1:0));this.setState({tabOptions:r})}runDetectedLabels(){this.state.$labelsData.runQueries()}runDetectedLabelsSubs(){this._subs.add(o.jh.getTimeRange(this).subscribeToState((()=>{this.runDetectedLabels()}))),this._subs.add((0,h.S9)(this).subscribeToState((()=>{this.runDetectedLabels()})))}onActivate(){this.runDetectedLabels(),this.setState({popover:new M({})}),this.runDetectedLabelsSubs(),this._subs.add((0,h.S9)(this).subscribeToState((()=>{this.state.$labelsData.runQueries()}))),this._subs.add((0,h.El)(this).subscribeToState((()=>{var e;const t=this.getLabelsFromQueryRunnerState(null===(e=this.state.$labelsData)||void 0===e?void 0:e.state);t&&this.populatePrimaryLabelsVariableOptions(t)}))),this._subs.add(this.state.$labelsData.subscribeToState((e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===l.LoadingState.Done){const t=this.getLabelsFromQueryRunnerState(e),n=o.jh.getAncestor(this,ge);t&&this.populatePrimaryLabelsVariableOptions(t);const r=n.getSelectedTab();(null==t?void 0:t.some((e=>e.label===r)))||n.selectDefaultLabelTab()}})))}constructor(e){super(W({showPopover:!1,$labelsData:(0,E.HF)({queries:[(0,x.BM)("","detected_labels")],runQueriesMode:"manual"}),tabOptions:[{label:d.ky,value:d.OX,saved:!0}]},e)),V(this,"removeSavedTab",(e=>{(0,u.Gg)((0,h.S9)(this).getValue().toString(),e);const t=this.getLabelsFromQueryRunnerState();t&&this.populatePrimaryLabelsVariableOptions(t);const n=o.jh.getAncestor(this,ge);n.getSelectedTab()===e&&n.selectDefaultLabelTab()})),V(this,"toggleShowPopover",(()=>{this.setState({showPopover:!this.state.showPopover})})),this.addActivationHandler(this.onActivate.bind(this))}}V(H,"Component",(({model:e})=>{const{tabOptions:t,showPopover:n,popover:u,$labelsData:p}=e.useState(),{data:g}=p.useState(),f=o.jh.getAncestor(e,ge);(0,h.El)(e).useState();const v=(0,c.useStyles2)(Q),m=(0,i.useRef)(null);return s().createElement(c.TabsBar,{className:v.tabs},t.filter((e=>e.saved||e.active||e.value===d.OX)).sort(((e,t)=>{return e.value===d.OX||t.value===d.OX?e.value===d.OX?-1:1:(null!==(n=e.savedIndex)&&void 0!==n?n:0)-(null!==(r=t.savedIndex)&&void 0!==r?r:0);var n,r})).map((t=>{const n=s().createElement(c.Tab,{key:t.value,onChangeTab:()=>{f.setSelectedTab(t.value)},label:(0,I.EJ)(t.label,15,!0),active:t.active,suffix:t.value!==d.OX?n=>s().createElement(s().Fragment,null,s().createElement(c.Tooltip,{content:"Remove tab"},s().createElement(c.Icon,{onKeyDownCapture:n=>{"Enter"===n.key&&e.removeSavedTab(t.value)},onClick:n=>{n.stopPropagation(),e.removeSavedTab(t.value)},name:"times",className:(0,r.cx)(n.className)}))):void 0});return t.label.length>15?s().createElement(c.Tooltip,{key:t.value,content:t.label},n):n})),(null==g?void 0:g.state)===l.LoadingState.Loading&&s().createElement(c.Tab,{label:"Loading tabs",icon:"spinner"}),(null==g?void 0:g.state)===l.LoadingState.Done&&s().createElement("span",{className:v.addTab},s().createElement(c.Tab,{onChangeTab:e.toggleShowPopover,label:"Add label",ref:m,icon:"plus-circle"})),u&&s().createElement(c.PopoverController,{content:s().createElement(u.Component,{model:u})},((e,t,r)=>{const i={onBlur:t,onFocus:e};return s().createElement(s().Fragment,null,m.current&&s().createElement(s().Fragment,null,s().createElement(c.Popover,W(z(W({},r,a.rest),{show:n,wrapperClassName:v.popover,referenceElement:m.current,renderArrow:!0}),i))))})))}));const Q=e=>({tabs:(0,r.css)({overflowY:"hidden"}),addTab:(0,r.css)({label:"add-label-tab",color:e.colors.primary.text,"& button":{color:e.colors.primary.text}}),popover:(0,r.css)({borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3,background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`})});var K=n(577);const G=e=>s().createElement(C.R,null,s().createElement("p",null,"No logs found in ",s().createElement("strong",null,e.labelName),".",s().createElement("br",null),"Please adjust time range or select another label."));var U=n(5719),q=n(9405);function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){J(e,t,n[t])}))}return e}function X(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class Z extends o.Bs{onActivate(){this.setState(Y({},this.isSelected())),this._subs.add((0,h.cR)(this).subscribeToState((()=>{const e=this.isSelected();this.state.included!==e.included&&this.setState(Y({},e))})))}getFilter(){return{name:this.state.name,value:this.state.value}}constructor(e){super(X(Y({},e),{included:null})),J(this,"isSelected",(()=>{const e=(0,h.cR)(this).state.filters.find((e=>{const t=(0,h.z2)(d.MB,e);return e.key===this.state.name&&t.value===this.state.value}));return e?{included:e.operator===f.w7.Equal}:{included:!1}})),J(this,"onClick",(e=>{const t=this.getFilter();(0,q.Qt)(t.name,t.value,e,this,d.MB);const n=(0,h.cR)(this);(0,p.EE)(p.NO.service_selection,p.ir.service_selection.add_to_filters,{filterType:"index-filters",key:t.name,action:e,filtersLength:(null==n?void 0:n.state.filters.length)||0}),this.setState(Y({},this.isSelected()))})),this.addActivationHandler(this.onActivate.bind(this))}}J(Z,"Component",(({model:e})=>{const{value:t,included:n}=e.useState(),r=(0,c.useStyles2)(ee);return s().createElement("span",{className:r.wrapper},s().createElement(c.Button,{tooltip:!0===n?`Remove ${t} from filters`:`Add ${t} to filters`,variant:"secondary",fill:"outline",size:"sm","aria-selected":!0===n,className:r.includeButton,onClick:()=>!0===n?e.onClick("clear"):e.onClick("include"),"data-testid":v.b.exploreServiceDetails.buttonFilterInclude},n?"Remove":"Include"))}));const ee=()=>({container:(0,r.css)({display:"flex",justifyContent:"center"}),includeButton:(0,r.css)({borderRadius:0}),wrapper:(0,r.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignSelf:"center"})});var te=n(7796);function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class re extends o.Bs{}function ae(e){return{icon:(0,r.css)({color:e.colors.text.disabled,marginLeft:e.spacing.x1}),searchPageCountWrap:(0,r.css)({display:"flex",alignItems:"center"}),select:(0,r.css)({maxWidth:"65px",marginLeft:e.spacing(1),marginRight:e.spacing(1)}),searchFieldPlaceholderText:(0,r.css)({fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.disabled,alignItems:"center",display:"flex",flex:"1 0 auto",textWrapMode:"nowrap"})}}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ie(e,t,n[t])}))}return e}function le(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}ne(re,"PageCount",(({model:e,totalCount:t})=>{const n=(0,c.useStyles2)(ae),r=o.jh.getAncestor(e,ge),{countPerPage:a}=r.useState(),l=function(e){const t=20,n=60,r=Math.ceil(e/t)*t,a=[];for(let i=t;i<=n&&i<=r;i+=t){let n=i.toString();i<t?n=i.toString():i>e&&(n=e.toString()),a.push({value:i.toString(),label:n})}return a}(t);return(0,i.useEffect)((()=>{var e,t;const n=null!==(t=null===(e=l[l.length-1])||void 0===e?void 0:e.value)&&void 0!==t?t:a.toString();a.toString()>n&&r.setState({countPerPage:parseInt(n,10)})}),[a,l,r]),s().createElement("span",{className:n.searchPageCountWrap},s().createElement("span",{className:n.searchFieldPlaceholderText},"Showing"," ",s().createElement(c.Select,{className:n.select,onChange:e=>{if(e.value){const t=parseInt(e.value,10);r.setState({countPerPage:t,currentPage:1}),r.updateBody(),(0,u.uF)(t)}},options:l,value:a.toString()})," ","of ",t," ",s().createElement(c.IconButton,{className:n.icon,"aria-label":"Count info",name:"info-circle",tooltip:`${t} labels have values for the selected time range. Total label count may differ`})))})),ne(re,"Component",(({model:e,totalCount:t})=>{const n=o.jh.getAncestor(e,ge),{countPerPage:a,currentPage:i}=n.useState(),l=(0,c.useStyles2)((e=>({pagination:(0,r.css)({float:"none"}),paginationWrap:(0,r.css)({[e.breakpoints.up("lg")]:{display:"none"},[e.breakpoints.down("lg")]:{display:"flex",justifyContent:"flex-end",flex:"1 0 auto"}}),paginationWrapMd:(0,r.css)({[e.breakpoints.down("lg")]:{display:"none"},[e.breakpoints.up("lg")]:{display:"flex",justifyContent:"flex-end",flex:"1 0 auto"}})})));return t>a?s().createElement(s().Fragment,null,s().createElement("span",{className:l.paginationWrapMd},s().createElement(c.Pagination,{className:l.pagination,currentPage:i,numberOfPages:Math.ceil(t/a),onNavigate:e=>{n.setState({currentPage:e}),n.updateBody()}})),s().createElement("span",{className:l.paginationWrap},s().createElement(c.Pagination,{showSmallVersion:!0,className:l.pagination,currentPage:i,numberOfPages:Math.ceil(t/a),onNavigate:e=>{n.setState({currentPage:e}),n.updateBody()}}))):null}));const oe=T.config.featureToggles.exploreLogsAggregatedMetrics,ce="__aggregated_metric__",ue=(0,l.dateTime)("2024-08-30","YYYY-MM-DD");const de="var-primary_label",pe="var-ds";class ge extends o.Bs{getUrlState(){const{key:e}=he(),t=(0,h.El)(this).state.filters[0];return t.key&&t.key!==e&&(0,h.El)(this).setState({filters:[le(se({},t),{key:null!=e?e:t.key})]}),{}}updateFromUrl(e){}addDatasourceChangeToBrowserHistory(e){const t=T.locationService.getLocation(),n=new URLSearchParams(t.search),r=n.get(pe);if(r&&e!==r){const r=t.pathname+t.search;n.set(pe,e);const a=t.pathname+"?"+n.toString();r!==a&&(0,g.ad)(a)}}addLabelChangeToBrowserHistory(e,t=!1){const{key:n,search:r,location:a}=he();if(n){const i=null==n?void 0:n.split("|");if((null==i?void 0:i[0])!==e){i[0]=e,r.set(de,i.join("|"));const n=a.pathname+a.search,s=a.pathname+"?"+r.toString();n!==s&&(t?T.locationService.replace(s):(0,g.ad)(s))}}}getSelectedTab(){var e;return null===(e=(0,h.El)(this).state.filters[0])||void 0===e?void 0:e.key}selectDefaultLabelTab(){this.addLabelChangeToBrowserHistory(d.OX,!0),this.setSelectedTab(d.OX)}setSelectedTab(e){(0,u.cO)((0,h.S9)(this).getValue().toString(),e),(0,h.h)(this),(0,h.BL)(e,this)}buildServiceLayout(e,t,n,r,a,i){var s;let u;n.to.diff(n.from,"hours")>=4&&n.to.diff(n.from,"hours")<=26&&(u="2h");const p=[];var g;this.isAggregatedMetricsActive()||p.push(new Z({name:e,value:t})),p.push(new y({labelValue:t,labelName:e}));const h=o.d0.timeseries().setTitle(t).setData((0,E.rS)([(0,x.l)(this.getMetricExpression(t,r,a),{legendFormat:`{{${d.e4}}}`,splitDuration:u,refId:`ts-${t}`,step:r.state.value===ce?"10s":void 0})],{runQueriesMode:"manual"})).setCustomFieldConfig("stacking",{mode:c.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",c.DrawStyle.Bars).setUnit("short").setOverrides(E.jC).setOption("legend",{showLegend:!0,calcs:["sum"],placement:"right",displayMode:c.LegendDisplayMode.Table}).setHeaderActions([new K.p({ds:null!==(g=null===(s=i.getValue())||void 0===s?void 0:s.toString())&&void 0!==g?g:"",labelName:e,labelValue:t}),...p]).build();h.setState({extendPanelContext:(n,r)=>this.extendTimeSeriesLegendBus(e,t,r,h)});const f=new o.xK({$behaviors:[new o.Gg.K2({key:"serviceCrosshairSync",sync:l.DashboardCursorSync.Crosshair})],body:h});return f.addActivationHandler((()=>{var e;(null===(e=(0,U.oh)(f)[0].state.data)||void 0===e?void 0:e.state)!==l.LoadingState.Done&&this.runPanelQuery(f)})),f}isAggregatedMetricsActive(){const e=this.getQueryOptionsToolbar();return!(null==e?void 0:e.state.options.aggregatedMetrics.disabled)&&(null==e?void 0:e.state.options.aggregatedMetrics.active)}formatPrimaryLabelForUI(){const e=this.getSelectedTab();return e===d.OX?d.ky:e}setVolumeQueryRunner(){this.setState({$data:(0,E.HF)({queries:[(0,x.$k)(`{${d.kl}, ${d.ll}}`,"volume",this.getSelectedTab())],runQueriesMode:"manual"})}),this.subscribeToVolume()}doVariablesNeedSync(){const e=(0,h.cR)(this),t=(0,h.aW)(this),n=this.getSelectedTab(),r=e.state.filters.filter((e=>e.key!==n));return{filters:r,needsSync:!(0,_.B)(r,t.state.filters)}}syncVariables(){const e=(0,h.aW)(this),{filters:t,needsSync:n}=this.doVariablesNeedSync();n&&e.setState({filters:t})}onActivate(){var e;this.fixRequiredUrlParams(),this.syncVariables(),this.setVolumeQueryRunner(),this.subscribeToPrimaryLabelsVariable(),this.subscribeToLabelFilterChanges(),this.subscribeToActiveTabVariable((0,h.El)(this)),(null===(e=this.state.$data.state.data)||void 0===e?void 0:e.state)!==l.LoadingState.Done&&this.runVolumeOnActivate(),this.subscribeToTimeRange(),this.subscribeToDatasource(),this.subscribeToAggregatedMetricToggle(),this.subscribeToAggregatedMetricVariable()}runVolumeOnActivate(){var e,t;this.isTimeRangeTooEarlyForAggMetrics()?(this.onUnsupportedAggregatedMetricTimeRange(),(null===(e=this.state.$data.state.data)||void 0===e?void 0:e.state)!==l.LoadingState.Done&&this.runVolumeQuery()):(this.onSupportedAggregatedMetricTimeRange(),(null===(t=this.state.$data.state.data)||void 0===t?void 0:t.state)!==l.LoadingState.Done&&this.runVolumeQuery())}subscribeToAggregatedMetricToggle(){var e;this._subs.add(null===(e=this.getQueryOptionsToolbar())||void 0===e?void 0:e.subscribeToState(((e,t)=>{e.options.aggregatedMetrics.userOverride!==t.options.aggregatedMetrics.userOverride&&this.runVolumeQuery(!0)})))}subscribeToDatasource(){this._subs.add((0,h.S9)(this).subscribeToState((e=>{this.addDatasourceChangeToBrowserHistory(e.value.toString()),this.runVolumeQuery()})))}subscribeToActiveTabVariable(e){this._subs.add(e.subscribeToState(((e,t)=>{if(e.filterExpression!==t.filterExpression){const t=e.filters[0].key;this.addLabelChangeToBrowserHistory(t);const{needsSync:n}=this.doVariablesNeedSync();n?this.syncVariables():this.runVolumeQuery(!0)}})))}subscribeToAggregatedMetricVariable(){this._subs.add((0,h.vm)(this).subscribeToState(((e,t)=>{e.value!==t.value&&(this.setState({body:new o.gF({children:[]})}),this.updateBody(!0))})))}subscribeToPrimaryLabelsVariable(){const e=(0,h.cR)(this);this._subs.add(e.subscribeToState(((e,t)=>{(0,_.B)(e.filters,t.filters)||this.syncVariables()})))}subscribeToLabelFilterChanges(){const e=(0,h.aW)(this);this._subs.add(e.subscribeToState(((e,t)=>{(0,_.B)(e.filters,t.filters)||this.runVolumeQuery(!0)})))}subscribeToVolume(){this._subs.add(this.state.$data.subscribeToState(((e,t)=>{var n,r,a;(null===(n=e.data)||void 0===n?void 0:n.state)!==l.LoadingState.Done||(0,_.B)(null==t||null===(r=t.data)||void 0===r?void 0:r.series,null==e||null===(a=e.data)||void 0===a?void 0:a.series)||this.updateBody(!0)})))}subscribeToTimeRange(){this._subs.add(o.jh.getTimeRange(this).subscribeToState((()=>{this.isTimeRangeTooEarlyForAggMetrics()?this.onUnsupportedAggregatedMetricTimeRange():this.onSupportedAggregatedMetricTimeRange(),this.runVolumeQuery()})))}fixRequiredUrlParams(){const{key:e}=he();e||this.selectDefaultLabelTab()}isTimeRangeTooEarlyForAggMetrics(){return o.jh.getTimeRange(this).state.value.from.isBefore((0,l.dateTime)(ue))}onUnsupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:le(se({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!0})}})}getQueryOptionsToolbar(){return o.jh.getAncestor(this,$.P).state.controls.find((e=>e instanceof N.s))}onSupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:le(se({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!1})}})}runVolumeQuery(e=!1){e&&this.setVolumeQueryRunner(),this.updateAggregatedMetricVariable(),this.state.$data.runQueries()}updateAggregatedMetricVariable(){const e=(0,h.vm)(this),t=(0,h.cR)(this);if(this.isTimeRangeTooEarlyForAggMetrics()&&oe||!this.isAggregatedMetricsActive()){e.changeValueTo(d.OX),t.setState({hide:D.zL.dontHide}),e.changeValueTo(d.OX);o.jh.findByKeyAndType(this,$.y,te.H).setState({hidden:!1})}else{e.changeValueTo(ce),t.setState({hide:D.zL.hideVariable,filters:[]});o.jh.findByKeyAndType(this,$.y,te.H).setState({hidden:!0})}}updateTabs(){if(!this.state.tabs){const e=new H({});this.setState({tabs:e})}}getGridItems(){return this.state.body.state.children}getVizPanel(e){return e.state.body instanceof o.Eb?e.state.body:void 0}runPanelQuery(e){if(e.isActive){const n=(0,U.oh)(e);if(1===n.length){var t;const e=n[0],r=e.state.queries[0],a=null===(t=e.state.data)||void 0===t?void 0:t.timeRange,i=o.jh.getTimeRange(this),s=a?Math.abs(i.state.value.from.diff(null==a?void 0:a.from,"s")):1/0,l=a?Math.abs(i.state.value.to.diff(null==a?void 0:a.to,"s")):1/0,c=o.jh.interpolate(this,r.expr);(e.state.key!==c||s>0||l>0)&&(e.setState({key:c}),e.runQueries())}}}updateBody(e=!1){var t;const{labelsToQuery:n}=this.getLabels(null===(t=this.state.$data.state.data)||void 0===t?void 0:t.series),r=this.getSelectedTab();if(this.updateTabs(),this.state.paginationScene||this.setState({paginationScene:new re({})}),n&&0!==n.length){const t=[],a=this.getGridItems(),i=o.jh.getTimeRange(this).state.value,s=(0,h.vm)(this),l=(0,h.El)(this),c=(0,h.S9)(this),u=(this.state.currentPage-1)*this.state.countPerPage,d=u+this.state.countPerPage;for(const o of n.slice(u,d)){const n=a.filter((e=>{const t=this.getVizPanel(e);return(null==t?void 0:t.state.title)===o}));if(2===n.length)t.push(n[0],n[1]),n[0].isActive&&e&&this.runPanelQuery(n[0]),n[1].isActive&&e&&this.runPanelQuery(n[1]);else{const e=this.buildServiceLayout(r,o,i,s,l,c),n=this.buildServiceLogsLayout(r,o);t.push(e,n)}}this.state.body.setState({children:t,isLazy:!0,templateColumns:"repeat(auto-fit, minmax(350px, 1fr) minmax(300px, calc(70vw - 100px)))",autoRows:"200px",md:{templateColumns:"1fr",rowGap:1,columnGap:1}})}else this.state.body.setState({children:[]})}updateServiceLogs(e,t){var n;if(!this.state.body)return void this.updateBody();const{labelsToQuery:r}=this.getLabels(null===(n=this.state.$data.state.data)||void 0===n?void 0:n.series),a=null==r?void 0:r.indexOf(t);if(void 0===a||a<0)return;let i=[...this.getGridItems()];i.splice(2*a+1,1,this.buildServiceLogsLayout(e,t)),this.state.body.setState({children:i})}getLogExpression(e,t,n){return`{${e}=\`${t}\` , ${d.ll} }${n}`}getMetricExpression(e,t,n){const r=n.state.filters[0];return t.state.value===ce?r.key===d.OX?`sum by (${d.e4}) (sum_over_time({${ce}=\`${e}\` } | logfmt | unwrap count [$__auto]))`:`sum by (${d.e4}) (sum_over_time({${ce}=~\`.+\` } | logfmt | ${r.key}=\`${e}\` | unwrap count [$__auto]))`:`sum by (${d.e4}) (count_over_time({ ${r.key}=\`${e}\`, ${d.ll} } [$__auto]))`}getLabels(e){var t,n,r;const a=null!==(r=null==e||null===(t=e[0])||void 0===t?void 0:t.fields[0].values)&&void 0!==r?r:[],i=null===(n=(0,h.S9)(this).getValue())||void 0===n?void 0:n.toString(),s=(0,h.eY)(this).getValue(),l=this.getSelectedTab(),o=function(e,t,n,r){if(!(null==e?void 0:e.length))return[];".+"===n&&(n="");const a=(0,u.eT)(t,r).filter((t=>t.toLowerCase().includes(n.toLowerCase())&&e.includes(t)));return Array.from(new Set([...a,...e]))}(a,i,String(s),l);return{labelsByVolume:a,labelsToQuery:o}}constructor(e){var t,n;super(se({body:new o.gF({children:[]}),$variables:new o.Pj({variables:[new L.m({name:d.Du,label:"Service",hide:D.zL.hideVariable,skipUrlSync:!0,value:".+"}),new L.m({name:d.Wi,label:"",hide:D.zL.hideLabel,value:d.OX,skipUrlSync:!0,options:[{value:d.OX,label:d.OX},{value:ce,label:ce}]}),new o.H9({name:d.Gb,hide:D.zL.hideLabel,expressionBuilder:e=>function(e){if(e.length){const t=e[0];return`${t.key}${t.operator}\`${t.value}\``}return""}(e),filters:[{key:null!==(t=he().key)&&void 0!==t?t:d.OX,value:".+",operator:"=~"}]}),new o.H9({name:d.fi,datasource:d.eL,layout:"vertical",filters:[],expressionBuilder:x.VW,hide:D.zL.hideVariable,key:"adhoc_service_filter_replica",skipUrlSync:!0})]}),$data:(0,E.HF)({queries:[],runQueriesMode:"manual"}),serviceLevel:new Map,countPerPage:null!==(n=(0,u.KH)())&&void 0!==n?n:20,currentPage:1,showPopover:!1,tabOptions:[{label:d.ky,value:d.OX}]},e)),ie(this,"_urlSync",new o.So(this,{keys:[de]})),ie(this,"onSearchServicesChange",(0,a.debounce)((e=>{const t=(0,h.eY)(this);(e?(0,x.vC)(e):".+")!==t.state.value&&t.setState({value:e?(0,x.vC)(e):".+",label:null!=e?e:""});const n=(0,h.El)(this),r=n.state.filters[0];(0,x.vC)(t.state.value.toString())!==r.value&&n.setState({filters:[le(se({},r),{value:(0,x.vC)(t.state.value.toString())})]}),this.setState({currentPage:1}),(0,p.EE)(p.NO.service_selection,p.ir.service_selection.search_services_changed,{searchQuery:e})}),500)),ie(this,"getLevelFilterForService",(e=>{let t=this.state.serviceLevel.get(e)||[];if(0===t.length)return"";return` | ${t.map((e=>("logs"===e&&(e=""),`${d.e4}=\`${e}\``))).join(" or ")} `})),ie(this,"buildServiceLogsLayout",((e,t)=>{const n=this.getLevelFilterForService(t),r=new o.xK({$behaviors:[new o.Gg.K2({sync:l.DashboardCursorSync.Off})],body:o.d0.logs().setHoverHeader(!0).setData((0,E.rS)([(0,x.l)(this.getLogExpression(e,t,n),{maxLines:100,refId:`logs-${t}`})],{runQueriesMode:"manual"})).setTitle(t).setOption("showTime",!0).setOption("enableLogDetails",!1).build()});return r.addActivationHandler((()=>{var e;(null===(e=(0,U.oh)(r)[0].state.data)||void 0===e?void 0:e.state)!==l.LoadingState.Done&&this.runPanelQuery(r)})),r})),ie(this,"extendTimeSeriesLegendBus",((e,t,n,r)=>{const a=n.onToggleSeriesVisibility;n.onToggleSeriesVisibility=(n,i)=>{var s,l,o;null==a||a(n,i);const c=(0,j.vX)(null!==(o=null===(l=r.state.$data)||void 0===l||null===(s=l.state.data)||void 0===s?void 0:s.series)&&void 0!==o?o:[]),u=(0,j.pC)(n,this.state.serviceLevel.get(t),i,c);this.state.serviceLevel.set(t,u),this.updateServiceLogs(e,t)}})),this.addActivationHandler(this.onActivate.bind(this))}}function he(){const e=T.locationService.getLocation(),t=new URLSearchParams(e.search),n=t.get(de),r=null==n?void 0:n.split("|");return{key:null==r?void 0:r[0],search:t,location:e}}function fe(e){return{container:(0,r.css)({display:"flex",flexDirection:"column",flexGrow:1,position:"relative"}),headingWrapper:(0,r.css)({marginTop:e.spacing(1)}),loadingText:(0,r.css)({margin:0}),header:(0,r.css)({position:"absolute",right:0,top:"4px",zIndex:2}),bodyWrapper:(0,r.css)({flexGrow:1,display:"flex",flexDirection:"column"}),body:(0,r.css)({flexGrow:1,display:"flex",flexDirection:"column"}),searchPaginationWrap:(0,r.css)({label:"search-pagination-wrap",display:"flex",alignItems:"center",flexWrap:"wrap",flex:"1 0 auto",[e.breakpoints.down("md")]:{marginTop:e.spacing(1),width:"100%"}}),searchWrapper:(0,r.css)({label:"search-wrapper",display:"flex",alignItems:"center",flexWrap:"wrap",[e.breakpoints.down("md")]:{flexDirection:"column",alignItems:"flex-start"}}),searchField:(0,r.css)({marginTop:e.spacing(1),position:"relative"})}}ie(ge,"Component",(({model:e})=>{var t;const n=(0,c.useStyles2)(fe),{body:r,$data:a,tabs:i,paginationScene:o}=e.useState(),{data:u}=a.useState(),d=e.getSelectedTab(),p=(0,h.eY)(e),{label:f,value:v}=p.useState(),m=v&&".+"!==v,{labelsByVolume:b,labelsToQuery:y}=e.getLabels(null==u?void 0:u.series),O=(null==u?void 0:u.state)===l.LoadingState.Loading||(null==u?void 0:u.state)===l.LoadingState.Streaming||void 0===u,E=(null===(t=a.state.data)||void 0===t?void 0:t.state)===l.LoadingState.Error,C=e.formatPrimaryLabelForUI();let j=p.getValue().toString();".+"===j&&(j="");const L=(0,x.sT)(j);var _;return s().createElement("div",{className:n.container},s().createElement("div",{className:n.bodyWrapper},i&&s().createElement(i.Component,{model:i}),s().createElement(c.Field,{className:n.searchField},s().createElement("div",{className:n.searchWrapper},s().createElement(F.f,{initialFilter:{label:L,value:j,icon:"filter"},isLoading:O,value:j||f,onChange:t=>(t=>{e.onSearchServicesChange(t)})(t),selectOption:t=>{!function(e,t,n){const r=w(e,t,n);S(e,t,n),(0,g.ad)(r)}(d,t,e)},label:C,options:null!==(_=null==y?void 0:y.map((e=>({value:e,label:e}))))&&void 0!==_?_:[]}),!O&&s().createElement("span",{className:n.searchPaginationWrap},o&&s().createElement(re.PageCount,{model:o,totalCount:y.length}),o&&s().createElement(re.Component,{model:o,totalCount:y.length})))),!O&&E&&s().createElement(P,null),!O&&!E&&m&&!(null==b?void 0:b.length)&&s().createElement(k,null),!O&&!E&&!m&&!(null==b?void 0:b.length)&&s().createElement(G,{labelName:d}),!(!O&&E)&&s().createElement("div",{className:n.body},s().createElement(r.Component,{model:r}),s().createElement("div",{className:n.headingWrapper},o&&s().createElement(re.Component,{totalCount:y.length,model:o})))))}))},9641:(e,t,n)=>{n.d(t,{C:()=>s});var r=n(5959),a=n.n(r),i=n(2007);function s(e){return a().createElement(i.RadioButtonGroup,{options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:e.vizType,onChange:e.onChange})}},4702:(e,t,n)=>{n.d(t,{m:()=>s});var r=n(1269),a=n(9736);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class s extends a.n8{getValueOptions(e){return(0,r.of)(this.state.options)}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({type:"custom",value:"",text:"",options:[],name:""},e))}}i(s,"Component",(({model:e})=>(0,a.WY)({model:e})))},6464:(e,t,n)=>{n.d(t,{K:()=>g});var r=n(9736),a=n(6854),i=n(3241),s=n(20),l=n(5553),o=n(708),c=n(8428),u=n(4351);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){d(e,t,n[t])}))}return e}class g{getJoinedLabelsFilters(){let{equalsFilters:e,notEqualsFilters:t,regexEqualFilters:n,regexNotEqualFilters:r}=this.getCombinedLabelFilters();const a=[];return[e,t,n,r].filter((e=>e)).forEach((e=>{const t=this.joinCombinedFiltersValues(e,"|");for(const n in e){const r=e[n].operator;a.push({key:n,operator:r,value:t[n]})}})),a}getExpr(){let{equalsFilters:e,notEqualsFilters:t,regexEqualFilters:n,regexNotEqualFilters:r,ltFilters:a,lteFilters:i,gtFilters:s,gteFilters:l}=this.getCombinedLabelFilters();this.options.debug;const o=this.buildLabelsLogQLFromFilters({equalsFilters:e,notEqualsFilters:t,regexEqualFilters:n,regexNotEqualFilters:r,ltFilters:a,lteFilters:i,gtFilters:s,gteFilters:l});var c;return o?(null!==(c=this.options.prefix)&&void 0!==c?c:"")+o:""}getLabelsExpr(e){return this.options=p({},{joinMatchFilters:!0,decodeFilters:!1,filterType:"indexed"},e),this.getExpr()}getMetadataExpr(e){return this.options=p({},{filterSeparator:" |",prefix:"| ",joinMatchFilters:!1,decodeFilters:!1,filterType:"field"},e),this.getExpr()}getLevelsExpr(e){return this.options=p({},{filterSeparator:" |",prefix:"| ",joinMatchFilters:!1,decodeFilters:!1,filterType:"field"},e),this.getExpr()}getFieldsExpr(e){return this.options=p({},{filterSeparator:" |",prefix:"| ",joinMatchFilters:!1,decodeFilters:!0,filterType:"field"},e),this.getExpr()}buildLabelsLogQLFromFilters({equalsFilters:e,notEqualsFilters:t,regexEqualFilters:n,regexNotEqualFilters:r,ltFilters:s,lteFilters:l,gtFilters:o,gteFilters:c}){let u,d,p,g,h,f,v,m;const b=[];var y;this.options.joinMatchFilters?(u=this.joinCombinedFiltersValues(e,"|"),d=this.joinCombinedFiltersValues(t,"|"),p=this.joinCombinedFiltersValues(n,"|"),g=this.joinCombinedFiltersValues(r,"|"),b.push(...this.buildJoinedFilters(u,a.KQ.Equal)),b.push(...this.buildJoinedFilters(d,a.KQ.NotEqual)),b.push(...this.buildJoinedFilters(p,a.KQ.RegexEqual)),b.push(...this.buildJoinedFilters(g,a.KQ.RegexNotEqual))):(u=this.getFilterValues(e),d=this.getFilterValues(t),p=this.getFilterValues(n),g=this.getFilterValues(r),b.push(...this.buildFilter(u,a.KQ.Equal)),b.push(...this.buildFilter(d,a.KQ.NotEqual)),b.push(...this.buildFilter(p,a.KQ.RegexEqual)),b.push(...this.buildFilter(g,a.KQ.RegexNotEqual))),h=this.getFilterValues(s),f=this.getFilterValues(l),v=this.getFilterValues(o),m=this.getFilterValues(c),b.push(...this.buildFilter(h,a.Rk.lt)),b.push(...this.buildFilter(f,a.Rk.lte)),b.push(...this.buildFilter(v,a.Rk.gt)),b.push(...this.buildFilter(m,a.Rk.gte)),this.options.debug;const S=(0,i.trim)(this.combineValues(b,`${null!==(y=this.options.filterSeparator)&&void 0!==y?y:","} `));return this.options.debug,S}getCombinedLabelFilters(){const{[a.KQ.Equal]:e,[a.KQ.NotEqual]:t,[a.KQ.RegexEqual]:n,[a.KQ.RegexNotEqual]:r,[a.Rk.lt]:i,[a.Rk.lte]:s,[a.Rk.gt]:l,[a.Rk.gte]:o}=this.groupFiltersByKey(this.filters);let c,u,d,p,g,h,f,v;return this.options.joinMatchFilters?(c=this.combineFiltersValues(e,a.KQ.RegexEqual),u=this.combineFiltersValues(t,a.KQ.RegexNotEqual),d=this.combineFiltersValues(n),p=this.combineFiltersValues(r)):(c=this.combineFiltersValues(e),u=this.combineFiltersValues(t),d=this.combineFiltersValues(n),p=this.combineFiltersValues(r)),g=this.combineFiltersValues(i),h=this.combineFiltersValues(s),f=this.combineFiltersValues(l),v=this.combineFiltersValues(o),this.options.debug,this.options.joinMatchFilters&&(c&&(d=this.mergeFilters(a.KQ.RegexEqual,c,d),c=this.removeStaleOperators(c,a.KQ.Equal)),u&&(p=this.mergeFilters(a.KQ.RegexNotEqual,u,p),u=this.removeStaleOperators(u,a.KQ.NotEqual))),{equalsFilters:c,notEqualsFilters:u,regexEqualFilters:d,regexNotEqualFilters:p,ltFilters:g,lteFilters:h,gtFilters:f,gteFilters:v}}buildFilter(e,t){const n=[];for(const r in e){const a=[],i=e[r];(0,o.iu)(t)?i.forEach((e=>a.push(this.buildFilterString(r,t,e,"")))):i.forEach((e=>a.push(this.buildFilterString(r,t,e)))),(0,o.BG)(t)?n.push(a.join(` ${this.positiveFilterValueSeparator} `)):n.push(a.join(` ${this.negativeFilterValueSeparator} `))}return n}buildJoinedFilters(e,t){const n=[];for(const r in e)n.push(this.buildFilterString(r,t,e[r]));return n}removeStaleOperators(e,t){const n={};return Object.keys(e).forEach((r=>{e[r].operator===t&&(n[r]=e[r])})),n}mergeFilters(e,t,n){return Object.keys(t).filter((n=>t[n].operator===e)).map((e=>({values:t[e].values,key:e}))).forEach((r=>{void 0===n&&(n={[r.key]:{values:[],operator:e}}),void 0===n[r.key]&&(n[r.key]={values:[],operator:e}),n[r.key].values.push(...this.mergeCombinedFiltersValues(t[r.key],e))})),n}mergeCombinedFiltersValues(e,t){var n;const r=[];return e.operator===t&&(null===(n=e.values)||void 0===n?void 0:n.length)&&r.push(...e.values),r}joinCombinedFiltersValues(e,t){const n={};for(const r in e)e[r].values.length&&(n[r]=this.combineValues(e[r].values,t));return n}getFilterValues(e){const t={};for(const n in e)e[n].values.length&&(t[n]=e[n].values);return t}combineValues(e,t){return e.join(`${t}`)}combineFiltersValues(e,t){let n={};for(const i in e){if(!e[i].length)continue;const s=(0,c.kR)(e[i][0].operator),l=null!=t?t:s,o=e[i][0];if(n[i]={values:[],operator:l},1===e[i].length){var r;const e=this.escapeFieldValue(o.operator,o.value,null!==(r=o.valueLabels)&&void 0!==r?r:[]);n[i]={operator:s,values:[e]},this.options.debug}else{const t=this.escapeFieldValues(i,e,l);var a;if(void 0===n[i].operator)n[i]={operator:l,values:t};else null===(a=n[i].values)||void 0===a||a.push(...t)}}return n}escapeFieldValues(e,t,n){return t[e].map((e=>{var t;return this.escapeFieldValue(n,e.value,null!==(t=e.valueLabels)&&void 0!==t?t:[])}))}escapeFieldValue(e,t,n){const a=(0,s.zE)(t);if(this.options.decodeFilters){t=(0,l.bu)({value:t,valueLabels:n}).value}return t===s.ZO?(this.options.debug,t):a?(this.options.debug,r.Go.escapeLabelValueInExactSelector((0,s.Dx)(t))):(0,o.SM)(e)?(this.options.debug,r.Go.escapeLabelValueInRegexSelector(t)):(this.options.debug,r.Go.escapeLabelValueInExactSelector(t))}buildFilterString(e,t,n,r='"'){if(n===s.ZO)return`${e}${t}${n}`;const a=`${e}${t}${r}${n}${r}`;return this.options.debug,a}groupFiltersByKey(e){let t=e.filter((e=>{var t;return!(null===(t=this.options.ignoreKeys)||void 0===t?void 0:t.includes(e.key))||(0,o.SM)(e.operator)}));"indexed"===this.options.filterType&&t.length<1&&(t=e);const n=t.filter((e=>(0,o.BG)(e.operator)&&!(0,o.SM)(e.operator))),r=t.filter((e=>(0,o.BG)(e.operator)&&(0,o.SM)(e.operator))),s=t.filter((e=>(0,o.Lw)(e.operator)&&!(0,o.SM)(e.operator))),l=t.filter((e=>(0,o.Lw)(e.operator)&&(0,o.SM)(e.operator))),c=t.filter((e=>e.operator===a.w7.gt)),u=t.filter((e=>e.operator===a.w7.gte)),d=t.filter((e=>e.operator===a.w7.lt)),p=t.filter((e=>e.operator===a.w7.lte)),g=(0,i.groupBy)(n,(e=>e.key)),h=(0,i.groupBy)(r,(e=>e.key)),f=(0,i.groupBy)(s,(e=>e.key)),v=(0,i.groupBy)(l,(e=>e.key)),m=(0,i.groupBy)(c,(e=>e.key)),b=(0,i.groupBy)(u,(e=>e.key)),y=(0,i.groupBy)(d,(e=>e.key)),S=(0,i.groupBy)(p,(e=>e.key));return{[a.w7.Equal]:g,[a.w7.RegexEqual]:h,[a.w7.NotEqual]:f,[a.w7.RegexNotEqual]:v,[a.w7.gt]:m,[a.w7.gte]:b,[a.w7.lt]:y,[a.w7.lte]:S}}constructor(e,t={joinMatchFilters:!0,decodeFilters:!1,filterType:"field"}){d(this,"filters",void 0),d(this,"options",void 0),d(this,"positiveFilterValueSeparator","or"),d(this,"negativeFilterValueSeparator","|"),this.filters=e,this.options=t,this.options.debug||(this.options.debug=(0,u.Rb)())}}},4509:(e,t,n)=>{n.d(t,{EE:()=>i,NO:()=>s,ir:()=>l});var r=n(8531),a=n(2533);const i=(e,t,n)=>{(0,r.reportInteraction)(((e,t)=>`${a.id.replace(/-/g,"_")}_${e}_${t}`)(e,t),n)},s={service_selection:"service_selection",service_details:"service_details",all:"all"},l={[s.service_selection]:{search_services_changed:"search_services_changed",service_selected:"service_selected",aggregated_metrics_toggled:"aggregated_metrics_toggled",add_to_filters:"add_to_filters"},[s.service_details]:{open_in_explore_clicked:"open_in_explore_clicked",action_view_changed:"action_view_changed",add_to_filters_in_breakdown_clicked:"add_to_filters_in_breakdown_clicked",select_field_in_breakdown_clicked:"select_field_in_breakdown_clicked",level_in_logs_volume_clicked:"level_in_logs_volume_clicked",label_in_panel_summary_clicked:"label_in_panel_summary_clicked",layout_type_changed:"layout_type_changed",search_string_in_logs_changed:"search_string_in_logs_changed",search_string_in_variables_changed:"search_string_in_variables_changed",pattern_removed:"pattern_removed",pattern_selected:"pattern_selected",pattern_field_clicked:"pattern_field_clicked",logs_visualization_toggle:"logs_visualization_toggle",logs_detail_filter_applied:"logs_detail_filter_applied",logs_popover_line_filter:"logs_popover_line_filter",logs_toggle_displayed_field:"logs_toggle_displayed_field",logs_clear_displayed_fields:"logs_clear_displayed_fields",value_breakdown_sort_change:"value_breakdown_sort_change",wasm_not_supported:"wasm_not_supported",change_viz_type:"change_viz_type"},[s.all]:{interval_too_long:"interval_too_long",open_in_explore_menu_clicked:"open_in_explore_menu_clicked"}}},1532:(e,t,n)=>{n.d(t,{B:()=>i,n:()=>s});var r=n(3241),a=n.n(r);const i=(e,t)=>{if(typeof e!=typeof t)return!1;const n=new Set(e),r=new Set(t);return n.size===r.size&&a().isEqual(n,r)},s=(e,t)=>typeof e==typeof t&&a().isEqual(e,t)},8955:(e,t,n)=>{n.r(t),n.d(t,{DETECTED_FIELDS_CARDINALITY_NAME:()=>G,DETECTED_FIELDS_NAME_FIELD:()=>K,DETECTED_FIELDS_PARSER_NAME:()=>U,DETECTED_FIELDS_TYPE_NAME:()=>q,WRAPPED_LOKI_DS_UID:()=>Q,WrappedLokiDatasource:()=>J,default:()=>Y});var r=n(7781),a=n(8531),i=n(9736),s=n(1269),l=n(5719),o=n(8502),c=n(20),u=n(2533),d=n(5745),p=n(2344),g=n(3257);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){h(e,t,n[t])}))}return e}function v(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function m(e){return e.trim().length>2&&!function(e,t){let n=!1;return p.K3.parse(e).iterate({enter:({type:e})=>{if(e.id===t)return n=!0,!1}}),n}(e,p.Yw)}function b(e){if(function(e){return void 0!==e.targets.find((e=>m(e.expr)))}(e))return!1;if(function(e){return e.targets.find((e=>"instant"===e.queryType))}(e))return!1;for(let n=0;n<e.targets.length;n++){var t;if(null===(t=e.targets[n].expr)||void 0===t?void 0:t.includes("avg_over_time"))return!1}return!0}const y="__stream_shard_number__",S=e=>e.replace("}",`, __stream_shard__=~"${y}"}`),w=(e,t)=>{if(void 0===t||0===t.length)return e.map((e=>v(f({},e),{expr:e.expr.replace(`, __stream_shard__=~"${y}"}`,"}")})));let n=t.join("|");return"-1"===n||1===t.length?(n="-1"===n?"":n,e.map((e=>v(f({},e),{expr:e.expr.replace(`, __stream_shard__=~"${y}"}`,`, __stream_shard__="${n}"}`)})))):e.map((e=>v(f({},e),{expr:e.expr.replace(new RegExp(`${y}`,"g"),n)})))};var O=n(5953);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}function C(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function P(e,t){if(!e)return C(E({},n=t),{data:n.data.map(T)});var n,a,i;t.data.forEach((t=>{const n=e.data.find((e=>function(e,t){var n,a,i,s,l,o;if(e.refId!==t.refId)return!1;if(null!=e.name&&null!=t.name&&e.name!==t.name)return!1;const c=null===(n=e.meta)||void 0===n?void 0:n.type,u=null===(a=t.meta)||void 0===a?void 0:a.type;if(c!==u)return!1;if(c===r.DataFrameType.TimeSeriesMulti)return function(e,t){const n=e.fields.find((e=>e.type===r.FieldType.number)),a=t.fields.find((e=>e.type===r.FieldType.number));if(void 0===n||void 0===a)return!1;null==e.name&&(e.name=JSON.stringify(n.labels));null==t.name&&(t.name=JSON.stringify(a.labels));return e.name===t.name}(e,t);const d=null===(s=e.meta)||void 0===s||null===(i=s.custom)||void 0===i?void 0:i.frameType,p=null===(o=t.meta)||void 0===o||null===(l=o.custom)||void 0===l?void 0:l.frameType;if("LabeledTimeValues"===d&&"LabeledTimeValues"===p)return!0;if(d===p)return!0;return!1}(e,t)));n?function(e,t){var n,a;const i=e.fields.find((e=>e.type===r.FieldType.time)),s=e.fields.find((e=>e.type===r.FieldType.string&&"id"===e.name)),l=t.fields.find((e=>e.type===r.FieldType.time)),o=t.fields.find((e=>e.type===r.FieldType.string&&"id"===e.name));if(!i||!l)return void O.v.error(new Error("Time fields not found in the data frames"));var c;const u=null!==(c=null==l?void 0:l.values.slice(0))&&void 0!==c?c:[],d=Math.max(e.fields.length,t.fields.length);for(let n=0;n<u.length;n++){const a=k(i,l,n),c=j(i,s,a,l,o,n);for(let i=0;i<d;i++){if(!e.fields[i])continue;const s=F(e.fields[i],t.fields,i);if(s)if(c){if(e.fields[i].type===r.FieldType.time)continue;var p;e.fields[i].type===r.FieldType.number?e.fields[i].values[a]=(null!==(p=e.fields[i].values[a])&&void 0!==p?p:0)+s.values[n]:e.fields[i].type===r.FieldType.other?"object"==typeof s.values[n]?e.fields[i].values[a]=E({},e.fields[i].values[a],s.values[n]):null!=s.values[n]&&(e.fields[i].values[a]=s.values[n]):e.fields[i].values[a]=s.values[n]}else if(void 0!==s.values[n]){var g,h;if(e.fields[i].values.splice(a,0,s.values[n]),s.nanos)e.fields[i].nanos=null!==(h=e.fields[i].nanos)&&void 0!==h?h:new Array(e.fields[i].values.length-1).fill(0),null===(g=e.fields[i].nanos)||void 0===g||g.splice(a,0,s.nanos[n])}}}var f,v;e.length=e.fields[0].values.length,e.meta=C(E({},e.meta),{stats:_(null!==(f=null===(n=e.meta)||void 0===n?void 0:n.stats)&&void 0!==f?f:[],null!==(v=null===(a=t.meta)||void 0===a?void 0:a.stats)&&void 0!==v?v:[])})}(n,t):e.data.push(T(t))}));const s=[...null!==(a=e.errors)&&void 0!==a?a:[],...null!==(i=t.errors)&&void 0!==i?i:[]];var l;s.length>0&&(e.errors=s);const o=null!==(l=e.error)&&void 0!==l?l:t.error;var c,u;null!=o&&(e.error=o);const d=[...null!==(c=e.traceIds)&&void 0!==c?c:[],...null!==(u=t.traceIds)&&void 0!==u?u:[]];return d.length>0&&(e.traceIds=d),e}function k(e,t,n){const a=(0,r.closestIdx)(t.values[n],e.values);return a<0?0:t.values[n]===e.values[a]&&null!=t.nanos&&null!=e.nanos?t.nanos[n]>e.nanos[a]?a+1:a:t.values[n]>e.values[a]?a+1:a}function j(e,t,n,r,a,i){const s=function(e,t,n,r){if(e.nanos&&n.nanos)return void 0!==e.values[t]&&e.values[t]===n.values[r]&&void 0!==e.nanos[t]&&e.nanos[t]===n.nanos[r];return void 0!==e.values[t]&&e.values[t]===n.values[r]}(e,n,r,i);return!!s&&(null==t||null==a||void 0!==t.values[n]&&t.values[n]===a.values[i])}function F(e,t,n){const r=t.filter((t=>t.name===e.name));return 1===r.length?r[0]:t[n]}const L="Summary: total bytes processed";function _(e,t){const n=e.find((e=>e.displayName===L)),r=t.find((e=>e.displayName===L));if(null!=r&&null!=n)return[{value:r.value+n.value,displayName:L,unit:n.unit}];const a=null!=r?r:n;return null!=a?[a]:[]}function T(e){return C(E({},e),{fields:e.fields.map((e=>C(E({},e),{values:e.values})))})}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){D(e,t,n[t])}))}return e}function $(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function I(e,t){const n=e.interpolateVariablesInQueries(t.targets,t.scopedVars).filter((e=>e.expr)).map((e=>$(N({},e),{expr:S(e.expr)})));return function(e,t,n){let a=!1,i={data:[],state:r.LoadingState.Streaming,key:(0,d.A)()},l=null,o=new Map,c=null;const u=(s,d,p,g)=>{let h=g,f=!1;null!=l&&(l.unsubscribe(),l=null);const v=()=>{i.state=a?r.LoadingState.Error:r.LoadingState.Done,s.next(i),s.complete()};if(a)return void v();const m=()=>{const e=Math.min(d+g,p.length);d<p.length&&e<=p.length?u(s,e,p,h):v()},b=e=>{try{if(e&&!function(e){var t,n,r;const a=e.errors?(null!==(n=e.errors[0].message)&&void 0!==n?n:"").toLowerCase():null!==(r=null===(t=e.error)||void 0===t?void 0:t.message)&&void 0!==r?r:"";if(a.includes("timeout"))return!0;if(a.includes("parse error"))throw new Error(a);return!1}(e))return!1}catch(s){var t,n,r,i,l,h;return O.v.error(s,{msg:"sharding retry error",error:null!==(i=null==e||null===(t=e.error)||void 0===t?void 0:t.message)&&void 0!==i?i:"",errors:null!==(l=null==e||null===(n=e.errors)||void 0===n?void 0:n.map((e=>e.message)).join(" | "))&&void 0!==l?l:"",traces:null!==(h=null==e||null===(r=e.traceIds)||void 0===r?void 0:r.join("|"))&&void 0!==h?h:""}),a=!0,!1}if(g>1)return B(`Possible time out, new group size ${g=Math.floor(Math.sqrt(g))}`),f=!0,u(s,d,p,g),!0;var v;const m=null!==(v=o.get(d))&&void 0!==v?v:0;return m>3?(a=!0,!1):(o.set(d,m+1),c=setTimeout((()=>{O.v.info(`Retrying ${d} (${m+1})`),u(s,d,p,g),c=null}),1500*Math.pow(2,m)),f=!0,!0)},y=function(e,t,n){if(t===e.length)return[-1];return e.slice(t,t+n)}(p,d,g);B(`Querying ${y.join(", ")}`);const S=$(N({},t),{targets:w(n,y)});t.requestId&&(S.requestId=`${t.requestId}_shard_${d}_${g}`),l=e.runQuery(S).subscribe({next:e=>{var t;((null!==(t=e.errors)&&void 0!==t?t:[]).length>0||null!=e.error)&&b(e)||(h=function(e,t,n){const r=.7;return Math.min(t,Math.max(Math.floor((n-e)*r),1))}(d+g,function(e,t){var n,r;if(!e.data.length)return t+1;const a=null===(r=e.data[0].meta)||void 0===r||null===(n=r.stats)||void 0===n?void 0:n.find((e=>"Summary: exec time"===e.displayName));if(a){const e=Math.round(a.value);return B(`${a.value}`),e<=1?Math.floor(1.5*t):e<6?Math.ceil(1.1*t):1===t?t:e<20?Math.ceil(.9*t):Math.floor(t/2)}return t}(e,g),p.length),h!==g&&B(`New group size ${h}`),i=P(i,e))},complete:()=>{f||(i.data.length&&s.next(i),m())},error:e=>{O.v.error(e,{msg:"failed to shard"}),s.next(i),b()||m()}})},h=n=>{l=e.query(t).subscribe({next:e=>{i=e},complete:()=>{n.next(i)},error:e=>{O.v.error(e,{msg:"runNonSplitRequest subscription error"}),n.error(i)}})},f=new s.Observable((r=>{const i=(e=>{const t=(0,g.QH)(e,[p.MD]);return t.length>0?e.substring(t[0].from,t[0].to).replace(`, __stream_shard__=~"${y}"}`,"}"):""})(n[0].expr);return(0,g.T0)(i)?(e.languageProvider.fetchLabelValues("__stream_shard__",{timeRange:t.range,streamSelector:i||void 0}).then((e=>{const t=e.map((e=>parseInt(e,10)));t&&t.length?(t.sort(((e,t)=>t-e)),B(`Querying ${t.join(", ")} shards`),u(r,0,t,function(e){return Math.floor(Math.sqrt(e.length))}(t))):(O.v.warn("Shard splitting not supported. Issuing a regular query."),h(r))})).catch((e=>{O.v.error(e,{msg:"failed to fetch label values for __stream_shard__"}),h(r)})),()=>{a=!0,c&&clearTimeout(c),null!=l&&(l.unsubscribe(),l=null)}):(B(`Skipping invalid selector: ${i}`),void r.complete())}));return f}(e,t,n)}Boolean(localStorage.getItem(`${u.id}.sharding_debug_enabled`));function B(e){}var A=n(9598),M=n(7985);function R(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function V(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){R(i,r,a,s,l,"next",e)}function l(e){R(i,r,a,s,l,"throw",e)}s(void 0)}))}}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){W(e,t,n[t])}))}return e}function H(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Q="wrapped-loki-ds-uid",K="name",G="cardinality",U="parser",q="type";class J extends i.UU{query(e){return new s.Observable((t=>{var n;if(!(null===(n=e.scopedVars)||void 0===n?void 0:n.__sceneObject))throw new Error("Scene object not found in request");var r=this;(0,a.getDataSourceSrv)().get((0,l.U4)(e.scopedVars.__sceneObject.valueOf())).then(function(){var n=V((function*(n){var i;if(!(n instanceof a.DataSourceWithBackend&&"interpolateString"in n&&"getTimeRangeParams"in n))throw new Error("Invalid datasource!");const s=n;e.targets=null===(i=e.targets)||void 0===i?void 0:i.map((e=>(e.datasource=s,e)));const l=new Set;if(e.targets.forEach((e=>{var t;l.add(null!==(t=e.resource)&&void 0!==t?t:"")})),1!==l.size)throw new Error("A request cannot contain queries to multiple endpoints");switch(e.targets[0].resource){case"volume":yield r.getVolume(e,s,t);break;case"patterns":yield r.getPatterns(e,s,t);break;case"detected_labels":yield r.getDetectedLabels(e,s,t);break;case"detected_fields":yield r.getDetectedFields(e,s,t);break;case"labels":yield r.getLabels(e,s,t);break;default:r.getData(e,s,t)}}));return function(e){return n.apply(this,arguments)}}())}))}getData(e,t,n){const r=a.config.featureToggles.exploreLogsShardSplitting,i=H(z({},e),{targets:t.interpolateVariablesInQueries(e.targets,e.scopedVars).map((e=>H(z({},e),{resource:void 0,expr:(0,M.VT)(e.expr)})))});return(!1!==b(i)&&r?I(t,i):t.query(i)).subscribe(n),n}getPatterns(e,t,n){var a=this;return V((function*(){const i=e.targets.filter((e=>"patterns"===e.resource));if(1!==i.length)throw new Error("Patterns query can only have a single target!");const{interpolatedTarget:s,expression:l}=a.interpolate(t,i,e);n.next({data:[],state:r.LoadingState.Loading});try{var o;const a=t.getResource("patterns",{query:l,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString(),step:e.interval},{requestId:null!==(o=e.requestId)&&void 0!==o?o:"patterns",headers:{"X-Query-Tags":`Source=${A.s_}`}}),i=yield a,u=null==i?void 0:i.data;let d=-1/0,p=0;var c;const g=null!==(c=null==u?void 0:u.map((e=>{const t=[],n=[];let a=0;return e.samples.forEach((([e,r])=>{t.push(1e3*e),n.push(r),r>d&&(d=r),r<p&&(p=r),r>d&&(d=r),r<p&&(p=r),a+=r})),(0,r.createDataFrame)({refId:s.refId,name:e.pattern,fields:[{name:"time",type:r.FieldType.time,values:t,config:{}},{name:e.pattern,type:r.FieldType.number,values:n,config:{}}],meta:{preferredVisualisationType:"graph",custom:{sum:a}}})})))&&void 0!==c?c:[];g.sort(((e,t)=>{var n,r,a,i;return(null===(r=t.meta)||void 0===r||null===(n=r.custom)||void 0===n?void 0:n.sum)-(null===(i=e.meta)||void 0===i||null===(a=i.custom)||void 0===a?void 0:a.sum)})),n.next({data:g,state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n}))()}interpolate(e,t,n){const r=e.interpolateVariablesInQueries(t,n.scopedVars);if(!r.length)throw new Error("Datasource failed to interpolate query!");const a=r[0];return{interpolatedTarget:a,expression:(0,M.VT)(a.expr)}}getDetectedLabels(e,t,n){var a=this;return V((function*(){const i=e.targets.filter((e=>"detected_labels"===e.resource));if(1!==i.length)throw new Error("Detected labels query can only have a single target!");let{interpolatedTarget:s,expression:l}=a.interpolate(t,i,e);"{}"===l&&(l=""),n.next({data:[],state:r.LoadingState.Loading});try{var c,u,d;const a=null===(u=(yield t.getResource("detected_labels",{query:l,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(d=e.requestId)&&void 0!==d?d:"detected_labels",headers:{"X-Query-Tags":`Source=${A.s_}`}})).detectedLabels)||void 0===u||null===(c=u.filter((e=>!o.rm.includes(e.label))))||void 0===c?void 0:c.sort(((e,t)=>(0,o.p_)(e,t))),i=null==a?void 0:a.map((e=>({name:e.label,values:[e.cardinality]}))),p=(0,r.createDataFrame)({refId:s.refId,fields:null!=i?i:[]});n.next({data:[p],state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n}))()}getDetectedFields(e,t,n){var a=this;return V((function*(){const i=e.targets.filter((e=>"detected_fields"===e.resource));if(1!==i.length)throw new Error("Detected fields query can only have a single target!");n.next({data:[],state:r.LoadingState.Loading});const{interpolatedTarget:s,expression:l}=a.interpolate(t,i,e);try{var c,u;const a=yield t.getResource("detected_fields",{query:l,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(u=e.requestId)&&void 0!==u?u:"detected_fields",headers:{"X-Query-Tags":`Source=${A.s_}`}}),i={name:K,type:r.FieldType.string,values:[],config:{}},d={name:G,type:r.FieldType.number,values:[],config:{}},p={name:U,type:r.FieldType.string,values:[],config:{}},g={name:q,type:r.FieldType.string,values:[],config:{}};null===(c=a.fields)||void 0===c||c.forEach((e=>{var t;o.$R.includes(e.label)||(i.values.push(e.label),d.values.push(e.cardinality),p.values.push((null===(t=e.parsers)||void 0===t?void 0:t.length)?e.parsers.join(", "):"structuredMetadata"),g.values.push(e.type))}));const h=(0,r.createDataFrame)({refId:s.refId,fields:[i,d,p,g]});n.next({data:[h],state:r.LoadingState.Done})}catch(e){O.v.error(e,{msg:"Detected fields error"}),n.next({data:[],state:r.LoadingState.Error})}return n}))()}getVolume(e,t,n){return V((function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");const a=e.targets[0],i=a.primaryLabel;if(!i)throw new Error("Primary label is required for volume queries!");const s=t.interpolateVariablesInQueries([a],e.scopedVars),l=(0,M.VT)(s[0].expr.replace(".*.*",".+"));n.next({data:[],state:r.LoadingState.Loading});try{var o,u,d;const a=yield t.getResource("index/volume",{query:l,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString(),limit:5e3},{requestId:null!==(d=e.requestId)&&void 0!==d?d:"volume",headers:{"X-Query-Tags":`Source=${A.s_}`}});null==a||a.data.result.sort(((e,t)=>{const n=e.value[1],r=t.value[1];return Number(r)-Number(n)}));const s=(0,r.createDataFrame)({fields:[{name:c.OX,values:null==a||null===(o=a.data.result)||void 0===o?void 0:o.map((e=>e.metric[i]))},{name:"volume",values:null==a||null===(u=a.data.result)||void 0===u?void 0:u.map((e=>Number(e.value[1])))}]});n.next({data:[s]})}catch(e){O.v.error(e),n.next({data:[],state:r.LoadingState.Error})}return n.complete(),n}))()}getLabels(e,t,n){return V((function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");try{var a;const i=yield t.getResource("labels",{start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(a=e.requestId)&&void 0!==a?a:"labels",headers:{"X-Query-Tags":`Source=${A.s_}`}}),s=(0,r.createDataFrame)({fields:[{name:"labels",values:null==i?void 0:i.data}]});n.next({data:[s],state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n.complete(),n}))()}testDatasource(){return Promise.resolve({status:"success",message:"Data source is working",title:"Success"})}constructor(e,t){super(e,t)}}const Y=function(){i.Go.registerRuntimeDataSource({dataSource:new J("wrapped-loki-ds",Q)})}},6838:(e,t,n)=>{n.d(t,{O:()=>o,m:()=>l});var r=n(20),a=n(376),i=n(5553),s=n(5953);function l(e,t,n=!0){const s=(0,i.ir)(e);let l="";n&&t===r.e4&&(l=`| ${r.e4} != ""`);const o=s.state.filters,c=(0,a.k$)(s);if(o.length){if("mixed"===c)return`sum(count_over_time({${r.S1}} ${l} ${r.S6} ${r.sC} ${r.rl} ${r.YN} ${r.Oc} [$__auto])) by (${t})`;if("json"===c)return`sum(count_over_time({${r.S1}} ${l} ${r.S6} ${r.sC} ${r.rl} ${r.VL} ${r.Oc} [$__auto])) by (${t})`;if("logfmt"===c)return`sum(count_over_time({${r.S1}} ${l} ${r.S6} ${r.sC} ${r.rl} ${r.mF} ${r.Oc} [$__auto])) by (${t})`}return`sum(count_over_time({${r.S1}} ${l} ${r.S6} ${r.sC} ${r.rl} ${r.Oc} [$__auto])) by (${t})`}function o(e){switch(e){case r._Y:return r.Sy;case r.sL:return r.fJ;default:const t=new Error(`Unknown variable type: ${e}`);throw s.v.error(t,{variableType:e,msg:`getFieldsTagValuesExpression: Unknown variable type: ${e}`}),t}}},696:(e,t,n)=>{n.d(t,{_J:()=>u,wy:()=>d});var r=n(9736),a=n(2661),i=n(577),s=n(173),l=n(5553),o=n(4351);function c(e){const t=r.jh.getAncestor(e,a.P);r.jh.findAllObjects(t,(e=>e instanceof i.p)).forEach((e=>e.forceRender()));r.jh.findDescendents(t,s.y).forEach((e=>e.forceRender()))}function u(e,t,n){const r=(0,l.S9)(n).getValue();(0,o.OB)(r,e,t),c(n)}function d(e,t,n){const r=(0,l.S9)(n).getValue();(0,o.cC)(r,e,t),c(n)}},376:(e,t,n)=>{n.d(t,{JI:()=>E,Jl:()=>P,OE:()=>O,Qg:()=>y,Ri:()=>S,Zp:()=>w,k$:()=>x,ph:()=>C});var r=n(7781),a=n(2007),i=n(9736),s=n(9405),l=n(20),o=n(1475),c=n(1269),u=n(7352),d=n(5553),p=n(5953),g=n(5700),h=n(3142),f=n(4247);const v=e=>{if(e){if(Object.values(r.ReducerID).includes(e))return e}};function m(e){switch(e){case"json":return"json";case"logfmt":return"logfmt";case"":case"structuredMetadata":return"structuredMetadata";default:return"mixed"}}function b(e){switch(e){case"int":case"float":case"duration":case"boolean":case"bytes":return e;default:return"string"}}function y(e){var t;const n=new Set(null!==(t=null==e?void 0:e.map((e=>e.toString())))&&void 0!==t?t:[]);n.delete("structuredMetadata");const r=Array.from(n);return 1===r.length?m(r[0]):0===n.size?"structuredMetadata":"mixed"}function S(e,t){var n;const r=(0,u.rD)(t),a=null==r?void 0:r.fields[2],i=null==r?void 0:r.fields[0],s=null==i?void 0:i.values.indexOf(e);var l;const o=void 0!==s&&-1!==s?m(null!==(l=null==a||null===(n=a.values)||void 0===n?void 0:n[s])&&void 0!==l?l:""):void 0;return void 0===o?(p.v.warn("missing parser, using mixed format for",{fieldName:e}),"mixed"):o}function w(e,t,n,r,u){return(d,p)=>{const h=v(r.state.sortBy),f=i.d0.timeseries().setOption("legend",{showLegend:!1}).setCustomFieldConfig("fillOpacity",9).setTitle(e(d)).setShowMenuAlways(!0).setData(new i.Es({transformations:[()=>function(e){return t=>t.pipe((0,c.map)((()=>[e])))}(d)]})).setOverrides(o.jC).setMenu(new g.GD({investigationOptions:{frame:d,fieldName:e(d),labelName:u}})).setHeaderActions([new s.oR({frame:d,variableName:n,hideExclude:u===l.e4})]);return t===a.DrawStyle.Bars&&f.setCustomFieldConfig("stacking",{mode:a.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setOverrides(o.jC).setCustomFieldConfig("drawStyle",a.DrawStyle.Bars),h&&(f.setOption("legend",{showLegend:!0,calcs:[h]}),f.setDisplayName(" ")),new i.xK({body:f.build()})}}function O(e,t,n){const r=e?(0,h.E)(t,e):f.H.Parsed;if(r)return function(e,t){switch(e){case f.H.Indexed:return l.MB;case f.H.Parsed:return l.mB;case f.H.StructuredMetadata:return t===l.e4?l._Y:l._P;default:{const n=new Error(`Invalid label type for ${t}`);throw p.v.error(n,{type:e,msg:`Invalid label type for ${t}`}),n}}}(r,t);const a=S(t,n);return"structuredMetadata"===a?l._P:(p.v.warn("unable to determine label variable, falling back to parsed field",{key:t,parserForThisField:null!=a?a:""}),l.mB)}function x(e){return y(e.state.filters.map((e=>(0,d.bu)(e).parser)))}function E(e){return"duration"===e||"bytes"===e||"float"===e}function C(e,t){var n;const r=null==t?void 0:t.fields[0],a=null==t?void 0:t.fields[3],i=null==r?void 0:r.values.indexOf(e);return void 0!==i&&-1!==i?b(null==a||null===(n=a.values)||void 0===n?void 0:n[i]):void 0}function P(e,t,n){var r,a;const i=null==n?void 0:n.fields[2],s=null==n?void 0:n.fields[0],l=null==n?void 0:n.fields[3],o=null==s?void 0:s.values.indexOf(e),c=void 0!==o&&-1!==o?m(null==i||null===(r=i.values)||void 0===r?void 0:r[o]):"mixed",u=void 0!==o&&-1!==o?b(null==l||null===(a=l.values)||void 0===a?void 0:a[o]):void 0,p=t.state.filters.map((e=>{var t;const n=null==s?void 0:s.values.indexOf(e.key),r=(0,d.bu)(e);if(r.parser)return r.parser;var a;const l=void 0!==n&&-1!==n?m(null!==(a=null==i||null===(t=i.values)||void 0===t?void 0:t[n])&&void 0!==a?a:"mixed"):void 0;return null!=l?l:"mixed"}));let g="",h="";"structuredMetadata"===c?h=`| ${e}!=""`:g=`| ${e}!=""`;return function(e,t){return t.fieldType&&["bytes","duration"].includes(t.fieldType)?`avg_over_time(${(0,d.DX)(t)} | unwrap `+t.fieldType+`(${e}) | __error__="" [$__auto]) by ()`:t.fieldType&&"float"===t.fieldType?`avg_over_time(${(0,d.DX)(t)} | unwrap `+e+' | __error__="" [$__auto]) by ()':`sum by (${e}) (count_over_time(${(0,d.DX)(t)} [$__auto]))`}(e,{structuredMetadataToAdd:h,fieldExpressionToAdd:g,parser:y([...p,c]),fieldType:u})}},8502:(e,t,n)=>{n.d(t,{$R:()=>s,OH:()=>c,dD:()=>i,p_:()=>a,rd:()=>o,rm:()=>l});var r=n(20);function a(e,t){return 1===e.cardinality?1:1===t.cardinality?-1:e.cardinality-t.cardinality}function i(e){const t=[...e];e.includes(r.e4)||t.unshift(r.e4);const n=t.map((e=>({label:e,value:String(e)})));return[{label:"All",value:r.To},...n]}const s=["level_extracted",r.e4,"level"],l=["__aggregated_metric__","__stream_shard__"];function o(e){const t=[...e].map((e=>({label:e,value:String(e)})));return[{label:"All",value:r.To},...t]}function c(e){var t;return((0,r.zE)(e.value)?(0,r.Dx)(e.value):e.value)===(null===(t=e.valueLabels)||void 0===t?void 0:t[0])}},42:(e,t,n)=>{n.d(t,{CP:()=>m,R7:()=>h,_t:()=>v,de:()=>p,di:()=>u,ec:()=>f,oj:()=>d,zr:()=>g});var r=n(20),a=n(376),i=n(7985),s=n(5553),l=n(9405),o=n(708),c=n(5570);const u="repeat(auto-fit, minmax(400px, 1fr))";function d(e,t,n){let l="",o="";const c=(0,s.ir)(e),u=(0,a.k$)(c);return n&&n!==r.e4?l=` ,${n} != ""`:n&&n===r.e4&&(o=` | ${n} != ""`),(0,i.l)(`sum(count_over_time(${(0,s.DX)({labelExpressionToAdd:l,structuredMetadataToAdd:o,parser:u})} [$__auto])) by (${t})`,{legendFormat:`{{${t}}}`,refId:"LABEL_BREAKDOWN_VALUES"})}function p(e){return e.map((e=>(0,c.H7)(e))).flatMap((e=>e?[e]:[]))}function g(e,t,n){const i=(0,s.YS)(n),c=0===i.state.filters.length,u="structuredMetadata"===(0,a.Ri)(e,n),d=i.state.filters.find((e=>u?(0,o.BG)(e.operator)&&e.value===t:(0,o.BG)(e.operator)&&(0,s.bu)(e).value===t));return c||!d?((0,l.Qt)(e,t,"include",n,u?r._P:r.mB),"include"):((0,l.Qt)(e,t,"toggle",n,u?r._P:r.mB),"toggle")}function h(e,t,n){const a=(0,s.cR)(n),i=0===a.state.filters.length,c=a.state.filters.find((e=>e.value===t&&(0,o.BG)(e.operator)));return i||!c?((0,l.Qt)(e,t,"include",n,r.MB),"include"):((0,l.Qt)(e,t,"toggle",n,r.MB),"toggle")}function f(e,t,n){return b(e,t,(0,s.cR)(n))}function v(e,t,n){return b(e,t,(0,s.ir)(n))}function m(e,t,n){return b(e,t,(0,s.oY)(n))}function b(e,t,n){const a=n.state.filters.filter((t=>t.key===e&&(0,o.BG)(t.operator))).map((e=>n.state.name===r.mB?(0,s.bu)(e).value:e.value)),i=n.state.filters.filter((t=>t.key===e&&(0,o.Lw)(t.operator))).map((e=>n.state.name===r.mB?(0,s.bu)(e).value:e.value));return t.filter((e=>!i.includes(e)&&(0===a.length||a.includes(e))))}},5570:(e,t,n)=>{n.d(t,{Ex:()=>d,H7:()=>u,PE:()=>g,pC:()=>o,vX:()=>c});var r=n(2007),a=n(20),i=n(9405),s=n(5553),l=n(708);function o(e,t,n,a){if(n===r.SeriesVisibilityChangeMode.ToggleSelection){const n=null!=t?t:[];return 1===n.length&&n.includes(e)?[]:[e]}let i=(null==t?void 0:t.length)?t:a;return i.includes(e)?i.filter((t=>t!==e)):[...i,e]}function c(e){return e.map((e=>{var t;return null!==(t=u(e))&&void 0!==t?t:"logs"}))}function u(e){var t;const n=null===(t=e.fields[1])||void 0===t?void 0:t.labels;if(!n)return null;const r=Object.keys(n);return 0===r.length?null:n[r[0]]}function d(e,t){const n=(0,s.iw)(t),r=n.state.filters.filter((e=>(0,l.BG)(e.operator))).map((e=>e.value.split("|").map(p))).join("|"),a=n.state.filters.filter((e=>(0,l.Lw)(e.operator))).map((e=>e.value.split("|").map(p))).join("|");return e.filter((e=>!a.includes(e)&&(0===r.length||r.includes(e))))}function p(e){return'""'===e?"logs":e}function g(e,t){const n=(0,s.iw)(t),r=0===n.state.filters.length,o=n.state.filters.find((t=>t.value===e&&(0,l.BG)(t.operator)));return"logs"===e&&(e='""'),r||!o?((0,i.Qt)(a.e4,e,"include",t,a._Y),"include"):((0,i.Qt)(a.e4,e,"toggle",t,a._Y),"toggle")}},2165:(e,t,n)=>{n.d(t,{Il:()=>g,Os:()=>d,bz:()=>c,fF:()=>p,hy:()=>m,po:()=>h,y2:()=>b,z5:()=>f});var r=n(7781);function a(e,t,n){const r=e.getFieldByName(t);if(void 0!==r)return r.type===n?r:void 0}const i="timestamp",s="body",l="severity",o="id",c="labels";function u(e){const t={};return Object.entries(e).forEach((([e,n])=>{t[e]="string"==typeof n?n:JSON.stringify(n)})),t}function d(e){var t;return(null===(t=e.meta)||void 0===t?void 0:t.type)===r.DataFrameType.LogLines?function(e){const t=new r.FieldCache(e),n=a(t,i,r.FieldType.time),d=a(t,s,r.FieldType.string);if(void 0===n||void 0===d)return null;var p;const g=null!==(p=a(t,l,r.FieldType.string))&&void 0!==p?p:null;var h;const f=null!==(h=a(t,o,r.FieldType.string))&&void 0!==h?h:null;var v;const m=null!==(v=a(t,c,r.FieldType.other))&&void 0!==v?v:null,b=null===m?null:m.values,y=t.fields.filter(((e,t)=>t!==n.index&&t!==d.index&&t!==(null==g?void 0:g.index)&&t!==(null==f?void 0:f.index)&&t!==(null==m?void 0:m.index)));return{raw:e,timeField:n,bodyField:d,severityField:g,idField:f,getLogFrameLabels:()=>b,timeNanosecondField:null,getLogFrameLabelsAsLabels:()=>null!==b?b.map(u):null,getLabelFieldName:()=>null!==m?m.name:null,extraFields:y}}(e):function(e){const t=new r.FieldCache(e),n=t.getFirstFieldOfType(r.FieldType.time),a=t.getFirstFieldOfType(r.FieldType.string);if(void 0===n||void 0===a)return null;var i;const s=null!==(i=t.getFieldByName("tsNs"))&&void 0!==i?i:null;var l;const o=null!==(l=t.getFieldByName("level"))&&void 0!==l?l:null;var c;const d=null!==(c=t.getFieldByName("id"))&&void 0!==c?c:null,[p,g]=function(e,t,n){const a=e.getFieldByName("labels");if(void 0!==a&&a.type===r.FieldType.other){const e=a.values.map(u);return[a,()=>e]}return[null,()=>function(e,t){const n=e.labels;if(void 0!==n){const e=new Array(t);return e.fill(n),e}return null}(t,n.length)]}(t,a,e),h=t.fields.filter(((e,t)=>t!==n.index&&t!==a.index&&t!==(null==s?void 0:s.index)&&t!==(null==o?void 0:o.index)&&t!==(null==d?void 0:d.index)&&t!==(null==p?void 0:p.index)));return{timeField:n,bodyField:a,timeNanosecondField:s,severityField:o,idField:d,getLogFrameLabels:g,getLogFrameLabelsAsLabels:g,getLabelFieldName:()=>{var e;return null!==(e=null==p?void 0:p.name)&&void 0!==e?e:null},extraFields:h,raw:e}}(e)}function p(e){var t;return null!==(t=null==e?void 0:e.timeField.name)&&void 0!==t?t:i}function g(e){var t;return null!==(t=null==e?void 0:e.bodyField.name)&&void 0!==t?t:s}function h(e){var t,n;return null!==(n=null==e||null===(t=e.idField)||void 0===t?void 0:t.name)&&void 0!==n?n:o}function f(e){var t;let n=0,a=0;const i=null===(t=e[0])||void 0===t?void 0:t.fields.find((e=>e.type===r.FieldType.time));if(i){const e=[...i.values].sort(),t=e[0]<e[e.length-1];n=t?e[0]:e[e.length-1],a=t?e[e.length-1]:e[0]}return{start:n,end:a}}const v="Visible range";function m(e,t){const n=(0,r.arrayToDataFrame)([{time:e,timeEnd:t,isRegion:!0,text:"Range from oldest to newest logs in display",color:"rgba(58, 113, 255, 0.3)"}]);return n.name=v,n.meta={dataTopic:r.DataTopic.Annotations},n}function b(e){return 0===e.length||0===e[0].fields[0].values.length}},2152:(e,t,n)=>{let r;function a(){r||(r=new i)}n.d(t,{JO:()=>s,rX:()=>a});class i{getServiceSceneState(){return this.serviceSceneState}setPatternsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.patternsCount=e}setLabelsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.labelsCount=e}setFieldsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.fieldsCount=e}setServiceSceneState(e){this.serviceSceneState={patternsCount:e.patternsCount,labelsCount:e.labelsCount,fieldsCount:e.fieldsCount,loading:e.loading,logsCount:e.logsCount,totalLogsCount:e.totalLogsCount}}constructor(){var e,t,n;n=void 0,(t="serviceSceneState")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}}function s(){return r}},7478:(e,t,n)=>{n.d(t,{FB:()=>f,Ns:()=>O,Vt:()=>y,ad:()=>S,bN:()=>w,fg:()=>v,k9:()=>m,rs:()=>b});var r=n(2661),a=n(20),i=n(2152),s=n(8531),l=n(9683),o=n(9736),c=n(7781),u=n(7389),d=n(9598);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let g;function h(e,t){return c.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}({},Object.entries(c.urlUtil.getUrlSearchParams()).reduce(((e,[t,n])=>(l.tm.includes(t)&&(e[t]=n),e)),{}),e)}(t))}function f(e,t,n){var s,c;const p=o.jh.getAncestor(n,r.P),g=null===(s=p.state.routeMatch)||void 0===s?void 0:s.params.labelName,f=null===(c=p.state.routeMatch)||void 0===c?void 0:c.params.labelValue;if(g&&f){let r=function(e,t,n,r="service"){return e===a.To&&t===l._J.label?(0,d._F)(`${l.G3.explore}/${r}/${(0,u.uu)(n)}/${l.G3.labels}`):e===a.To&&t===l._J.field?(0,d._F)(`${l.G3.explore}/${r}/${(0,u.uu)(n)}/${l.G3.fields}`):(0,d._F)(`${l.G3.explore}/${r}/${(0,u.uu)(n)}/${t}/${(0,u.uu)(e)}`)}(t,e,f,g);const s=h(r);if(n){(0,i.JO)().setServiceSceneState(n.state)}return s}return""}function v(e,t,n){const r=f(e,t,n);r&&S(r)}function m(e,t,n){return h(l.bw.logs(t,e),n)}function b(e,t,n){var a,i;const s=o.jh.getAncestor(t,r.P),c=null===(a=s.state.routeMatch)||void 0===a?void 0:a.params.labelValue,p=null===(i=s.state.routeMatch)||void 0===i?void 0:i.params.labelName;if(c){return h((0,d._F)(`${l.G3.explore}/${p}/${(0,u.uu)(c)}/${e}`),n)}return""}function y(e,t,n){const r=b(e,t,n);if(r){if(t){(0,i.JO)().setServiceSceneState(t.state)}S(r)}else;}function S(e){g=e,s.locationService.push(e)}function w(){const e=s.locationService.getLocation();s.locationService.push(e.pathname+e.search)}function O(){const e=s.locationService.getLocation(),t=(0,l.qe)(l.bw.explore()),n=e.pathname+e.search,r=s.locationService.getSearch();t===n||n.includes(t)||(r.get("var-filters")?S(t):(g&&s.locationService.replace(g),s.locationService.push(t)))}},1475:(e,t,n)=>{n.d(t,{rS:()=>I,FH:()=>$,HF:()=>B,jC:()=>P,ZC:()=>k,Nr:()=>T,dO:()=>_,C6:()=>L});var r=n(7781),a=n(9736),i=n(1269),s=n(1625),l=n(8955);class o extends a.dt{runQueries(){const e=a.jh.getTimeRange(this);this.runWithTimeRangeAndScopes(e)}constructor(e){super(e)}}var c=n(2007),u=n(5570),d=n(3142),p=n(7352),g=n(2649),h=n(42),f=n(376);function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){v(e,t,n[t])}))}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const y="logs",S=/^info$/i,w=/^debug$/i,O=/^(warn|warning)$/i,x=/^error$/i,E=/^(crit|critical|fatal)$/i,C=/^(logs|unknown)$/i;function P(e){e.matchFieldsWithNameByRegex(S.source).overrideColor({mode:"fixed",fixedColor:"semi-dark-green"}),e.matchFieldsWithNameByRegex(w.source).overrideColor({mode:"fixed",fixedColor:"semi-dark-blue"}),e.matchFieldsWithNameByRegex(O.source).overrideColor({mode:"fixed",fixedColor:"semi-dark-orange"}),e.matchFieldsWithNameByRegex(x.source).overrideColor({mode:"fixed",fixedColor:"semi-dark-red"}),e.matchFieldsWithNameByRegex(E.source).overrideColor({mode:"fixed",fixedColor:"#705da0"}),e.matchFieldsWithNameByRegex(C.source).overrideColor({mode:"fixed",fixedColor:"darkgray"})}function k(e){return e.setCustomFieldConfig("stacking",{mode:c.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("axisSoftMin",0).setCustomFieldConfig("drawStyle",c.DrawStyle.Bars).setOverrides(P)}function j(e){return e.setCustomFieldConfig("stacking",{mode:c.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",c.DrawStyle.Bars)}function F(e,t){t.match({id:r.FieldMatcherID.byNames,options:{mode:"exclude",names:e,prefix:"All except:",readOnly:!0}}).overrideCustomFieldConfig("hideFrom",{legend:!1,tooltip:!1,viz:!0});const n=t.build();n[n.length-1].__systemRef="hideSeriesFrom"}function L(e,t,n){const r=(0,u.Ex)((0,u.vX)(t),n),i=k(a.No.timeseries()).setOverrides(F.bind(null,r));i instanceof a.OS&&e.onFieldConfigChange(i.build(),!0)}function _(e,t,n,r){const i=(0,h.de)(n),s=(0,h.ec)(e,i,r),l=j(a.No.timeseries());s.length&&l.setOverrides(F.bind(null,s)),l instanceof a.OS&&t.onFieldConfigChange(l.build(),!0)}function T(e,t,n,r){const i=(0,h.de)(n),s="structuredMetadata"===(0,f.Ri)(e,r)?(0,h.CP)(e,i,r):(0,h._t)(e,i,r),l=j(a.No.timeseries());s.length&&l.setOverrides(F.bind(null,s)),l instanceof a.OS&&t.onFieldConfigChange(l.build(),!0)}function D(){return e=>e.pipe((0,i.map)((e=>e.map(((t,n)=>b(m({},t),{fields:t.fields.map(((n,a)=>{if(n.type===r.FieldType.time)return n;const i=(0,r.getFieldDisplayName)(n,t,e);return b(m({},n),{config:b(m({},n.config),{displayName:i,color:{mode:r.FieldColorModeId.PaletteClassicByName}})})}))}))))))}function N(){return e=>e.pipe((0,i.map)((e=>e.map((e=>(e.fields.length<2||e.fields[1].config.displayNameFromDS||(e.fields[1].config.displayNameFromDS=y),e))).sort(((e,t)=>{if(e.fields.length<2||t.fields.length<2)return 0;const n=e.fields[1].config.displayNameFromDS,r=(null==n?void 0:n.match(E))?5:(null==n?void 0:n.match(x))?4:(null==n?void 0:n.match(O))?3:(null==n?void 0:n.match(w))||(null==n?void 0:n.match(S))?2:1,a=t.fields[1].config.displayNameFromDS;return r-((null==a?void 0:a.match(E))?5:(null==a?void 0:a.match(x))?4:(null==a?void 0:a.match(O))?3:(null==a?void 0:a.match(w))||(null==a?void 0:a.match(S))?2:1)})))))}function $(e){return new o({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:e})}function I(e,t){const n=e.find((e=>{var t;return null===(t=e.legendFormat)||void 0===t?void 0:t.toLowerCase().includes("level")})),r=e.find((e=>e.refId===p.DS||e.refId===p.AA));return n?new a.Es({$data:B(m({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:e},t)),transformations:[N]}):r?(e=e.map((e=>b(m({},e),{get direction(){return((0,g.PY)()||(0,g.zQ)())===s.uH.Descending?d.t.Backward:d.t.Forward}}))),B(m({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:e},t))):new a.Es({$data:B(m({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:e},t)),transformations:[D]})}function B(e){return new a.dt(m({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:[]},e))}},9598:(e,t,n)=>{n.d(t,{Gy:()=>a,_F:()=>i,s_:()=>r});const r=n(2533).id,a=`/a/${r}`;function i(e){return`${a}/${e}`}},7985:(e,t,n)=>{n.d(t,{$k:()=>f,BM:()=>p,CY:()=>O,E3:()=>S,PP:()=>b,VT:()=>C,VW:()=>v,ZX:()=>w,_q:()=>y,by:()=>P,c0:()=>m,l:()=>g,sT:()=>E,vC:()=>x});var r=n(20),a=n(9598),i=n(9736),s=n(6854),l=n(1459),o=n(6464);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){c(e,t,n[t])}))}return e}function d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const p=(e,t,n,a)=>d(u(d(u({},h),{resource:t,refId:t}),n),{datasource:{uid:r.gR},expr:e,primaryLabel:a}),g=(e,t)=>d(u({},h,t),{expr:e}),h={refId:"A",queryType:"range",editorMode:"code",supportingQueryType:a.s_},f=(e,t,n,r)=>p(e,t,u({},r),n);function v(e,t){return new o.K(e).getLabelsExpr({ignoreKeys:t})}function m(e){var t,n,a;return e.value?{value:(0,r.OQ)(e.value),valueLabels:[null!==(t=e.label)&&void 0!==t?t:e.value]}:{value:e.value,valueLabels:[null!==(a=null!==(n=e.label)&&void 0!==n?n:e.value)&&void 0!==a?a:""]}}function b(e,t){var n,a,i;const s={value:null!==(a=e.value)&&void 0!==a?a:"",parser:null!==(i=null==t||null===(n=t.meta)||void 0===n?void 0:n.parser)&&void 0!==i?i:"mixed"};var l,o;return"structuredMetadata"===s.parser?{value:(0,r.OQ)(s.value),valueLabels:[null!==(l=e.label)&&void 0!==l?l:s.value]}:{value:(0,r.OQ)(JSON.stringify(s)),valueLabels:[null!==(o=e.label)&&void 0!==o?o:s.value]}}function y(e,t){return new o.K(e).getLevelsExpr({ignoreKeys:t})}function S(e,t){return new o.K(e).getMetadataExpr({ignoreKeys:t})}function w(e,t){return new o.K(e).getFieldsExpr({ignoreKeys:t})}function O(e){return(0,l.F)(e),e.map((e=>{if(!e.value)return"";const t=function(e){var t,n,r;return e.operator===s.cK.match||e.operator===s.cK.negativeMatch?e.key===s.ld.caseInsensitive?i.Go.escapeLabelValueInRegexSelector(null!==(t=e.value)&&void 0!==t?t:""):i.Go.escapeLabelValueInExactSelector(null!==(n=e.value)&&void 0!==n?n:""):i.Go.escapeLabelValueInExactSelector(null!==(r=e.value)&&void 0!==r?r:"")}(e);return function(e,t){return e.key===s.ld.caseInsensitive?e.operator===s.cK.negativeRegex||e.operator===s.cK.negativeMatch?`${s.cK.negativeRegex} "(?i)${t}"`:`${s.cK.regex} "(?i)${t}"`:`${e.operator} "${t}"`}(e,t)})).join(" ")}function x(e){return".+"===e?e:"(?i).*"!==e.substring(0,6)?`(?i).*${e}.*`:e}function E(e){return"(?i).*"===e.substring(0,6)&&".*"===e.slice(-2)?e.slice(6).slice(0,-2):e}function C(e){return e.replace(/\s*,\s*}/,"}")}const P=1e3},9683:(e,t,n)=>{n.d(t,{FT:()=>y,G3:()=>d,HU:()=>f,KL:()=>v,NX:()=>E,W6:()=>S,XJ:()=>x,Zt:()=>m,_J:()=>p,bw:()=>g,er:()=>w,mC:()=>h,qe:()=>O,tm:()=>b});var r=n(7781),a=n(20),i=n(8531),s=n(7389),l=n(5553),o=n(5953),c=n(9598);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(e){return e.explore="explore",e.logs="logs",e.labels="labels",e.patterns="patterns",e.fields="fields",e}({}),p=function(e){return e.field="field",e.label="label",e}({});const g={explore:()=>(0,c._F)("explore"),logs:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/logs`),fields:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/fields`),patterns:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/patterns`),labels:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/labels`)},h={label:(e,t="service",n)=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/label/${n}`),field:(e,t="service",n)=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/field/${n}`)},f={explore:"explore/*",logs:":labelName/:labelValue/logs",fields:":labelName/:labelValue/fields",patterns:":labelName/:labelValue/patterns",labels:":labelName/:labelValue/labels"},v={field:":labelName/:labelValue/field/:breakdownLabel",label:":labelName/:labelValue/label/:breakdownLabel"},m=["from","to",`var-${a.EY}`,`var-${a.MB}`],b=["from","to","mode","urlColumns","visualizationType","selectedLine","displayedFields","panelState",a.uw,`var-${a.uw}`,`var-${a.EY}`,`var-${a.MB}`,`var-${a.mB}`,`var-${a._Y}`,`var-${a.LI}`,`var-${a.Jg}`,`var-${a.EY}`,`var-${a.WM}`,`var-${a._P}`,`var-${a.NW}`];function y(){const e=i.locationService.getLocation();return e.pathname.slice(e.pathname.lastIndexOf("/")+1,e.pathname.length)}function S(){const e=i.locationService.getLocation(),t="/a/grafana-lokiexplore-app/explore",n=e.pathname.slice(e.pathname.indexOf(t)+34+1).split("/");let r=n[0];const s=n[1],l=n[3];return r===a.OX&&(r=a.ky),{labelName:r,labelValue:s,breakdownLabel:l}}function w(){const e=i.locationService.getLocation().pathname.split("/");return e[e.length-2]}function O(e,t){return r.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}({},Object.entries(r.urlUtil.getUrlSearchParams()).reduce(((e,[t,n])=>(m.includes(t)&&(e[t]=n),e)),{}),e)}(t))}function x(e){return{labelName:e.params.labelName,labelValue:e.params.labelValue,breakdownLabel:e.params.breakdownLabel}}function E(e){const t=(0,l.cR)(e);let{labelName:n,labelValue:r}=S();n===a.ky&&(n=a.OX);if(!t.state.filters.find((e=>e.key===n))){const e=i.locationService.getLocation();o.v.info("invalid primary label name in url",{labelName:n,url:`${e.pathname}${e.search}`})}if(!t.state.filters.find((e=>(0,s.uu)(e.value)===r))){const e=i.locationService.getLocation();o.v.info("invalid primary label value in url",{labelValue:r,url:`${e.pathname}${e.search}`})}}},5719:(e,t,n)=>{n.d(t,{Mq:()=>p,Ti:()=>c,U4:()=>u,UX:()=>v,hJ:()=>g,m0:()=>m,oh:()=>f,u9:()=>d});n(7781);var r=n(8531),a=n(9736),i=n(20),s=(n(9683),n(2661)),l=n(5953);function o(e,t,n,r,a,i,s){try{var l=e[i](s),o=l.value}catch(e){return void n(e)}l.done?t(o):Promise.resolve(o).then(r,a)}function c(e){return a.jh.getAncestor(e,s.P)}function u(e){return a.jh.interpolate(e,i.gR)}function d(e){return a.jh.interpolate(e,i.SA).replace(/\s+/g," ")}function p(e){return a.jh.interpolate(e,i.FX).replace(/\s+/g," ")}function g(e){return h.apply(this,arguments)}function h(){var e;return e=function*(e){return yield(0,r.getDataSourceSrv)().get(i.gR,{__sceneObject:{value:e}})},h=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){o(i,r,a,s,l,"next",e)}function l(e){o(i,r,a,s,l,"throw",e)}s(void 0)}))},h.apply(this,arguments)}function f(e){return a.jh.findDescendents(e,a.dt)}function v(e,t,n){const r=a.jh.findObject(e,t);return r instanceof n?r:(null!==r&&l.v.warn(`invalid return type: ${n.toString()}`),null)}function m(e){var t;return null===(t=e.state.controls)||void 0===t?void 0:t.find((e=>e instanceof a.KE))}},9193:(e,t,n)=>{n.d(t,{E:()=>l,X:()=>s});var r=n(7993),a=n(3241);const i=new r.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function s(e,t,n){const[a,s,l]=i.search(e,t,0,1e5);let o=[],c=new Set;if(a&&l){const t=(e,t)=>{t&&c.add(e)};for(let n=0;n<l.length;n++){let a=l[n];r.A.highlight(e[s.idx[a]],s.ranges[a],t),o.push(e[s.idx[a]])}n([o,[...c]])}else t||n([])}const l=(0,a.debounce)(s,300)},2601:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_SORT_BY:()=>u,calculateDataFrameChangepoints:()=>p,calculateOutlierValue:()=>v,sortSeries:()=>d,sortSeriesByName:()=>g,wasmSupported:()=>m});var r=n(1854),a=n(6944),i=n(7781),s=n(5570),l=n(3241),o=n(4509),c=n(5953);const u="changepoint",d=(0,l.memoize)(((e,t,n)=>{if("alphabetical"===t)return g(e,n);"outliers"===t&&h(e);const r=n=>{var r;try{if("changepoint"===t)return p(n);if("outliers"===t)return v(e,n)}catch(e){c.v.error(e,{msg:"failed to sort"}),t=i.ReducerID.stdDev}const a=i.fieldReducers.get(t);var s;var l;return null!==(l=(null!==(s=null===(r=a.reduce)||void 0===r?void 0:r.call(a,n.fields[1],!0,!0))&&void 0!==s?s:(0,i.doStandardCalcs)(n.fields[1],!0,!0))[t])&&void 0!==l?l:0},a=e.map((e=>({value:r(e),dataFrame:e})));return a.sort(((e,t)=>void 0!==e.value&&void 0!==t.value?t.value-e.value:0)),"asc"===n&&a.reverse(),a.map((({dataFrame:e})=>e))}),((e,t,n)=>{const r=e.length>0?e[0].fields[0].values[0]:0,a=e.length>0?e[e.length-1].fields[0].values[e[e.length-1].fields[0].values.length-1]:0,i=e.length>0?(0,s.H7)(e[0]):"",l=e.length>0?(0,s.H7)(e[e.length-1]):"",o=e.map((e=>e.length+"_"+e.fields.map((e=>e.name+"_"+e.values[0]+"_"+e.values[e.values.length-1]))));return`${i}_${l}_${r}_${a}_${e.length}_${o}_${t}_${n}`})),p=e=>{if(!m())throw new Error("WASM not supported, fall back to stdDev");const t=e.fields.filter((e=>e.type===i.FieldType.number)),n=t[0].values.length;let a=Math.floor(n/100)||1;a>1&&(a=Math.ceil(a/2));const s=t[0].values.filter(((e,t)=>t%a==0)),l=new Float64Array(s);return r.ChangepointDetector.defaultArgpcp().detectChangepoints(l).indices.length},g=(e,t)=>{const n=[...e];return n.sort(((e,t)=>{const n=(0,s.H7)(e),r=(0,s.H7)(t);return n&&r&&null!==(a=null==n?void 0:n.localeCompare(r))&&void 0!==a?a:0;var a})),"desc"===t&&n.reverse(),n},h=e=>{if(!m())return;const t=(0,i.outerJoinDataFrames)({frames:e});if(!t)return;const n=t.fields.filter((e=>e.type===i.FieldType.number)).flatMap((e=>new Float64Array(e.values)));try{const e=a.OutlierDetector.dbscan({sensitivity:.4}).preprocess(n);f=e.detect()}catch(e){c.v.error(e,{msg:"initOutlierDetector: OutlierDetector error"})}};let f;const v=(e,t)=>{if(!m())throw new Error("WASM not supported, fall back to stdDev");if(!f)throw new Error("Initialize outlier detector first");const n=e.indexOf(t);return f.seriesResults[n].isOutlier?f.seriesResults[n].outlierIntervals.length:0},m=()=>{const e="object"==typeof WebAssembly;return e||(0,o.EE)(o.NO.service_details,o.ir.service_details.wasm_not_supported),e}},4351:(e,t,n)=>{n.d(t,{Bq:()=>R,Dy:()=>X,GL:()=>M,Gg:()=>v,IW:()=>K,KH:()=>J,N$:()=>P,OB:()=>g,QB:()=>S,RN:()=>T,Rb:()=>U,Rf:()=>D,Xo:()=>A,YK:()=>L,YM:()=>F,ZF:()=>k,Zs:()=>z,cC:()=>h,cO:()=>f,eT:()=>p,ex:()=>Q,fq:()=>E,hp:()=>V,k5:()=>$,ke:()=>w,o5:()=>I,og:()=>W,sj:()=>m,uF:()=>Y,vs:()=>x,zu:()=>Z});var r=n(2533),a=n(5553),i=n(5953),s=n(20),l=n(8428);const o=`${r.id}.services.favorite`,c=`${r.id}.primarylabels.tabs.favorite`,u=`${r.id}.datasource`,d=`${r.id}.scene.layout`;function p(e,t){if(!e||"string"!=typeof e)return[];const n=b(e,t);let r=[];try{r=(0,l.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(r)||(r=[]),r}function g(e,t,n){if(!e||"string"!=typeof e)return;const r=b(e,t);let a=[];try{a=(0,l.aJ)(JSON.parse(localStorage.getItem(r)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const s=a.filter((e=>e!==n));s.unshift(n),localStorage.setItem(r,JSON.stringify(s))}function h(e,t,n){if(!e||!t||!n||"string"!=typeof e)return;const r=b(e,t);let a=[];try{a=(0,l.aJ)(JSON.parse(localStorage.getItem(r)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const s=a.filter((e=>e!==n));localStorage.setItem(r,JSON.stringify(s))}function f(e,t){if(!e||!t)return;const n=y(e);let r=[];try{r=(0,l.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing saved tabs from local storage"})}if(Array.isArray(r)||(r=[]),-1===r.indexOf(t)){const e=r.filter((e=>e!==t));e.unshift(t),localStorage.setItem(n,JSON.stringify(e))}}function v(e,t){if(!e||!t)return;const n=y(e);let r=[];try{r=(0,l.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(r)||(r=[]);const a=r.filter((e=>e!==t));localStorage.setItem(n,JSON.stringify(a))}function m(e){if(!e||"string"!=typeof e)return[];const t=y(e);let n=[];try{n=(0,l.aJ)(JSON.parse(localStorage.getItem(t)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(n)||(n=[]),n}function b(e,t){return t=t===s.OX?"":`_${t}`,`${o}_${e}${t}`}function y(e){return`${c}_${e}`}function S(){var e;return null!==(e=localStorage.getItem(u))&&void 0!==e?e:void 0}function w(e){localStorage.setItem(u,e)}const O=`${r.id}.values.sort`;function x(e,t,n){var r;const a=(null!==(r=localStorage.getItem(`${O}.${e}.by`))&&void 0!==r?r:"").split(".");if(!a[0]||!a[1])return{sortBy:t,direction:n};return{sortBy:a[0],direction:a[1]}}function E(e,t,n){t&&n&&localStorage.setItem(`${O}.${e}.by`,`${t}.${n}`)}function C(e){return`${(0,a.nH)(e)}.${(0,a.p_)(e)}`}function P(e){const t=C(e),n=localStorage.getItem(`${r.id}.${t}.logs.fields`);return n?JSON.parse(n):[]}function k(e,t){const n=C(e);localStorage.setItem(`${r.id}.${n}.logs.fields`,JSON.stringify(t))}const j=`${r.id}.logs.option`;function F(e,t){const n=localStorage.getItem(`${j}.${e}`);return n||t}function L(e,t){let n=t.toString();"boolean"!=typeof t||t||(n=""),localStorage.setItem(`${j}.${e}`,n)}const _="grafana.explore.logs.logsVolume";function T(e,t){const n=`${_}.${e}`;void 0!==t?localStorage.setItem(n,t):localStorage.removeItem(n)}function D(e){return Boolean(localStorage.getItem(`${_}.${e}`))}const N="grafana.explore.logs.visualisationType";function $(){var e;const t=null!==(e=localStorage.getItem(N))&&void 0!==e?e:"";switch(t){case"table":case"logs":return t;default:return"logs"}}function I(e){localStorage.setItem(N,e)}const B=`${r.id}.linefilter.option`;function A(e){let t=e.toString();e||(t=""),localStorage.setItem(`${B}.caseSensitive`,t)}function M(e){let t=e.toString();e||(t=""),localStorage.setItem(`${B}.regex`,t)}function R(e){let t=e.toString();e||(t=""),localStorage.setItem(`${B}.exclusive`,t)}function V(e){return"true"===localStorage.getItem(`${B}.caseSensitive`)||e}function W(e){return"true"===localStorage.getItem(`${B}.regex`)||e}function z(e){return"true"===localStorage.getItem(`${B}.exclusive`)||e}const H=`${r.id}.panel.option`;function Q(e,t){const n=localStorage.getItem(`${H}.${e}`);var r;return null!==n&&null!==(r=t.find((e=>n===e)))&&void 0!==r?r:null}function K(e,t){localStorage.setItem(`${H}.${e}`,t)}const G=`${r.id}.expressionBuilder.debug`;function U(){return!!localStorage.getItem(G)}const q=`${r.id}.serviceSelection.pageCount`;function J(){const e=localStorage.getItem(q);return e?parseInt(e,10):void 0}function Y(e){localStorage.setItem(q,e.toString(10))}function X(){return localStorage.getItem(d)}function Z(e){localStorage.setItem(d,e)}},3571:(e,t,n)=>{n.d(t,{b:()=>r});const r={appConfig:{container:"data-testid ac-container",apiKey:"data-testid ac-api-key",apiUrl:"data-testid ac-api-url",submit:"data-testid ac-submit-form"},exploreServiceSearch:{search:"data-testid search-services"},header:{refreshPicker:"data-testid RefreshPicker run button"},variables:{datasource:{label:"data-testid Dashboard template variables submenu Label Data source"},combobox:{},serviceName:{label:"data-testid Dashboard template variables submenu Label Labels"},levels:{inputWrap:"data-testid detected_level filter variable"}},breakdowns:{labels:{},fields:{},common:{sortByFunction:"data-testid SortBy function",sortByDirection:"data-testid SortBy direction",filterButtonGroup:"data-testid filter-button-group",filterButton:"data-testid filter-button",filterSelect:"data-testid filter-select",filterNumericPopover:{removeButton:"data-testid filter-numeric-remove",submitButton:"data-testid filter-numeric-submit",cancelButton:"data-testid filter-numeric-cancel",inputGreaterThan:"data-testid filter-numeric-gt",inputGreaterThanUnit:"data-testid filter-numeric-gtu",inputGreaterThanInclusive:"data-testid filter-numeric-gte",inputLessThan:"data-testid filter-numeric-lt",inputLessThanUnit:"data-testid filter-numeric-ltu",inputLessThanInclusive:"data-testid filter-numeric-lte"}}},index:{showLogsButton:"data-testid button-filter-include",selectServiceButton:"data-testid button-select-service",addNewLabelTab:"data-testid Tab Add label",searchLabelValueInput:"data-testid search-services-input",aggregatedMetricsMenu:"data-testid aggregated-metrics-menu",aggregatedMetricsToggle:"data-testid aggregated-metrics-toggle",header:{showLogsButton:"data-testid Show logs header"}},exploreServiceDetails:{searchLogs:"data-testid search-logs",openExplore:"data-testid open-explore",tabPatterns:"data-testid tab-patterns",tabLogs:"data-testid tab-logs",tabFields:"data-testid tab-fields",tabLabels:"data-testid tab-labels",buttonRemovePattern:"data-testid button-remove-pattern",buttonFilterInclude:"data-testid button-filter-include",buttonFilterExclude:"data-testid button-filter-exclude"},patterns:{tableWrapper:"data-testid table-wrapper",buttonIncludedPattern:"data-testid button-included-pattern",buttonExcludedPattern:"data-testid button-excluded-pattern"},logsPanelHeader:{header:"data-testid Panel header Logs",radio:"data-testid radio-button"},table:{wrapper:"data-testid table-wrapper",inspectLine:"data-testid inspect",rawLogLine:"data-testid raw-log-line"}}},5002:(e,t,n)=>{n.d(t,{Dk:()=>s,EJ:()=>c,Ki:()=>u,Zr:()=>o,gW:()=>l});var r=n(8531),a=n(5953),i=n(7781);const s=e=>{if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}};const l=(e,t,n)=>{const a=r.locationService.getLocation(),s=i.urlUtil.getUrlSearchParams();return s.from=n.from.toISOString(),s.to=n.to.toISOString(),s[e]=JSON.stringify(t),l=i.urlUtil.renderUrl(a.pathname,s),`${window.location.protocol}//${window.location.host}${r.config.appSubUrl}${l}`;var l};function o(e){return e.length?(null==e?void 0:e.charAt(0).toUpperCase())+e.slice(1):(a.v.warn("invalid string argument"),e)}function c(e,t,n){return e.substring(0,t)+(n&&e.length>t?"â€¦":"")}function u(e){const t=(0,i.dateTime)(e.timeEpochMs-1),n=(0,i.dateTime)(e.timeEpochMs+1);return{from:t,to:n,raw:{from:t,to:n}}}},5553:(e,t,n)=>{n.d(t,{BL:()=>k,DX:()=>c,El:()=>P,Gk:()=>O,Hj:()=>S,Ku:()=>u,P4:()=>b,Rr:()=>m,S9:()=>w,YS:()=>h,aW:()=>p,bY:()=>x,bu:()=>F,cR:()=>d,eY:()=>E,h:()=>C,ir:()=>f,iw:()=>v,n5:()=>j,nH:()=>T,oY:()=>g,p_:()=>_,vm:()=>y,z2:()=>L});var r=n(9736),a=n(4702),i=n(20),s=n(5953),l=n(8428),o=n(8502);function c(e){const{labelExpressionToAdd:t="",structuredMetadataToAdd:n="",fieldExpressionToAdd:r="",parser:a}=e;switch(a){case"structuredMetadata":return`{${i.S1}${t}} ${n} ${i.qZ} ${i.S6} ${i.sC} ${i.rl} ${r} ${i.Oc}`;case"json":return`{${i.S1}${t}} ${n} ${i.qZ} ${i.S6} ${i.sC} ${i.rl} ${i.VL} ${r} ${i.Oc}`;case"logfmt":return`{${i.S1}${t}} ${n} ${i.qZ} ${i.S6} ${i.sC} ${i.rl} ${i.mF} ${r} ${i.Oc}`;default:return`{${i.S1}${t}} ${n} ${i.qZ} ${i.S6} ${i.sC} ${i.rl} ${i.YN} ${r} ${i.Oc}`}}function u(e){const t=r.jh.lookupVariable(i.uw,e);if(!(t instanceof r.yP))throw new Error("VAR_PATTERNS not found");return t}function d(e){return x(i.MB,e)}function p(e){return x(i.fi,e)}function g(e){return x(i._P,e)}function h(e){return x(i.sL,e)}function f(e){return x(i.mB,e)}function v(e){return x(i._Y,e)}function m(e){const t=r.jh.lookupVariable(i.WM,e);if(!(t instanceof r.H9))throw new Error("VAR_LINE_FILTER not found");return t}function b(e){const t=r.jh.lookupVariable(i.Jg,e);if(!(t instanceof a.m))throw new Error("VAR_LABEL_GROUP_BY not found");return t}function y(e){const t=r.jh.lookupVariable(i.Wi,e);if(!(t instanceof a.m))throw new Error("SERVICE_LABEL_VAR not found");return t}function S(e){const t=r.jh.lookupVariable(i.LI,e);if(!(t instanceof a.m))throw new Error("VAR_FIELD_GROUP_BY not found");return t}function w(e){const t=r.jh.lookupVariable(i.EY,e);if(!(t instanceof r.mI))throw new Error("VAR_DATASOURCE not found");return t}function O(e){const t=r.jh.lookupVariable(i.NW,e);if(!(t instanceof r.H9))throw new Error("VAR_LINE_FILTERS not found");return t}function x(e,t){const n=r.jh.lookupVariable(e,t);if(!(n instanceof r.H9))throw new Error(`Could not get AdHocFiltersVariable ${e}. Variable not found.`);return n}function E(e){const t=r.jh.lookupVariable(i.Du,e);if(!(t instanceof a.m))throw new Error("VAR_PRIMARY_LABEL_SEARCH not found");return t}function C(e){E(e).setState({value:".+",label:""})}function P(e){const t=r.jh.lookupVariable(i.Gb,e);if(!(t instanceof r.H9))throw new Error("VAR_PRIMARY_LABEL not found");return t}function k(e,t){P(t).setState({filters:[{value:".+",operator:"=~",key:e}]})}function j(e){return`var-${e}`}function F(e,t=i.mB){if((0,o.OH)(e))return{value:e.value,parser:"structuredMetadata"};try{const t=(0,i.zE)(e.value)?(0,i.Dx)(e.value):e.value,n=(0,l.fS)(JSON.parse(t));if(!1!==n)return n;throw new l.QX("getValueFromFieldsFilter: invalid filter value!")}catch(n){if(n instanceof l.QX?s.v.error(n,{msg:`getValueFromFieldsFilter: Failed to validate ${t}`,value:e.value}):s.v.error(n,{msg:`getValueFromFieldsFilter: Failed to parse ${t}`,value:e.value}),e.value)return{value:e.value,parser:"mixed"};throw n}}function L(e,t){return e===i.mB&&t?F(t):{value:null==t?void 0:t.value}}function _(e){return function(e){const t=e.filters.filter((e=>e.key===i.OX)).map((e=>e.value));if(!t)throw new Error("Service present in filters selected");return t[0]}(d(e).state)}function T(e){return w(e).getValue()}},5548:(e,t,n)=>{n.d(t,{Ht:()=>g,mE:()=>d,rA:()=>p});var r=n(9736),a=n(4702),i=n(20),s=n(2661),l=n(9683),o=n(6854),c=n(4532),u=n(708);function d(e){const t=r.jh.getVariables(e);let n=[];for(const e of t.state.variables)e instanceof r.H9&&e.state.filters.length&&n.push(e),e instanceof a.m&&e.state.value&&"logsFormat"!==e.state.name&&n.push(e);return n}function p(e){const t=r.jh.getAncestor(e,s.P);t.setState({patterns:[]});d(t).forEach((e=>{if(e instanceof r.H9&&"adhoc_service_filter"===e.state.key){let{labelName:t}=(0,l.W6)();t===i.ky&&(t=i.OX),e.setState({filters:e.state.filters.filter((e=>e.key===t))})}else e instanceof r.H9?e.setState({filters:[]}):e instanceof a.m&&e.setState({value:"",text:""})}))}const g=function(e){const t=e.state._wip;if(t&&e.state.filters.some((e=>e.key===t.key&&e.operator===o.w7.Equal)))return c._i;const n=e.state.name===i.MB,r=e.state.filters.filter((e=>(0,u.BG)(e.operator))).length,a=!(null==t?void 0:t.key)&&1===r,s=(null==t?void 0:t.key)&&r<1;if(n&&(a||s))return c._i;if(null==t?void 0:t.meta){const e=t.meta.type;if("float"===e||"bytes"===e||"duration"===e)return c.hI}return c.II}}}]);
//# sourceMappingURL=386.js.map?_cache=46b2efad8f9b648bc3ff